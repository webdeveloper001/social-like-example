!function(){"use strict";angular.module("app").config(["$stateProvider","$urlRouterProvider",function(e,n){$([{name:"queries",parent:"admin",url:"/queries",templateUrl:"app/admin/Partials/queries.html",controller:"queries as vm"},{name:"views",parent:"admin",url:"/views",templateUrl:"app/admin/Partials/views.html",controller:"views as vm"},{name:"flags",parent:"admin",url:"/flags",templateUrl:"app/admin/Partials/flags.html",controller:"flags as vm"},{name:"addRank",parent:"admin",url:"/addRank",templateUrl:"app/admin/Partials/addRank.html",controller:"addRank as vm"},{name:"dbMaint",parent:"admin",url:"/dbMaint",templateUrl:"app/admin/Partials/dbMaint.html",controller:"dbMaint as vm"},{name:"mergeAnswers",parent:"admin",url:"/mergeAnswers",templateUrl:"app/admin/Partials/mergeAnswers.html",controller:"mergeAnswers as vm"},{name:"dbQuery",parent:"admin",url:"/dbQuery",templateUrl:"app/admin/Partials/dbQuery.html",controller:"dbQuery as vm"},{name:"imagesmod",parent:"admin",url:"/imagemod",templateUrl:"app/admin/Partials/imagesmod.html",controller:"imagesmod as vm"},{name:"staticpagesconsole",parent:"admin",url:"/staticpagesconsole",templateUrl:"app/admin/Partials/staticpagesconsole.html",controller:"staticpagesconsole as vm"},{name:"answerimages",parent:"admin",url:"/answerimages",templateUrl:"app/admin/Partials/answerimages.html",controller:"answerimages as vm"},{name:"sitemap",parent:"admin",url:"/sitemap",templateUrl:"app/admin/Partials/sitemap.html",controller:"sitemap as vm"},{name:"locations",parent:"admin",url:"/locations",templateUrl:"app/admin/Partials/locations.html",controller:"locations as vm"},{name:"updateHeaders",parent:"admin",url:"/updateHeaders",templateUrl:"app/admin/Partials/updateHeaders.html",controller:"updateHeaders as vm"},{name:"foodRanks",parent:"admin",url:"/foodRanks",templateUrl:"app/admin/Partials/foodRanks.html",controller:"foodRanks as vm"},{name:"sibLocs",parent:"admin",url:"/sibLocs",templateUrl:"app/admin/Partials/sibLocs.html",controller:"sibLocs as vm"},{name:"payment",parent:"admin",url:"/payment",templateUrl:"app/admin/Partials/payment.html",controller:"payment as vm"},{name:"plan",parent:"admin",url:"/plan",templateUrl:"app/admin/Partials/plan.html",controller:"plan as vm"},{name:"bizadmin",parent:"admin",url:"/bizadmin",templateUrl:"app/admin/Partials/bizadmin.html",controller:"bizadmin as vm"},{name:"cleandb",parent:"admin",url:"/cleandb",templateUrl:"app/admin/Partials/cleandb.html",controller:"cleandb as vm",resolve:{load:["$ocLazyLoad",function(e){return e.load({rerun:!0,files:["scripts/vendor3.js"]})}]}},{name:"rodconsole",url:"/rodconsole",parent:"layout",templateUrl:"app/admin/Partials/rodconsole.html",controller:"rodconsole as vm"}]).each(function(){e.state(this)})}])}(),function(){"use strict";function e(e,n,t){this.title="views",this.content=n.content,console.log("views page Loaded!")}angular.module("app").controller("views",e),e.$inject=["$location","$rootScope","$state"]}(),function(){"use strict";function e(e,n,t,a,s,o){var i=this;i.title="updateHeaders",i.refresh=function(){if(!r){r=!0;var e="",t=[],a=[];i.res=[];for(var o=!0,c="",l="",d=0;d<n.cblocks.length;d++){c="",l="",o=!0,a=[];for(var u=0;u<n.headlines.length;u++)if(n.cblocks[d].type==n.headlines[u].type){"city"==n.cblocks[d].scope&&(e=n.headlines[u].filter+" isMP"),"rx"==n.cblocks[d].scope&&(e=n.headlines[u].filter),"nh"==n.cblocks[d].scope&&(e=n.headlines[u].filter+" "+n.cblocks[d].scopename),t=e.split(" ");break}for(var g="",f=0;f<n.content.length;f++){g=n.content[f].tags+" "+n.content[f].title,o=!0;for(var m=0;m<t.length;m++){var p=t[m].charAt(0).toUpperCase()+t[m].slice(1),h=t[m].charAt(0).toLowerCase()+t[m].slice(1);o=o&&(g.indexOf(t[m])>-1||g.indexOf(t[m].toUpperCase())>-1||g.indexOf(p)>-1||g.indexOf(h)>-1)}o&&a.push(n.content[f].id)}!function(e){for(var n,t,a=e.length;0!==a;)t=Math.floor(Math.random()*a),n=e[a-=1],e[a]=e[t],e[t]=n}(a);for(var w=0;w<a.length;w++)c=c+":"+a[w];l=c.substring(1),s.update(n.cblocks[d].id,["catstr"],[l])}}},i.createCBlocksRecsCity=function(){if(!c){for(var e=["rankofweek","city","lifestyle","food","politics","services","social","beauty","sports","personalities","technology","dating","health"],n={},t=0;t<e.length;t++)(n={}).scope="city",n.ismp=!0,n.scopename="San Diego",n.catstr="0",n.type=e[t],s.addcblock(n);c=!0}},i.createCBlocksRecsNh=function(){if(!d){for(var e=["rankofweeknh","neighborhood","lifestyle","food","services","social","beauty","health"],n={},t=0;t<l.length;t++)for(var a=0;a<e.length;a++)(n={}).scope="nh",n.ismp=!1,n.scopename=l[t],n.catstr="0",n.type=e[a],s.addcblock(n);d=!0}},i.createCBlocksRecsRankX=function(){if(!u){for(var e=["rxfeedback","rxsuggestion"],n={},t=0;t<e.length;t++)(n={}).scope="rx",n.scopename="RankX",n.ismp=!1,n.catstr="0",n.type=e[t],s.addcblock(n);u=!0}},i.deleteCBlocks=function(){for(var e=0;e<n.cblocks.length;e++)s.deleteRec(n.cblocks[e].id)},i.catStrings=function(){for(var e=!1,t=[],a=0;a<n.content.length;a++)n.content[a].title.indexOf("in Hillcrest")>-1&&t.push(n.content[a]);for(var s=0;s<t.length;s++){for(var i="",r="",c=t[s].title.replace("Hillcrest","San Diego"),l=0;l<n.content.length;l++)if(c==n.content[l].title){if((null==n.content[l].catstr||void 0==n.content[l].catstr||0==n.content[l].catstr.length)&&473!=(g=n.content[l].id)&&3125!=g&&6949!=g&&7424!=g&&7675!=g&&3124!=g&&3163!=g&&3202!=g){console.log("Found gen rank --- ",n.content[l].title," ",n.content[l].id);for(var d=n.content[l].title.replace("San Diego",""),u=0;u<n.content.length;u++)n.content[u].title.indexOf(d)>-1&&u!=l&&(i=i+":"+n.content[u].id);r=i.substring(1),console.log("final catstr ---",r),o.update(n.content[l].id,["isatomic","catstr"],[!1,r])}break}for(i="",r="",c=t[s].title.replace("Hillcrest","Downtown"),l=0;l<n.content.length;l++)if(c==n.content[l].title){if(null==n.content[l].catstr||void 0==n.content[l].catstr||0==n.content[l].catstr.length){var g=n.content[l].id;if(473!=g&&3125!=g&&6949!=g&&7424!=g&&7675!=g&&3124!=g&&3163!=g&&3202!=g){console.log("Found gen rank --- ",n.content[l].title," ",n.content[l].id);for(var d=n.content[l].title.replace("Downtown",""),u=0;u<n.content.length;u++)if(n.content[u].title.indexOf(d)>-1&&u!=l){for(e=!1,a=0;a<n.districts.length;a++)n.content[u].title.includes(n.districts[a])&&(e=!0);e&&(i=i+":"+n.content[u].id)}r=i.substring(1),console.log("final catstr ---",r),o.update(n.content[l].id,["isatomic","catstr"],[!1,r])}}break}}},i.isAdmin=n.isAdmin;var r=!1;console.log("updateHeaders page Loaded!");var c=!1,l=n.nhs,d=!1,u=!1}angular.module("app").controller("updateHeaders",e),e.$inject=["$location","$rootScope","$state","headline","cblock","table"]}(),function(){"use strict";function e(e,n,t,a,s){function o(){r.mode="ranks",r.rankopts=[];for(var n=0;n<e.content.length;n++)r.rankopts.push(e.content[n].title)}function i(){r.inprogress=!0;"answers"==r.mode&&(r.cpct=l/e.answers.length*100,"answer"+e.answers[l].id+".html",n.createPageAnswer(e.answers[l]),l++,s(function(){i()},400))}var r=this;r.title="staticpagesconsole",r.dataready=!1,r.inprogress=!1;var c=[];r.rankopts=[];var l=0;r.selRanks=o,r.selAnswers=function(){r.mode="answers",r.rankopts=[];for(var n=0;n<e.answers.length;n++)r.rankopts.push(e.answers[n].name)},r.getPage=function(){var t="";if("ranks"==r.mode)for(a=0;a<e.content.length;a++)e.content[a].title==r.query&&(t="rank"+e.content[a].id+".html");if("answers"==r.mode)for(var a=0;a<e.answers.length;a++)e.answers[a].name==r.query&&(t="answer"+e.answers[a].id+".html");var s={},o="";s.filename=t,n.getPageContent(s).then(function(e){o=(o=e.data).replace(/>/g,">&&&"),r.pagecontent=o.split("&&&")})},r.recreatePage=function(){if("ranks"==r.mode)for(a=0;a<e.content.length;a++)e.content[a].title==r.query&&n.createPageRank(e.content[a]).then(function(){t.notificationSuccess("Success","File recreated successfully")});if("answers"==r.mode)for(var a=0;a<e.answers.length;a++)e.answers[a].name==r.query&&n.createPageRank(e.answers[a]).then(function(){t.notificationSuccess("Success","File recreated successfully")})},r.forceScrape=function(){var n="";if("ranks"==r.mode)for(s=0;s<e.content.length;s++)e.content[s].title==r.query&&(n="rank"+e.content[s].id+".html",o=a+n,FB.api("https://graph.facebook.com/","post",{id:[o],scrape:!0},function(e){t.notificationSuccess("Success","File scrapped successfully - "+e)}));if("answers"==r.mode)for(var s=0;s<e.answers.length;s++)if(e.answers[s].name==r.query){n="answer"+e.answers[s].id+".html";var o=a+n;FB.api("https://graph.facebook.com/","post",{id:[o],scrape:!0},function(e){t.notificationSuccess("Success","File scrapped successfully - "+e)})}},r.recreateAll=i,r.scrapeAll=function(){},r.share=function(n){if("ranks"==r.mode)for(o=0;o<e.content.length;o++)if(e.content[o].title==r.query){var t="rank"+e.content[o].id+".html",s=a+t;FB.ui({method:"feed",link:s,caption:"An example caption"},function(e){})}if("answers"==r.mode)for(var o=0;o<e.answers.length;o++)if(e.answers[o].name==r.query){var t="answer"+e.answers[o].id+".html",s=a+t;FB.ui({method:"feed",link:s,caption:"An example caption"},function(e){})}},r.pagecontent="",o(),n.getFileList().then(function(e){c=e.data,r.dataready=!1,console.log("static pages list ready")}),e.DEBUG_MODE&&console.log("staticpagesconsole page Loaded!")}angular.module("app").controller("staticpagesconsole",e),e.$inject=["$rootScope","staticpages","dialog","SERVER_URL","$timeout"]}(),function(){"use strict";function e(e,n,t,a,s){var o=this;o.title="sitemap",o.createSitemap=function(){i="",e.content.forEach(function(e){2==e.scope&&1==e.ismp&&null!=e.slug&&(i+="<url><loc>https://rank-x.com/rankSummary/"+e.slug+"</loc></url>")}),i=i.replace(/\/url>/g,"/url>&&&"),o.sitemap=i.split("&&&")};var i="";o.sitemap="",console.log("sitemap console loaded")}angular.module("app").controller("sitemap",e),e.$inject=["$rootScope","staticpages","dialog","SERVER_URL","$timeout"]}(),function(){"use strict";function e(e,n,t,a,s,o,i){function r(){var e=0;if(l.answer.ansLocs){l.locations=[];for(var t=0;t<l.answer.ansLocs.length;t++)e=n.answers.map(function(e){return e.id}).indexOf(l.answer.ansLocs[t]),l.locations.push(n.answers[e])}}function c(){var e=l.answer.ansLocs,n="";e.push(l.answer.id),console.log("bros - ",e);for(var t=0;t<e.length;t++){n="";for(var a=0;a<e.length;a++)t!=a&&(n=n+":"+e[a]);n=n.substring(1),i.updateAnswer(e[t],["family"],[n]),console.log("updated answer ",e[t]," brothers: ",n)}l.answer=void 0,l.locations=void 0,l.brothername="",l.answername=""}var l=this;l.title="sibLocs",l.selAns=function(){for(var e=0;e<n.answers.length;e++)l.answername==n.answers[e].name&&(l.answer=n.answers[e]);l.answer.ansLocs=[],l.locations=[],l.answer&&l.answer.family&&(l.answer.ansLocs=l.answer.family.split(":").map(Number)),r(l.answer)},l.addBrother=function(){for(var e=0;e<n.answers.length;e++)if(l.brothername==n.answers[e].name){for(var t=!1,a=0;a<l.answer.ansLocs.length;a++)if(l.answer.ansLocs[a]==n.answers[e].id){t=!0,console.log("flag repeated");break}n.answers[e].id==l.answer.id&&(console.log("flag2"),t=!0),t||(console.log("Added brother"),l.answer.ansLocs.push(n.answers[e].id))}console.log("@ addBrother ---\x3e vm.answer.ansLocs",l.answer.ansLocs),console.log("@ addBrother ---\x3e vm.answer",l.answer),r(),l.brothername=""},l.remAns=function(e){for(var n=0;n<l.locations.length;n++)l.locations[n].id==e.id&&(l.locations.splice(n,1),l.answer.ansLocs.splice(n,1));r(),console.log("vm.answer ",l.answer)},l.confirm=function(){o.confirmSiblings(l.answer,c)},function(){console.log("query Answer"),l.ansOpts=[];for(var e=0;e<n.answers.length;e++)l.ansOpts.push(n.answers[e].name)}(),console.log("sibLocs page Loaded!")}angular.module("app").controller("sibLocs",e),e.$inject=["$location","$rootScope","$state","catans","$http","dialog","answer"]}(),function(){"use strict";function e(e,n,t,a,s,o,i,r,c,l,d){function u(){p=[],a.getall().then(function(e){(p=e).forEach(function(e){if(e.datenum=o.date2number(e.date),e.category){var t=n.categories.map(function(e){return e.id}).indexOf(e.category);t>-1&&(e.title=n.categories[t].category.replace("@Nh","San Diego"),e.fimage=n.categories[t].fimage,e.introtext||null!=n.categories[t].introtext&&void 0!=n.categories[t].introtext&&""!=n.categories[t].introtext&&(e.introtext=n.categories[t].introtext),e.fc=n.categories[t].fc,e.bc=n.categories[t].bc,e.shade=n.categories[t].shade),void 0!=e.fimage&&""!=e.fimage?e.imageok=!0:e.imageok=!1,void 0!=e.introtext&&""!=e.introtext?e.textok=!0:e.textok=!1}}),m.dataReady=!0,m.rods=p}),m.addopts=[];for(var e=0;e<n.categories.length;e++)m.addopts.push(n.categories[e].category)}function g(){m.overview=!0,m.detail=!1}function f(){w?(m.rank.fimage=n.blobimage,m.rank.image1=m.rank.fimage):(m.rank.fimage=n.blobimage,m.rank.image3=m.rank.image2,m.rank.image2=m.rank.image1,m.rank.image1=m.rank.fimage),n.cmd1exe=!1}var m=this;m.title="rodconsole",m.selRank=function(e){m.overview=!1,m.detail=!0,m.addval="",m.rank=e,void 0!=m.rank.fimage&&""!=m.rank.fimage&&(m.rank.image3=m.rank.image2,m.rank.image2=m.rank.image1,m.rank.image1=m.rank.fimage),console.log("selRank",m.rank),console.log(m.rank.bc),null!=m.rank.bc?(v="h"!=m.rank.bc.charAt(0)?m.rank.bc:s.hsl2rgb(m.rank.bc),m.rank.bc2=s.shadeColor(v,m.rank.shade/10)):(m.rank.bc="hsl(240, 100%, 99%)",m.rank.bc2=s.shadeColor(m.rank.bc,-.3)),n.cmd1exe=!1},m.goBack=g,m.plusShade=function(){m.rank.shade=m.rank.shade+1,m.rank.shade>10&&(m.rank.shade=10),v=s.hsl2rgb(m.rank.bc),m.rank.bc2=s.shadeColor(v,m.rank.shade/10)},m.minusShade=function(){m.rank.shade=m.rank.shade-1,m.rank.shade<-10&&(m.rank.shade=-10),v=s.hsl2rgb(m.rank.bc),m.rank.bc2=s.shadeColor(v,m.rank.shade/10)},m.refreshImages=f,m.filterData=function(e){if("all"==e&&(m.next20IsSelected=!1,m.allIsSelected=!0),"next20"==e&&(m.next20IsSelected=!0,m.allIsSelected=!1),m.rods=[],m.next20IsSelected)for(var n=0;n<p.length;n++)p[n].datenum>=h&&m.rods.push(p[n]);else m.rods=p},m.goSaveImage=function(){if(void 0!=m.rank.fimage&&""!=m.rank.fimage){var e=["fimage","bc","fc","shade"];"h"==m.rank.bc.charAt(0)&&(m.rank.bc=s.hsl2rgb(m.rank.bc)),"h"==m.rank.fc.charAt(0)&&(m.rank.fc=s.hsl2rgb(m.rank.fc));var t=[m.rank.fimage,m.rank.bc,m.rank.fc,m.rank.shade],a="",o=[];if(m.rank.isatomic)console.log("rank:",m.rank.title),c.update(m.rank.rankid,e,t).then(function(){i.getDialog("rodimageuploadsuccess"),loadData(),g()});else{m.dataReady=!1,m.loadText="Saving data...",a=m.rank.title.replace(" in San Diego","");for(var l=0;l<n.content.length;l++)n.content[l].title.indexOf(a)>-1&&o.push(c.update(n.content[l].id,e,t));r.all(o).then(function(){m.dataReady=!0,i.getDialog("rodimageuploadsuccess"),loadData(),g()})}}else i.getDialog("nouploadedimage")},m.goSaveText=function(){d.update(m.rank.category,["introtext"],[m.rank.introtext]).then(function(){i.getDialog("introTextSaved"),u()});var e=m.rank.introtext;a.update(m.rank.id,["introtext"],[""]).then(function(){}),""==m.rank.introtext&&(m.rank.introtext=e)},m.goDeleteImage=function(){if(void 0!=m.rank.fimage&&""!=m.rank.fimage){l.deleteBlob(m.rank.fimage);var e=n.content.map(function(e){return e.id}).indexOf(m.rank.rankid),t=s.defaultRankColor(n.content[e]),a=["fimage","bc","fc","shade"],o=["",t[0],t[1],0],d="",u=[];if(m.rank.isatomic)c.update(m.rank.rankid,a,o).then(function(){i.getDialog("rodimagedeletesuccess"),loadData(),g()});else{m.dataReady=!1,m.loadText="Deleting image...",d=m.rank.title.replace(" in San Diego","");for(var f=0;f<n.content.length;f++)n.content[f].title.indexOf(d)>-1&&u.push(c.update(n.content[f].id,a,o));r.all(u).then(function(){m.dataReady=!0,i.getDialog("rodimagedeletesuccess"),loadData(),g()})}}else i.getDialog("nouploadedimage")},m.addCategory=function(){for(var e=0;e<n.categories.length;e++)m.addval==n.categories[e].category&&(console.log(m.rank.id,m.addval),a.update(m.rank.id,["category"],[n.categories[e].id]))},m.dataReady=!1;var p=[],h=0;m.overview=!0,m.detail=!1,m.rank={},m.sm=n.sm,m.allIsSelected=!0,m.next20IsSelected=!1,m.loadText="Loading data...";var w=!1;n.canswer={},n.canswer.id="featuredImages",m.testimage=n.EMPTY_IMAGE;var v="";n.$on("fileUploaded",function(e,a){n.cmd1exe=!!n.cmd1exe&&n.cmd1exe,"rodconsole"!=t.current.name||n.cmd1exe||(n.cmd1exe=!0,n.blobimage=a,f())}),i.enterPassword(function(){function e(e){return e}var t=new Date,a=t.getTimezoneOffset();t.setMinutes(t.getMinutes()-a);var s=e(t.getMonth()+1)+"/"+e(t.getDate())+"/"+t.getFullYear();h=o.date2number(s),u(),n.DEBUG_MODE&&console.log("rodconsole page Loaded!")},function(){n.$emit("backToResults")})}angular.module("app").controller("rodconsole",e),e.$inject=["$location","$rootScope","$state","rankofday","color","datetime","dialog","$q","table","imagelist","categories"]}(),function(){"use strict";function e(e,n,t,a){var s=this;s.title="queries",s.clearDb=function(){for(var e=0;e<s.queries.length;e++)a.deleteRec(s.queries[e].id)},s.isAdmin=n.isAdmin,a.getQueries().then(function(e){s.queries=e,console.log("Queries Loaded!")})}angular.module("app").controller("queries",e),e.$inject=["$location","$rootScope","$state","query"]}(),function(){"use strict";function e(e,n,t,a,s,o,i,r,c,l,d,u,g){function f(e,n){m.isSaving=!0,u.setCodePrice(e,n).then(function(n){m.isSaving=!1,"Custom Rank"==e.code?(m.notifications.push({message:"Custom Rank Price $ "+n.data.plan.amount/100+" has changed successfully",type:"success"}),e.price=n.data.plan.amount/100):(m.notifications.push({message:"Premium Plan "+e.code+" Price $ "+n.data.plan.amount/100+" has changed successfully",type:"success"}),e.price=n.data.plan.amount/100)}).catch(function(e){m.notifications.push({message:e.data.err.message,type:"error"})})}var m=this;m.title="plan",m.dataReady=!1,m.changeCodePrice=function(e){o.changeCodePriceDlg(e,f)},m.customranking={},m.notifications=[],m.isAdmin=n.isAdmin,m.isSaving=!1,i.all([d.get(),u.getSetting()]).then(function(e){m.codeprices=e[0],m.STRIPE_COMMISSION_PERCENTAGE=e[1].STRIPE_COMMISSION_PERCENTAGE,m.CUSTOM_RANK_PRICE=e[1].CUSTOM_RANK_PRICE,m.customranking={code:"Custom Rank",price:m.CUSTOM_RANK_PRICE},m.codeprices.push(m.customranking),m.dataReady=!0,console.log("Plan admin page Loaded!")})}angular.module("app").controller("plan",e),e.$inject=["$location","$rootScope","$state","$stateParams","table","dialog","$q","useraccnt","promoter","answer","codeprice","setting","$timeout"]}(),function(){"use strict";function e(e,n,t,a,s,o,i,r,c,l,d,u,g){function f(e){u.setSetting({STRIPE_COMMISSION_PERCENTAGE:parseInt(e)/100}).then(function(e){m.STRIPE_COMMISSION_PERCENTAGE=e.STRIPE_COMMISSION_PERCENTAGE})}var m=this;m.title="payment",m.dataReady=!1,m.promoters=[],m.isAdmin=n.isAdmin,m.detailview=!1,m.overview=!0,m.notifications=[],m.selectedPromoters=[],m.payPromoter=function(e){e.stripeid?r.payPromoter(e,m.STRIPE_COMMISSION_PERCENTAGE).then(function(n){m.notifications.push({message:"$"+e.balance*m.STRIPE_COMMISSION_PERCENTAGE+"transfered successfully to Promoter: "+e.firstname+" "+e.lastname,type:"success"}),e.lastPaymentDate=n.data.lastPaymentDate,e.payedThisMonth=!0}).catch(function(n){m.notifications.push({message:"$"+e.balance*m.STRIPE_COMMISSION_PERCENTAGE+"  to Promoter: "+e.firstname+" "+e.lastname+" transfer failed. ",type:"error"})}):window.alert("The promoter"+e.firstname+" "+e.lastname+" need to connect stipe account.")},m.gotoanswer=function(e){t.go("answerDetail",{index:e.slug})},m.goBack=function(){if(1==m.detailview)return m.overview=!0,void(m.detailview=!1)},m.goDetailView=function(e){m.currentPromoter=e,m.detailview=!0,m.overview=!1},m.showBusinessDetail=function(e){o.showBusinessDetailDlg(e,m.STRIPE_COMMISSION_PERCENTAGE,m.CUSTOM_RANK_PRICE)},m.addOrRemovePromoter=function(e){-1!=m.selectedPromoters.indexOf(e)?m.selectedPromoters.splice(m.selectedPromoters.indexOf(e),1):m.selectedPromoters.push(e)},m.paySelectedPromoters=function(){m.selectedPromoters.forEach(function(e){m.payPromoter(e)})},m.changeCommission=function(){o.changeCommissionDlg(m.STRIPE_COMMISSION_PERCENTAGE,f)},i.all([c.getall(),r.getallaccnts(),d.get(),u.getSetting()]).then(function(e){var t=e[1],a=e[2];m.STRIPE_COMMISSION_PERCENTAGE=e[3].STRIPE_COMMISSION_PERCENTAGE?e[3].STRIPE_COMMISSION_PERCENTAGE:.2,m.CUSTOM_RANK_PRICE=e[3].CUSTOM_RANK_PRICE,e[0].forEach(function(e){var s=angular.copy(e);s.businesses=[];for(var o=0;o<t.length;o++)if(t[o].promocode==e.code){var i=angular.copy(t[o]);"Basic"==i.status&&(i.style="background-color:#bfbfbf"),i.istrial?(i.status="On Trial "+Math.ceil(moment.duration(moment(i.discountEndDate)-moment()).asDays())+" Days left",i.style="background-color:#b3b300"):(i.status="Active",i.style="background-color:#009900");for(var r=0;r<a.length;r++)if(a[r].code==i.bizcat){i.price=a[r].price;break}i.totalCommission=0,i.ispremium&&(i.totalCommission+=i.price*m.STRIPE_COMMISSION_PERCENTAGE),i.hasranks&&(i.totalCommission+=i.ranksqty*m.CUSTOM_RANK_PRICE*m.STRIPE_COMMISSION_PERCENTAGE),s.businesses.push(i),function(e){l.getAnswer(e.answer).then(function(n){e.answerObj=n})}(s.businesses[s.businesses.length-1])}for(s.payedThisMonth=!0,s.lastPaymentDate||(s.payedThisMonth=!1),(moment(s.lastPaymentDate).year()==moment(n.setting.serverDate).year()&&moment(s.lastPaymentDate).month()<moment(n.setting.serverDate).month()||moment(s.lastPaymentDate).year()<moment(n.setting.serverDate).year())&&(s.payedThisMonth=!1),s.balance=0,o=0;o<s.businesses.length;o++)"Active"==s.businesses[o].status&&(s.balance+=s.businesses[o].monthlyCost);s.activeCount=s.businesses.filter(function(e){return"Active"==e.status}).length,s.ontrialCount=s.businesses.filter(function(e){return-1!=e.status.indexOf("On Trial")}).length,m.promoters.push(s)}),m.dataReady=!0}),console.log("payment admin page Loaded!")}angular.module("app").controller("payment",e),e.$inject=["$location","$rootScope","$state","$stateParams","table","dialog","$q","useraccnt","promoter","answer","codeprice","setting","$timeout"]}(),function(){"use strict";function e(e,n,t,a,s,o,i){function r(){console.log("@getData"),console.log("$rootScope.catansrecs.length ",n.catansrecs.length),l.idx=d;var e={},t={},a=0,s=0;l.ans1=n.dupAns[d].ans1,l.ans2=n.dupAns[d].ans2,c(),l.ans1.catans=[],a=l.ans1.id;for(o=0;o<n.catansrecs.length;o++)if(a==n.catansrecs[o].answer){e=n.catansrecs[o];for(i=0;i<n.content.length;i++)n.catansrecs[o].category==n.content[i].id&&(e.rank=n.content[i].title);l.ans1.catans.push(e)}l.ans2.catans=[],s=l.ans2.id;for(var o=0;o<n.catansrecs.length;o++)if(s==n.catansrecs[o].answer){t=n.catansrecs[o];for(var i=0;i<n.content.length;i++)n.catansrecs[o].category==n.content[i].id&&(t.rank=n.content[i].title);l.ans2.catans.push(t)}console.log("vm.ans1.catans.length ",l.ans1.catans.length),console.log("vm.ans2.catans.length ",l.ans2.catans.length)}function c(){u=[];for(var e="",t=0;t<n.content.length;t++)n.content[t].title.indexOf("in Hillcrest")>-1&&(e=n.content[t].title.replace("Hillcrest","@neighborhood"),u.push(e)),n.content[t].ismp&&u.push(n.content[t].title)}var l=this;l.title="mergeAnswers";var d=0;l.goPrev=function(e){(d-=e)<0&&(d=0),r()},l.goNext=function(e){(d+=e)>=l.tot&&(d=l.tot),r()},l.delAnswer=function(e){1==e&&(o.deleteAnswer(n.dupAns[d].ans1.id),a.deleteAnswer(n.dupAns[d].ans1.id)),2==e&&(o.deleteAnswer(n.dupAns[d].ans2.id),a.deleteAnswer(n.dupAns[d].ans2.id))},l.addCatans=function(e){if(1==e){l.addcts1opts=[];for(var n="",t=0;t<u.length;t++)u[t].indexOf("@neighborhood")>-1?(n=u[t].replace("@neighborhood",l.ans1.cityarea),l.addcts1opts.push(n)):l.addcts1opts.push(u[t]);l.addcts1active=!0}if(2==e){l.addcts2opts=[];for(var a="",t=0;t<u.length;t++)u[t].indexOf("@neighborhood")>-1?(a=u[t].replace("@neighborhood",l.ans2.cityarea),l.addcts2opts.push(a)):l.addcts2opts.push(u[t]);l.addcts2active=!0}},l.addcts=function(e){var t="",s={},o=0;1==e&&(t=l.addcts1val,s=l.ans1,void 0!=l.cat1isdup&&l.cat1isdup),2==e&&(t=l.addcts2val,s=l.ans2,void 0!=l.cat2isdup&&l.cat2isdup);for(var i=0;i<n.content.length;i++)if(n.content[i].title==t){o=n.content[i].id;break}a.postRec2(s.id,o),1==e&&(l.addcts1active=!1),2==e&&(l.addcts2active=!1),setTimeout(function(){r()},1e3)},l.delCatans=function(e){a.deleteRec(e.answer,e.category),setTimeout(function(){r()},1e3)},l.editAnswer=function(e){1==e&&t.go("editAnswer",{index:l.ans1.id}),2==e&&t.go("editAnswer",{index:l.ans2.id})},l.addcts1active=!1,l.addcts2active=!1;var u=[];l.tot=n.dupAns.length-1,c(),r(),console.log("mergeAnswers page Loaded!")}angular.module("app").controller("mergeAnswers",e),e.$inject=["$location","$rootScope","$state","catans","$http","answer","$stateParams"]}(),function(){"use strict";function e(e,n,t,a,s,o){function i(){r.locs=[];var n={},t=[];r.locations=e.locations.slice(1),r.locations.forEach(function(a){t=a.sub_areas.split(",").map(Number),a.sa=[],t.forEach(function(t){var s=e.locations.map(function(e){return e.id}).indexOf(t);s>-1&&((n={}).id=t,n.name=e.locations[s].nh_name,n.sel=!0,a.sa.push(n))}),a.sel=!1,r.locs.push(a.nh_name)})}var r=this;r.title="locations",r.getLocations=i,r.update=function(){var n="";r.locations.forEach(function(e){n+=","+e.id}),n=n.substring(1),console.log("str - ",n);var t=e.locations.map(function(e){return e.nh_name}).indexOf("San Diego");o.update(e.locations[t].id,["sub_areas"],[n])},r.enableAddLocation=function(){r.showAddLocation=!0},r.addLocation=function(){var n={};n.nh_name=r.locname,n.cityid=e.locations[0].cityid,n.cityname=e.locations[0].cityname,n.sub_areas="",o.addLocation(n).then(function(){r.showAddLocation=!1,i()})},r.editLocation=function(e){r.locations.forEach(function(e){e.sel=!1}),e.sel=!0},r.selsa=function(e){e.sel?e.sel=!1:e.sel=!0},r.addsa=function(n){var a={};a.sel=!0,a.name=r.newsa;var s=e.locations.map(function(e){return e.nh_name}).indexOf(r.newsa);s>-1?(a.id=e.locations[s].id,n.sa.push(a),r.newsa=""):t.getDialog("subAreaInvalid")},r.savesa=function(n){var t="";n.sa.forEach(function(e){e.sel&&(t+=","+e.id)}),t=t.substring(1),e.DEBUG_MODE&&console.log("str - ",t),o.update(n.id,["sub_areas"],[t]),n.sel=!1,i()},r.deleteloc=function(e){o.deleteRec(e.id).then(function(){i()})},r.cancel=function(e){e.sel=!1},r.showAddLocation=!1,r.opts=["San Diego"],r.locs=[],e.DEBUG_MODE&&console.log("locations page Loaded!")}angular.module("app").controller("locations",e),e.$inject=["$rootScope","staticpages","dialog","SERVER_URL","$timeout","locations"]}(),function(){"use strict";function e(e,n,t,a){function s(){o.uuis=e.uuis}var o=this;o.title="imagesmod",o.dataready=!1,o.removeImage=function(o){var i=e.answers.map(function(e){return e.id}).indexOf(o.answer);e.answers[i].imageurl==o.imageurl&&a.updateAnswer(e.answers[i].id,["imageurl"],[e.EMPTY_IMAGE]),t.deleteBlob(o.imageurl),n.deleteRecord(o.id).then(s)},o.approveImage=function(e){n.deleteRecord(e.id).then(s)},n.getRecords().then(function(){o.dataready=!0,s()}),e.DEBUG_MODE&&console.log("imagesmod page Loaded!")}angular.module("app").controller("imagesmod",e),e.$inject=["$rootScope","useruploadedimages","imagelist","answer"]}(),function(){"use strict";function e(e,n,t,a,s,o,i){function r(e){c.indexOf(n.answers[e].id)>-1?(o.updateAnswer(n.answers[e].id,["isfood"],[!0]),i(function(){e++,console.log(e," ",n.answers[e].name,", isfood is TRUE"),e<n.answers.length&&r(e)},100)):(o.updateAnswer(n.answers[e].id,["isfood"],[!1]),i(function(){e++,console.log(e," ",n.answers[e].name,", isfood is FALSE"),e<n.answers.length&&r(e)},100))}this.title="foodRanks";var c=[];this.getRanks=function(){console.log("getRanks");for(var e="",t=0;t<n.content.length;t++)n.content[t].tags.indexOf("food")>-1&&(e=e+":"+n.content[t].id);for(var s=e.substring(1).split(":").map(Number),o={},i=0,l=0,d=[],u=!1,g="",t=0;t<n.catansrecs.length;t++){o=n.catansrecs[t];for(var f=0;f<s.length;f++)if(o.category==s[f]){if(i=o.answer,(l=n.answers.map(function(e){return e.id}).indexOf(i))<0&&(console.log("idx - ",i,"catansrec - ",o.id,o.answer,o.category),a.deleteRec(o.answer,o.category)),u=!1,d.length>0&&l>0)for(var m=0;m<d.length;m++)if(d[m].id==n.answers[l].id){u=!0;break}u||(g=g+":"+n.answers[l].id,d.push(n.answers[l]))}}c=d.map(function(e){return e.id}),r(0),console.log("Answers Ids: - ",g.substring(1)),console.log("Food answers length: - ",d.length)},console.log("foodRanks page Loaded!")}angular.module("app").controller("foodRanks",e),e.$inject=["$location","$rootScope","$state","catans","$http","answer","$timeout"]}(),function(){"use strict";function e(e,n,t,a,s,o,i){function r(){a.getFlags().then(function(e){c.flags=e,console.log("flags - ",c.flags);for(var n=0;n<c.flags.length;n++){if("comment-rank"==c.flags[n].type||"comment-answer"==c.flags[n].type)switch(c.flags[n].flag){case 1:c.flags[n].desc="Off-Topic";break;case 2:c.flags[n].desc="Offensive";break;case 3:c.flags[n].desc="Spam"}if("answer"==c.flags[n].type)switch(c.flags[n].flag){case 1:c.flags[n].desc="Wrong Category";break;case 2:c.flags[n].desc="No longer active";break;case 3:c.flags[n].desc="Offensive";break;case 4:c.flags[n].desc="Spam"}}})}var c=this;c.title="flags",c.getFlags=r,c.gotoView=function(e){"answer"==e.type&&t.go("answerDetail",{index:e.number}),"comment-answer"==e.type&&t.go("answerDetail",{index:e.number}),"comment-rank"==e.type&&t.go("rankSummary",{index:e.number})},c.delCatans=function(e){s.deleteRec(e.answer,e.category)},c.delComment=function(e){"comment-rank"==c.data.type&&o.deletecomment(e.id),"comment-answer"==c.data.type&&i.deletecomment(e.id)},c.seeDetails=function(e){c.viewTable=!1,c.viewDetails=!0;var t={};if(c.data={},c.catans=[],c.comments=[],c.data.type=e.type,c.data.desc=e.desc,c.data.id=e.id,"answer"==e.type){r=n.answers.map(function(e){return e.id}).indexOf(e.number),c.data.imageurl=n.answers[r].imageurl,c.data.name=n.answers[r].name,c.data.location=n.answers[r].location,c.data.cityarea=n.answers[r].cityarea,c.data.phone=n.answers[r].phone,c.data.website=n.answers[r].website,c.data.addinfo=n.answers[r].addinfo;for(var a=0;a<n.catansrecs.length;a++)if(n.answers[r].id==n.catansrecs[a].answer){t={},t=n.catansrecs[a];for(var s=0;s<n.content.length;s++)n.catansrecs[a].category==n.content[s].id&&(t.rank=n.content[s].title);c.catans.push(t)}}"comment-answer"==e.type&&(r=n.answers.map(function(e){return e.id}).indexOf(e.number),c.data.imageurl=n.answers[r].imageurl,c.data.name=n.answers[r].name,c.data.location=n.answers[r].location,c.data.cityarea=n.answers[r].cityarea,c.data.phone=n.answers[r].phone,c.data.website=n.answers[r].website,c.data.addinfo=n.answers[r].addinfo,i.getcommentsbyanswer(e.number).then(function(e){c.comments=e}));if("comment-rank"==e.type){var r=n.content.map(function(e){return e.id}).indexOf(e.number);c.data.title=n.content[r].title,o.getcommentsbyrank(e.number).then(function(e){c.comments=e})}},c.seeFlags=function(){c.viewTable=!0,c.viewDetails=!1},c.deleteFlag=function(e){a.deleteFlag(e.id).then(function(){r()})},c.viewDetails=!1,c.viewTable=!0,console.log("Flags page loaded!")}angular.module("app").controller("flags",e),e.$inject=["$location","$rootScope","$state","flag","catans","comment","comment2"]}(),function(){"use strict";function e(e,n,t,a,s,o,i,r){var c=this;c.title="dbQuery",c.queryAnswer=function(){console.log("query Answer"),c.ansRes=[];for(var e=0,t={},a=0;a<n.answers.length;a++)n.answers[a].name.indexOf(c.val)>-1&&c.ansRes.push(n.answers[a]);for(var s=0;s<c.ansRes.length;s++){c.ansRes[s].catans=[],e=c.ansRes[s].id;for(var o=0;o<n.catansrecs.length;o++)if(e==n.catansrecs[o].answer){t=n.catansrecs[o];for(var i=0;i<n.content.length;i++)n.catansrecs[o].category==n.content[i].id&&(t.rankid=n.content[i].id,t.catid=n.content[i].cat,t.title=n.content[i].title);c.ansRes[s].catans.push(t)}}},c.delCatans=function(e){r.deleteRec(e.answer,e.category)},c.delAnswer=function(e){i.deleteAnswer(e.id)},c.isAdmin=n.isAdmin||n.dataAdmin,c.isDET=n.isLoggedIn&&(12==n.user.id||30==n.user.id||41==n.user.id||42==n.user.id||30==n.user.id),console.log("dbQuery page Loaded!")}angular.module("app").controller("dbQuery",e),e.$inject=["$location","$rootScope","$state","$stateParams","table","dialog","answer","catans"]}(),function(){"use strict";function e(e,n,t,a,s,o,i,r,c,l,d,u,g,f,m,p,h){function w(){var e={},t=!1;A.unrefans=[],A.addctsopts=[],A.ans=-1;for(var a=0;a<n.answers.length;a++){({}),e={},e=n.answers[a],t=!1;for(var s=0;s<n.catansrecs.length;s++)if(n.catansrecs[s].answer==e.id){t=!0;break}0==t&&A.unrefans.push(e)}if(A.unrefans.length>0)for(var o=0;o<n.content.length;o++)A.addctsopts.push(n.content[o].title)}function v(e){l.deleteAnswer(e.id).then(function(){w()})}function k(){console.log("@ Show Possible Duplicated"),console.log("answers length",n.answers.length);var e={},t={};A.dupAnswers=[];for(var a=0,s=0,o="",i=0;i<n.answers.length;i++)if(s=.75*n.answers[i].name.length,e=n.answers[i],o=n.answers[i].name.slice(0,s),"Establishment"==n.answers[i].type&&o.length>8)for(var r=0;r<n.answers.length;r++)n.answers[r].name.indexOf(o)>-1&&i!=r&&((t={}).id=a,t.add1=e.addinfo,t.nh1=e.cityarea,t.loc1=e.location,t.name1=e.name,t.image1=e.imageurl,t.id1=e.id,t.name2=n.answers[r].name,t.idx1=i,t.idx2=r,t.loc2=n.answers[r].location,t.nh2=n.answers[r].cityarea,t.add2=n.answers[r].addinfo,t.image2=n.answers[r].imageurl,t.id2=n.answers[r].id,A.dupAnswers.push(t),a++);console.log("finished")}function b(){console.log("@estDistances, need to have GPS location stored-",n.answers.length),A.ans=-1,A.answerdist=[];for(var e=.017453292519943295,t=Math.cos,a=0,s=n.currentUserLatitude,o=n.currentUserLongitude,i=0,r=0,c=0,l={},d=0;d<n.answers.length;d++)"Establishment"==n.answers[d].type&&void 0!=n.answers[d].location&&""!=n.answers[d].location&&(i=n.answers[d].lat,r=n.answers[d].lng,l=n.answers[d],a=.5-t((i-s)*e)/2+t(s*e)*t(i*e)*(1-t((r-o)*e))/2,c=12742*Math.asin(Math.sqrt(a))/1.609,l.dist=c,(c>100||NaN==c)&&A.answerdist.push(l))}function y(){var e={},t="";A.codes=[],A.catcode={},A.ans=-1;var a=m.get(),s=p.get();return o.all([a,s]).then(function(a){n.catcodes=a[0],n.codeprices=a[1];for(var s=0;s<n.codeprices.length;s++)A.codes.push(n.codeprices[s].code);console.log("Category-codes loaded..."),A.ansNoCode=[];for(var o=0;o<n.answers.length;o++)if(("Establishment"==n.answers[o].type||"PersonCust"==n.answers[o].type)&&(e={},e=n.answers[o],void 0==(t=h.getBizCat(e.id))||""==t||null==t)){e.cats=[];for(var i=0;i<n.catansrecs.length;i++)if(n.catansrecs[i].answer==e.id)for(var r=0;r<n.content.length;r++)n.content[r].id==n.catansrecs[i].category&&e.cats.push(n.content[r].title);A.ansNoCode.push(e)}})}var A=this;A.title="dbMaint",A.showUrefAns=w,A.delAnswer=v,A.selAns=function(e){A.ans=e.id},A.showPossibleDuplicated=k,A.syncToFirst=function(e){for(var t=0;t<n.catansrecs.length;t++)if(e.id2==n.catansrecs[t].answer){d.updateRec(n.catansrecs[t].id,["answer"],[e.id1]);break}l.deleteAnswer(e.id2),k()},A.syncToSecond=function(e){for(var t=0;t<n.catansrecs.length;t++)if(e.id1==n.catansrecs[t].answer){d.updateRec(n.catansrecs[t].id,["answer"],[e.id2]);break}l.deleteAnswer(e.id1),k()},A.showDuplicatedOnlyName=function(){n.dupAns=[];var e={},t={};A.dupAnsNames=[];for(var a=0;a<n.answers.length;a++){e=n.answers[a];for(var s=0;s<n.answers.length;s++)e.name==n.answers[s].name&&e.location==n.answers[s].location&&a!=s&&((t={}).ans1=e,t.ans2=n.answers[s],n.dupAns.push(t),A.dupAnsRdy=!0)}},A.showDuplicatedByLocation=function(){n.fields=n.typeSchema[6].fields;for(var e={},t={},a=[],s=0;s<n.answers.length;s++)if(void 0!=(e=n.answers[s]).location&&""!=e.location)for(var o=0;o<n.answers.length;o++)void 0!=n.answers[o].location&&""!=n.answers[o].location&&e.location==n.answers[o].location&&s!=o&&((t={}).ans1=e,t.ans2=n.answers[o],a.push(t));n.dupAns=a,console.log("@finished - showDuplicatedByLocation"),A.dupAnsRdy=!0},A.findPhoneWebsite=function(){},A.findDuplicatedRanks=function(){for(var e=[],t=0;t<n.content.length;t++)for(var a=t;a<n.content.length;a++)n.content[t].title==n.content[a].title&&t!=a&&(console.log("duplicated rank --- ",n.content[t].title),e.push(n.content[t]))},A.clearAllCatansVotes=function(){console.log("Clearing all catans vote sums to zero")},A.syncUserVotes=function(){console.log("syncUSerVotes"),u.loadAllVotes().then(function(e){n.allvotes=e,function(){console.log("syncVotes");var e={},t={},a=[],s=[],o=0,i=0;A.syncp=[];for(var r={},c=0;c<n.catansrecs.length;c++){e=n.catansrecs[c],a=[],s=[],t={};for(var l=0;l<n.allvotes.length;l++)(t=n.allvotes[l]).catans==e.id&&(1==t.vote&&a.push(t),-1==t.vote&&s.push(t));a.length==e.upV&&s.length==e.downV||(r={},o=n.answers.map(function(e){return e.id}).indexOf(e.answer),i=n.content.map(function(e){return e.id}).indexOf(e.category),r.answername=n.answers[o].name,r.categorytitle=n.content[i].title,r.answer=n.answers[o].id,r.catans=e.id,r.category=n.content[i].id,r.caUpV=e.upV,r.caDownV=e.downV,r.nUpVlen=a.length,r.nDownVlen=s.length,r.upVotes=a,r.downVotes=s,A.syncp.push(r))}}()})},A.getAnswerBizCode=y,A.updatecatans=function(e){d.updateRec(e.catans,["upV","downV"],[e.nUpVlen,e.nDownVlen])},A.estDistances=b,A.gotoAnswer=function(e){t.go("answerDetail",{index:e.id})},A.createImagesJSON=function(){for(var e=[],t={},a=1256,s=0;s<n.answers.length;s++)n.answers[s].imageurl.indexOf("http://")>-1&&((t={}).id=a++,t.answer=n.answers[s].id,t.url=n.answers[s].imageurl,e.push(t));console.log(JSON.stringify(e))},A.updateUrls=function(){var e=[],n="";f.get("../../../assets/images.json").then(function(t){e=t.data;for(var a=0;a<e.length;a++)e[a].url.indexOf("jpg")>-1&&(n="jpg"),e[a].url.indexOf("png")>-1&&(n="png"),e[a].url.indexOf("jpeg")>-1&&(n="jpeg"),l.updateAnswer(e[a].answer,["image"],["https://rankx.blob.core.windows.net/sandiego/"+e[a].answer+"/"+e[a].id+"."+n])})},A.goMerge=function(){t.go("mergeAnswers")},A.getSlugs=function(){},A.delAnswer=v,A.addcts=function(e){var t="",a=0;t=A.addctsval;for(var s=0;s<n.content.length;s++)if(n.content[s].title==t){a=n.content[s].id;break}d.postRec2(A.ans,a).then(function(){w()})},A.selEditAddress=function(e){console.log("selEditAddess - ",e),A.ans=e.id},A.editAddress=function(e){i.getLocationGPS(e).then(function(){l.updateAnswer(e.id,["location","lat","lng"],[e.location,e.lat,e.lng]).then(function(){b()})})},A.addcatcode=function(){m.post(A.catcode).then(function(){console.log("Added category code pair"),y()})},A.categoryStr=function(){A.catstrmode=!0;for(var e=0,t="",a=[],s=[],o=0;o<n.content.length;o++){a=[],g.getInclusiveAreas(n.content[o].nh,a),s=[];for(var i=0;i<n.content.length;i++)if(n.content[o].cat==n.content[i].cat)for(var c=0;c<a.length;c++)a[c]==n.content[i].nh&&-1==s.indexOf(n.content[i].id)&&s.push(n.content[i].id);t="";for(var l=0;l<s.length;l++)t=t+":"+s[l];t=t.substring(1),r.update(n.content[o].id,["catstr"],[t]).then(function(){e++,A.cpct=Math.floor(e/n.content.length*100)})}},A.deleteDupVotes=function(e){for(var t=!1,a=0;a<n.allvotes.length;a++)e.user==n.allvotes[a].user&&e.vote==n.allvotes[a].vote&&e.catans==n.allvotes[a].catans&&e.answer==n.allvotes[a].answer&&(t&&u.deleteRec(n.allvotes[a].id),t=!0)},A.isAdmin=n.isAdmin,A.dupAnsRdy=!1,A.catstrmode=!1,console.log("dbMaint page Loaded!")}angular.module("app").controller("dbMaint",e),e.$inject=["$location","$rootScope","$state","$stateParams","Upload","$q","getgps","table","dialog","answer","catans","votes","common","$http","categorycode","codeprice","useraccnt"]}(),function(){"use strict";function e(e,n,t,a,s,o,i,r,c,l,d,u,g,f,m,p,h,w,v,k){function b(){E.filteredCatans=[];var e=_.groupBy(E.catans,function(e){return"cat"+e.category+"answer"+e.answer});for(var n in e)e[n].length>1&&(e[n].dup=e[n].length,E.filteredCatans.push(e[n]));E.deletingCatans=!1,E.dtInstanceCatans={},g(function(){E.dtInstanceCatans.rerender()},1e3)}function y(){E.filteredCategories=[];var e=E.rankings.map(function(e){return e.cat});E.filteredCategories=E.categories.filter(function(n){return-1==e.indexOf(n.id)}),E.deletingCategories=!1,E.dtInstanceCategories={},g(function(){E.dtInstanceCategories.rerender()},1e3)}function A(){E.filteredAnswers=[];var e=E.catans.map(function(e){return e.answer});E.filteredAnswers=E.answers.filter(function(n){return-1==e.indexOf(n.id)}),E.deletingAnswers=!1,E.dtInstanceAnswers={},g(function(){E.dtInstanceAnswers.rerender()},1e3)}function S(){E.filteredRankings=[];var e=E.catans.map(function(e){return e.category});E.filteredRankings=E.rankings.filter(function(n){return-1==e.indexOf(n.id)}),E.deletingRankings=!1,E.dtInstanceRankings={},g(function(){E.dtInstanceRankings.rerender()},1e3)}function R(){E.filteredFImages=[];var e=E.categories.map(function(e){return e.fimage});E.filteredFImages=E.fimages.filter(function(n){return-1==e.indexOf(n.url)}),E.deletingFImages=!1,E.dtInstanceFImages={},g(function(){E.dtInstanceFImages.rerender()},1e3)}var E=this;E.title="cleandb",E.dataReady=!1,E.catans=[],E.accounts=[],E.rankings=[],E.categories=[],E.answers=[],E.fimages=[],E.isAdmin=n.isAdmin,E.notifications=[],E.gotoanswer=function(e){t.go("answerDetail",{index:e.slug})},E.filterCatans=b,E.filterCategories=y,E.filterAnswers=A,E.filterRankings=S,E.filterFImages=R,E.deleteSelectedCatans=function(){E.deletingCatans=!0;var e=[];E.filteredCatans.filter(function(e){return e[0].checked}).forEach(function(n){for(var t=1;t<n.length;t++)e.push(p.deleteCatan(n[t].id))}),i.all(e).then(function(e){e.forEach(function(e){var n=E.catans.map(function(e){return e.id}).indexOf(e.resource[0].id);E.catans.splice(n,1)}),b()})},E.deleteSelectedCategories=function(){E.deletingCategories=!0;var e=[];E.filteredCategories.filter(function(e){return e.checked}).forEach(function(n){e.push(h.deleteRec(n.id))}),i.all(e).then(function(e){e.forEach(function(e){var n=E.categories.map(function(e){return e.id}).indexOf(e.id);E.categories.splice(n,1)}),y()})},E.deleteSelectedAnswers=function(){E.deletingAnswers=!0;var e=[];E.filteredAnswers.filter(function(e){return e.checked}).forEach(function(n){e.push(l.deleteAnswer(n.id))}),i.all(e).then(function(e){e.forEach(function(e){var n=E.answers.map(function(e){return e.id}).indexOf(e.id);E.answers.splice(n,1)}),A()})},E.deleteSelectedRankings=function(){E.deletingRankings=!0;var e=[];E.filteredRankings.filter(function(e){return e.checked}).forEach(function(n){e.push(s.deleteTable(n.id))}),i.all(e).then(function(e){e.forEach(function(e){var n=E.rankings.map(function(e){return e.id}).indexOf(e.id);E.rankings.splice(n,1)}),S()})},E.deleteSelectedFImages=function(){E.deletingFImages=!0;var e=E.filteredFImages.filter(function(e){return e.checked}),n=[];e.forEach(function(e){n.push(k.deleteBlob(e.url))}),i.all(n).then(function(n){e.forEach(function(e){var n=E.fimages.map(function(e){return e.url}).indexOf(e.url);E.fimages.splice(n,1)}),R()})},E.dtInstanceCatans={},E.dtInstanceCategories={},E.dtInstanceAnswers={},E.dtInstanceRankings={},E.dtInstanceFImages={},E.filteredCatans=[],E.filteredCategories=[],E.filteredAnswers=[],E.filteredRankings=[],E.filteredFImages=[],i.all([p.getAllcatans(),r.getallaccnts(),h.getAllCategories(),v.getAllLocations(),s.getTables(),l.getAnswers(),k.getFeatureImageList()]).then(function(e){E.catans=e[0],E.accounts=e[1],E.categories=e[2],E.locations=e[3],n.categories=e[2],n.locations=e[3],n.content=e[4],w.unwrap(),E.rankings=n.content,E.answers=e[5],E.fimages=e[6],console.log("vm.fimages - ",E.fimages),E.dataReady=!0,b(),y(),A(),S(),R()})}angular.module("app").controller("cleandb",e),e.$inject=["$location","$rootScope","$state","$stateParams","table","dialog","$q","useraccnt","promoter","answer","codeprice","setting","$timeout","DTOptionsBuilder","DTColumnDefBuilder","catans","categories","dataloader","locations","imagelist"]}(),function(){"use strict";function e(e,n,t,a,s,o,i,r,c,l,d,u,g,f,m){function p(){return 1==h.showFilter?h.filtered=h.businesses.filter(function(e){return e.hasranks||e.haspremium}):2==h.showFilter?h.filtered=h.businesses.filter(function(e){return!(e.hasranks||e.haspremium)}):(h.loading=!1,h.dtInstance.rerender(),h.filtered=h.businesses)}var h=this;h.title="bizadmin",h.dataReady=!1,h.businesses=[],h.isAdmin=n.isAdmin,h.notifications=[],h.gotoanswer=function(e){t.go("answerDetail",{index:e.slug})},h.filterData=p,h.showFilter=0,h.showUserFilter=!0,h.setShowPurchases=function(){h.showFilter=1,p()},h.setShowAll=function(){h.showFilter=0,p()},h.setShowNonPurchases=function(){h.showFilter=2,p()},h.showUser=function(){h.showUserFilter=!h.showUserFilter,p()},h.deleteSelected=function(){console.log(h.filtered.filter(function(e){return e.checked}).map(function(e){return e}))},h.dtInstance={},h.filtered=[],h.loading=!1,i.all([r.getallaccnts(),u.getSetting(),d.get()]).then(function(e){e[0],e[2],h.STRIPE_COMMISSION_PERCENTAGE=e[1].STRIPE_COMMISSION_PERCENTAGE?e[1].STRIPE_COMMISSION_PERCENTAGE:.2,h.CUSTOM_RANK_PRICE=e[1].CUSTOM_RANK_PRICE,e[0].forEach(function(e){var t=angular.copy(e);n.answers.map(function(e){return e.id}).indexOf(t.answer)>-1&&(function(e){return l.getAnswer(e.answer).then(function(n){e.answerObj=n})}(t).then(function(){p()}),h.businesses.push(t))}),h.dataReady=!0,p()}),console.log("bizadmin page Loaded!")}angular.module("app").controller("bizadmin",e),e.$inject=["$location","$rootScope","$state","$stateParams","table","dialog","$q","useraccnt","promoter","answer","codeprice","setting","$timeout","DTOptionsBuilder","DTColumnDefBuilder"]}(),function(){"use strict";function e(e,n,t,a,s,o,i){function r(){l<c.ansimgs.length&&(c.inprogress=!0,function(e,n,t){var a={method:"POST",url:"https://server.rank-x.com/ImageServer/SaveImage",headers:{"X-Dreamfactory-API-Key":void 0,"X-DreamFactory-Session-Token":void 0},data:{imageurl:e,filename:n,answerid:t}};return o(a)}(c.ansimgs[l].imageurl,c.ansimgs[l].slug,c.ansimgs[l].id).then(function(){console.log("processing image success - ",c.ansimgs[l].slug),l++,c.cpct=l/c.ansimgs.length*100,r()},function(e){console.log("there was error processing image: ",e),l++,c.cpct=l/c.ansimgs.length*100,r()}))}var c=this;c.title="answerimages",c.ansimgs=[];var l=0;c.processAllImages=r,e.answers.forEach(function(e){void 0!=e.imageurl&&-1==e.imageurl.indexOf("noimage.jpg")&&-1==e.imageurl.indexOf("rankx.blob.core")&&"Short-Phrase"!=e.type&&(c.ansimgs.push(e),console.log(e.name,e.imageurl))}),e.DEBUG_MODE&&console.log("answerimages page Loaded!")}angular.module("app").controller("answerimages",e),e.$inject=["$rootScope","staticpages","dialog","SERVER_URL","$timeout","$http","answer"]}(),function(){"use strict";function e(e,n,t,a,s,o,i,r,c,l,d,u,g,f,m,p,h,w,v,k){function b(){y.selKeywords="",y.selViews="",y.selFlags="",y.selRankings="",y.selDbMaint="",y.selQuery="",y.selUpdate="",y.selFoodRanks="",y.selPlan="",y.selPayment="",y.selBizAdmin="",y.selSibLocks="",y.selCleanDB="",y.selimagesMod="",y.selStaticPages="",y.selLocations="",y.selsitemap="",y.selanswerimages=""}var y=this;y.title="admin",y.selKeywords="active",y.selViews="",y.selFlags="",y.selRankings="",y.selPlan="",y.selCleanDB="",y.goBack=function(){n.go("content")},y.keywords=function(){b(),y.selKeywords="active",n.go("queries")},y.views=function(){b(),y.selViews="active",n.go("views")},y.flags=function(){b(),y.selFlags="active",n.go("flags")},y.addRank=function(){b(),y.selRankings="active",n.go("addRank")},y.dbMaint=function(){b(),y.selDbMaint="active",n.go("dbMaint")},y.dbQuery=function(){b(),y.selQuery="active",n.go("dbQuery")},y.update=function(){b(),y.selUpdate="active",n.go("updateHeaders")},y.foodranks=function(){b(),y.selFoodRanks="active",n.go("foodRanks")},y.sibLocs=function(){b(),y.selSibLocks="active",n.go("sibLocs")},y.payment=function(){b(),y.selPayment="active",n.go("payment")},y.plan=function(){b(),y.selPlan="active",n.go("plan")},y.bizAdmin=function(){b(),y.selBizAdmin="active",n.go("bizadmin")},y.applyRule=function(){console.log("apply Rule")},y.cleanDB=function(){b(),y.selCleanDB="active",n.go("cleandb")},y.modImages=function(){b(),y.selimagesMod="active",n.go("imagesmod")},y.staticPages=function(){b(),y.selStaticPages="active",n.go("staticpagesconsole")},y.golocations=function(){b(),y.selLocations="active",n.go("locations")},y.gositemap=function(){b(),y.selsitemap="active",n.go("sitemap")},y.goanswerimages=function(){b(),y.selanswerimages="active",n.go("answerimages")},y.dataready=!1,e.isAdmin||e.dataAdmin||e.modAdmin?(y.isDET=e.isLoggedIn&&("10104518570729893"==e.user.id||30==e.user.id||41==e.user.id||42==e.user.id||30==e.user.id||0xaaf2b1002387==e.user.id||0xb07a74be061a==e.user.id),y.isAdmin=e.user.is_sys_admin||e.isAdmin,y.dataAdmin=e.dataAdmin,y.modAdmin=e.modAdmin,function(){var n=t.getTables(),i=s.getAllCategories(),d=g.getAllLocations(),v=a.getAllAnswers(),k=f.getSpecials(),b=m.GetMatchTable(),A=p.getAllUserActivity(),S=l.getAllcatans(),R=h.getEdits(),E=c.getAllvrows(),P=o.getTables(),C=w.getallaccnts();r.all([n,i,d,v,k,b,A,S,R,E,P,C]).then(function(n){e.content=n[0],e.categories=n[1],e.locations=n[2],e.answers=n[3],e.specials=n[4],e.mrecs=n[5],e.alluseractivity=n[6],e.catansrecs=n[7],e.edits=n[8],e.cvrows=n[9],e.customranks=n[10],e.useraccnts=n[11],u.unwrap(),u.createSearchStrings(),y.dataready=!0})}(),e.DEBUG_MODE&&console.log("admin page Loaded!")):n.go("cwrapper")}angular.module("app").controller("admin",e),e.$inject=["$rootScope","$state","table","answer","categories","table2","categorycode","$q","vrows","catans","common","dataloader","locations","special","matchrec","useractivity","edit","useraccnt","staticpages","$timeout"]}(),function(){"use strict";function e(e,n,t,a,s,o){function i(){c={},r.rankTitle="",r.tags="",r.keywords="",r.type="",r.isatomic=!0,r.question="",r.image1url="",r.image2url="",r.image3url=""}var r=this;r.title="addRank";var c={},l=!0,d=!0,u=!0;r.addRanking=function(){if(c.title=r.rankTitle,c.tags=r.tags,c.keywords=r.keywords,c.type=r.type,c.question=r.question,c.views=0,c.answers=0,(null==c.title||void 0==c.title||c.title.length<10)&&(l=!1),(null==c.question||void 0==c.question||c.question.length<10)&&(u=!1),"Person"!=c.type&&"Establishment"!=c.type&&"Short-Phrase"!=c.type&&"Event"!=c.type&&"Organization"!=c.type&&"Place"!=c.type&&"Activity"!=c.type&&"Thing"!=c.type&&"PersonCust"!=c.type&&(d=!1),console.log("vm.allNh --- ",r.allNh),0==r.allNh||void 0==r.allNh)l&&d&&u?(s.addTable(c),i()):l?u?o.getDialog("rankType"):o.getDialog("rankQuestion"):o.getDialog("rankTitle");else if(l&&d&&u){for(var e=0;e<n.content.length;e++)if(n.content[e].title.indexOf("Yoga studios in")>-1){var t=JSON.parse(JSON.stringify(n.content[e]));t.id=void 0;var a=t.title.replace("Yoga studios in",r.rankTitle);t.title=a;var g=r.tags;t.tags=g,a.indexOf("Pacific Beach")>-1&&(t.tags=t.tags+" pb"),a.indexOf("Ocean Beach")>-1&&(t.tags=t.tags+" ob"),a.indexOf("Mission Beach")>-1&&(t.tags=t.tags+" mb"),a.indexOf("in San Diego")>-1&&(t.tags=t.tags+" isMP",t.isatomic=!1),a.indexOf("in Downtown")>-1&&(t.isatomic=!1),t.answers=0,t.views=0,t.answertags="",t.catstr="",s.addTable(t)}i()}else l?u?o.getDialog("rankType"):o.getDialog("rankQuestion"):o.getDialog("rankTitle")},r.typeList=["Person","Establishment","Place","Activity","Short-Phrase","Organization","Event","Thing","PersonCust"],r.isAdmin=n.isAdmin,console.log("addRank page Loaded!")}angular.module("app").controller("addRank",e),e.$inject=["$location","$rootScope","$state","$stateParams","table","dialog"]}();