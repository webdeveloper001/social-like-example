angular.module("app").run(["$templateCache",function(t){t.put("app/admin/Partials/addRank.html",'<br><div class="row" ng-if="vm.isAdmin"><div class="col-sm-1"></div><div class="col-sm-10"><h4>Add Ranking</h4><label class="checkbox-inline"><input type="checkbox" ng-model="vm.allNh" value="">All Neighborhoods</label><p>To add a ranking to all neighborhoods, type title without actual neighborhood name:</p><p>For instance, for \'Best pizza in ###? , simply type \'Best pizza in\' and select the checkbox</p><label><strong>Title:</strong></label> <input class="form-control" ng-model="vm.rankTitle" type="text" placeholder="{{vm.rankTitle}}"> <label><strong>Question:</strong></label> <input class="form-control" ng-model="vm.question" type="text" placeholder="{{vm.question}}"> <label><strong>Tags:</strong></label> <input class="form-control" ng-model="vm.tags" type="text" placeholder="{{vm.tags}}"> <label><strong>Keywords:</strong></label> <input class="form-control" ng-model="vm.keywords" type="text" placeholder="{{vm.keywords}}"> <label><strong>Type:</strong></label> <input class="form-control" ng-model="vm.type" bs-typeahead="" type="text" placeholder="{{vm.type}}" bs-options="c for c in vm.typeList"><br><div class="form-group text-right"><button type="button" class="btn btn-primary" ng-click="vm.addRanking()">Add</button></div></div><div class="col-sm-1"></div></div>'),t.put("app/admin/Partials/admin.html",'<div ui-view="navbar"></div><br><div ng-if="!vm.dataready"><h2>Please wait, loading all admin data...</h2></div><div ng-if="vm.dataready"><div class="text-center" ng-if="vm.isAdmin"><div class="btn-group"><button class="btn btn-default {{vm.selKeywords}}" ng-click="vm.keywords()">Searched-Keyword</button> <button class="btn btn-default {{vm.selViews}}" ng-click="vm.views()">Ranking-Answers Views</button> <button class="btn btn-default {{vm.selFlags}}" ng-click="vm.flags()">Answer Flags</button> <button class="btn btn-default {{vm.selAddRanking}}" ng-click="vm.addRank()">Add Ranking</button> <button class="btn btn-default {{vm.selDbMaint}}" ng-click="vm.dbMaint()">dB Maint</button> <button class="btn btn-default {{vm.selQuery}}" ng-click="vm.dbQuery()">Query</button> <button class="btn btn-default {{vm.selSibLocs}}" ng-click="vm.sibLocs()">Sibbling Locations</button> <button class="btn btn-default {{vm.selFoodRanks}}" ng-click="vm.foodranks()">Food Ranks</button> <button class="btn btn-default {{vm.selPayment}}" ng-click="vm.payment()">Payment</button> <button class="btn btn-default {{vm.selPlan}}" ng-click="vm.plan()">Plan</button> <button class="btn btn-default" ng-click="vm.bizAdmin()">Business</button> <button class="btn btn-default" ng-click="vm.cleanDB()">Clean DB</button> <button class="btn btn-default" ng-click="vm.modImages()">Moderate Images</button> <button class="btn btn-default" ng-click="vm.staticPages()">Static Pages</button> <button class="btn btn-default {{vm.selLocations}}" ng-click="vm.golocations()">Locations</button> <button class="btn btn-default {{vm.selsitemap}}" ng-click="vm.gositemap()">Sitemap</button> <button class="btn btn-default {{vm.selanswerimages}}" ng-click="vm.goanswerimages()">Answer Images</button> <button class="btn btn-danger" ng-click="vm.applyRule()">Apply Rule</button></div></div><div ng-if="vm.dataAdmin"><button class="btn btn-default {{vm.selQuery}}" ng-click="vm.dbQuery()">Query</button> <button class="btn btn-default {{vm.selSibLocs}}" ng-click="vm.sibLocs()">Sibbling Locations</button></div><div ng-if="vm.modAdmin"><button class="btn btn-default" ng-click="vm.modImages()">Moderate Images</button> <button class="btn btn-default" ng-click="vm.staticPages()">Static Pages</button></div></div><br><br><div ui-view=""></div><br><br>'),t.put("app/admin/Partials/answerimages.html",'<h1>Answer Images</h1>Number of answer images that are not in rankx blob: {{vm.ansimgs.length}}<br><br><button class="btn btn-primary" ng-click="vm.processAllImages()">Store Images</button><br><br><div class="progress" ng-if="vm.inprogress"><div class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="vm.cpct" aria-valuemin="0" aria-valuemax="100" style="width:{{vm.cpct}}%">{{vm.cpct}}% Complete (success)</div></div>'),t.put("app/admin/Partials/bizadmin.html",'<br><div class="row" ng-if="vm.isAdmin"><div id="veil" ng-hide="vm.dataReady"></div><div id="feedLoading" ng-hide="vm.dataReady"><div style="text-align: center" ng-if="!vm.dataReady"><div><img src="/assets/images/loading.gif" class="img" style="width:50px;height:50px"></div><p style="font-size:large">loading your business information...</p></div></div><div ng-if="vm.dataReady"><div style="margin-left:40px; margin-right:40px"><h3>Businesses</h3><div class="pull-right"><button class="btn btn-default" ng-class="vm.showFilter == 0 ? \'active\' : \'\'" ng-click="vm.setShowAll()">Show All</button> <button class="btn btn-default" ng-class="vm.showFilter == 1 ? \'active\' : \'\'" ng-click="vm.setShowPurchases()">Show Only Purchaces</button> <button class="btn btn-default" ng-class="vm.showFilter == 2 ? \'active\' : \'\'" ng-click="vm.setShowNonPurchases()">Show Only Non-Purchaces</button> <button class="btn btn-default" ng-class="vm.showUserFilter ? \'active\' : \'\'" ng-click="vm.showUser()">Show User</button> <button class="btn btn-warning" ng-class="vm.showUserFilter ? \'active\' : \'\'" ng-click="vm.deleteSelected()">Delete Selected</button></div><div class="clearfix"></div><table datatable="ng" class="table" dt-options="vm.dtOptions" dt-columns="vm.dtColumns" dt-instance="vm.dtInstance" ng-if="!vm.loading"><thead style="border-style:none;"><tr><th></th><th>Business Name</th><th>Type</th><th>Activity</th><th ng-if="vm.showUserFilter">User</th><th ng-if="vm.showUserFilter">Email</th></tr></thead><tbody><tr ng-repeat="biz in vm.filtered" style="cursor:pointer;">{{vm.filtered.length}}<td><input type="checkbox" ng-model="biz.checked"></td><td>{{biz.answerObj.name}}</td><td>{{biz.bizcat}}</td><td style="padding: 0px;display: inline; height: 100%"><div ng-if="!biz.ispreminum && !biz.hasranks" style="background-color: #ffe699; padding:10px 18px; min-width: 160px" class="text-center">Account Bind</div><div ng-if="biz.ispreminum || biz.hasranks" class="text-center" style="min-width:200px ; min-width: 160px"><div ng-if="biz.ispreminum" style="background-color: #a9d18e; float:left; width:50%; padding:10px 18px" class="text-center">Preminum</div><div ng-if="!biz.ispreminum" style="background-color: #d9d9d9;float:left; width:50%; padding:10px 18px" class="text-center">No Preminum</div><div ng-if="biz.hasranks" style="background-color: #a9d18e; float:left; width:50%; padding:10px 18px" class="text-center">{{biz.ranksqty}} Ranks</div><div ng-if="!biz.hasranks" style="background-color: #d9d9d9; float:left; width:50%; padding:10px 18px" class="text-center">No Ranks</div></div></td><td ng-if="vm.showUserFilter">{{biz.username}}</td><td ng-if="vm.showUserFilter">{{biz.email}}</td></tr></tbody></table></div></div></div>'),t.put("app/admin/Partials/cleandb.html",'<br><div class="row" ng-if="vm.isAdmin"><div id="veil" ng-hide="vm.dataReady"></div><div id="feedLoading" ng-hide="vm.dataReady"><div style="text-align: center" ng-if="!vm.dataReady"><div><img src="/assets/images/loading.gif" class="img" style="width:50px;height:50px"></div><p style="font-size:large">loading your DB information...</p></div></div><div style="min-height: 200px" ng-hide="vm.dataReady"></div><div ng-if="vm.dataReady"><div style="margin-left:40px; margin-right:40px"><h3>Catans(Duplicated)</h3><div class="pull-right"><button class="btn btn-warning" ng-click="vm.deleteSelectedCatans()">Delete Duplication in Selected Catans</button></div><div class="clearfix"></div><div ng-if="!vm.deletingCatans"><table datatable="ng" class="table" dt-options="vm.dtOptions" dt-columns="vm.dtColumns" dt-instance="vm.dtInstanceCatans"><thead style="border-style:none;"><tr><th></th><th>Category</th><th>Answer</th><th>Duplication</th></tr></thead><tbody><tr ng-repeat="biz in vm.filteredCatans" style="cursor:pointer;"><td><input type="checkbox" ng-model="biz[0].checked"></td><td>{{biz[0].category}}</td><td>{{biz[0].answer}}</td><td>{{biz.length}}</td></tr></tbody></table></div><div ng-if="vm.deletingCatans"><h6>Deleting Duplication...</h6></div></div><div style="margin-left:40px; margin-right:40px"><h3>Categories(Have no Rankings)</h3><div class="pull-right"><button class="btn btn-warning" ng-click="vm.deleteSelectedCategories()">Delete Selected Unlinked Categories</button></div><div class="clearfix"></div><div ng-if="!vm.deletingCategories"><table datatable="ng" class="table" dt-options="vm.dtOptionsCategories" dt-columns="vm.dtColumnsCategories" dt-instance="vm.dtInstanceCategories"><thead style="border-style:none;"><tr><th></th><th>ID</th><th>Category</th><th>Type</th></tr></thead><tbody><tr ng-repeat="biz in vm.filteredCategories" style="cursor:pointer;"><td><input type="checkbox" ng-model="biz.checked"></td><td>{{biz.id}}</td><td>{{biz.category}}</td><td>{{biz.type}}</td></tr></tbody></table></div><div ng-if="vm.deletingCategories"><h6>Deleting Unlinked Categories...</h6></div></div><div style="margin-left:40px; margin-right:40px"><h3>Answers(Have no Reference)</h3><div class="pull-right"><button class="btn btn-warning" ng-click="vm.deleteSelectedAnswers()">Delete Selected Unreferenced Answers</button></div><div class="clearfix"></div><div ng-if="!vm.deletingAnswer"><table datatable="ng" class="table" dt-options="vm.dtOptionsAnswers" dt-columns="vm.dtColumnsAnswer" dt-instance="vm.dtInstanceAnswers"><thead style="border-style:none;"><tr><th></th><th>ID</th><th>Image</th><th>Name</th></tr></thead><tbody><tr ng-repeat="biz in vm.filteredAnswers" style="cursor:pointer;"><td><input type="checkbox" ng-model="biz.checked"></td><td>{{biz.id}}</td><td><img style="width:100px;height:100px" ng-src="{{biz.imageurl}}"></td><td>{{biz.name}}</td></tr></tbody></table></div><div ng-if="vm.deletingAnswers"><h6>Deleting Unreferenced Answers...</h6></div></div><div style="margin-left:40px; margin-right:40px"><h3>Rankings(Have no Answers)</h3><div class="pull-right"><button class="btn btn-warning" ng-click="vm.deleteSelectedRankings()">Delete Selected Unreferenced Rankings</button></div><div class="clearfix"></div><div ng-if="!vm.deletingRanking"><table datatable="ng" class="table" dt-options="vm.dtOptionsRankings" dt-columns="vm.dtColumnsRanking" dt-instance="vm.dtInstanceRankings"><thead style="border-style:none;"><tr><th></th><th>ID</th><th>Title</th><th>Type</th></tr></thead><tbody><tr ng-repeat="biz in vm.filteredRankings" style="cursor:pointer;"><td><input type="checkbox" ng-model="biz.checked"></td><td>{{biz.id}}</td><td>{{biz.title}}</td><td>{{biz.type}}</td></tr></tbody></table></div><div ng-if="vm.deletingRankings"><h6>Deleting Unreferenced Rankings...</h6></div></div><div style="margin-left:40px; margin-right:40px"><h3>Feature Images(Have no Reference)</h3><div class="pull-right"><button class="btn btn-warning" ng-click="vm.deleteSelectedFImages()">Delete Selected Unreferenced FImages</button></div><div class="clearfix"></div><div ng-if="!vm.deletingFImages"><table datatable="ng" class="table" dt-options="vm.dtOptionsFImages" dt-columns="vm.dtColumnsFImages" dt-instance="vm.dtInstanceFImages"><thead style="border-style:none;"><tr><th></th><th>Image</th></tr></thead><tbody><tr ng-repeat="biz in vm.filteredFImages" style="cursor:pointer;"><td><input type="checkbox" ng-model="biz.checked"></td><td><img style="width:100px;height:100px" ng-src="{{biz.url}}" <="" td=""></td></tr></tbody></table></div><div ng-if="vm.deletingFImages"><h6>Deleting Unreferenced Feature Images...</h6></div></div><div style="margin-left:40px; margin-right:40px"><h3>Feature Images Sizes</h3><div class="clearfix"></div><div ng-if="!vm.deletingFImages"><table datatable="ng" class="table" dt-options="vm.dtOptionsFImages" dt-columns="vm.dtColumnsFImages" dt-instance="vm.dtInstanceFImages"><thead style="border-style:none;"><tr><th></th><th>Image</th><th>Filename</th><th>Size</th></tr></thead><tbody><tr ng-repeat="biz in vm.fimages | orderBy:\'-size\'" style="cursor:pointer;"><td><input type="checkbox" ng-model="biz.checked"></td><td><img style="width:100px;height:100px" ng-src="{{biz.url}}" <="" td=""></td><td>{{biz.url}}</td><td>{{biz.size}}</td></tr></tbody></table></div><div ng-if="vm.deletingFImages"><h6>Deleting Unreferenced Feature Images...</h6></div></div></div></div>'),t.put("app/admin/Partials/dbMaint.html",'<div class="container" ng-if="vm.isAdmin"><h1>Database Maintenance</h1><button class="btn btn-success" ng-click="vm.showUrefAns()">Unreferenced Answers</button><br><button class="btn btn-danger" ng-click="vm.deleteAnswers()">Delete Answers</button> <button class="btn btn-default" ng-click="vm.showPossibleDuplicated()">Show Possible Duplicated</button> <button class="btn btn-default" ng-click="vm.showDuplicatedOnlyName()">Show Duplicated Only Name</button> <button class="btn btn-default" ng-click="vm.showDuplicatedByLocation()">Show Duplicated By Location</button><br><button class="btn btn-default" ng-click="vm.findPhoneWebsite()">Phone Numbers & Website</button><br><button class="btn btn-default" ng-click="vm.findDuplicatedRanks()">Duplicated Ranks</button><br><button class="btn btn-default" ng-click="vm.clearAllCatansVotes()">Clear Catans Votes</button><br><button class="btn btn-default" ng-click="vm.syncUserVotes()">Sync User Votes</button><br><button class="btn btn-default" ng-click="vm.estDistances()">Establishment Distances</button><br><button class="btn btn-default" ng-click="vm.createImagesJSON()">createImagesJSON</button><br><button class="btn btn-default" ng-click="vm.updateUrls()">updateUrls</button><br><button class="btn btn-default" ng-click="vm.getAnswerBizCode()">getAnswerBizCode</button><br><button class="btn btn-default" ng-click="vm.getSlugs()">get Slugs</button><br><button class="btn btn-default" ng-click="vm.categoryStr()">Update CatStr</button><br><br><div ng-if="vm.unrefans"><div ng-repeat="x in vm.unrefans" ng-click="vm.selAns(x)"><h4 class="text-left">{{$index+1}}. {{x.name}}</h4><img ng-src="{{x.imageurl}}" style="width:120px"><br>Id: {{x.id}} Added by User: {{x.userid}}<br>Neighborhood: {{x.cityarea}}<br>Address: {{x.location}}<br>Website: {{x.website}}<br>Phone: {{x.phone}}<br>Additional Info: {{x.addinfo}}<br><button class="btn btn-danger" ng-click="vm.delAnswer(x)">Delete Answer</button><br><div ng-if="vm.ans == x.id"><label>Add Catans</label> <input type="text" class="form-control" ng-model="vm.addctsval" bs-options="c for c in vm.addctsopts" bs-typeahead=""> <span class="input-group-btn text-right"><button class="btn btn-success" type="button" ng-click="vm.addcts()">Add</button></span></div></div></div><div ng-if="vm.ansNoCode"><div ng-repeat="x in vm.ansNoCode" ng-click="vm.selAns(x)"><p class="text-left"><strong>{{$index}}.&nbsp{{x.name}}&nbsp-&nbsp{{x.bizcat}}</strong></p><div ng-repeat="y in x.cats"><p class="text-left">{{y}}</p></div><div ng-if="vm.ans == x.id"><label>Category</label> <input type="text" class="form-control" ng-model="vm.catcode.category"> <label>Code</label> <input type="text" class="form-control" ng-model="vm.catcode.code" bs-options="c for c in vm.codes" bs-typeahead=""> <span class="input-group-btn text-right"><button class="btn btn-success" type="button" ng-click="vm.addcatcode()">Add Category-Code Pair</button></span></div></div></div><div ng-repeat="x in vm.dupAnswers track by $index"><img ng-src="{{x.image1}}" ng-attr-style="width:120px"> <img ng-src="{{x.image2}}" style="width:120px"><p>{{x.name1}} --- {{x.idx1}} --- {{x.loc1}} --- {{x.nh1}} --- {{x.add1}} --- {{x.id1}}</p><p>{{x.name2}} --- {{x.idx2}} --- {{x.loc2}} --- {{x.nh2}} --- {{x.add2}} --- {{x.id2}}</p><button class="btn btn-default" ng-click="vm.syncToFirst(x)">Sync 1st</button> <button class="btn btn-default" ng-click="vm.syncToSecond(x)">Sync 2nd</button><p>-------------------------------------------------------</p></div><div ng-repeat="x in vm.dupAnsNames track by $index"><img ng-src="{{x.image1}}" ng-attr-style="width:120px"> <img ng-src="{{x.image2}}" style="width:120px"><p>{{x.name1}} --- {{x.idx1}} --- {{x.loc1}} --- {{x.nh1}} --- {{x.add1}} --- {{x.id1}}</p><p>{{x.name2}} --- {{x.idx2}} --- {{x.loc2}} --- {{x.nh2}} --- {{x.add2}} --- {{x.id2}}</p><button class="btn btn-default" ng-click="vm.syncToFirst(x)">Sync 1st</button> <button class="btn btn-default" ng-click="vm.syncToSecond(x)">Sync 2nd</button><p>-------------------------------------------------------</p></div><p ng-repeat="x in vm.resDupRanks track by $index">{{x.title}} --- {{x.id}}</p><div ng-repeat="x in vm.syncp">{{x.answername}} - {{x.categoryname}} - caUpV {{x.caUpV}} - nUpVotes {{x.nUpVlen}} - caDownV {{x.caDownV}} - nDownVotes {{x.nDownVlen}}<br>UP VOTES<br><div ng-repeat="y in x.upVotes">User:&nbsp{{y.user}} Vote:&nbsp{{y.vote}} VoteId:&nbsp{{y.id}} <a ng-click="vm.deleteDupVotes(y)">Delete</a></div>DOWN VOTES<br><div ng-repeat="y in x.downVotes">User:&nbsp{{y.user}} Vote:&nbsp{{y.vote}} VoteId:&nbsp{{y.id}} <a ng-click="vm.deleteDupVotes(y)">Delete</a></div><button class="btn btn-primary" ng-click="vm.updatecatans(x)">Fix</button></div><div ng-repeat="x in vm.answerdist"><div class="row">{{x.name}} - {{x.location}} - {{x.dist}} <button class="btn btn-default" ng-click="vm.gotoAnswer(x)">Go to Answer</button> <button class="btn btn-primary" ng-click="vm.selEditAddress(x)">Edit</button></div><div ng-if="vm.ans == x.id"><br><input type="text" class="form-control" ng-model="x.location"> <span class="input-group-btn text-right"><button class="btn btn-success" type="button" ng-click="vm.editAddress(x)">Edit</button></span></div></div><button ng-if="vm.dupAnsRdy" class="btn btn-primary" ng-click="vm.goMerge()">Go Merge Screen</button><div ng-if="vm.catstrmode"><div class="progress"><div class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="vm.cpct" aria-valuemin="0" aria-valuemax="100" style="width:{{vm.cpct}}%">{{vm.cpct}}%</div><p>Updating Category Strings</p></div></div></div>'),t.put("app/admin/Partials/dbQuery.html",'<div class="container" ng-if="vm.isAdmin"><h1>Database Query</h1><input class="form-control" ng-model="vm.val" placeholder="Enter answer to search"> <button class="btn btn-primary" ng-click="vm.queryAnswer()">Query</button><div ng-repeat="x in vm.ansRes"><h4 class="text-left">{{$index+1}}. {{x.name}}</h4><img ng-src="{{x.imageurl}}" style="width:120px"><br>Id: {{x.id}} Added by User: {{x.userid}}<br>Neighborhood: {{x.cityarea}}<br>Address: {{x.location}}<br>Website: {{x.website}}<br>Phone: {{x.phone}}<br>Additional Info: {{x.addinfo}}<br><button class="btn btn-danger" ng-click="vm.delAnswer(x)">Delete Answer</button><br>Categories<br><div ng-repeat="y in x.catans">{{y.title}}---cat:{{y.catid}}---c:{{y.id}}---r:{{y.category}}---a:{{y.answer}} <button class="btn btn-warning" ng-click="vm.delCatans(y)">Delete Catans</button><br></div></div></div>'),t.put("app/admin/Partials/flags.html",'<h1>Flags</h1><br><button class="btn btn-danger" ng-click="vm.getFlags()">Get Flags</button><table class="table table-hover cursor" ng-if="vm.viewTable"><tbody><thead><tr><th>No.</th><th>Type</th><th>Flag</th><th>Details</th><th>Go To</th><th>Dismiss</th></tr></thead><tbody><tr ng-repeat="x in vm.flags"><td>{{x.id}}</td><td>{{x.type}}</td><td>{{x.desc}}</td><td><button class="btn btn-default" ng-click="vm.seeDetails(x)">Details</button></td><td><button class="btn btn-success" ng-click="vm.gotoView(x)">Go to</button></td><td><button class="btn btn-warning" ng-click="vm.deleteFlag(x)">Delete Flag</button></td></tr></tbody></tbody></table><div ng-if="vm.viewDetails"><h4>{{vm.data.id}} - {{vm.data.type}} - Reason:&nbsp{{vm.data.desc}}</h4><div ng-if="vm.data.imageurl"><img src="{{vm.data.imageurl}}" style="width:120px"><br></div><div ng-if="vm.data.name">Name: {{vm.data.name}}<br></div><div ng-if="vm.data.location">Address: {{vm.data.location}}<br></div><div ng-if="vm.data.cityarea">Neighborhood: {{vm.data.cityarea}}<br></div><div ng-if="vm.data.phone">Phone: {{vm.data.phone}}<br></div><div ng-if="vm.data.website">Website: {{vm.data.website}}<br></div><div ng-if="vm.data.title">Title: {{vm.data.title}}<br></div><div ng-if="vm.catans">Categories<br><div ng-repeat="y in vm.catans">{{y.rank}} --- {{y.id}} --- {{y.category}} --- {{y.answer}} <button class="btn btn-warning" ng-click="vm.delCatans(y)">Delete Catans</button><br></div></div><div ng-if="vm.comments">Comments<br><div ng-repeat="x in vm.comments">{{x.user}} --- {{x.username}} --- {{x.body}} <button class="btn btn-warning" ng-click="vm.delComment(x)">Delete Comment</button><br></div></div><button class="btn btn default" ng-click="vm.seeFlags()">Back to Flags</button></div>'),t.put("app/admin/Partials/foodRanks.html",'<br><br><h1>Get Food Ranks</h1><br><br><button class="btn btn-primary" ng-click="vm.getRanks()">Get Food Ranks</button>'),t.put("app/admin/Partials/imagesmod.html",'<div class="container"><h1>Images Moderation</h1><div ng-repeat="x in vm.uuis"><img ng-src="{{x.imageurl}}" style="width:200px;height:auto"> {{x.answername}} <button class="btn btn-success" ng-click="vm.approveImage(x)">Approve Image</button> <button class="btn btn-danger" ng-click="vm.removeImage(x)">Remove Image</button></div></div>'),t.put("app/admin/Partials/locations.html",'<div class="container"><h1>Locations</h1><form class="form-horizontal" role="form"><label class="control-label">City:</label><div class="input-group"><input class="form-control" type="text" ng-model="vm.city" bs-options="c for c in vm.opts" bs-typeahead="" placeholder="Enter City"> <span class="input-group-btn text-right"><button class="btn btn-success" type="button" ng-click="vm.getLocations()">GO</button></span></div></form><br><table class="table table-hover cursor"><thead><tr><th align="middle">Id</th><th align="middle">Location</th><th align="middle">SubAreas</th><th align="middle" style="width:30px"></th></tr></thead><tbody><tr ng-repeat="x in vm.locations"><td ng-show="!x.sel">{{x.id}}</td><td ng-show="!x.sel">{{x.nh_name}}</td><td ng-show="!x.sel"><div ng-repeat="y in x.sa">- {{y.name}}</div></td><td ng-show="!x.sel" style="width:30px"><button class="btn btn-primary" type="button" ng-click="vm.editLocation(x)">Edit</button></td><td ng-show="x.sel" colspan="4"><div><h2>{{x.nh_name}}</h2>SubAreas:<ul class="list-group"><li class="list-group-item" ng-repeat="y in x.sa" ng-click="vm.selsa(y)" style="color:{{y.sel?\'black\':\'lightgrey\'}};cursor:pointer;"><i ng-if="y.sel" class="fa fa-check"></i>&nbsp{{y.name}}</li></ul><div class="input-group"><input type="text" class="form-control" ng-model="vm.newsa" bs-options="c for c in vm.locs" bs-typeahead=""> <span class="input-group-btn text-right"><button class="btn btn-success" type="button" ng-click="vm.addsa(x)">Add</button></span></div><button class="btn btn-primary" type="button" ng-click="vm.savesa(x)">Save</button> <button class="btn btn-danger" type="button" ng-click="vm.deleteloc(x)">Delete</button> <button class="btn btn-default" type="button" ng-click="vm.cancel(x)">Cancel</button></div></td></tr></tbody></table><div><button class="btn btn-primary" ng-click="vm.enableAddLocation()">Add Location</button> <button class="btn btn-default" ng-click="vm.update()">Update</button></div><div ng-show="vm.showAddLocation"><form class="form-horizontal" role="form"><label class="control-label">Location Name:</label><div class="input-group"><input class="form-control" type="text" ng-model="vm.locname" placeholder="Enter Location Name"> <span class="input-group-btn text-right"><button class="btn btn-success" type="button" ng-click="vm.addLocation()">ADD</button></span></div></form></div></div>'),t.put("app/admin/Partials/mergeAnswers.html",'<h1>Merge Answers</h1><br><h3>Pair {{vm.idx}} of {{vm.tot}}</h3><div class="row"><div class="text-left col-xs-6"><button class="btn-success" ng-click="vm.goPrev(50)">&lt;&lt;&lt</button> <button class="btn-success" ng-click="vm.goPrev(10)">&lt;&lt</button> <button class="btn-success" ng-click="vm.goPrev(1)">&lt</button></div><div class="text-right col-xs-6"><button class="btn-success" ng-click="vm.goNext(1)">&gt</button> <button class="btn-success" ng-click="vm.goNext(10)">&gt;&gt</button> <button class="btn-success" ng-click="vm.goNext(50)">&gt;&gt;&gt</button></div></div><br><div class="container"><div class="row"><div class="col-xs-6 col-sm-6 col-lg-6"><h4 class="radio"><input type="radio" ng-model="vm.ans1_NameSel" name="nameOption">{{vm.ans1.name}}</h4><div class="text-left btn-group"><button class="btn btn-danger" ng-click="vm.delAnswer(1)">Delete Answer</button> <button class="btn btn-primary" ng-click="vm.editAnswer(1)">Edit Answer</button></div><br><input type="radio" class="radio-inline" ng-model="vm.ans1_ImageSel" name="imageOption"> <img src="{{vm.ans1.imageurl}}" style="width:40%;height:100px"><p class="text-left"><input type="radio" ng-model="vm.ans1_AddressSel" name="addressOption">&nbsp{{vm.ans1.location}}</p><p class="text-left"><input type="radio" ng-model="vm.ans1_NhSel" name="nhOption">&nbsp{{vm.ans1.cityarea}}</p><p class="text-left"><input type="radio" ng-model="vm.ans1_PhoneSel" name="phoneOption">&nbsp{{vm.ans1.phone}}</p><p class="text-left"><input type="radio" ng-model="vm.ans1_WebsiteSel" name="websiteOption">&nbsp{{vm.ans1.website}}</p><p class="text-left"><input type="radio" ng-model="vm.ans1_AddinfoSel" name="addinfoOption">&nbsp{{vm.ans1.addinfo}}</p><div ng-repeat="y in vm.ans1.catans track by $index">{{y.rank}} --- {{y.id}} --- {{y.category}} --- {{y.answer}} <button class="btn btn-warning" ng-click="vm.delCatans(y)">Delete Catans</button><br></div><div class="text-left"><button class="btn btn-primary" ng-click="vm.addCatans(1)">Add Catans</button></div><div class="input-group" ng-if="vm.addcts1active"><input type="text" class="form-control" ng-model="vm.addcts1val" bs-options="c for c in vm.addcts1opts" bs-typeahead=""> <span class="input-group-btn text-right"><button class="btn btn-success" type="button" ng-click="vm.addcts(1)">Add</button></span></div><label class="checkbox-inline" ng-if="vm.addcts1active"><input type="checkbox" ng-model="vm.cat1isdup">Is Dup</label></div><div class="col-xs-6 col-sm-6 col-lg-6"><h4 class="radio"><input type="radio" ng-model="vm.ans2_NameSel" name="nameOption">{{vm.ans2.name}}</h4><div class="text-left btn-group"><button class="btn btn-danger" ng-click="vm.delAnswer(2)">Delete Answer</button> <button class="btn btn-primary" ng-click="vm.editAnswer(2)">Edit Answer</button></div><br><input type="radio" class="radio-inline" ng-model="vm.ans2_ImageSel" name="imageOption"> <img src="{{vm.ans2.imageurl}}" style="width:40%;height:100px"><p class="text-left"><input type="radio" ng-model="vm.ans2_AddressSel" name="addressOption">&nbsp{{vm.ans2.location}}</p><p class="text-left"><input type="radio" ng-model="vm.ans2_NhSel" name="nhOption">&nbsp{{vm.ans2.cityarea}}</p><p class="text-left"><input type="radio" ng-model="vm.ans2_PhoneSel" name="phoneOption">&nbsp{{vm.ans2.phone}}</p><p class="text-left"><input type="radio" ng-model="vm.ans2_WebsiteSel" name="websiteOption">&nbsp{{vm.ans2.website}}</p><p class="text-left"><input type="radio" ng-model="vm.ans2_AddinfoSel" name="addinfoOption">&nbsp{{vm.ans2.addinfo}}</p><div ng-repeat="x in vm.ans2.catans track by $index">{{x.rank}} --- {{x.id}} --- {{x.category}} --- {{x.answer}} <button class="btn btn-warning" ng-click="vm.delCatans(x)">Delete Catans</button><br></div><div class="text-left"><button class="btn btn-primary" ng-click="vm.addCatans(2)">Add Catans</button></div><div class="input-group" ng-if="vm.addcts2active"><input type="text" class="form-control" ng-model="vm.addcts2val" bs-options="c for c in vm.addcts2opts" bs-typeahead=""> <span class="input-group-btn text-right"><button class="btn btn-success" type="button" ng-click="vm.addcts(2)">Add</button></span></div><label class="checkbox-inline" ng-if="vm.addcts2active"><input type="checkbox" ng-model="vm.cat2isdup">Is Dup</label></div></div></div>'),t.put("app/admin/Partials/notification.drtv.html",'<div><div class="alert fade in" ng-repeat="notification in notifications" ng-class="notification.type==\'success\' ? \'alert-success\' : \'alert-warning\'"><a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a> <strong>{{noticiation.type.toUpperCase()}}</strong> {{notification.message}}</div></div>'),t.put("app/admin/Partials/payment.html",'<br><div class="row" ng-if="vm.isAdmin"><div id="veil" ng-hide="vm.dataReady"></div><div id="feedLoading" ng-hide="vm.dataReady"><div style="text-align: center" ng-if="!vm.dataReady"><div><img src="/assets/images/loading.gif" class="img" style="width:50px;height:50px"></div><p style="font-size:large">loading your promoters information...</p></div></div><div ng-if="vm.dataReady"><div class="container"><h3>Promoters</h3><div style="font-size: 18px; padding: 16px; background-color: darkgray; margin-bottom: 20px; border-radius: 5px;">Current Commission Fee is {{vm.STRIPE_COMMISSION_PERCENTAGE*100}}%. <button class="btn btn-primary pull-right btn-sm" ng-click="vm.changeCommission()">Change</button></div><button ng-class="vm.selectedPromoters.length == 0 ? \'disabled\' : \'\'" class="btn btn-primary pull-right" style="margin-bottom:10px" ng-click="vm.paySelectedPromoters()">Pay Selected Promoters</button><div style="clear:both"></div><table class="table" ng-if="vm.overview"><tbody><thead style="border-style:none;"><tr><th></th><th>Promoter</th><th>Code</th><th>Business On Trial</th><th>Business Active</th><th>Total Fee</th><th>Commission to Promoter</th><th>Last Payed Date</th><th></th></tr></thead><tr ng-repeat="promoter in vm.promoters" style="cursor:pointer;"><td><input type="checkbox" ng-if="!promoter.payedThisMonth" ng-click="vm.addOrRemovePromoter(promoter)"></td><td ng-click="vm.goDetailView(promoter)">{{promoter.firstname + \' \' + promoter.lastname}}</td><td ng-click="vm.goDetailView(promoter)">{{promoter.code}}</td><td ng-click="vm.goDetailView(promoter)">{{promoter.ontrialCount}}</td><td ng-click="vm.goDetailView(promoter)">{{promoter.activeCount}}</td><td ng-click="vm.goDetailView(promoter)">${{promoter.balance / 100}}</td><td ng-click="vm.goDetailView(promoter)">${{promoter.balance / 100 * vm.STRIPE_COMMISSION_PERCENTAGE}}</td><td ng-click="vm.goDetailView(promoter)">{{promoter.lastPaymentDate}}</td><td><button ng-if="!promoter.payedThisMonth" class="btn btn-primary" ng-click="vm.payPromoter(promoter)">Pay</button> <button ng-if="promoter.payedThisMonth" class="btn btn-primary disabled">Paid This Month</button></td></tr></tbody></table><div ng-if="vm.detailview"><table class="table" ng-if="vm.currentPromoter.businesses.length >= 1"><thead style="border-style:none;"><tr><th>Business</th><th>Total Commission After Trial</th><th>Status</th></tr></thead><tbody><tr ng-repeat="x in vm.currentPromoter.businesses" style="cursor:pointer;"><td ng-click="vm.gotoanswer(x.answerObj)">{{x.answerObj.name}}</td><td ng-click="vm.showBusinessDetail(x)">${{x.totalCommission}}</td><td align="middle" ng-attr-style="{{x.style}}" ng-click="vm.showBusinessDetail(x)">{{x.status}}</td></tr></tbody></table><div ng-if="vm.currentPromoter.businesses.length == 0">No Businesses.</div></div><div class="text-right" role="group"><button type="button" ng-click="vm.goBack()" class="btn btn-default">Back</button></div></div></div></div>'),t.put("app/admin/Partials/plan.html",'<br><div class="row" ng-if="vm.isAdmin"><div id="veil" ng-hide="vm.dataReady"></div><div id="feedLoading" ng-hide="vm.dataReady"><div style="text-align: center" ng-if="!vm.dataReady"><div><img src="/assets/images/loading.gif" class="img" style="width:50px;height:50px"></div><p style="font-size:large">loading plans information...</p></div></div><div id="veil" ng-hide="!vm.isSaving"></div><div id="feedLoading" ng-hide="!vm.isSaving"><div style="text-align: center" ng-if="vm.isSaving"><div><img src="/assets/images/loading.gif" class="img" style="width:50px;height:50px"></div><p style="font-size:large">saving plan...</p></div></div><div ng-if="vm.dataReady"><div class="container"><h3>Plans</h3><div ng-if="vm.notifications.length != 0"><notification-block notifications="vm.notifications"></notification-block></div><table class="table"><tbody><thead style="border-style:none;"><tr><th>Code</th><th>Price</th><th></th></tr></thead><tr ng-repeat="codeprice in vm.codeprices" style="cursor:pointer;"><td ng-click="vm.goDetailView(promoter)">{{codeprice.code}}</td><td ng-click="vm.goDetailView(promoter)">${{codeprice.price}}</td><td ng-click="vm.goDetailView(promoter)"><button class="btn btn-primary" ng-click="vm.changeCodePrice(codeprice)">Change</button></td></tr></tbody></table></div></div></div>'),t.put("app/admin/Partials/queries.html",'<div class="container" ng-if="vm.isAdmin"><h1>Queries</h1><br><a ng-click="vm.clearDb()" class="btn btn-danger">Clear Database</a><br><div class="row"><div class="col-sm-2"></div><div class="col-sm-8"><table class="table table-hover cursor"><tbody><thead><tr><th>User Input</th><th>Num. Results</th></tr></thead><tbody><tr ng-repeat="x in vm.queries | orderBy: \'-results\'"><td>{{x.query}}</td><td>{{x.results}}</td></tr></tbody></tbody></table></div><div class="col-sm-2"></div></div></div>'),t.put("app/admin/Partials/rodconsole.html",'<div id="veil" ng-hide="vm.dataReady"></div><div id="feedLoading" ng-hide="vm.dataReady"><div style="text-align: center" ng-if="!vm.dataReady"><div><img src="/assets/images/loading.gif" class="img" style="width:50px;height:50px"></div><p style="font-size:large">{{vm.loadText}}</p></div></div><div ng-if="vm.dataReady"><div class="container"><div ng-if="vm.overview"><h2>Ranking of the Day Admin Console</h2><div class="row"><div class="col-xs-6"><label class="checkbox-inline"><input type="checkbox" ng-change=\'vm.filterData("all")\' ng-model="vm.allIsSelected" ng-checked="vm.allIsSelected">&nbspAll</label></div><div class="col-xs-6"><label class="checkbox-inline"><input type="checkbox" ng-change=\'vm.filterData("next20")\' ng-model="vm.next20IsSelected" ng-checked="vm.next20IsSelected">&nbspNext 20</label></div></div><br><table class="table"><tbody><thead style="border-style:none;"><tr><th>Date</th><th>Title</th><th>Category</th></tr></thead><tr ng-repeat="x in vm.rods" style="cursor:pointer;" ng-click="vm.selRank(x)"><td align="middle">{{x.datenum}}</td><td align="middle">{{x.title}}</td><td align="middle">{{x.category}}</td><td align="middle" ng-attr-style="background-color:{{x.imageok ? \'palegreen\':\'grey\'}}">{{x.imageok ? \'Ready\':\'None\'}}</td><td align="middle" ng-attr-style="background-color:{{x.textok ? \'palegreen\':\'grey\'}}">{{x.textok ? \'Ready\':\'None\'}}</td></tr></tbody></table></div><div ng-if="vm.detail"><h2>{{vm.rank.title}}</h2><br><p class="text-left"><strong>Date:</strong>{{vm.rank.date}}</p><br><div class="row"><div class="text-right col-xs-6"><label>Background Color:</label></div><div class="col-xs-6"><color-picker ng-model="vm.rank.bc" color-picker-swatch="true" color-picker-swatch-pos="\'left\'" color-picker-swatch-bootstrap="true" color-picker-swatch-only="true"></color-picker></div></div><br><div class="row"><div class="text-right col-xs-6"><label>Font Color:</label></div><div class="col-xs-6"><color-picker ng-model="vm.rank.fc" color-picker-swatch="true" color-picker-swatch-pos="\'left\'" color-picker-swatch-bootstrap="true" color-picker-swatch-only="true"></color-picker></div></div><br><div class="row"><div class="text-right col-xs-6"><label>Shade Factor:</label></div><div class="col-xs-5 sm-4 md-2 lg-2"><div class="input-group"><span class="input-group-btn"><button class="btn btn-primary" ng-click="vm.minusShade()"><i class="fa fa-minus"></i></button></span> <input style="text-align:center" class="form-control" ng-model="vm.rank.shade" type="text" placeholder="vm.rank.shade"> <span class="input-group-btn"><button class="btn btn-primary" ng-click="vm.plusShade()"><i class="fa fa-plus"></i></button></span></div></div></div><br><div class="row"><div class="container col-xs-6 col-sm-6 col-md-4 col-lg-3" style="color:{{vm.rank.fc}};height:{{vm.sm ? \'150px\':\'200px\'}};margin:0px;padding:0px;border:0px;position:relative; background: {{vm.rank.bc}}; background: -webkit-linear-gradient(left, {{vm.rank.bc}}, {{vm.rank.bc2}}); background: -o-linear-gradient(right, {{vm.rank.bc}}, {{vm.rank.bc2}}); background: -moz-linear-gradient(right, {{vm.rank.bc}}, {{vm.rank.bc2}}); background: linear-gradient(to right, {{vm.rank.bc}}, {{vm.rank.bc2}});"><h2 class="hidden-xs text-center" style="padding:3px; margin:0px; position:absolute; top:50%; left:50%; margin-right:-50%;transform: translate(-50%,-50%)">{{vm.rank.title}}</h2><h3 class="hidden-sm hidden-md hidden-lg hidden-xl text-center" style="padding:3px; margin:0px; position:absolute; top:50%; left:50%; margin-right:-50%;transform: translate(-50%,-50%)">{{vm.rank.title}}</h3></div><div class="col-xs-6 col-sm-6 col-md-4 col-lg-3" style="margin:0px;padding:0px;border:0px;" ng-if="!vm.isShortPhrase"><img ng-src="{{vm.rank.image1}}" ng-attr-style="display:{{vm.rank.image1 != undefined ? \'inline\':\'none\'}};width:100%;height:{{vm.sm ? \'150px\':\'200px\'}};"></div><div class="hidden-xs hidden-sm col-md-4 col-lg-3" style="margin:0px;padding:0px;border:0px;" ng-if="!vm.isShortPhrase"><img ng-src="{{vm.rank.image2}}" ng-attr-style="display:{{vm.rank.image1 != undefined ? \'inline\':\'none\'}};width:100%;height:{{vm.sm ? \'150px\':\'200px\'}};"></div><div class="hidden-xs hidden-sm hidden-md col-lg-3" style="margin:0px;padding:0px;border:0px;" ng-if="!vm.isShortPhrase"><img ng-src="{{vm.rank.image3}}" ng-attr-style="display:{{vm.rank.image1 != undefined ? \'inline\':\'none\'}};width:100%;height:{{vm.sm ? \'150px\':\'200px\'}};"></div><div class="container col-xs-6 col-sm-6 col-md-4 col-lg-3" ng-if="vm.isShortPhrase" ng-attr-style="background-color:lightgray;color:black;height:{{vm.sm ? \'150px\':\'200px\'}};margin:0px;padding:0px;border:0px;position:relative;"><div style="padding:3px; margin:0px; position:absolute; top:50%; left:50%; margin-right:-50%;transform: translate(-50%,-50%)"><h2 class="hidden-xs text-center">{{vm.rank.title1}}</h2><h3 class="hidden-sm hidden-md hidden-lg hidden-xl text-center">{{vm.rank.title1}}</h3></div></div><div class="container hidden-xs hidden-sm col-md-4 col-lg-3" ng-if="vm.isShortPhrase" ng-attr-style="background-color:lightgray;color:black;height:{{vm.sm ? \'150px\':\'200px\'}};margin:0px;padding:0px;border:0px;position:relative;"><div style="padding:3px; margin:0px; position:absolute; top:50%; left:50%; margin-right:-50%;transform: translate(-50%,-50%)"><h2 class="hidden-xs text-center">{{vm.rank.title2}}</h2><h3 class="hidden-sm hidden-md hidden-lg hidden-xl text-center">{{vm.rank.title2}}</h3></div></div><div class="container hidden-xs hidden-sm hidden-md col-lg-3" ng-if="vm.isShortPhrase" ng-attr-style="background-color:lightgray;color:black;height:{{vm.sm ? \'150px\':\'200px\'}};margin:0px;padding:0px;border:0px;position:relative;"><div style="padding:3px; margin:0px; position:absolute; top:50%; left:50%; margin-right:-50%;transform: translate(-50%,-50%)"><h2 class="hidden-xs text-center">{{vm.rank.title3}}</h2><h3 class="hidden-sm hidden-md hidden-lg hidden-xl text-center">{{vm.rank.title3}}</h3></div></div></div><br><div class="row"><div class="text-left col-xs-6"><blob-upload></blob-upload></div><div class="text-right col-xs-6"><button class="btn btn-danger" ng-click="vm.goDeleteImage()">Delete Image</button> <button class="btn btn-success" ng-click="vm.goSaveImage()">Save Image & Design</button></div></div><input type="text" class="form-control" ng-model="vm.addval" bs-options="c for c in vm.addopts" bs-typeahead=""> <span class="input-group-btn text-right"><button class="btn btn-success" type="button" ng-click="vm.addCategory()">Add</button></span><label class="control-label capitalize">Social Media Text:</label> <textarea id="textarea1" class="form-control" ng-model="vm.rank.introtext" rows="6">\n        </textarea><br><br><div class="text-right"><button class="btn btn-success" ng-click="vm.goSaveText()">Save Intro Text</button></div><br><div class="text-right"><button class="btn btn-default" ng-click="vm.goBack()">Back</button></div></div><br><br><br></div></div>'),t.put("app/admin/Partials/sibLocs.html",'<div class="container"><br><h1>Sibbling Locations</h1><br><input type="text" class="form-control" ng-model="vm.answername" bs-options="c for c in vm.ansOpts" bs-typeahead=""> <span class="input-group-btn text-right"><button class="btn btn-success" type="button" ng-click="vm.selAns()">Add</button></span><br><div ng-if"vm.answer.anslocs"=""><h2>{{vm.answer.name}}</h2><h4>{{vm.answer.location}}</h4></div><br><strong>Sibbling Locations</strong><ul class="list-group"><li class="list-group-item" ng-repeat="x in vm.locations" style="cursor:pointer;">{{x.name}},&nbsp{{x.location}} <i class="glyphicon glyphicon-remove pull-right" ng-click="vm.remAns(x)"></i></li></ul><br><input type="text" class="form-control" ng-model="vm.brothername" bs-options="c for c in vm.ansOpts" bs-typeahead=""> <span class="input-group-btn text-right"><button class="btn btn-primary" type="button" ng-click="vm.addBrother()">Add Brother</button></span><br><div class="text-center"><button class="btn btn-success" type="button" ng-click="vm.confirm()">Add Sibbling Locations</button></div><br></div>'),t.put("app/admin/Partials/sitemap.html",'<h1>Create sitemap.xml</h1><br><button class="btn btn-primary" ng-click="vm.createSitemap()">Create Sitemap</button><br><div ng-repeat="x in vm.sitemap">{{x}}<br></div>'),t.put("app/admin/Partials/staticpagesconsole.html",'<div class="container"><h1>Static Pages Console</h1><div class="input-group text-right"><button class="btn {{vm.mode == \'ranks\'? \'btn-primary\':\'btn-default\'}}" type="button" ng-click="vm.selRanks()">Ranks</button> <button class="btn {{vm.mode == \'answers\'? \'btn-primary\':\'btn-default\'}}" type="button" ng-click="vm.selAnswers()">Answers</button></div><div class="input-group"><input type="text" class="form-control" ng-model="vm.query" bs-options="c for c in vm.rankopts" bs-typeahead=""> <span class="input-group text-right"><button class="btn btn-default" type="button" ng-click="vm.getPage()">Get Static Page</button> <button class="btn btn-default" type="button" ng-click="vm.recreatePage()">Re-Create</button> <button class="btn btn-default" type="button" ng-click="vm.forceScrape()">Scrape</button> <button class="btn btn-default" type="button" ng-click="vm.share()">Share</button></span></div><div class="input-group"><span class="input-group text-right"><button class="btn btn-default" type="button" ng-click="vm.recreateAll()">Re-Create All</button> <button class="btn btn-default" type="button" ng-click="vm.scrapeAll()">Scrape All</button></span></div><div class="progress" ng-if="vm.inprogress"><div class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="vm.cpct" aria-valuemin="0" aria-valuemax="100" style="width:{{vm.cpct}}%">{{vm.cpct}}% Complete (success)</div></div><div ng-if="!vm.inprogress" ng-repeat="x in vm.pagecontent">{{x}}<br></div></div>'),t.put("app/admin/Partials/updateHeaders.html",'<div class="container" ng-if="vm.isAdmin"><br><br><h1>Refresh Headlines</h1><br><div class="text-center"><button ng-click="vm.catStrings()" class="btn btn-primary">Check for Empty Category Strings</button><br><br><button ng-click="vm.refresh()" class="btn btn-success">Shuffle Headers</button><br><br><button ng-click="vm.createCBlocksRecsCity()" class="btn btn-success">Create C-Blocks City</button><br><br><button ng-click="vm.createCBlocksRecsNh()" class="btn btn-success">Create C-Blocks Neighborhood</button><br><br><button ng-click="vm.createCBlocksRecsRankX()" class="btn btn-success">Create C-Blocks RankX</button><br><br><button ng-click="vm.deleteCBlocks()" class="btn btn-warning">Delete ALL C-Blocks</button></div><div ng-repeat="x in vm.res track by $index">{{x.modeNum}} - {{x.htitle}} - {{x.scope}} - {{x.title}}</div></div>'),t.put("app/admin/Partials/views.html",'<h1>Views</h1><div class="row"><div class="col-sm-2"></div><div class="col-sm-8"><table class="table table-hover cursor"><tbody><thead><tr><th>Ranking</th><th>Views</th></tr></thead><tbody><tr ng-repeat="x in vm.content | orderBy: \'-views\'"><td>{{x.title}}</td><td>{{x.views}}</td></tr></tbody></tbody></table></div><div class="col-sm-2"></div></div>')}]),function(){"use strict";angular.module("app").config(["$stateProvider","$urlRouterProvider",function(t,e){$([{name:"queries",parent:"admin",url:"/queries",templateUrl:"app/admin/Partials/queries.html",controller:"queries as vm"},{name:"views",parent:"admin",url:"/views",templateUrl:"app/admin/Partials/views.html",controller:"views as vm"},{name:"flags",parent:"admin",url:"/flags",templateUrl:"app/admin/Partials/flags.html",controller:"flags as vm"},{name:"addRank",parent:"admin",url:"/addRank",templateUrl:"app/admin/Partials/addRank.html",controller:"addRank as vm"},{name:"dbMaint",parent:"admin",url:"/dbMaint",templateUrl:"app/admin/Partials/dbMaint.html",controller:"dbMaint as vm"},{name:"mergeAnswers",parent:"admin",url:"/mergeAnswers",templateUrl:"app/admin/Partials/mergeAnswers.html",controller:"mergeAnswers as vm"},{name:"dbQuery",parent:"admin",url:"/dbQuery",templateUrl:"app/admin/Partials/dbQuery.html",controller:"dbQuery as vm"},{name:"imagesmod",parent:"admin",url:"/imagemod",templateUrl:"app/admin/Partials/imagesmod.html",controller:"imagesmod as vm"},{name:"staticpagesconsole",parent:"admin",url:"/staticpagesconsole",templateUrl:"app/admin/Partials/staticpagesconsole.html",controller:"staticpagesconsole as vm"},{name:"answerimages",parent:"admin",url:"/answerimages",templateUrl:"app/admin/Partials/answerimages.html",controller:"answerimages as vm"},{name:"sitemap",parent:"admin",url:"/sitemap",templateUrl:"app/admin/Partials/sitemap.html",controller:"sitemap as vm"},{name:"locations",parent:"admin",url:"/locations",templateUrl:"app/admin/Partials/locations.html",controller:"locations as vm"},{name:"updateHeaders",parent:"admin",url:"/updateHeaders",templateUrl:"app/admin/Partials/updateHeaders.html",controller:"updateHeaders as vm"},{name:"foodRanks",parent:"admin",url:"/foodRanks",templateUrl:"app/admin/Partials/foodRanks.html",controller:"foodRanks as vm"},{name:"sibLocs",parent:"admin",url:"/sibLocs",templateUrl:"app/admin/Partials/sibLocs.html",controller:"sibLocs as vm"},{name:"payment",parent:"admin",url:"/payment",templateUrl:"app/admin/Partials/payment.html",controller:"payment as vm"},{name:"plan",parent:"admin",url:"/plan",templateUrl:"app/admin/Partials/plan.html",controller:"plan as vm"},{name:"bizadmin",parent:"admin",url:"/bizadmin",templateUrl:"app/admin/Partials/bizadmin.html",controller:"bizadmin as vm"},{name:"cleandb",parent:"admin",url:"/cleandb",templateUrl:"app/admin/Partials/cleandb.html",controller:"cleandb as vm",resolve:{load:["$ocLazyLoad",function(t){return t.load({rerun:!0,files:["scripts/vendor3.js"]})}]}},{name:"rodconsole",url:"/rodconsole",parent:"layout",templateUrl:"app/admin/Partials/rodconsole.html",controller:"rodconsole as vm"}]).each(function(){t.state(this)})}])}(),function(){"use strict";function t(t,e,n){this.title="views",this.content=e.content,console.log("views page Loaded!")}angular.module("app").controller("views",t),t.$inject=["$location","$rootScope","$state"]}(),function(){"use strict";function t(t,e,n,a,s,i){var o=this;o.title="updateHeaders",o.refresh=function(){if(!r){r=!0;var t="",n=[],a=[];o.res=[];for(var i=!0,l="",c="",d=0;d<e.cblocks.length;d++){l="",c="",i=!0,a=[];for(var g=0;g<e.headlines.length;g++)if(e.cblocks[d].type==e.headlines[g].type){"city"==e.cblocks[d].scope&&(t=e.headlines[g].filter+" isMP"),"rx"==e.cblocks[d].scope&&(t=e.headlines[g].filter),"nh"==e.cblocks[d].scope&&(t=e.headlines[g].filter+" "+e.cblocks[d].scopename),n=t.split(" ");break}for(var m="",u=0;u<e.content.length;u++){m=e.content[u].tags+" "+e.content[u].title,i=!0;for(var p=0;p<n.length;p++){var v=n[p].charAt(0).toUpperCase()+n[p].slice(1),b=n[p].charAt(0).toLowerCase()+n[p].slice(1);i=i&&(m.indexOf(n[p])>-1||m.indexOf(n[p].toUpperCase())>-1||m.indexOf(v)>-1||m.indexOf(b)>-1)}i&&a.push(e.content[u].id)}!function(t){for(var e,n,a=t.length;0!==a;)n=Math.floor(Math.random()*a),e=t[a-=1],t[a]=t[n],t[n]=e}(a);for(var h=0;h<a.length;h++)l=l+":"+a[h];c=l.substring(1),s.update(e.cblocks[d].id,["catstr"],[c])}}},o.createCBlocksRecsCity=function(){if(!l){for(var t=["rankofweek","city","lifestyle","food","politics","services","social","beauty","sports","personalities","technology","dating","health"],e={},n=0;n<t.length;n++)(e={}).scope="city",e.ismp=!0,e.scopename="San Diego",e.catstr="0",e.type=t[n],s.addcblock(e);l=!0}},o.createCBlocksRecsNh=function(){if(!d){for(var t=["rankofweeknh","neighborhood","lifestyle","food","services","social","beauty","health"],e={},n=0;n<c.length;n++)for(var a=0;a<t.length;a++)(e={}).scope="nh",e.ismp=!1,e.scopename=c[n],e.catstr="0",e.type=t[a],s.addcblock(e);d=!0}},o.createCBlocksRecsRankX=function(){if(!g){for(var t=["rxfeedback","rxsuggestion"],e={},n=0;n<t.length;n++)(e={}).scope="rx",e.scopename="RankX",e.ismp=!1,e.catstr="0",e.type=t[n],s.addcblock(e);g=!0}},o.deleteCBlocks=function(){for(var t=0;t<e.cblocks.length;t++)s.deleteRec(e.cblocks[t].id)},o.catStrings=function(){for(var t=!1,n=[],a=0;a<e.content.length;a++)e.content[a].title.indexOf("in Hillcrest")>-1&&n.push(e.content[a]);for(var s=0;s<n.length;s++){for(var o="",r="",l=n[s].title.replace("Hillcrest","San Diego"),c=0;c<e.content.length;c++)if(l==e.content[c].title){if((null==e.content[c].catstr||void 0==e.content[c].catstr||0==e.content[c].catstr.length)&&473!=(m=e.content[c].id)&&3125!=m&&6949!=m&&7424!=m&&7675!=m&&3124!=m&&3163!=m&&3202!=m){console.log("Found gen rank --- ",e.content[c].title," ",e.content[c].id);for(var d=e.content[c].title.replace("San Diego",""),g=0;g<e.content.length;g++)e.content[g].title.indexOf(d)>-1&&g!=c&&(o=o+":"+e.content[g].id);r=o.substring(1),console.log("final catstr ---",r),i.update(e.content[c].id,["isatomic","catstr"],[!1,r])}break}for(o="",r="",l=n[s].title.replace("Hillcrest","Downtown"),c=0;c<e.content.length;c++)if(l==e.content[c].title){if(null==e.content[c].catstr||void 0==e.content[c].catstr||0==e.content[c].catstr.length){var m=e.content[c].id;if(473!=m&&3125!=m&&6949!=m&&7424!=m&&7675!=m&&3124!=m&&3163!=m&&3202!=m){console.log("Found gen rank --- ",e.content[c].title," ",e.content[c].id);for(var d=e.content[c].title.replace("Downtown",""),g=0;g<e.content.length;g++)if(e.content[g].title.indexOf(d)>-1&&g!=c){for(t=!1,a=0;a<e.districts.length;a++)e.content[g].title.includes(e.districts[a])&&(t=!0);t&&(o=o+":"+e.content[g].id)}r=o.substring(1),console.log("final catstr ---",r),i.update(e.content[c].id,["isatomic","catstr"],[!1,r])}}break}}},o.isAdmin=e.isAdmin;var r=!1;console.log("updateHeaders page Loaded!");var l=!1,c=e.nhs,d=!1,g=!1}angular.module("app").controller("updateHeaders",t),t.$inject=["$location","$rootScope","$state","headline","cblock","table"]}(),function(){"use strict";function t(t,e,n,a,s){function i(){r.mode="ranks",r.rankopts=[];for(var e=0;e<t.content.length;e++)r.rankopts.push(t.content[e].title)}function o(){r.inprogress=!0;"answers"==r.mode&&(r.cpct=c/t.answers.length*100,"answer"+t.answers[c].id+".html",e.createPageAnswer(t.answers[c]),c++,s(function(){o()},400))}var r=this;r.title="staticpagesconsole",r.dataready=!1,r.inprogress=!1;var l=[];r.rankopts=[];var c=0;r.selRanks=i,r.selAnswers=function(){r.mode="answers",r.rankopts=[];for(var e=0;e<t.answers.length;e++)r.rankopts.push(t.answers[e].name)},r.getPage=function(){var n="";if("ranks"==r.mode)for(a=0;a<t.content.length;a++)t.content[a].title==r.query&&(n="rank"+t.content[a].id+".html");if("answers"==r.mode)for(var a=0;a<t.answers.length;a++)t.answers[a].name==r.query&&(n="answer"+t.answers[a].id+".html");var s={},i="";s.filename=n,e.getPageContent(s).then(function(t){i=(i=t.data).replace(/>/g,">&&&"),r.pagecontent=i.split("&&&")})},r.recreatePage=function(){if("ranks"==r.mode)for(a=0;a<t.content.length;a++)t.content[a].title==r.query&&e.createPageRank(t.content[a]).then(function(){n.notificationSuccess("Success","File recreated successfully")});if("answers"==r.mode)for(var a=0;a<t.answers.length;a++)t.answers[a].name==r.query&&e.createPageRank(t.answers[a]).then(function(){n.notificationSuccess("Success","File recreated successfully")})},r.forceScrape=function(){var e="";if("ranks"==r.mode)for(s=0;s<t.content.length;s++)t.content[s].title==r.query&&(e="rank"+t.content[s].id+".html",i=a+e,FB.api("https://graph.facebook.com/","post",{id:[i],scrape:!0},function(t){n.notificationSuccess("Success","File scrapped successfully - "+t)}));if("answers"==r.mode)for(var s=0;s<t.answers.length;s++)if(t.answers[s].name==r.query){e="answer"+t.answers[s].id+".html";var i=a+e;FB.api("https://graph.facebook.com/","post",{id:[i],scrape:!0},function(t){n.notificationSuccess("Success","File scrapped successfully - "+t)})}},r.recreateAll=o,r.scrapeAll=function(){},r.share=function(e){if("ranks"==r.mode)for(i=0;i<t.content.length;i++)if(t.content[i].title==r.query){var n="rank"+t.content[i].id+".html",s=a+n;FB.ui({method:"feed",link:s,caption:"An example caption"},function(t){})}if("answers"==r.mode)for(var i=0;i<t.answers.length;i++)if(t.answers[i].name==r.query){var n="answer"+t.answers[i].id+".html",s=a+n;FB.ui({method:"feed",link:s,caption:"An example caption"},function(t){})}},r.pagecontent="",i(),e.getFileList().then(function(t){l=t.data,r.dataready=!1,console.log("static pages list ready")}),t.DEBUG_MODE&&console.log("staticpagesconsole page Loaded!")}angular.module("app").controller("staticpagesconsole",t),t.$inject=["$rootScope","staticpages","dialog","SERVER_URL","$timeout"]}(),function(){"use strict";function t(t,e,n,a,s){var i=this;i.title="sitemap",i.createSitemap=function(){o="",t.content.forEach(function(t){2==t.scope&&1==t.ismp&&null!=t.slug&&(o+="<url><loc>https://rank-x.com/rankSummary/"+t.slug+"</loc></url>")}),o=o.replace(/\/url>/g,"/url>&&&"),i.sitemap=o.split("&&&")};var o="";i.sitemap="",console.log("sitemap console loaded")}angular.module("app").controller("sitemap",t),t.$inject=["$rootScope","staticpages","dialog","SERVER_URL","$timeout"]}(),function(){"use strict";function t(t,e,n,a,s,i,o){function r(){var t=0;if(c.answer.ansLocs){c.locations=[];for(var n=0;n<c.answer.ansLocs.length;n++)t=e.answers.map(function(t){return t.id}).indexOf(c.answer.ansLocs[n]),c.locations.push(e.answers[t])}}function l(){var t=c.answer.ansLocs,e="";t.push(c.answer.id),console.log("bros - ",t);for(var n=0;n<t.length;n++){e="";for(var a=0;a<t.length;a++)n!=a&&(e=e+":"+t[a]);e=e.substring(1),o.updateAnswer(t[n],["family"],[e]),console.log("updated answer ",t[n]," brothers: ",e)}c.answer=void 0,c.locations=void 0,c.brothername="",c.answername=""}var c=this;c.title="sibLocs",c.selAns=function(){for(var t=0;t<e.answers.length;t++)c.answername==e.answers[t].name&&(c.answer=e.answers[t]);c.answer.ansLocs=[],c.locations=[],c.answer&&c.answer.family&&(c.answer.ansLocs=c.answer.family.split(":").map(Number)),r(c.answer)},c.addBrother=function(){for(var t=0;t<e.answers.length;t++)if(c.brothername==e.answers[t].name){for(var n=!1,a=0;a<c.answer.ansLocs.length;a++)if(c.answer.ansLocs[a]==e.answers[t].id){n=!0,console.log("flag repeated");break}e.answers[t].id==c.answer.id&&(console.log("flag2"),n=!0),n||(console.log("Added brother"),c.answer.ansLocs.push(e.answers[t].id))}console.log("@ addBrother ---\x3e vm.answer.ansLocs",c.answer.ansLocs),console.log("@ addBrother ---\x3e vm.answer",c.answer),r(),c.brothername=""},c.remAns=function(t){for(var e=0;e<c.locations.length;e++)c.locations[e].id==t.id&&(c.locations.splice(e,1),c.answer.ansLocs.splice(e,1));r(),console.log("vm.answer ",c.answer)},c.confirm=function(){i.confirmSiblings(c.answer,l)},function(){console.log("query Answer"),c.ansOpts=[];for(var t=0;t<e.answers.length;t++)c.ansOpts.push(e.answers[t].name)}(),console.log("sibLocs page Loaded!")}angular.module("app").controller("sibLocs",t),t.$inject=["$location","$rootScope","$state","catans","$http","dialog","answer"]}(),function(){"use strict";function t(t,e,n,a,s,i,o,r,l,c,d){function g(){v=[],a.getall().then(function(t){(v=t).forEach(function(t){if(t.datenum=i.date2number(t.date),t.category){var n=e.categories.map(function(t){return t.id}).indexOf(t.category);n>-1&&(t.title=e.categories[n].category.replace("@Nh","San Diego"),t.fimage=e.categories[n].fimage,t.introtext||null!=e.categories[n].introtext&&void 0!=e.categories[n].introtext&&""!=e.categories[n].introtext&&(t.introtext=e.categories[n].introtext),t.fc=e.categories[n].fc,t.bc=e.categories[n].bc,t.shade=e.categories[n].shade),void 0!=t.fimage&&""!=t.fimage?t.imageok=!0:t.imageok=!1,void 0!=t.introtext&&""!=t.introtext?t.textok=!0:t.textok=!1}}),p.dataReady=!0,p.rods=v}),p.addopts=[];for(var t=0;t<e.categories.length;t++)p.addopts.push(e.categories[t].category)}function m(){p.overview=!0,p.detail=!1}function u(){h?(p.rank.fimage=e.blobimage,p.rank.image1=p.rank.fimage):(p.rank.fimage=e.blobimage,p.rank.image3=p.rank.image2,p.rank.image2=p.rank.image1,p.rank.image1=p.rank.fimage),e.cmd1exe=!1}var p=this;p.title="rodconsole",p.selRank=function(t){p.overview=!1,p.detail=!0,p.addval="",p.rank=t,void 0!=p.rank.fimage&&""!=p.rank.fimage&&(p.rank.image3=p.rank.image2,p.rank.image2=p.rank.image1,p.rank.image1=p.rank.fimage),console.log("selRank",p.rank),console.log(p.rank.bc),null!=p.rank.bc?(f="h"!=p.rank.bc.charAt(0)?p.rank.bc:s.hsl2rgb(p.rank.bc),p.rank.bc2=s.shadeColor(f,p.rank.shade/10)):(p.rank.bc="hsl(240, 100%, 99%)",p.rank.bc2=s.shadeColor(p.rank.bc,-.3)),e.cmd1exe=!1},p.goBack=m,p.plusShade=function(){p.rank.shade=p.rank.shade+1,p.rank.shade>10&&(p.rank.shade=10),f=s.hsl2rgb(p.rank.bc),p.rank.bc2=s.shadeColor(f,p.rank.shade/10)},p.minusShade=function(){p.rank.shade=p.rank.shade-1,p.rank.shade<-10&&(p.rank.shade=-10),f=s.hsl2rgb(p.rank.bc),p.rank.bc2=s.shadeColor(f,p.rank.shade/10)},p.refreshImages=u,p.filterData=function(t){if("all"==t&&(p.next20IsSelected=!1,p.allIsSelected=!0),"next20"==t&&(p.next20IsSelected=!0,p.allIsSelected=!1),p.rods=[],p.next20IsSelected)for(var e=0;e<v.length;e++)v[e].datenum>=b&&p.rods.push(v[e]);else p.rods=v},p.goSaveImage=function(){if(void 0!=p.rank.fimage&&""!=p.rank.fimage){var t=["fimage","bc","fc","shade"];"h"==p.rank.bc.charAt(0)&&(p.rank.bc=s.hsl2rgb(p.rank.bc)),"h"==p.rank.fc.charAt(0)&&(p.rank.fc=s.hsl2rgb(p.rank.fc));var n=[p.rank.fimage,p.rank.bc,p.rank.fc,p.rank.shade],a="",i=[];if(p.rank.isatomic)console.log("rank:",p.rank.title),l.update(p.rank.rankid,t,n).then(function(){o.getDialog("rodimageuploadsuccess"),loadData(),m()});else{p.dataReady=!1,p.loadText="Saving data...",a=p.rank.title.replace(" in San Diego","");for(var c=0;c<e.content.length;c++)e.content[c].title.indexOf(a)>-1&&i.push(l.update(e.content[c].id,t,n));r.all(i).then(function(){p.dataReady=!0,o.getDialog("rodimageuploadsuccess"),loadData(),m()})}}else o.getDialog("nouploadedimage")},p.goSaveText=function(){d.update(p.rank.category,["introtext"],[p.rank.introtext]).then(function(){o.getDialog("introTextSaved"),g()});var t=p.rank.introtext;a.update(p.rank.id,["introtext"],[""]).then(function(){}),""==p.rank.introtext&&(p.rank.introtext=t)},p.goDeleteImage=function(){if(void 0!=p.rank.fimage&&""!=p.rank.fimage){c.deleteBlob(p.rank.fimage);var t=e.content.map(function(t){return t.id}).indexOf(p.rank.rankid),n=s.defaultRankColor(e.content[t]),a=["fimage","bc","fc","shade"],i=["",n[0],n[1],0],d="",g=[];if(p.rank.isatomic)l.update(p.rank.rankid,a,i).then(function(){o.getDialog("rodimagedeletesuccess"),loadData(),m()});else{p.dataReady=!1,p.loadText="Deleting image...",d=p.rank.title.replace(" in San Diego","");for(var u=0;u<e.content.length;u++)e.content[u].title.indexOf(d)>-1&&g.push(l.update(e.content[u].id,a,i));r.all(g).then(function(){p.dataReady=!0,o.getDialog("rodimagedeletesuccess"),loadData(),m()})}}else o.getDialog("nouploadedimage")},p.addCategory=function(){for(var t=0;t<e.categories.length;t++)p.addval==e.categories[t].category&&(console.log(p.rank.id,p.addval),a.update(p.rank.id,["category"],[e.categories[t].id]))},p.dataReady=!1;var v=[],b=0;p.overview=!0,p.detail=!1,p.rank={},p.sm=e.sm,p.allIsSelected=!0,p.next20IsSelected=!1,p.loadText="Loading data...";var h=!1;e.canswer={},e.canswer.id="featuredImages",p.testimage=e.EMPTY_IMAGE;var f="";e.$on("fileUploaded",function(t,a){e.cmd1exe=!!e.cmd1exe&&e.cmd1exe,"rodconsole"!=n.current.name||e.cmd1exe||(e.cmd1exe=!0,e.blobimage=a,u())}),o.enterPassword(function(){function t(t){return t}var n=new Date,a=n.getTimezoneOffset();n.setMinutes(n.getMinutes()-a);var s=t(n.getMonth()+1)+"/"+t(n.getDate())+"/"+n.getFullYear();b=i.date2number(s),g(),e.DEBUG_MODE&&console.log("rodconsole page Loaded!")},function(){e.$emit("backToResults")})}angular.module("app").controller("rodconsole",t),t.$inject=["$location","$rootScope","$state","rankofday","color","datetime","dialog","$q","table","imagelist","categories"]}(),function(){"use strict";function t(t,e,n,a){var s=this;s.title="queries",s.clearDb=function(){for(var t=0;t<s.queries.length;t++)a.deleteRec(s.queries[t].id)},s.isAdmin=e.isAdmin,a.getQueries().then(function(t){s.queries=t,console.log("Queries Loaded!")})}angular.module("app").controller("queries",t),t.$inject=["$location","$rootScope","$state","query"]}(),function(){"use strict";function t(t,e,n,a,s,i,o,r,l,c,d,g,m){function u(t,e){p.isSaving=!0,g.setCodePrice(t,e).then(function(e){p.isSaving=!1,"Custom Rank"==t.code?(p.notifications.push({message:"Custom Rank Price $ "+e.data.plan.amount/100+" has changed successfully",type:"success"}),t.price=e.data.plan.amount/100):(p.notifications.push({message:"Premium Plan "+t.code+" Price $ "+e.data.plan.amount/100+" has changed successfully",type:"success"}),t.price=e.data.plan.amount/100)}).catch(function(t){p.notifications.push({message:t.data.err.message,type:"error"})})}var p=this;p.title="plan",p.dataReady=!1,p.changeCodePrice=function(t){i.changeCodePriceDlg(t,u)},p.customranking={},p.notifications=[],p.isAdmin=e.isAdmin,p.isSaving=!1,o.all([d.get(),g.getSetting()]).then(function(t){p.codeprices=t[0],p.STRIPE_COMMISSION_PERCENTAGE=t[1].STRIPE_COMMISSION_PERCENTAGE,p.CUSTOM_RANK_PRICE=t[1].CUSTOM_RANK_PRICE,p.customranking={code:"Custom Rank",price:p.CUSTOM_RANK_PRICE},p.codeprices.push(p.customranking),p.dataReady=!0,console.log("Plan admin page Loaded!")})}angular.module("app").controller("plan",t),t.$inject=["$location","$rootScope","$state","$stateParams","table","dialog","$q","useraccnt","promoter","answer","codeprice","setting","$timeout"]}(),function(){"use strict";function t(t,e,n,a,s,i,o,r,l,c,d,g,m){function u(t){g.setSetting({STRIPE_COMMISSION_PERCENTAGE:parseInt(t)/100}).then(function(t){p.STRIPE_COMMISSION_PERCENTAGE=t.STRIPE_COMMISSION_PERCENTAGE})}var p=this;p.title="payment",p.dataReady=!1,p.promoters=[],p.isAdmin=e.isAdmin,p.detailview=!1,p.overview=!0,p.notifications=[],p.selectedPromoters=[],p.payPromoter=function(t){t.stripeid?r.payPromoter(t,p.STRIPE_COMMISSION_PERCENTAGE).then(function(e){p.notifications.push({message:"$"+t.balance*p.STRIPE_COMMISSION_PERCENTAGE+"transfered successfully to Promoter: "+t.firstname+" "+t.lastname,type:"success"}),t.lastPaymentDate=e.data.lastPaymentDate,t.payedThisMonth=!0}).catch(function(e){p.notifications.push({message:"$"+t.balance*p.STRIPE_COMMISSION_PERCENTAGE+"  to Promoter: "+t.firstname+" "+t.lastname+" transfer failed. ",type:"error"})}):window.alert("The promoter"+t.firstname+" "+t.lastname+" need to connect stipe account.")},p.gotoanswer=function(t){n.go("answerDetail",{index:t.slug})},p.goBack=function(){if(1==p.detailview)return p.overview=!0,void(p.detailview=!1)},p.goDetailView=function(t){p.currentPromoter=t,p.detailview=!0,p.overview=!1},p.showBusinessDetail=function(t){i.showBusinessDetailDlg(t,p.STRIPE_COMMISSION_PERCENTAGE,p.CUSTOM_RANK_PRICE)},p.addOrRemovePromoter=function(t){-1!=p.selectedPromoters.indexOf(t)?p.selectedPromoters.splice(p.selectedPromoters.indexOf(t),1):p.selectedPromoters.push(t)},p.paySelectedPromoters=function(){p.selectedPromoters.forEach(function(t){p.payPromoter(t)})},p.changeCommission=function(){i.changeCommissionDlg(p.STRIPE_COMMISSION_PERCENTAGE,u)},o.all([l.getall(),r.getallaccnts(),d.get(),g.getSetting()]).then(function(t){var n=t[1],a=t[2];p.STRIPE_COMMISSION_PERCENTAGE=t[3].STRIPE_COMMISSION_PERCENTAGE?t[3].STRIPE_COMMISSION_PERCENTAGE:.2,p.CUSTOM_RANK_PRICE=t[3].CUSTOM_RANK_PRICE,t[0].forEach(function(t){var s=angular.copy(t);s.businesses=[];for(var i=0;i<n.length;i++)if(n[i].promocode==t.code){var o=angular.copy(n[i]);"Basic"==o.status&&(o.style="background-color:#bfbfbf"),o.istrial?(o.status="On Trial "+Math.ceil(moment.duration(moment(o.discountEndDate)-moment()).asDays())+" Days left",o.style="background-color:#b3b300"):(o.status="Active",o.style="background-color:#009900");for(var r=0;r<a.length;r++)if(a[r].code==o.bizcat){o.price=a[r].price;break}o.totalCommission=0,o.ispremium&&(o.totalCommission+=o.price*p.STRIPE_COMMISSION_PERCENTAGE),o.hasranks&&(o.totalCommission+=o.ranksqty*p.CUSTOM_RANK_PRICE*p.STRIPE_COMMISSION_PERCENTAGE),s.businesses.push(o),function(t){c.getAnswer(t.answer).then(function(e){t.answerObj=e})}(s.businesses[s.businesses.length-1])}for(s.payedThisMonth=!0,s.lastPaymentDate||(s.payedThisMonth=!1),(moment(s.lastPaymentDate).year()==moment(e.setting.serverDate).year()&&moment(s.lastPaymentDate).month()<moment(e.setting.serverDate).month()||moment(s.lastPaymentDate).year()<moment(e.setting.serverDate).year())&&(s.payedThisMonth=!1),s.balance=0,i=0;i<s.businesses.length;i++)"Active"==s.businesses[i].status&&(s.balance+=s.businesses[i].monthlyCost);s.activeCount=s.businesses.filter(function(t){return"Active"==t.status}).length,s.ontrialCount=s.businesses.filter(function(t){return-1!=t.status.indexOf("On Trial")}).length,p.promoters.push(s)}),p.dataReady=!0}),console.log("payment admin page Loaded!")}angular.module("app").controller("payment",t),t.$inject=["$location","$rootScope","$state","$stateParams","table","dialog","$q","useraccnt","promoter","answer","codeprice","setting","$timeout"]}(),function(){"use strict";function t(t,e,n,a,s,i,o){function r(){console.log("@getData"),console.log("$rootScope.catansrecs.length ",e.catansrecs.length),c.idx=d;var t={},n={},a=0,s=0;c.ans1=e.dupAns[d].ans1,c.ans2=e.dupAns[d].ans2,l(),c.ans1.catans=[],a=c.ans1.id;for(i=0;i<e.catansrecs.length;i++)if(a==e.catansrecs[i].answer){t=e.catansrecs[i];for(o=0;o<e.content.length;o++)e.catansrecs[i].category==e.content[o].id&&(t.rank=e.content[o].title);c.ans1.catans.push(t)}c.ans2.catans=[],s=c.ans2.id;for(var i=0;i<e.catansrecs.length;i++)if(s==e.catansrecs[i].answer){n=e.catansrecs[i];for(var o=0;o<e.content.length;o++)e.catansrecs[i].category==e.content[o].id&&(n.rank=e.content[o].title);c.ans2.catans.push(n)}console.log("vm.ans1.catans.length ",c.ans1.catans.length),console.log("vm.ans2.catans.length ",c.ans2.catans.length)}function l(){g=[];for(var t="",n=0;n<e.content.length;n++)e.content[n].title.indexOf("in Hillcrest")>-1&&(t=e.content[n].title.replace("Hillcrest","@neighborhood"),g.push(t)),e.content[n].ismp&&g.push(e.content[n].title)}var c=this;c.title="mergeAnswers";var d=0;c.goPrev=function(t){(d-=t)<0&&(d=0),r()},c.goNext=function(t){(d+=t)>=c.tot&&(d=c.tot),r()},c.delAnswer=function(t){1==t&&(i.deleteAnswer(e.dupAns[d].ans1.id),a.deleteAnswer(e.dupAns[d].ans1.id)),2==t&&(i.deleteAnswer(e.dupAns[d].ans2.id),a.deleteAnswer(e.dupAns[d].ans2.id))},c.addCatans=function(t){if(1==t){c.addcts1opts=[];for(var e="",n=0;n<g.length;n++)g[n].indexOf("@neighborhood")>-1?(e=g[n].replace("@neighborhood",c.ans1.cityarea),c.addcts1opts.push(e)):c.addcts1opts.push(g[n]);c.addcts1active=!0}if(2==t){c.addcts2opts=[];for(var a="",n=0;n<g.length;n++)g[n].indexOf("@neighborhood")>-1?(a=g[n].replace("@neighborhood",c.ans2.cityarea),c.addcts2opts.push(a)):c.addcts2opts.push(g[n]);c.addcts2active=!0}},c.addcts=function(t){var n="",s={},i=0;1==t&&(n=c.addcts1val,s=c.ans1,void 0!=c.cat1isdup&&c.cat1isdup),2==t&&(n=c.addcts2val,s=c.ans2,void 0!=c.cat2isdup&&c.cat2isdup);for(var o=0;o<e.content.length;o++)if(e.content[o].title==n){i=e.content[o].id;break}a.postRec2(s.id,i),1==t&&(c.addcts1active=!1),2==t&&(c.addcts2active=!1),setTimeout(function(){r()},1e3)},c.delCatans=function(t){a.deleteRec(t.answer,t.category),setTimeout(function(){r()},1e3)},c.editAnswer=function(t){1==t&&n.go("editAnswer",{index:c.ans1.id}),2==t&&n.go("editAnswer",{index:c.ans2.id})},c.addcts1active=!1,c.addcts2active=!1;var g=[];c.tot=e.dupAns.length-1,l(),r(),console.log("mergeAnswers page Loaded!")}angular.module("app").controller("mergeAnswers",t),t.$inject=["$location","$rootScope","$state","catans","$http","answer","$stateParams"]}(),function(){"use strict";function t(t,e,n,a,s,i){function o(){r.locs=[];var e={},n=[];r.locations=t.locations.slice(1),r.locations.forEach(function(a){n=a.sub_areas.split(",").map(Number),a.sa=[],n.forEach(function(n){var s=t.locations.map(function(t){return t.id}).indexOf(n);s>-1&&((e={}).id=n,e.name=t.locations[s].nh_name,e.sel=!0,a.sa.push(e))}),a.sel=!1,r.locs.push(a.nh_name)})}var r=this;r.title="locations",r.getLocations=o,r.update=function(){var e="";r.locations.forEach(function(t){e+=","+t.id}),e=e.substring(1),console.log("str - ",e);var n=t.locations.map(function(t){return t.nh_name}).indexOf("San Diego");i.update(t.locations[n].id,["sub_areas"],[e])},r.enableAddLocation=function(){r.showAddLocation=!0},r.addLocation=function(){var e={};e.nh_name=r.locname,e.cityid=t.locations[0].cityid,e.cityname=t.locations[0].cityname,e.sub_areas="",i.addLocation(e).then(function(){r.showAddLocation=!1,o()})},r.editLocation=function(t){r.locations.forEach(function(t){t.sel=!1}),t.sel=!0},r.selsa=function(t){t.sel?t.sel=!1:t.sel=!0},r.addsa=function(e){var a={};a.sel=!0,a.name=r.newsa;var s=t.locations.map(function(t){return t.nh_name}).indexOf(r.newsa);s>-1?(a.id=t.locations[s].id,e.sa.push(a),r.newsa=""):n.getDialog("subAreaInvalid")},r.savesa=function(e){var n="";e.sa.forEach(function(t){t.sel&&(n+=","+t.id)}),n=n.substring(1),t.DEBUG_MODE&&console.log("str - ",n),i.update(e.id,["sub_areas"],[n]),e.sel=!1,o()},r.deleteloc=function(t){i.deleteRec(t.id).then(function(){o()})},r.cancel=function(t){t.sel=!1},r.showAddLocation=!1,r.opts=["San Diego"],r.locs=[],t.DEBUG_MODE&&console.log("locations page Loaded!")}angular.module("app").controller("locations",t),t.$inject=["$rootScope","staticpages","dialog","SERVER_URL","$timeout","locations"]}(),function(){"use strict";function t(t,e,n){function a(){s.uuis=t.uuis}var s=this;s.title="imagesmod",s.dataready=!1,s.removeImage=function(t){n.deleteBlob(t.imageurl),e.deleteRecord(t.id).then(a)},s.approveImage=function(t){e.deleteRecord(t.id).then(a)},e.getRecords().then(function(){s.dataready=!0,a()}),t.DEBUG_MODE&&console.log("imagesmod page Loaded!")}angular.module("app").controller("imagesmod",t),t.$inject=["$rootScope","useruploadedimages","imagelist"]}(),function(){"use strict";function t(t,e,n,a,s,i,o){function r(t){l.indexOf(e.answers[t].id)>-1?(i.updateAnswer(e.answers[t].id,["isfood"],[!0]),o(function(){t++,console.log(t," ",e.answers[t].name,", isfood is TRUE"),t<e.answers.length&&r(t)},100)):(i.updateAnswer(e.answers[t].id,["isfood"],[!1]),o(function(){t++,console.log(t," ",e.answers[t].name,", isfood is FALSE"),t<e.answers.length&&r(t)},100))}this.title="foodRanks";var l=[];this.getRanks=function(){console.log("getRanks");for(var t="",n=0;n<e.content.length;n++)e.content[n].tags.indexOf("food")>-1&&(t=t+":"+e.content[n].id);for(var s=t.substring(1).split(":").map(Number),i={},o=0,c=0,d=[],g=!1,m="",n=0;n<e.catansrecs.length;n++){i=e.catansrecs[n];for(var u=0;u<s.length;u++)if(i.category==s[u]){if(o=i.answer,(c=e.answers.map(function(t){return t.id}).indexOf(o))<0&&(console.log("idx - ",o,"catansrec - ",i.id,i.answer,i.category),a.deleteRec(i.answer,i.category)),g=!1,d.length>0&&c>0)for(var p=0;p<d.length;p++)if(d[p].id==e.answers[c].id){g=!0;break}g||(m=m+":"+e.answers[c].id,d.push(e.answers[c]))}}l=d.map(function(t){return t.id}),r(0),console.log("Answers Ids: - ",m.substring(1)),console.log("Food answers length: - ",d.length)},console.log("foodRanks page Loaded!")}angular.module("app").controller("foodRanks",t),t.$inject=["$location","$rootScope","$state","catans","$http","answer","$timeout"]}(),function(){"use strict";function t(t,e,n,a,s,i,o){function r(){a.getFlags().then(function(t){l.flags=t,console.log("flags - ",l.flags);for(var e=0;e<l.flags.length;e++){if("comment-rank"==l.flags[e].type||"comment-answer"==l.flags[e].type)switch(l.flags[e].flag){case 1:l.flags[e].desc="Off-Topic";break;case 2:l.flags[e].desc="Offensive";break;case 3:l.flags[e].desc="Spam"}if("answer"==l.flags[e].type)switch(l.flags[e].flag){case 1:l.flags[e].desc="Wrong Category";break;case 2:l.flags[e].desc="No longer active";break;case 3:l.flags[e].desc="Offensive";break;case 4:l.flags[e].desc="Spam"}}})}var l=this;l.title="flags",l.getFlags=r,l.gotoView=function(t){"answer"==t.type&&n.go("answerDetail",{index:t.number}),"comment-answer"==t.type&&n.go("answerDetail",{index:t.number}),"comment-rank"==t.type&&n.go("rankSummary",{index:t.number})},l.delCatans=function(t){s.deleteRec(t.answer,t.category)},l.delComment=function(t){"comment-rank"==l.data.type&&i.deletecomment(t.id),"comment-answer"==l.data.type&&o.deletecomment(t.id)},l.seeDetails=function(t){l.viewTable=!1,l.viewDetails=!0;var n={};if(l.data={},l.catans=[],l.comments=[],l.data.type=t.type,l.data.desc=t.desc,l.data.id=t.id,"answer"==t.type){r=e.answers.map(function(t){return t.id}).indexOf(t.number),l.data.imageurl=e.answers[r].imageurl,l.data.name=e.answers[r].name,l.data.location=e.answers[r].location,l.data.cityarea=e.answers[r].cityarea,l.data.phone=e.answers[r].phone,l.data.website=e.answers[r].website,l.data.addinfo=e.answers[r].addinfo;for(var a=0;a<e.catansrecs.length;a++)if(e.answers[r].id==e.catansrecs[a].answer){n={},n=e.catansrecs[a];for(var s=0;s<e.content.length;s++)e.catansrecs[a].category==e.content[s].id&&(n.rank=e.content[s].title);l.catans.push(n)}}"comment-answer"==t.type&&(r=e.answers.map(function(t){return t.id}).indexOf(t.number),l.data.imageurl=e.answers[r].imageurl,l.data.name=e.answers[r].name,l.data.location=e.answers[r].location,l.data.cityarea=e.answers[r].cityarea,l.data.phone=e.answers[r].phone,l.data.website=e.answers[r].website,l.data.addinfo=e.answers[r].addinfo,o.getcommentsbyanswer(t.number).then(function(t){l.comments=t}));if("comment-rank"==t.type){var r=e.content.map(function(t){return t.id}).indexOf(t.number);l.data.title=e.content[r].title,i.getcommentsbyrank(t.number).then(function(t){l.comments=t})}},l.seeFlags=function(){l.viewTable=!0,l.viewDetails=!1},l.deleteFlag=function(t){a.deleteFlag(t.id).then(function(){r()})},l.viewDetails=!1,l.viewTable=!0,console.log("Flags page loaded!")}angular.module("app").controller("flags",t),t.$inject=["$location","$rootScope","$state","flag","catans","comment","comment2"]}(),function(){"use strict";function t(t,e,n,a,s,i,o,r){var l=this;l.title="dbQuery",l.queryAnswer=function(){console.log("query Answer"),l.ansRes=[];for(var t=0,n={},a=0;a<e.answers.length;a++)e.answers[a].name.indexOf(l.val)>-1&&l.ansRes.push(e.answers[a]);for(var s=0;s<l.ansRes.length;s++){l.ansRes[s].catans=[],t=l.ansRes[s].id;for(var i=0;i<e.catansrecs.length;i++)if(t==e.catansrecs[i].answer){n=e.catansrecs[i];for(var o=0;o<e.content.length;o++)e.catansrecs[i].category==e.content[o].id&&(n.rankid=e.content[o].id,n.catid=e.content[o].cat,n.title=e.content[o].title);l.ansRes[s].catans.push(n)}}},l.delCatans=function(t){r.deleteRec(t.answer,t.category)},l.delAnswer=function(t){o.deleteAnswer(t.id)},l.isAdmin=e.isAdmin||e.dataAdmin,l.isDET=e.isLoggedIn&&(12==e.user.id||30==e.user.id||41==e.user.id||42==e.user.id||30==e.user.id),console.log("dbQuery page Loaded!")}angular.module("app").controller("dbQuery",t),t.$inject=["$location","$rootScope","$state","$stateParams","table","dialog","answer","catans"]}(),function(){"use strict";function t(t,e,n,a,s,i,o,r,l,c,d,g,m,u,p,v,b){function h(){var t={},n=!1;x.unrefans=[],x.addctsopts=[],x.ans=-1;for(var a=0;a<e.answers.length;a++){({}),t={},t=e.answers[a],n=!1;for(var s=0;s<e.catansrecs.length;s++)if(e.catansrecs[s].answer==t.id){n=!0;break}0==n&&x.unrefans.push(t)}if(x.unrefans.length>0)for(var i=0;i<e.content.length;i++)x.addctsopts.push(e.content[i].title)}function f(t){c.deleteAnswer(t.id).then(function(){h()})}function y(){console.log("@ Show Possible Duplicated"),console.log("answers length",e.answers.length);var t={},n={};x.dupAnswers=[];for(var a=0,s=0,i="",o=0;o<e.answers.length;o++)if(s=.75*e.answers[o].name.length,t=e.answers[o],i=e.answers[o].name.slice(0,s),"Establishment"==e.answers[o].type&&i.length>8)for(var r=0;r<e.answers.length;r++)e.answers[r].name.indexOf(i)>-1&&o!=r&&((n={}).id=a,n.add1=t.addinfo,n.nh1=t.cityarea,n.loc1=t.location,n.name1=t.name,n.image1=t.imageurl,n.id1=t.id,n.name2=e.answers[r].name,n.idx1=o,n.idx2=r,n.loc2=e.answers[r].location,n.nh2=e.answers[r].cityarea,n.add2=e.answers[r].addinfo,n.image2=e.answers[r].imageurl,n.id2=e.answers[r].id,x.dupAnswers.push(n),a++);console.log("finished")}function w(){console.log("@estDistances, need to have GPS location stored-",e.answers.length),x.ans=-1,x.answerdist=[];for(var t=.017453292519943295,n=Math.cos,a=0,s=e.currentUserLatitude,i=e.currentUserLongitude,o=0,r=0,l=0,c={},d=0;d<e.answers.length;d++)"Establishment"==e.answers[d].type&&void 0!=e.answers[d].location&&""!=e.answers[d].location&&(o=e.answers[d].lat,r=e.answers[d].lng,c=e.answers[d],a=.5-n((o-s)*t)/2+n(s*t)*n(o*t)*(1-n((r-i)*t))/2,l=12742*Math.asin(Math.sqrt(a))/1.609,c.dist=l,(l>100||NaN==l)&&x.answerdist.push(c))}function k(){var t={},n="";x.codes=[],x.catcode={},x.ans=-1;var a=p.get(),s=v.get();return i.all([a,s]).then(function(a){e.catcodes=a[0],e.codeprices=a[1];for(var s=0;s<e.codeprices.length;s++)x.codes.push(e.codeprices[s].code);console.log("Category-codes loaded..."),x.ansNoCode=[];for(var i=0;i<e.answers.length;i++)if(("Establishment"==e.answers[i].type||"PersonCust"==e.answers[i].type)&&(t={},t=e.answers[i],void 0==(n=b.getBizCat(t.id))||""==n||null==n)){t.cats=[];for(var o=0;o<e.catansrecs.length;o++)if(e.catansrecs[o].answer==t.id)for(var r=0;r<e.content.length;r++)e.content[r].id==e.catansrecs[o].category&&t.cats.push(e.content[r].title);x.ansNoCode.push(t)}})}var x=this;x.title="dbMaint",x.showUrefAns=h,x.delAnswer=f,x.selAns=function(t){x.ans=t.id},x.showPossibleDuplicated=y,x.syncToFirst=function(t){for(var n=0;n<e.catansrecs.length;n++)if(t.id2==e.catansrecs[n].answer){d.updateRec(e.catansrecs[n].id,["answer"],[t.id1]);break}c.deleteAnswer(t.id2),y()},x.syncToSecond=function(t){for(var n=0;n<e.catansrecs.length;n++)if(t.id1==e.catansrecs[n].answer){d.updateRec(e.catansrecs[n].id,["answer"],[t.id2]);break}c.deleteAnswer(t.id1),y()},x.showDuplicatedOnlyName=function(){e.dupAns=[];var t={},n={};x.dupAnsNames=[];for(var a=0;a<e.answers.length;a++){t=e.answers[a];for(var s=0;s<e.answers.length;s++)t.name==e.answers[s].name&&t.location==e.answers[s].location&&a!=s&&((n={}).ans1=t,n.ans2=e.answers[s],e.dupAns.push(n),x.dupAnsRdy=!0)}},x.showDuplicatedByLocation=function(){e.fields=e.typeSchema[6].fields;for(var t={},n={},a=[],s=0;s<e.answers.length;s++)if(void 0!=(t=e.answers[s]).location&&""!=t.location)for(var i=0;i<e.answers.length;i++)void 0!=e.answers[i].location&&""!=e.answers[i].location&&t.location==e.answers[i].location&&s!=i&&((n={}).ans1=t,n.ans2=e.answers[i],a.push(n));e.dupAns=a,console.log("@finished - showDuplicatedByLocation"),x.dupAnsRdy=!0},x.findPhoneWebsite=function(){},x.findDuplicatedRanks=function(){for(var t=[],n=0;n<e.content.length;n++)for(var a=n;a<e.content.length;a++)e.content[n].title==e.content[a].title&&n!=a&&(console.log("duplicated rank --- ",e.content[n].title),t.push(e.content[n]))},x.clearAllCatansVotes=function(){console.log("Clearing all catans vote sums to zero")},x.syncUserVotes=function(){console.log("syncUSerVotes"),g.loadAllVotes().then(function(t){e.allvotes=t,function(){console.log("syncVotes");var t={},n={},a=[],s=[],i=0,o=0;x.syncp=[];for(var r={},l=0;l<e.catansrecs.length;l++){t=e.catansrecs[l],a=[],s=[],n={};for(var c=0;c<e.allvotes.length;c++)(n=e.allvotes[c]).catans==t.id&&(1==n.vote&&a.push(n),-1==n.vote&&s.push(n));a.length==t.upV&&s.length==t.downV||(r={},i=e.answers.map(function(t){return t.id}).indexOf(t.answer),o=e.content.map(function(t){return t.id}).indexOf(t.category),r.answername=e.answers[i].name,r.categorytitle=e.content[o].title,r.answer=e.answers[i].id,r.catans=t.id,r.category=e.content[o].id,r.caUpV=t.upV,r.caDownV=t.downV,r.nUpVlen=a.length,r.nDownVlen=s.length,r.upVotes=a,r.downVotes=s,x.syncp.push(r))}}()})},x.getAnswerBizCode=k,x.updatecatans=function(t){d.updateRec(t.catans,["upV","downV"],[t.nUpVlen,t.nDownVlen])},x.estDistances=w,x.gotoAnswer=function(t){n.go("answerDetail",{index:t.id})},x.createImagesJSON=function(){for(var t=[],n={},a=1256,s=0;s<e.answers.length;s++)e.answers[s].imageurl.indexOf("http://")>-1&&((n={}).id=a++,n.answer=e.answers[s].id,n.url=e.answers[s].imageurl,t.push(n));console.log(JSON.stringify(t))},x.updateUrls=function(){var t=[],e="";u.get("../../../assets/images.json").then(function(n){t=n.data;for(var a=0;a<t.length;a++)t[a].url.indexOf("jpg")>-1&&(e="jpg"),t[a].url.indexOf("png")>-1&&(e="png"),t[a].url.indexOf("jpeg")>-1&&(e="jpeg"),c.updateAnswer(t[a].answer,["image"],["https://rankx.blob.core.windows.net/sandiego/"+t[a].answer+"/"+t[a].id+"."+e])})},x.goMerge=function(){n.go("mergeAnswers")},x.getSlugs=function(){},x.delAnswer=f,x.addcts=function(t){var n="",a=0;n=x.addctsval;for(var s=0;s<e.content.length;s++)if(e.content[s].title==n){a=e.content[s].id;break}d.postRec2(x.ans,a).then(function(){h()})},x.selEditAddress=function(t){console.log("selEditAddess - ",t),x.ans=t.id},x.editAddress=function(t){o.getLocationGPS(t).then(function(){c.updateAnswer(t.id,["location","lat","lng"],[t.location,t.lat,t.lng]).then(function(){w()})})},x.addcatcode=function(){p.post(x.catcode).then(function(){console.log("Added category code pair"),k()})},x.categoryStr=function(){x.catstrmode=!0;for(var t=0,n="",a=[],s=[],i=0;i<e.content.length;i++){a=[],m.getInclusiveAreas(e.content[i].nh,a),s=[];for(var o=0;o<e.content.length;o++)if(e.content[i].cat==e.content[o].cat)for(var l=0;l<a.length;l++)a[l]==e.content[o].nh&&-1==s.indexOf(e.content[o].id)&&s.push(e.content[o].id);n="";for(var c=0;c<s.length;c++)n=n+":"+s[c];n=n.substring(1),r.update(e.content[i].id,["catstr"],[n]).then(function(){t++,x.cpct=Math.floor(t/e.content.length*100)})}},x.deleteDupVotes=function(t){for(var n=!1,a=0;a<e.allvotes.length;a++)t.user==e.allvotes[a].user&&t.vote==e.allvotes[a].vote&&t.catans==e.allvotes[a].catans&&t.answer==e.allvotes[a].answer&&(n&&g.deleteRec(e.allvotes[a].id),n=!0)},x.isAdmin=e.isAdmin,x.dupAnsRdy=!1,x.catstrmode=!1,console.log("dbMaint page Loaded!")}angular.module("app").controller("dbMaint",t),t.$inject=["$location","$rootScope","$state","$stateParams","Upload","$q","getgps","table","dialog","answer","catans","votes","common","$http","categorycode","codeprice","useraccnt"]}(),function(){"use strict";function t(t,e,n,a,s,i,o,r,l,c,d,g,m,u,p,v,b,h,f,y){function w(){R.filteredCatans=[];var t=_.groupBy(R.catans,function(t){return"cat"+t.category+"answer"+t.answer});for(var e in t)t[e].length>1&&(t[e].dup=t[e].length,R.filteredCatans.push(t[e]));R.deletingCatans=!1,R.dtInstanceCatans={},m(function(){R.dtInstanceCatans.rerender()},1e3)}function k(){R.filteredCategories=[];var t=R.rankings.map(function(t){return t.cat});R.filteredCategories=R.categories.filter(function(e){return-1==t.indexOf(e.id)}),R.deletingCategories=!1,R.dtInstanceCategories={},m(function(){R.dtInstanceCategories.rerender()},1e3)}function x(){R.filteredAnswers=[];var t=R.catans.map(function(t){return t.answer});R.filteredAnswers=R.answers.filter(function(e){return-1==t.indexOf(e.id)}),R.deletingAnswers=!1,R.dtInstanceAnswers={},m(function(){R.dtInstanceAnswers.rerender()},1e3)}function A(){R.filteredRankings=[];var t=R.catans.map(function(t){return t.category});R.filteredRankings=R.rankings.filter(function(e){return-1==t.indexOf(e.id)}),R.deletingRankings=!1,R.dtInstanceRankings={},m(function(){R.dtInstanceRankings.rerender()},1e3)}function S(){R.filteredFImages=[];var t=R.categories.map(function(t){return t.fimage});R.filteredFImages=R.fimages.filter(function(e){return-1==t.indexOf(e.url)}),R.deletingFImages=!1,R.dtInstanceFImages={},m(function(){R.dtInstanceFImages.rerender()},1e3)}var R=this;R.title="cleandb",R.dataReady=!1,R.catans=[],R.accounts=[],R.rankings=[],R.categories=[],R.answers=[],R.fimages=[],R.isAdmin=e.isAdmin,R.notifications=[],R.gotoanswer=function(t){n.go("answerDetail",{index:t.slug})},R.filterCatans=w,R.filterCategories=k,R.filterAnswers=x,R.filterRankings=A,R.filterFImages=S,R.deleteSelectedCatans=function(){R.deletingCatans=!0;var t=[];R.filteredCatans.filter(function(t){return t[0].checked}).forEach(function(e){for(var n=1;n<e.length;n++)t.push(v.deleteCatan(e[n].id))}),o.all(t).then(function(t){t.forEach(function(t){var e=R.catans.map(function(t){return t.id}).indexOf(t.resource[0].id);R.catans.splice(e,1)}),w()})},R.deleteSelectedCategories=function(){R.deletingCategories=!0;var t=[];R.filteredCategories.filter(function(t){return t.checked}).forEach(function(e){t.push(b.deleteRec(e.id))}),o.all(t).then(function(t){t.forEach(function(t){var e=R.categories.map(function(t){return t.id}).indexOf(t.id);R.categories.splice(e,1)}),k()})},R.deleteSelectedAnswers=function(){R.deletingAnswers=!0;var t=[];R.filteredAnswers.filter(function(t){return t.checked}).forEach(function(e){t.push(c.deleteAnswer(e.id))}),o.all(t).then(function(t){t.forEach(function(t){var e=R.answers.map(function(t){return t.id}).indexOf(t.id);R.answers.splice(e,1)}),x()})},R.deleteSelectedRankings=function(){R.deletingRankings=!0;var t=[];R.filteredRankings.filter(function(t){return t.checked}).forEach(function(e){t.push(s.deleteTable(e.id))}),o.all(t).then(function(t){t.forEach(function(t){var e=R.rankings.map(function(t){return t.id}).indexOf(t.id);R.rankings.splice(e,1)}),A()})},R.deleteSelectedFImages=function(){R.deletingFImages=!0;var t=R.filteredFImages.filter(function(t){return t.checked}),e=[];t.forEach(function(t){e.push(y.deleteBlob(t.url))}),o.all(e).then(function(e){t.forEach(function(t){var e=R.fimages.map(function(t){return t.url}).indexOf(t.url);R.fimages.splice(e,1)}),S()})},R.dtInstanceCatans={},R.dtInstanceCategories={},R.dtInstanceAnswers={},R.dtInstanceRankings={},R.dtInstanceFImages={},R.filteredCatans=[],R.filteredCategories=[],R.filteredAnswers=[],R.filteredRankings=[],R.filteredFImages=[],o.all([v.getAllcatans(),r.getallaccnts(),b.getAllCategories(),f.getAllLocations(),s.getTables(),c.getAnswers(),y.getFeatureImageList()]).then(function(t){R.catans=t[0],R.accounts=t[1],R.categories=t[2],R.locations=t[3],e.categories=t[2],e.locations=t[3],e.content=t[4],h.unwrap(),R.rankings=e.content,R.answers=t[5],R.fimages=t[6],console.log("vm.fimages - ",R.fimages),R.dataReady=!0,w(),k(),x(),A(),S()})}angular.module("app").controller("cleandb",t),t.$inject=["$location","$rootScope","$state","$stateParams","table","dialog","$q","useraccnt","promoter","answer","codeprice","setting","$timeout","DTOptionsBuilder","DTColumnDefBuilder","catans","categories","dataloader","locations","imagelist"]}(),function(){"use strict";function t(t,e,n,a,s,i,o,r,l,c,d,g,m,u,p){function v(){return 1==b.showFilter?b.filtered=b.businesses.filter(function(t){return t.hasranks||t.haspremium}):2==b.showFilter?b.filtered=b.businesses.filter(function(t){return!(t.hasranks||t.haspremium)}):(b.loading=!1,b.dtInstance.rerender(),b.filtered=b.businesses)}var b=this;b.title="bizadmin",b.dataReady=!1,b.businesses=[],b.isAdmin=e.isAdmin,b.notifications=[],b.gotoanswer=function(t){n.go("answerDetail",{index:t.slug})},b.filterData=v,b.showFilter=0,b.showUserFilter=!0,b.setShowPurchases=function(){b.showFilter=1,v()},b.setShowAll=function(){b.showFilter=0,v()},b.setShowNonPurchases=function(){b.showFilter=2,v()},b.showUser=function(){b.showUserFilter=!b.showUserFilter,v()},b.deleteSelected=function(){console.log(b.filtered.filter(function(t){return t.checked}).map(function(t){return t}))},b.dtInstance={},b.filtered=[],b.loading=!1,o.all([r.getallaccnts(),g.getSetting(),d.get()]).then(function(t){t[0],t[2],b.STRIPE_COMMISSION_PERCENTAGE=t[1].STRIPE_COMMISSION_PERCENTAGE?t[1].STRIPE_COMMISSION_PERCENTAGE:.2,b.CUSTOM_RANK_PRICE=t[1].CUSTOM_RANK_PRICE,t[0].forEach(function(t){var n=angular.copy(t);e.answers.map(function(t){return t.id}).indexOf(n.answer)>-1&&(function(t){return c.getAnswer(t.answer).then(function(e){t.answerObj=e})}(n).then(function(){v()}),b.businesses.push(n))}),b.dataReady=!0,v()}),console.log("bizadmin page Loaded!")}angular.module("app").controller("bizadmin",t),t.$inject=["$location","$rootScope","$state","$stateParams","table","dialog","$q","useraccnt","promoter","answer","codeprice","setting","$timeout","DTOptionsBuilder","DTColumnDefBuilder"]}(),function(){"use strict";function t(t,e,n,a,s,i,o){function r(){c<l.ansimgs.length&&(l.inprogress=!0,function(t,e,n){var a={method:"POST",url:"https://server.rank-x.com/ImageServer/SaveImage",headers:{"X-Dreamfactory-API-Key":void 0,"X-DreamFactory-Session-Token":void 0},data:{imageurl:t,filename:e,answerid:n}};return i(a)}(l.ansimgs[c].imageurl,l.ansimgs[c].slug,l.ansimgs[c].id).then(function(){console.log("processing image success - ",l.ansimgs[c].slug),c++,l.cpct=c/l.ansimgs.length*100,r()},function(t){console.log("there was error processing image: ",t),c++,l.cpct=c/l.ansimgs.length*100,r()}))}var l=this;l.title="answerimages",l.ansimgs=[];var c=0;l.processAllImages=r,t.answers.forEach(function(t){void 0!=t.imageurl&&-1==t.imageurl.indexOf("noimage.jpg")&&-1==t.imageurl.indexOf("rankx.blob.core")&&"Short-Phrase"!=t.type&&(l.ansimgs.push(t),console.log(t.name,t.imageurl))}),t.DEBUG_MODE&&console.log("answerimages page Loaded!")}angular.module("app").controller("answerimages",t),t.$inject=["$rootScope","staticpages","dialog","SERVER_URL","$timeout","$http","answer"]}(),function(){"use strict";function t(t,e,n,a,s,i,o,r,l,c,d,g,m,u,p,v,b,h,f,y){function w(){k.selKeywords="",k.selViews="",k.selFlags="",k.selRankings="",k.selDbMaint="",k.selQuery="",k.selUpdate="",k.selFoodRanks="",k.selPlan="",k.selPayment="",k.selBizAdmin="",k.selSibLocks="",k.selCleanDB="",k.selimagesMod="",k.selStaticPages="",k.selLocations="",k.selsitemap="",k.selanswerimages=""}var k=this;k.title="admin",k.selKeywords="active",k.selViews="",k.selFlags="",k.selRankings="",k.selPlan="",k.selCleanDB="",k.goBack=function(){e.go("content")},k.keywords=function(){w(),k.selKeywords="active",e.go("queries")},k.views=function(){w(),k.selViews="active",e.go("views")},k.flags=function(){w(),k.selFlags="active",e.go("flags")},k.addRank=function(){w(),k.selRankings="active",e.go("addRank")},k.dbMaint=function(){w(),k.selDbMaint="active",e.go("dbMaint")},k.dbQuery=function(){w(),k.selQuery="active",e.go("dbQuery")},k.update=function(){w(),k.selUpdate="active",e.go("updateHeaders")},k.foodranks=function(){w(),k.selFoodRanks="active",e.go("foodRanks")},k.sibLocs=function(){w(),k.selSibLocks="active",e.go("sibLocs")},k.payment=function(){w(),k.selPayment="active",e.go("payment")},k.plan=function(){w(),k.selPlan="active",e.go("plan")},k.bizAdmin=function(){w(),k.selBizAdmin="active",e.go("bizadmin")},k.applyRule=function(){console.log("apply Rule")},k.cleanDB=function(){w(),k.selCleanDB="active",e.go("cleandb")},k.modImages=function(){w(),k.selimagesMod="active",e.go("imagesmod")},k.staticPages=function(){w(),k.selStaticPages="active",e.go("staticpagesconsole")},k.golocations=function(){w(),k.selLocations="active",e.go("locations")},k.gositemap=function(){w(),k.selsitemap="active",e.go("sitemap")},k.goanswerimages=function(){w(),k.selanswerimages="active",e.go("answerimages")},k.dataready=!1,t.isAdmin||t.dataAdmin||t.modAdmin?(k.isDET=t.isLoggedIn&&("10104518570729893"==t.user.id||30==t.user.id||41==t.user.id||42==t.user.id||30==t.user.id||0xaaf2b1002387==t.user.id||0xb07a74be061a==t.user.id),k.isAdmin=t.user.is_sys_admin||t.isAdmin,k.dataAdmin=t.dataAdmin,k.modAdmin=t.modAdmin,function(){var e=n.getTables(),o=s.getAllCategories(),d=m.getAllLocations(),f=a.getAllAnswers(),y=u.getSpecials(),w=p.GetMatchTable(),x=v.getAllUserActivity(),A=c.getAllcatans(),S=b.getEdits(),R=l.getAllvrows(),C=i.getTables(),P=h.getallaccnts();r.all([e,o,d,f,y,w,x,A,S,R,C,P]).then(function(e){t.content=e[0],t.categories=e[1],t.locations=e[2],t.answers=e[3],t.specials=e[4],t.mrecs=e[5],t.alluseractivity=e[6],t.catansrecs=e[7],t.edits=e[8],t.cvrows=e[9],t.customranks=e[10],t.useraccnts=e[11],g.unwrap(),g.createSearchStrings(),k.dataready=!0})}(),t.DEBUG_MODE&&console.log("admin page Loaded!")):e.go("cwrapper")}angular.module("app").controller("admin",t),t.$inject=["$rootScope","$state","table","answer","categories","table2","categorycode","$q","vrows","catans","common","dataloader","locations","special","matchrec","useractivity","edit","useraccnt","staticpages","$timeout"]}(),function(){"use strict";function t(t,e,n,a,s,i){function o(){l={},r.rankTitle="",r.tags="",r.keywords="",r.type="",r.isatomic=!0,r.question="",r.image1url="",r.image2url="",r.image3url=""}var r=this;r.title="addRank";var l={},c=!0,d=!0,g=!0;r.addRanking=function(){if(l.title=r.rankTitle,l.tags=r.tags,l.keywords=r.keywords,l.type=r.type,l.question=r.question,l.views=0,l.answers=0,(null==l.title||void 0==l.title||l.title.length<10)&&(c=!1),(null==l.question||void 0==l.question||l.question.length<10)&&(g=!1),"Person"!=l.type&&"Establishment"!=l.type&&"Short-Phrase"!=l.type&&"Event"!=l.type&&"Organization"!=l.type&&"Place"!=l.type&&"Activity"!=l.type&&"Thing"!=l.type&&"PersonCust"!=l.type&&(d=!1),console.log("vm.allNh --- ",r.allNh),0==r.allNh||void 0==r.allNh)c&&d&&g?(s.addTable(l),o()):c?g?i.getDialog("rankType"):i.getDialog("rankQuestion"):i.getDialog("rankTitle");else if(c&&d&&g){for(var t=0;t<e.content.length;t++)if(e.content[t].title.indexOf("Yoga studios in")>-1){var n=JSON.parse(JSON.stringify(e.content[t]));n.id=void 0;var a=n.title.replace("Yoga studios in",r.rankTitle);n.title=a;var m=r.tags;n.tags=m,a.indexOf("Pacific Beach")>-1&&(n.tags=n.tags+" pb"),a.indexOf("Ocean Beach")>-1&&(n.tags=n.tags+" ob"),a.indexOf("Mission Beach")>-1&&(n.tags=n.tags+" mb"),a.indexOf("in San Diego")>-1&&(n.tags=n.tags+" isMP",n.isatomic=!1),a.indexOf("in Downtown")>-1&&(n.isatomic=!1),n.answers=0,n.views=0,n.answertags="",n.catstr="",s.addTable(n)}o()}else c?g?i.getDialog("rankType"):i.getDialog("rankQuestion"):i.getDialog("rankTitle")},r.typeList=["Person","Establishment","Place","Activity","Short-Phrase","Organization","Event","Thing","PersonCust"],r.isAdmin=e.isAdmin,console.log("addRank page Loaded!")}angular.module("app").controller("addRank",t),t.$inject=["$location","$rootScope","$state","$stateParams","table","dialog"]}();