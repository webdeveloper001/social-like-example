angular.module("app").run(["$templateCache",function(t){t.put("app/admin/Partials/addRank.html",'<br><div class="row" ng-if="vm.isAdmin"><div class="col-sm-1"></div><div class="col-sm-10"><h4>Add Ranking</h4><label class="checkbox-inline"><input type="checkbox" ng-model="vm.allNh" value="">All Neighborhoods</label><p>To add a ranking to all neighborhoods, type title without actual neighborhood name:</p><p>For instance, for \'Best pizza in ###? , simply type \'Best pizza in\' and select the checkbox</p><label><strong>Title:</strong></label> <input class="form-control" ng-model="vm.rankTitle" type="text" placeholder="{{vm.rankTitle}}"> <label><strong>Question:</strong></label> <input class="form-control" ng-model="vm.question" type="text" placeholder="{{vm.question}}"> <label><strong>Tags:</strong></label> <input class="form-control" ng-model="vm.tags" type="text" placeholder="{{vm.tags}}"> <label><strong>Keywords:</strong></label> <input class="form-control" ng-model="vm.keywords" type="text" placeholder="{{vm.keywords}}"> <label><strong>Type:</strong></label> <input class="form-control" ng-model="vm.type" bs-typeahead="" type="text" placeholder="{{vm.type}}" bs-options="c for c in vm.typeList"><br><div class="form-group text-right"><button type="button" class="btn btn-primary" ng-click="vm.addRanking()">Add</button></div></div><div class="col-sm-1"></div></div>'),t.put("app/admin/Partials/admin.html",'<div ui-view="navbar"></div><br><div ng-if="!vm.dataready"><h2>Please wait, loading all admin data...</h2></div><div ng-if="vm.dataready"><div class="text-center" ng-if="vm.isAdmin"><div class="btn-group"><button class="btn btn-default {{vm.selKeywords}}" ng-click="vm.keywords()">Searched-Keyword</button> <button class="btn btn-default {{vm.selViews}}" ng-click="vm.views()">Ranking-Answers Views</button> <button class="btn btn-default {{vm.selFlags}}" ng-click="vm.flags()">Answer Flags</button> <button class="btn btn-default {{vm.selAddRanking}}" ng-click="vm.addRank()">Add Ranking</button> <button class="btn btn-default {{vm.selDbMaint}}" ng-click="vm.dbMaint()">dB Maint</button> <button class="btn btn-default {{vm.selQuery}}" ng-click="vm.dbQuery()">Query</button> <button class="btn btn-default {{vm.selSibLocs}}" ng-click="vm.sibLocs()">Sibbling Locations</button> <button class="btn btn-default {{vm.selFoodRanks}}" ng-click="vm.foodranks()">Food Ranks</button> <button class="btn btn-default {{vm.selPayment}}" ng-click="vm.payment()">Payment</button> <button class="btn btn-default {{vm.selPlan}}" ng-click="vm.plan()">Plan</button> <button class="btn btn-default" ng-click="vm.bizAdmin()">Business</button> <button class="btn btn-default" ng-click="vm.cleanDB()">Clean DB</button> <button class="btn btn-default" ng-click="vm.modImages()">Moderate Images</button> <button class="btn btn-default" ng-click="vm.staticPages()">Static Pages</button> <button class="btn btn-default {{vm.selLocations}}" ng-click="vm.golocations()">Locations</button> <button class="btn btn-default {{vm.selsitemap}}" ng-click="vm.gositemap()">Sitemap</button> <button class="btn btn-default {{vm.selanswerimages}}" ng-click="vm.goanswerimages()">Answer Images</button> <button class="btn btn-danger" ng-click="vm.applyRule()">Apply Rule</button></div></div><div ng-if="vm.dataAdmin"><button class="btn btn-default {{vm.selQuery}}" ng-click="vm.dbQuery()">Query</button> <button class="btn btn-default {{vm.selSibLocs}}" ng-click="vm.sibLocs()">Sibbling Locations</button></div><div ng-if="vm.modAdmin"><button class="btn btn-default" ng-click="vm.modImages()">Moderate Images</button> <button class="btn btn-default" ng-click="vm.staticPages()">Static Pages</button></div></div><br><br><div ui-view=""></div><br><br>'),t.put("app/admin/Partials/answerimages.html",'<h1>Answer Images</h1>Number of answer images that are not in rankx blob: {{vm.ansimgs.length}}<br><br><button class="btn btn-primary" ng-click="vm.processAllImages()">Store Images</button><br><br><div class="progress" ng-if="vm.inprogress"><div class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="vm.cpct" aria-valuemin="0" aria-valuemax="100" style="width:{{vm.cpct}}%">{{vm.cpct}}% Complete (success)</div></div>'),t.put("app/admin/Partials/bizadmin.html",'<br><div class="row" ng-if="vm.isAdmin"><div id="veil" ng-hide="vm.dataReady"></div><div id="feedLoading" ng-hide="vm.dataReady"><div style="text-align: center" ng-if="!vm.dataReady"><div><img src="/assets/images/loading.gif" class="img" style="width:50px;height:50px"></div><p style="font-size:large">loading your business information...</p></div></div><div ng-if="vm.dataReady"><div style="margin-left:40px; margin-right:40px"><h3>Businesses</h3><div class="pull-right"><button class="btn btn-default" ng-class="vm.showFilter == 0 ? \'active\' : \'\'" ng-click="vm.setShowAll()">Show All</button> <button class="btn btn-default" ng-class="vm.showFilter == 1 ? \'active\' : \'\'" ng-click="vm.setShowPurchases()">Show Only Purchaces</button> <button class="btn btn-default" ng-class="vm.showFilter == 2 ? \'active\' : \'\'" ng-click="vm.setShowNonPurchases()">Show Only Non-Purchaces</button> <button class="btn btn-default" ng-class="vm.showUserFilter ? \'active\' : \'\'" ng-click="vm.showUser()">Show User</button> <button class="btn btn-warning" ng-class="vm.showUserFilter ? \'active\' : \'\'" ng-click="vm.deleteSelected()">Delete Selected</button></div><div class="clearfix"></div><table datatable="ng" class="table" dt-options="vm.dtOptions" dt-columns="vm.dtColumns" dt-instance="vm.dtInstance" ng-if="!vm.loading"><thead style="border-style:none;"><tr><th></th><th>Business Name</th><th>Type</th><th>Activity</th><th ng-if="vm.showUserFilter">User</th><th ng-if="vm.showUserFilter">Email</th></tr></thead><tbody><tr ng-repeat="biz in vm.filtered" style="cursor:pointer;">{{vm.filtered.length}}<td><input type="checkbox" ng-model="biz.checked"></td><td>{{biz.answerObj.name}}</td><td>{{biz.bizcat}}</td><td style="padding: 0px;display: inline; height: 100%"><div ng-if="!biz.ispreminum && !biz.hasranks" style="background-color: #ffe699; padding:10px 18px; min-width: 160px" class="text-center">Account Bind</div><div ng-if="biz.ispreminum || biz.hasranks" class="text-center" style="min-width:200px ; min-width: 160px"><div ng-if="biz.ispreminum" style="background-color: #a9d18e; float:left; width:50%; padding:10px 18px" class="text-center">Preminum</div><div ng-if="!biz.ispreminum" style="background-color: #d9d9d9;float:left; width:50%; padding:10px 18px" class="text-center">No Preminum</div><div ng-if="biz.hasranks" style="background-color: #a9d18e; float:left; width:50%; padding:10px 18px" class="text-center">{{biz.ranksqty}} Ranks</div><div ng-if="!biz.hasranks" style="background-color: #d9d9d9; float:left; width:50%; padding:10px 18px" class="text-center">No Ranks</div></div></td><td ng-if="vm.showUserFilter">{{biz.username}}</td><td ng-if="vm.showUserFilter">{{biz.email}}</td></tr></tbody></table></div></div></div>'),t.put("app/admin/Partials/cleandb.html",'<br><div class="row" ng-if="vm.isAdmin"><div id="veil" ng-hide="vm.dataReady"></div><div id="feedLoading" ng-hide="vm.dataReady"><div style="text-align: center" ng-if="!vm.dataReady"><div><img src="/assets/images/loading.gif" class="img" style="width:50px;height:50px"></div><p style="font-size:large">loading your DB information...</p></div></div><div style="min-height: 200px" ng-hide="vm.dataReady"></div><div ng-if="vm.dataReady"><div style="margin-left:40px; margin-right:40px"><h3>Catans(Duplicated)</h3><div class="pull-right"><button class="btn btn-warning" ng-click="vm.deleteSelectedCatans()">Delete Duplication in Selected Catans</button></div><div class="clearfix"></div><div ng-if="!vm.deletingCatans"><table datatable="ng" class="table" dt-options="vm.dtOptions" dt-columns="vm.dtColumns" dt-instance="vm.dtInstanceCatans"><thead style="border-style:none;"><tr><th></th><th>Category</th><th>Answer</th><th>Duplication</th></tr></thead><tbody><tr ng-repeat="biz in vm.filteredCatans" style="cursor:pointer;"><td><input type="checkbox" ng-model="biz[0].checked"></td><td>{{biz[0].category}}</td><td>{{biz[0].answer}}</td><td>{{biz.length}}</td></tr></tbody></table></div><div ng-if="vm.deletingCatans"><h6>Deleting Duplication...</h6></div></div><div style="margin-left:40px; margin-right:40px"><h3>Categories(Have no Rankings)</h3><div class="pull-right"><button class="btn btn-warning" ng-click="vm.deleteSelectedCategories()">Delete Selected Unlinked Categories</button></div><div class="clearfix"></div><div ng-if="!vm.deletingCategories"><table datatable="ng" class="table" dt-options="vm.dtOptionsCategories" dt-columns="vm.dtColumnsCategories" dt-instance="vm.dtInstanceCategories"><thead style="border-style:none;"><tr><th></th><th>ID</th><th>Category</th><th>Type</th></tr></thead><tbody><tr ng-repeat="biz in vm.filteredCategories" style="cursor:pointer;"><td><input type="checkbox" ng-model="biz.checked"></td><td>{{biz.id}}</td><td>{{biz.category}}</td><td>{{biz.type}}</td></tr></tbody></table></div><div ng-if="vm.deletingCategories"><h6>Deleting Unlinked Categories...</h6></div></div><div style="margin-left:40px; margin-right:40px"><h3>Answers(Have no Reference)</h3><div class="pull-right"><button class="btn btn-warning" ng-click="vm.deleteSelectedAnswers()">Delete Selected Unreferenced Answers</button></div><div class="clearfix"></div><div ng-if="!vm.deletingAnswer"><table datatable="ng" class="table" dt-options="vm.dtOptionsAnswers" dt-columns="vm.dtColumnsAnswer" dt-instance="vm.dtInstanceAnswers"><thead style="border-style:none;"><tr><th></th><th>ID</th><th>Image</th><th>Name</th></tr></thead><tbody><tr ng-repeat="biz in vm.filteredAnswers" style="cursor:pointer;"><td><input type="checkbox" ng-model="biz.checked"></td><td>{{biz.id}}</td><td><img style="width:100px;height:100px" ng-src="{{biz.imageurl}}"></td><td>{{biz.name}}</td></tr></tbody></table></div><div ng-if="vm.deletingAnswers"><h6>Deleting Unreferenced Answers...</h6></div></div><div style="margin-left:40px; margin-right:40px"><h3>Rankings(Have no Answers)</h3><div class="pull-right"><button class="btn btn-warning" ng-click="vm.deleteSelectedRankings()">Delete Selected Unreferenced Rankings</button></div><div class="clearfix"></div><div ng-if="!vm.deletingRanking"><table datatable="ng" class="table" dt-options="vm.dtOptionsRankings" dt-columns="vm.dtColumnsRanking" dt-instance="vm.dtInstanceRankings"><thead style="border-style:none;"><tr><th></th><th>ID</th><th>Title</th><th>Type</th></tr></thead><tbody><tr ng-repeat="biz in vm.filteredRankings" style="cursor:pointer;"><td><input type="checkbox" ng-model="biz.checked"></td><td>{{biz.id}}</td><td>{{biz.title}}</td><td>{{biz.type}}</td></tr></tbody></table></div><div ng-if="vm.deletingRankings"><h6>Deleting Unreferenced Rankings...</h6></div></div><div style="margin-left:40px; margin-right:40px"><h3>Feature Images(Have no Reference)</h3><div class="pull-right"><button class="btn btn-warning" ng-click="vm.deleteSelectedFImages()">Delete Selected Unreferenced FImages</button></div><div class="clearfix"></div><div ng-if="!vm.deletingFImages"><table datatable="ng" class="table" dt-options="vm.dtOptionsFImages" dt-columns="vm.dtColumnsFImages" dt-instance="vm.dtInstanceFImages"><thead style="border-style:none;"><tr><th></th><th>Image</th></tr></thead><tbody><tr ng-repeat="biz in vm.filteredFImages" style="cursor:pointer;"><td><input type="checkbox" ng-model="biz.checked"></td><td><img style="width:100px;height:100px" ng-src="{{biz.url}}" <="" td=""></td></tr></tbody></table></div><div ng-if="vm.deletingFImages"><h6>Deleting Unreferenced Feature Images...</h6></div></div><div style="margin-left:40px; margin-right:40px"><h3>Feature Images Sizes</h3><div class="clearfix"></div><div ng-if="!vm.deletingFImages"><table datatable="ng" class="table" dt-options="vm.dtOptionsFImages" dt-columns="vm.dtColumnsFImages" dt-instance="vm.dtInstanceFImages"><thead style="border-style:none;"><tr><th></th><th>Image</th><th>Filename</th><th>Size</th></tr></thead><tbody><tr ng-repeat="biz in vm.fimages | orderBy:\'-size\'" style="cursor:pointer;"><td><input type="checkbox" ng-model="biz.checked"></td><td><img style="width:100px;height:100px" ng-src="{{biz.url}}" <="" td=""></td><td>{{biz.url}}</td><td>{{biz.size}}</td></tr></tbody></table></div><div ng-if="vm.deletingFImages"><h6>Deleting Unreferenced Feature Images...</h6></div></div></div></div>'),t.put("app/admin/Partials/dbMaint.html",'<div class="container" ng-if="vm.isAdmin"><h1>Database Maintenance</h1><button class="btn btn-success" ng-click="vm.showUrefAns()">Unreferenced Answers</button><br><button class="btn btn-danger" ng-click="vm.deleteAnswers()">Delete Answers</button> <button class="btn btn-default" ng-click="vm.showPossibleDuplicated()">Show Possible Duplicated</button> <button class="btn btn-default" ng-click="vm.showDuplicatedOnlyName()">Show Duplicated Only Name</button> <button class="btn btn-default" ng-click="vm.showDuplicatedByLocation()">Show Duplicated By Location</button><br><button class="btn btn-default" ng-click="vm.findPhoneWebsite()">Phone Numbers & Website</button><br><button class="btn btn-default" ng-click="vm.findDuplicatedRanks()">Duplicated Ranks</button><br><button class="btn btn-default" ng-click="vm.clearAllCatansVotes()">Clear Catans Votes</button><br><button class="btn btn-default" ng-click="vm.syncUserVotes()">Sync User Votes</button><br><button class="btn btn-default" ng-click="vm.estDistances()">Establishment Distances</button><br><button class="btn btn-default" ng-click="vm.createImagesJSON()">createImagesJSON</button><br><button class="btn btn-default" ng-click="vm.updateUrls()">updateUrls</button><br><button class="btn btn-default" ng-click="vm.getAnswerBizCode()">getAnswerBizCode</button><br><button class="btn btn-default" ng-click="vm.getSlugs()">get Slugs</button><br><button class="btn btn-default" ng-click="vm.categoryStr()">Update CatStr</button><br><br><div ng-if="vm.unrefans"><div ng-repeat="x in vm.unrefans" ng-click="vm.selAns(x)"><h4 class="text-left">{{$index+1}}. {{x.name}}</h4><img ng-src="{{x.imageurl}}" style="width:120px"><br>Id: {{x.id}} Added by User: {{x.userid}}<br>Neighborhood: {{x.cityarea}}<br>Address: {{x.location}}<br>Website: {{x.website}}<br>Phone: {{x.phone}}<br>Additional Info: {{x.addinfo}}<br><button class="btn btn-danger" ng-click="vm.delAnswer(x)">Delete Answer</button><br><div ng-if="vm.ans == x.id"><label>Add Catans</label> <input type="text" class="form-control" ng-model="vm.addctsval" bs-options="c for c in vm.addctsopts" bs-typeahead=""> <span class="input-group-btn text-right"><button class="btn btn-success" type="button" ng-click="vm.addcts()">Add</button></span></div></div></div><div ng-if="vm.ansNoCode"><div ng-repeat="x in vm.ansNoCode" ng-click="vm.selAns(x)"><p class="text-left"><strong>{{$index}}.&nbsp{{x.name}}&nbsp-&nbsp{{x.bizcat}}</strong></p><div ng-repeat="y in x.cats"><p class="text-left">{{y}}</p></div><div ng-if="vm.ans == x.id"><label>Category</label> <input type="text" class="form-control" ng-model="vm.catcode.category"> <label>Code</label> <input type="text" class="form-control" ng-model="vm.catcode.code" bs-options="c for c in vm.codes" bs-typeahead=""> <span class="input-group-btn text-right"><button class="btn btn-success" type="button" ng-click="vm.addcatcode()">Add Category-Code Pair</button></span></div></div></div><div ng-repeat="x in vm.dupAnswers track by $index"><img ng-src="{{x.image1}}" ng-attr-style="width:120px"> <img ng-src="{{x.image2}}" style="width:120px"><p>{{x.name1}} --- {{x.idx1}} --- {{x.loc1}} --- {{x.nh1}} --- {{x.add1}} --- {{x.id1}}</p><p>{{x.name2}} --- {{x.idx2}} --- {{x.loc2}} --- {{x.nh2}} --- {{x.add2}} --- {{x.id2}}</p><button class="btn btn-default" ng-click="vm.syncToFirst(x)">Sync 1st</button> <button class="btn btn-default" ng-click="vm.syncToSecond(x)">Sync 2nd</button><p>-------------------------------------------------------</p></div><div ng-repeat="x in vm.dupAnsNames track by $index"><img ng-src="{{x.image1}}" ng-attr-style="width:120px"> <img ng-src="{{x.image2}}" style="width:120px"><p>{{x.name1}} --- {{x.idx1}} --- {{x.loc1}} --- {{x.nh1}} --- {{x.add1}} --- {{x.id1}}</p><p>{{x.name2}} --- {{x.idx2}} --- {{x.loc2}} --- {{x.nh2}} --- {{x.add2}} --- {{x.id2}}</p><button class="btn btn-default" ng-click="vm.syncToFirst(x)">Sync 1st</button> <button class="btn btn-default" ng-click="vm.syncToSecond(x)">Sync 2nd</button><p>-------------------------------------------------------</p></div><p ng-repeat="x in vm.resDupRanks track by $index">{{x.title}} --- {{x.id}}</p><div ng-if="vm.syncp"><button class="btn btn-primary" ng-click="vm.fixAll()">Fix All</button></div><div ng-repeat="x in vm.syncp">{{x.answername}} - {{x.categoryname}} - caUpV {{x.caUpV}} - nUpVotes {{x.nUpVlen}} - caDownV {{x.caDownV}} - nDownVotes {{x.nDownVlen}}<br>UP VOTES<br><div ng-repeat="y in x.upVotes">User:&nbsp{{y.user}} Vote:&nbsp{{y.vote}} VoteId:&nbsp{{y.id}} <a ng-click="vm.deleteDupVotes(y)">Delete</a></div>DOWN VOTES<br><div ng-repeat="y in x.downVotes">User:&nbsp{{y.user}} Vote:&nbsp{{y.vote}} VoteId:&nbsp{{y.id}} <a ng-click="vm.deleteDupVotes(y)">Delete</a></div><button class="btn btn-primary" ng-click="vm.updatecatans(x)">Fix</button></div><div ng-repeat="x in vm.answerdist"><div class="row">{{x.name}} - {{x.location}} - {{x.dist}} <button class="btn btn-default" ng-click="vm.gotoAnswer(x)">Go to Answer</button> <button class="btn btn-primary" ng-click="vm.selEditAddress(x)">Edit</button></div><div ng-if="vm.ans == x.id"><br><input type="text" class="form-control" ng-model="x.location"> <span class="input-group-btn text-right"><button class="btn btn-success" type="button" ng-click="vm.editAddress(x)">Edit</button></span></div></div><button ng-if="vm.dupAnsRdy" class="btn btn-primary" ng-click="vm.goMerge()">Go Merge Screen</button><div ng-if="vm.catstrmode"><div class="progress"><div class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="vm.cpct" aria-valuemin="0" aria-valuemax="100" style="width:{{vm.cpct}}%">{{vm.cpct}}%</div><p>Updating Category Strings</p></div></div></div>'),t.put("app/admin/Partials/dbQuery.html",'<div class="container" ng-if="vm.isAdmin"><h1>Database Query</h1><input class="form-control" ng-model="vm.val" placeholder="Enter answer to search"> <button class="btn btn-primary" ng-click="vm.queryAnswer()">Query</button><div ng-repeat="x in vm.ansRes"><h4 class="text-left">{{$index+1}}. {{x.name}}</h4><img ng-src="{{x.imageurl}}" style="width:120px"><br>Id: {{x.id}} Added by User: {{x.userid}}<br>Neighborhood: {{x.cityarea}}<br>Address: {{x.location}}<br>Website: {{x.website}}<br>Phone: {{x.phone}}<br>Additional Info: {{x.addinfo}}<br><button class="btn btn-danger" ng-click="vm.delAnswer(x)">Delete Answer</button><br>Categories<br><div ng-repeat="y in x.catans">{{y.title}}---cat:{{y.catid}}---c:{{y.id}}---r:{{y.category}}---a:{{y.answer}} <button class="btn btn-warning" ng-click="vm.delCatans(y)">Delete Catans</button><br></div></div></div>'),t.put("app/admin/Partials/flags.html",'<h1>Flags</h1><br><button class="btn btn-danger" ng-click="vm.getFlags()">Get Flags</button><table class="table table-hover cursor" ng-if="vm.viewTable"><tbody><thead><tr><th>No.</th><th>Type</th><th>Flag</th><th>Details</th><th>Go To</th><th>Dismiss</th></tr></thead><tbody><tr ng-repeat="x in vm.flags"><td>{{x.id}}</td><td>{{x.type}}</td><td>{{x.desc}}</td><td><button class="btn btn-default" ng-click="vm.seeDetails(x)">Details</button></td><td><button class="btn btn-success" ng-click="vm.gotoView(x)">Go to</button></td><td><button class="btn btn-warning" ng-click="vm.deleteFlag(x)">Delete Flag</button></td></tr></tbody></tbody></table><div ng-if="vm.viewDetails"><h4>{{vm.data.id}} - {{vm.data.type}} - Reason:&nbsp{{vm.data.desc}}</h4><div ng-if="vm.data.imageurl"><img src="{{vm.data.imageurl}}" style="width:120px"><br></div><div ng-if="vm.data.name">Name: {{vm.data.name}}<br></div><div ng-if="vm.data.location">Address: {{vm.data.location}}<br></div><div ng-if="vm.data.cityarea">Neighborhood: {{vm.data.cityarea}}<br></div><div ng-if="vm.data.phone">Phone: {{vm.data.phone}}<br></div><div ng-if="vm.data.website">Website: {{vm.data.website}}<br></div><div ng-if="vm.data.title">Title: {{vm.data.title}}<br></div><div ng-if="vm.catans">Categories<br><div ng-repeat="y in vm.catans">{{y.rank}} --- {{y.id}} --- {{y.category}} --- {{y.answer}} <button class="btn btn-warning" ng-click="vm.delCatans(y)">Delete Catans</button><br></div></div><div ng-if="vm.comments">Comments<br><div ng-repeat="x in vm.comments">{{x.user}} --- {{x.username}} --- {{x.body}} <button class="btn btn-warning" ng-click="vm.delComment(x)">Delete Comment</button><br></div></div><button class="btn btn default" ng-click="vm.seeFlags()">Back to Flags</button></div>'),t.put("app/admin/Partials/foodRanks.html",'<br><br><h1>Get Food Ranks</h1><br><br><button class="btn btn-primary" ng-click="vm.getRanks()">Get Food Ranks</button>'),t.put("app/admin/Partials/imagesmod.html",'<div class="container"><h1>Images Moderation</h1><div ng-repeat="x in vm.uuis"><img ng-src="{{x.imageurl}}" style="width:200px;height:auto"> {{x.answername}} <button class="btn btn-success" ng-click="vm.approveImage(x)">Approve Image</button> <button class="btn btn-danger" ng-click="vm.removeImage(x)">Remove Image</button></div></div>'),t.put("app/admin/Partials/locations.html",'<div class="container"><h1>Locations</h1><form class="form-horizontal" role="form"><label class="control-label">City:</label><div class="input-group"><input class="form-control" type="text" ng-model="vm.city" bs-options="c for c in vm.opts" bs-typeahead="" placeholder="Enter City"> <span class="input-group-btn text-right"><button class="btn btn-success" type="button" ng-click="vm.getLocations()">GO</button></span></div></form><br><table class="table table-hover cursor"><thead><tr><th align="middle">Id</th><th align="middle">Location</th><th align="middle">SubAreas</th><th align="middle" style="width:30px"></th></tr></thead><tbody><tr ng-repeat="x in vm.locations"><td ng-show="!x.sel">{{x.id}}</td><td ng-show="!x.sel">{{x.nh_name}}</td><td ng-show="!x.sel"><div ng-repeat="y in x.sa">- {{y.name}}</div></td><td ng-show="!x.sel" style="width:30px"><button class="btn btn-primary" type="button" ng-click="vm.editLocation(x)">Edit</button></td><td ng-show="x.sel" colspan="4"><div><h2>{{x.nh_name}}</h2>SubAreas:<ul class="list-group"><li class="list-group-item" ng-repeat="y in x.sa" ng-click="vm.selsa(y)" style="color:{{y.sel?\'black\':\'lightgrey\'}};cursor:pointer;"><i ng-if="y.sel" class="fa fa-check"></i>&nbsp{{y.name}}</li></ul><div class="input-group"><input type="text" class="form-control" ng-model="vm.newsa" bs-options="c for c in vm.locs" bs-typeahead=""> <span class="input-group-btn text-right"><button class="btn btn-success" type="button" ng-click="vm.addsa(x)">Add</button></span></div><button class="btn btn-primary" type="button" ng-click="vm.savesa(x)">Save</button> <button class="btn btn-danger" type="button" ng-click="vm.deleteloc(x)">Delete</button> <button class="btn btn-default" type="button" ng-click="vm.cancel(x)">Cancel</button></div></td></tr></tbody></table><div><button class="btn btn-primary" ng-click="vm.enableAddLocation()">Add Location</button> <button class="btn btn-default" ng-click="vm.update()">Update</button></div><div ng-show="vm.showAddLocation"><form class="form-horizontal" role="form"><label class="control-label">Location Name:</label><div class="input-group"><input class="form-control" type="text" ng-model="vm.locname" placeholder="Enter Location Name"> <span class="input-group-btn text-right"><button class="btn btn-success" type="button" ng-click="vm.addLocation()">ADD</button></span></div></form></div></div>'),t.put("app/admin/Partials/mergeAnswers.html",'<h1>Merge Answers</h1><br><h3>Pair {{vm.idx}} of {{vm.tot}}</h3><div class="row"><div class="text-left col-xs-6"><button class="btn-success" ng-click="vm.goPrev(50)">&lt;&lt;&lt</button> <button class="btn-success" ng-click="vm.goPrev(10)">&lt;&lt</button> <button class="btn-success" ng-click="vm.goPrev(1)">&lt</button></div><div class="text-right col-xs-6"><button class="btn-success" ng-click="vm.goNext(1)">&gt</button> <button class="btn-success" ng-click="vm.goNext(10)">&gt;&gt</button> <button class="btn-success" ng-click="vm.goNext(50)">&gt;&gt;&gt</button></div></div><br><div class="container"><div class="row"><div class="col-xs-6 col-sm-6 col-lg-6"><h4 class="radio"><input type="radio" ng-model="vm.ans1_NameSel" name="nameOption">{{vm.ans1.name}}</h4><div class="text-left btn-group"><button class="btn btn-danger" ng-click="vm.delAnswer(1)">Delete Answer</button> <button class="btn btn-primary" ng-click="vm.editAnswer(1)">Edit Answer</button></div><br><input type="radio" class="radio-inline" ng-model="vm.ans1_ImageSel" name="imageOption"> <img src="{{vm.ans1.imageurl}}" style="width:40%;height:100px"><p class="text-left"><input type="radio" ng-model="vm.ans1_AddressSel" name="addressOption">&nbsp{{vm.ans1.location}}</p><p class="text-left"><input type="radio" ng-model="vm.ans1_NhSel" name="nhOption">&nbsp{{vm.ans1.cityarea}}</p><p class="text-left"><input type="radio" ng-model="vm.ans1_PhoneSel" name="phoneOption">&nbsp{{vm.ans1.phone}}</p><p class="text-left"><input type="radio" ng-model="vm.ans1_WebsiteSel" name="websiteOption">&nbsp{{vm.ans1.website}}</p><p class="text-left"><input type="radio" ng-model="vm.ans1_AddinfoSel" name="addinfoOption">&nbsp{{vm.ans1.addinfo}}</p><div ng-repeat="y in vm.ans1.catans track by $index">{{y.rank}} --- {{y.id}} --- {{y.category}} --- {{y.answer}} <button class="btn btn-warning" ng-click="vm.delCatans(y)">Delete Catans</button><br></div><div class="text-left"><button class="btn btn-primary" ng-click="vm.addCatans(1)">Add Catans</button></div><div class="input-group" ng-if="vm.addcts1active"><input type="text" class="form-control" ng-model="vm.addcts1val" bs-options="c for c in vm.addcts1opts" bs-typeahead=""> <span class="input-group-btn text-right"><button class="btn btn-success" type="button" ng-click="vm.addcts(1)">Add</button></span></div><label class="checkbox-inline" ng-if="vm.addcts1active"><input type="checkbox" ng-model="vm.cat1isdup">Is Dup</label></div><div class="col-xs-6 col-sm-6 col-lg-6"><h4 class="radio"><input type="radio" ng-model="vm.ans2_NameSel" name="nameOption">{{vm.ans2.name}}</h4><div class="text-left btn-group"><button class="btn btn-danger" ng-click="vm.delAnswer(2)">Delete Answer</button> <button class="btn btn-primary" ng-click="vm.editAnswer(2)">Edit Answer</button></div><br><input type="radio" class="radio-inline" ng-model="vm.ans2_ImageSel" name="imageOption"> <img src="{{vm.ans2.imageurl}}" style="width:40%;height:100px"><p class="text-left"><input type="radio" ng-model="vm.ans2_AddressSel" name="addressOption">&nbsp{{vm.ans2.location}}</p><p class="text-left"><input type="radio" ng-model="vm.ans2_NhSel" name="nhOption">&nbsp{{vm.ans2.cityarea}}</p><p class="text-left"><input type="radio" ng-model="vm.ans2_PhoneSel" name="phoneOption">&nbsp{{vm.ans2.phone}}</p><p class="text-left"><input type="radio" ng-model="vm.ans2_WebsiteSel" name="websiteOption">&nbsp{{vm.ans2.website}}</p><p class="text-left"><input type="radio" ng-model="vm.ans2_AddinfoSel" name="addinfoOption">&nbsp{{vm.ans2.addinfo}}</p><div ng-repeat="x in vm.ans2.catans track by $index">{{x.rank}} --- {{x.id}} --- {{x.category}} --- {{x.answer}} <button class="btn btn-warning" ng-click="vm.delCatans(x)">Delete Catans</button><br></div><div class="text-left"><button class="btn btn-primary" ng-click="vm.addCatans(2)">Add Catans</button></div><div class="input-group" ng-if="vm.addcts2active"><input type="text" class="form-control" ng-model="vm.addcts2val" bs-options="c for c in vm.addcts2opts" bs-typeahead=""> <span class="input-group-btn text-right"><button class="btn btn-success" type="button" ng-click="vm.addcts(2)">Add</button></span></div><label class="checkbox-inline" ng-if="vm.addcts2active"><input type="checkbox" ng-model="vm.cat2isdup">Is Dup</label></div></div></div>'),t.put("app/admin/Partials/notification.drtv.html",'<div><div class="alert fade in" ng-repeat="notification in notifications" ng-class="notification.type==\'success\' ? \'alert-success\' : \'alert-warning\'"><a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a> <strong>{{noticiation.type.toUpperCase()}}</strong> {{notification.message}}</div></div>'),t.put("app/admin/Partials/payment.html",'<br><div class="row" ng-if="vm.isAdmin"><div id="veil" ng-hide="vm.dataReady"></div><div id="feedLoading" ng-hide="vm.dataReady"><div style="text-align: center" ng-if="!vm.dataReady"><div><img src="/assets/images/loading.gif" class="img" style="width:50px;height:50px"></div><p style="font-size:large">loading your promoters information...</p></div></div><div ng-if="vm.dataReady"><div class="container"><h3>Promoters</h3><div style="font-size: 18px; padding: 16px; background-color: darkgray; margin-bottom: 20px; border-radius: 5px;">Current Commission Fee is {{vm.STRIPE_COMMISSION_PERCENTAGE*100}}%. <button class="btn btn-primary pull-right btn-sm" ng-click="vm.changeCommission()">Change</button></div><button ng-class="vm.selectedPromoters.length == 0 ? \'disabled\' : \'\'" class="btn btn-primary pull-right" style="margin-bottom:10px" ng-click="vm.paySelectedPromoters()">Pay Selected Promoters</button><div style="clear:both"></div><table class="table" ng-if="vm.overview"><tbody><thead style="border-style:none;"><tr><th></th><th>Promoter</th><th>Code</th><th>Business On Trial</th><th>Business Active</th><th>Total Fee</th><th>Commission to Promoter</th><th>Last Payed Date</th><th></th></tr></thead><tr ng-repeat="promoter in vm.promoters" style="cursor:pointer;"><td><input type="checkbox" ng-if="!promoter.payedThisMonth" ng-click="vm.addOrRemovePromoter(promoter)"></td><td ng-click="vm.goDetailView(promoter)">{{promoter.firstname + \' \' + promoter.lastname}}</td><td ng-click="vm.goDetailView(promoter)">{{promoter.code}}</td><td ng-click="vm.goDetailView(promoter)">{{promoter.ontrialCount}}</td><td ng-click="vm.goDetailView(promoter)">{{promoter.activeCount}}</td><td ng-click="vm.goDetailView(promoter)">${{promoter.balance / 100}}</td><td ng-click="vm.goDetailView(promoter)">${{promoter.balance / 100 * vm.STRIPE_COMMISSION_PERCENTAGE}}</td><td ng-click="vm.goDetailView(promoter)">{{promoter.lastPaymentDate}}</td><td><button ng-if="!promoter.payedThisMonth" class="btn btn-primary" ng-click="vm.payPromoter(promoter)">Pay</button> <button ng-if="promoter.payedThisMonth" class="btn btn-primary disabled">Paid This Month</button></td></tr></tbody></table><div ng-if="vm.detailview"><table class="table" ng-if="vm.currentPromoter.businesses.length >= 1"><thead style="border-style:none;"><tr><th>Business</th><th>Total Commission After Trial</th><th>Status</th></tr></thead><tbody><tr ng-repeat="x in vm.currentPromoter.businesses" style="cursor:pointer;"><td ng-click="vm.gotoanswer(x.answerObj)">{{x.answerObj.name}}</td><td ng-click="vm.showBusinessDetail(x)">${{x.totalCommission}}</td><td align="middle" ng-attr-style="{{x.style}}" ng-click="vm.showBusinessDetail(x)">{{x.status}}</td></tr></tbody></table><div ng-if="vm.currentPromoter.businesses.length == 0">No Businesses.</div></div><div class="text-right" role="group"><button type="button" ng-click="vm.goBack()" class="btn btn-default">Back</button></div></div></div></div>'),
t.put("app/admin/Partials/plan.html",'<br><div class="row" ng-if="vm.isAdmin"><div id="veil" ng-hide="vm.dataReady"></div><div id="feedLoading" ng-hide="vm.dataReady"><div style="text-align: center" ng-if="!vm.dataReady"><div><img src="/assets/images/loading.gif" class="img" style="width:50px;height:50px"></div><p style="font-size:large">loading plans information...</p></div></div><div id="veil" ng-hide="!vm.isSaving"></div><div id="feedLoading" ng-hide="!vm.isSaving"><div style="text-align: center" ng-if="vm.isSaving"><div><img src="/assets/images/loading.gif" class="img" style="width:50px;height:50px"></div><p style="font-size:large">saving plan...</p></div></div><div ng-if="vm.dataReady"><div class="container"><h3>Plans</h3><div ng-if="vm.notifications.length != 0"><notification-block notifications="vm.notifications"></notification-block></div><table class="table"><tbody><thead style="border-style:none;"><tr><th>Code</th><th>Price</th><th></th></tr></thead><tr ng-repeat="codeprice in vm.codeprices" style="cursor:pointer;"><td ng-click="vm.goDetailView(promoter)">{{codeprice.code}}</td><td ng-click="vm.goDetailView(promoter)">${{codeprice.price}}</td><td ng-click="vm.goDetailView(promoter)"><button class="btn btn-primary" ng-click="vm.changeCodePrice(codeprice)">Change</button></td></tr></tbody></table></div></div></div>'),t.put("app/admin/Partials/queries.html",'<div class="container" ng-if="vm.isAdmin"><h1>Queries</h1><br><a ng-click="vm.clearDb()" class="btn btn-danger">Clear Database</a><br><div class="row"><div class="col-sm-2"></div><div class="col-sm-8"><table class="table table-hover cursor"><tbody><thead><tr><th>User Input</th><th>Num. Results</th></tr></thead><tbody><tr ng-repeat="x in vm.queries | orderBy: \'-results\'"><td>{{x.query}}</td><td>{{x.results}}</td></tr></tbody></tbody></table></div><div class="col-sm-2"></div></div></div>'),t.put("app/admin/Partials/rodconsole.html",'<div id="veil" ng-hide="vm.dataReady"></div><div id="feedLoading" ng-hide="vm.dataReady"><div style="text-align: center" ng-if="!vm.dataReady"><div><img src="/assets/images/loading.gif" class="img" style="width:50px;height:50px"></div><p style="font-size:large">{{vm.loadText}}</p></div></div><div ng-if="vm.dataReady"><div class="container"><div ng-if="vm.overview"><h2>Ranking of the Day Admin Console</h2><div class="row"><div class="col-xs-6"><label class="checkbox-inline"><input type="checkbox" ng-change=\'vm.filterData("all")\' ng-model="vm.allIsSelected" ng-checked="vm.allIsSelected">&nbspAll</label></div><div class="col-xs-6"><label class="checkbox-inline"><input type="checkbox" ng-change=\'vm.filterData("next20")\' ng-model="vm.next20IsSelected" ng-checked="vm.next20IsSelected">&nbspNext 20</label></div></div><br><table class="table"><tbody><thead style="border-style:none;"><tr><th>Date</th><th>Title</th><th>Category</th></tr></thead><tr ng-repeat="x in vm.rods" style="cursor:pointer;" ng-click="vm.selRank(x)"><td align="middle">{{x.datenum}}</td><td align="middle">{{x.title}}</td><td align="middle">{{x.category}}</td><td align="middle" ng-attr-style="background-color:{{x.imageok ? \'palegreen\':\'grey\'}}">{{x.imageok ? \'Ready\':\'None\'}}</td><td align="middle" ng-attr-style="background-color:{{x.textok ? \'palegreen\':\'grey\'}}">{{x.textok ? \'Ready\':\'None\'}}</td></tr></tbody></table></div><div ng-if="vm.detail"><h2>{{vm.rank.title}}</h2><br><p class="text-left"><strong>Date:</strong>{{vm.rank.date}}</p><br><div class="row"><div class="text-right col-xs-6"><label>Background Color:</label></div><div class="col-xs-6"><color-picker ng-model="vm.rank.bc" color-picker-swatch="true" color-picker-swatch-pos="\'left\'" color-picker-swatch-bootstrap="true" color-picker-swatch-only="true"></color-picker></div></div><br><div class="row"><div class="text-right col-xs-6"><label>Font Color:</label></div><div class="col-xs-6"><color-picker ng-model="vm.rank.fc" color-picker-swatch="true" color-picker-swatch-pos="\'left\'" color-picker-swatch-bootstrap="true" color-picker-swatch-only="true"></color-picker></div></div><br><div class="row"><div class="text-right col-xs-6"><label>Shade Factor:</label></div><div class="col-xs-5 sm-4 md-2 lg-2"><div class="input-group"><span class="input-group-btn"><button class="btn btn-primary" ng-click="vm.minusShade()"><i class="fa fa-minus"></i></button></span> <input style="text-align:center" class="form-control" ng-model="vm.rank.shade" type="text" placeholder="vm.rank.shade"> <span class="input-group-btn"><button class="btn btn-primary" ng-click="vm.plusShade()"><i class="fa fa-plus"></i></button></span></div></div></div><br><div class="row"><div class="container col-xs-6 col-sm-6 col-md-4 col-lg-3" style="color:{{vm.rank.fc}};height:{{vm.sm ? \'150px\':\'200px\'}};margin:0px;padding:0px;border:0px;position:relative; background: {{vm.rank.bc}}; background: -webkit-linear-gradient(left, {{vm.rank.bc}}, {{vm.rank.bc2}}); background: -o-linear-gradient(right, {{vm.rank.bc}}, {{vm.rank.bc2}}); background: -moz-linear-gradient(right, {{vm.rank.bc}}, {{vm.rank.bc2}}); background: linear-gradient(to right, {{vm.rank.bc}}, {{vm.rank.bc2}});"><h2 class="hidden-xs text-center" style="padding:3px; margin:0px; position:absolute; top:50%; left:50%; margin-right:-50%;transform: translate(-50%,-50%)">{{vm.rank.title}}</h2><h3 class="hidden-sm hidden-md hidden-lg hidden-xl text-center" style="padding:3px; margin:0px; position:absolute; top:50%; left:50%; margin-right:-50%;transform: translate(-50%,-50%)">{{vm.rank.title}}</h3></div><div class="col-xs-6 col-sm-6 col-md-4 col-lg-3" style="margin:0px;padding:0px;border:0px;" ng-if="!vm.isShortPhrase"><img ng-src="{{vm.rank.image1}}" ng-attr-style="display:{{vm.rank.image1 != undefined ? \'inline\':\'none\'}};width:100%;height:{{vm.sm ? \'150px\':\'200px\'}};"></div><div class="hidden-xs hidden-sm col-md-4 col-lg-3" style="margin:0px;padding:0px;border:0px;" ng-if="!vm.isShortPhrase"><img ng-src="{{vm.rank.image2}}" ng-attr-style="display:{{vm.rank.image1 != undefined ? \'inline\':\'none\'}};width:100%;height:{{vm.sm ? \'150px\':\'200px\'}};"></div><div class="hidden-xs hidden-sm hidden-md col-lg-3" style="margin:0px;padding:0px;border:0px;" ng-if="!vm.isShortPhrase"><img ng-src="{{vm.rank.image3}}" ng-attr-style="display:{{vm.rank.image1 != undefined ? \'inline\':\'none\'}};width:100%;height:{{vm.sm ? \'150px\':\'200px\'}};"></div><div class="container col-xs-6 col-sm-6 col-md-4 col-lg-3" ng-if="vm.isShortPhrase" ng-attr-style="background-color:lightgray;color:black;height:{{vm.sm ? \'150px\':\'200px\'}};margin:0px;padding:0px;border:0px;position:relative;"><div style="padding:3px; margin:0px; position:absolute; top:50%; left:50%; margin-right:-50%;transform: translate(-50%,-50%)"><h2 class="hidden-xs text-center">{{vm.rank.title1}}</h2><h3 class="hidden-sm hidden-md hidden-lg hidden-xl text-center">{{vm.rank.title1}}</h3></div></div><div class="container hidden-xs hidden-sm col-md-4 col-lg-3" ng-if="vm.isShortPhrase" ng-attr-style="background-color:lightgray;color:black;height:{{vm.sm ? \'150px\':\'200px\'}};margin:0px;padding:0px;border:0px;position:relative;"><div style="padding:3px; margin:0px; position:absolute; top:50%; left:50%; margin-right:-50%;transform: translate(-50%,-50%)"><h2 class="hidden-xs text-center">{{vm.rank.title2}}</h2><h3 class="hidden-sm hidden-md hidden-lg hidden-xl text-center">{{vm.rank.title2}}</h3></div></div><div class="container hidden-xs hidden-sm hidden-md col-lg-3" ng-if="vm.isShortPhrase" ng-attr-style="background-color:lightgray;color:black;height:{{vm.sm ? \'150px\':\'200px\'}};margin:0px;padding:0px;border:0px;position:relative;"><div style="padding:3px; margin:0px; position:absolute; top:50%; left:50%; margin-right:-50%;transform: translate(-50%,-50%)"><h2 class="hidden-xs text-center">{{vm.rank.title3}}</h2><h3 class="hidden-sm hidden-md hidden-lg hidden-xl text-center">{{vm.rank.title3}}</h3></div></div></div><br><div class="row"><div class="text-left col-xs-6"><blob-upload></blob-upload></div><div class="text-right col-xs-6"><button class="btn btn-danger" ng-click="vm.goDeleteImage()">Delete Image</button> <button class="btn btn-success" ng-click="vm.goSaveImage()">Save Image & Design</button></div></div><input type="text" class="form-control" ng-model="vm.addval" bs-options="c for c in vm.addopts" bs-typeahead=""> <span class="input-group-btn text-right"><button class="btn btn-success" type="button" ng-click="vm.addCategory()">Add</button></span><label class="control-label capitalize">Social Media Text:</label> <textarea id="textarea1" class="form-control" ng-model="vm.rank.introtext" rows="6">\n        </textarea><br><br><div class="text-right"><button class="btn btn-success" ng-click="vm.goSaveText()">Save Intro Text</button></div><br><div class="text-right"><button class="btn btn-default" ng-click="vm.goBack()">Back</button></div></div><br><br><br></div></div>'),t.put("app/admin/Partials/sibLocs.html",'<div class="container"><br><h1>Sibbling Locations</h1><br><input type="text" class="form-control" ng-model="vm.answername" bs-options="c for c in vm.ansOpts" bs-typeahead=""> <span class="input-group-btn text-right"><button class="btn btn-success" type="button" ng-click="vm.selAns()">Add</button></span><br><div ng-if"vm.answer.anslocs"=""><h2>{{vm.answer.name}}</h2><h4>{{vm.answer.location}}</h4></div><br><strong>Sibbling Locations</strong><ul class="list-group"><li class="list-group-item" ng-repeat="x in vm.locations" style="cursor:pointer;">{{x.name}},&nbsp{{x.location}} <i class="glyphicon glyphicon-remove pull-right" ng-click="vm.remAns(x)"></i></li></ul><br><input type="text" class="form-control" ng-model="vm.brothername" bs-options="c for c in vm.ansOpts" bs-typeahead=""> <span class="input-group-btn text-right"><button class="btn btn-primary" type="button" ng-click="vm.addBrother()">Add Brother</button></span><br><div class="text-center"><button class="btn btn-success" type="button" ng-click="vm.confirm()">Add Sibbling Locations</button></div><br></div>'),t.put("app/admin/Partials/sitemap.html",'<h1>Create sitemap.xml</h1><br><button class="btn btn-primary" ng-click="vm.createSitemap()">Create Sitemap</button><br><div ng-repeat="x in vm.sitemap">{{x}}<br></div>'),t.put("app/admin/Partials/staticpagesconsole.html",'<div class="container"><h1>Static Pages Console</h1><div class="input-group text-right"><button class="btn {{vm.mode == \'ranks\'? \'btn-primary\':\'btn-default\'}}" type="button" ng-click="vm.selRanks()">Ranks</button> <button class="btn {{vm.mode == \'answers\'? \'btn-primary\':\'btn-default\'}}" type="button" ng-click="vm.selAnswers()">Answers</button></div><div class="input-group"><input type="text" class="form-control" ng-model="vm.query" bs-options="c for c in vm.rankopts" bs-typeahead=""> <span class="input-group text-right"><button class="btn btn-default" type="button" ng-click="vm.getPage()">Get Static Page</button> <button class="btn btn-default" type="button" ng-click="vm.recreatePage()">Re-Create</button> <button class="btn btn-default" type="button" ng-click="vm.forceScrape()">Scrape</button> <button class="btn btn-default" type="button" ng-click="vm.share()">Share</button></span></div><div class="input-group"><span class="input-group text-right"><button class="btn btn-default" type="button" ng-click="vm.recreateAll()">Re-Create All</button> <button class="btn btn-default" type="button" ng-click="vm.scrapeAll()">Scrape All</button></span></div><div class="progress" ng-if="vm.inprogress"><div class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="vm.cpct" aria-valuemin="0" aria-valuemax="100" style="width:{{vm.cpct}}%">{{vm.cpct}}% Complete (success)</div></div><div ng-if="!vm.inprogress" ng-repeat="x in vm.pagecontent">{{x}}<br></div></div>'),t.put("app/admin/Partials/updateHeaders.html",'<div class="container" ng-if="vm.isAdmin"><br><br><h1>Refresh Headlines</h1><br><div class="text-center"><button ng-click="vm.catStrings()" class="btn btn-primary">Check for Empty Category Strings</button><br><br><button ng-click="vm.refresh()" class="btn btn-success">Shuffle Headers</button><br><br><button ng-click="vm.createCBlocksRecsCity()" class="btn btn-success">Create C-Blocks City</button><br><br><button ng-click="vm.createCBlocksRecsNh()" class="btn btn-success">Create C-Blocks Neighborhood</button><br><br><button ng-click="vm.createCBlocksRecsRankX()" class="btn btn-success">Create C-Blocks RankX</button><br><br><button ng-click="vm.deleteCBlocks()" class="btn btn-warning">Delete ALL C-Blocks</button></div><div ng-repeat="x in vm.res track by $index">{{x.modeNum}} - {{x.htitle}} - {{x.scope}} - {{x.title}}</div></div>'),t.put("app/admin/Partials/views.html",'<h1>Views</h1><div class="row"><div class="col-sm-2"></div><div class="col-sm-8"><table class="table table-hover cursor"><tbody><thead><tr><th>Ranking</th><th>Views</th></tr></thead><tbody><tr ng-repeat="x in vm.content | orderBy: \'-views\'"><td>{{x.title}}</td><td>{{x.views}}</td></tr></tbody></tbody></table></div><div class="col-sm-2"></div></div>')}]),function(){"use strict";function t(t,e){var n=[{name:"queries",parent:"admin",url:"/queries",templateUrl:"app/admin/Partials/queries.html",controller:"queries as vm"},{name:"views",parent:"admin",url:"/views",templateUrl:"app/admin/Partials/views.html",controller:"views as vm"},{name:"flags",parent:"admin",url:"/flags",templateUrl:"app/admin/Partials/flags.html",controller:"flags as vm"},{name:"addRank",parent:"admin",url:"/addRank",templateUrl:"app/admin/Partials/addRank.html",controller:"addRank as vm"},{name:"dbMaint",parent:"admin",url:"/dbMaint",templateUrl:"app/admin/Partials/dbMaint.html",controller:"dbMaint as vm"},{name:"mergeAnswers",parent:"admin",url:"/mergeAnswers",templateUrl:"app/admin/Partials/mergeAnswers.html",controller:"mergeAnswers as vm"},{name:"dbQuery",parent:"admin",url:"/dbQuery",templateUrl:"app/admin/Partials/dbQuery.html",controller:"dbQuery as vm"},{name:"imagesmod",parent:"admin",url:"/imagemod",templateUrl:"app/admin/Partials/imagesmod.html",controller:"imagesmod as vm"},{name:"staticpagesconsole",parent:"admin",url:"/staticpagesconsole",templateUrl:"app/admin/Partials/staticpagesconsole.html",controller:"staticpagesconsole as vm"},{name:"answerimages",parent:"admin",url:"/answerimages",templateUrl:"app/admin/Partials/answerimages.html",controller:"answerimages as vm"},{name:"sitemap",parent:"admin",url:"/sitemap",templateUrl:"app/admin/Partials/sitemap.html",controller:"sitemap as vm"},{name:"locations",parent:"admin",url:"/locations",templateUrl:"app/admin/Partials/locations.html",controller:"locations as vm"},{name:"updateHeaders",parent:"admin",url:"/updateHeaders",templateUrl:"app/admin/Partials/updateHeaders.html",controller:"updateHeaders as vm"},{name:"foodRanks",parent:"admin",url:"/foodRanks",templateUrl:"app/admin/Partials/foodRanks.html",controller:"foodRanks as vm"},{name:"sibLocs",parent:"admin",url:"/sibLocs",templateUrl:"app/admin/Partials/sibLocs.html",controller:"sibLocs as vm"},{name:"payment",parent:"admin",url:"/payment",templateUrl:"app/admin/Partials/payment.html",controller:"payment as vm"},{name:"plan",parent:"admin",url:"/plan",templateUrl:"app/admin/Partials/plan.html",controller:"plan as vm"},{name:"bizadmin",parent:"admin",url:"/bizadmin",templateUrl:"app/admin/Partials/bizadmin.html",controller:"bizadmin as vm"},{name:"cleandb",parent:"admin",url:"/cleandb",templateUrl:"app/admin/Partials/cleandb.html",controller:"cleandb as vm",resolve:{load:["$ocLazyLoad",function(t){return t.load({rerun:!0,files:["scripts/vendor3.js"]})}]}},{name:"rodconsole",url:"/rodconsole",parent:"layout",templateUrl:"app/admin/Partials/rodconsole.html",controller:"rodconsole as vm"}];$(n).each(function(){t.state(this)})}angular.module("app").config(["$stateProvider","$urlRouterProvider",t])}(),function(){"use strict";function t(t,e,n){var a=this;a.title="views",a.content=e.content,function(){console.log("views page Loaded!")}()}angular.module("app").controller("views",t),t.$inject=["$location","$rootScope","$state"]}(),function(){"use strict";function t(t,e,n,a,s,i){function o(){if(!p){p=!0;var t="",n=[],a=[];u.res=[];for(var i=!0,o="",r="",c=0;c<e.cblocks.length;c++){o="",r="",i=!0,{},a=[];for(var d=0;d<e.headlines.length;d++)if(e.cblocks[c].type==e.headlines[d].type){"city"==e.cblocks[c].scope&&(t=e.headlines[d].filter+" isMP"),"rx"==e.cblocks[c].scope&&(t=e.headlines[d].filter),"nh"==e.cblocks[c].scope&&(t=e.headlines[d].filter+" "+e.cblocks[c].scopename),n=t.split(" ");break}for(var g="",m=0;m<e.content.length;m++){g=e.content[m].tags+" "+e.content[m].title,i=!0;for(var v=0;v<n.length;v++){var b=n[v].charAt(0).toUpperCase()+n[v].slice(1),h=n[v].charAt(0).toLowerCase()+n[v].slice(1);i=i&&(g.indexOf(n[v])>-1||g.indexOf(n[v].toUpperCase())>-1||g.indexOf(b)>-1||g.indexOf(h)>-1)}i&&a.push(e.content[m].id)}l(a);for(var f=0;f<a.length;f++)o=o+":"+a[f];r=o.substring(1),s.update(e.cblocks[c].id,["catstr"],[r])}}}function r(){for(var t=!1,n=[],a=0;a<e.content.length;a++)e.content[a].title.indexOf("in Hillcrest")>-1&&n.push(e.content[a]);for(var s=0;s<n.length;s++){for(var o="",r="",l=n[s].title.replace("Hillcrest","San Diego"),c=0;c<e.content.length;c++)if(l==e.content[c].title){if(null==e.content[c].catstr||void 0==e.content[c].catstr||0==e.content[c].catstr.length){var d=e.content[c].id;if(473!=d&&3125!=d&&6949!=d&&7424!=d&&7675!=d&&3124!=d&&3163!=d&&3202!=d){console.log("Found gen rank --- ",e.content[c].title," ",e.content[c].id);for(var g=e.content[c].title.replace("San Diego",""),m=0;m<e.content.length;m++)e.content[m].title.indexOf(g)>-1&&m!=c&&(o=o+":"+e.content[m].id);r=o.substring(1),console.log("final catstr ---",r),i.update(e.content[c].id,["isatomic","catstr"],[!1,r])}}break}o="",r="",l=n[s].title.replace("Hillcrest","Downtown");for(var c=0;c<e.content.length;c++)if(l==e.content[c].title){if(null==e.content[c].catstr||void 0==e.content[c].catstr||0==e.content[c].catstr.length){var d=e.content[c].id;if(473!=d&&3125!=d&&6949!=d&&7424!=d&&7675!=d&&3124!=d&&3163!=d&&3202!=d){console.log("Found gen rank --- ",e.content[c].title," ",e.content[c].id);for(var g=e.content[c].title.replace("Downtown",""),m=0;m<e.content.length;m++)if(e.content[m].title.indexOf(g)>-1&&m!=c){t=!1;for(var a=0;a<e.districts.length;a++)e.content[m].title.includes(e.districts[a])&&(t=!0);t&&(o=o+":"+e.content[m].id)}r=o.substring(1),console.log("final catstr ---",r),i.update(e.content[c].id,["isatomic","catstr"],[!1,r])}}break}}}function l(t){for(var e,n,a=t.length;0!==a;)n=Math.floor(Math.random()*a),a-=1,e=t[a],t[a]=t[n],t[n]=e;return t}function c(){if(!v){for(var t=["rankofweek","city","lifestyle","food","politics","services","social","beauty","sports","personalities","technology","dating","health"],e={},n=0;n<t.length;n++)e={},e.scope="city",e.ismp=!0,e.scopename="San Diego",e.catstr="0",e.type=t[n],s.addcblock(e);v=!0}}function d(){if(!h){for(var t=["rankofweeknh","neighborhood","lifestyle","food","services","social","beauty","health"],e={},n=0;n<b.length;n++)for(var a=0;a<t.length;a++)e={},e.scope="nh",e.ismp=!1,e.scopename=b[n],e.catstr="0",e.type=t[a],s.addcblock(e);h=!0}}function g(){if(!f){for(var t=["rxfeedback","rxsuggestion"],e={},n=0;n<t.length;n++)e={},e.scope="rx",e.scopename="RankX",e.ismp=!1,e.catstr="0",e.type=t[n],s.addcblock(e);f=!0}}function m(){for(var t=0;t<e.cblocks.length;t++)s.deleteRec(e.cblocks[t].id)}var u=this;u.title="updateHeaders",u.refresh=o,u.createCBlocksRecsCity=c,u.createCBlocksRecsNh=d,u.createCBlocksRecsRankX=g,u.deleteCBlocks=m,u.catStrings=r,u.isAdmin=e.isAdmin;var p=!1;!function(){console.log("updateHeaders page Loaded!")}();var v=!1,b=e.nhs,h=!1,f=!1}angular.module("app").controller("updateHeaders",t),t.$inject=["$location","$rootScope","$state","headline","cblock","table"]}(),function(){"use strict";function t(t,e,n,a,s){function i(){u.mode="ranks",u.rankopts=[];for(var e=0;e<t.content.length;e++)u.rankopts.push(t.content[e].title)}function o(){u.mode="answers",u.rankopts=[];for(var e=0;e<t.answers.length;e++)u.rankopts.push(t.answers[e].name)}function r(){var n="";if("ranks"==u.mode)for(var a=0;a<t.content.length;a++)t.content[a].title==u.query&&(n="rank"+t.content[a].id+".html");if("answers"==u.mode)for(var a=0;a<t.answers.length;a++)t.answers[a].name==u.query&&(n="answer"+t.answers[a].id+".html");var s={},i="";s.filename=n,e.getPageContent(s).then(function(t){i=t.data,i=i.replace(/>/g,">&&&"),u.pagecontent=i.split("&&&")})}function l(){if("ranks"==u.mode)for(var a=0;a<t.content.length;a++)t.content[a].title==u.query&&e.createPageRank(t.content[a]).then(function(){n.notificationSuccess("Success","File recreated successfully")});if("answers"==u.mode)for(var a=0;a<t.answers.length;a++)t.answers[a].name==u.query&&e.createPageRank(t.answers[a]).then(function(){n.notificationSuccess("Success","File recreated successfully")})}function c(){var e="";if("ranks"==u.mode)for(var s=0;s<t.content.length;s++)if(t.content[s].title==u.query){e="rank"+t.content[s].id+".html";var i=a+e;FB.api("https://graph.facebook.com/","post",{id:[i],scrape:!0},function(t){n.notificationSuccess("Success","File scrapped successfully - "+t)})}if("answers"==u.mode)for(var s=0;s<t.answers.length;s++)if(t.answers[s].name==u.query){e="answer"+t.answers[s].id+".html";var i=a+e;FB.api("https://graph.facebook.com/","post",{id:[i],scrape:!0},function(t){n.notificationSuccess("Success","File scrapped successfully - "+t)})}}function d(e){if("ranks"==u.mode)for(var n=0;n<t.content.length;n++)if(t.content[n].title==u.query){var s="rank"+t.content[n].id+".html",i=a+s;FB.ui({method:"feed",link:i,caption:"An example caption"},function(t){})}if("answers"==u.mode)for(var n=0;n<t.answers.length;n++)if(t.answers[n].name==u.query){var s="answer"+t.answers[n].id+".html",i=a+s;FB.ui({method:"feed",link:i,caption:"An example caption"},function(t){})}}function g(){u.inprogress=!0;"answers"==u.mode&&(u.cpct=v/t.answers.length*100,"answer"+t.answers[v].id+".html",e.createPageAnswer(t.answers[v]),v++,s(function(){g()},400))}function m(){}var u=this;u.title="staticpagesconsole",u.dataready=!1,u.inprogress=!1;var p=[];u.rankopts=[];var v=0;u.selRanks=i,u.selAnswers=o,u.getPage=r,u.recreatePage=l,u.forceScrape=c,u.recreateAll=g,u.scrapeAll=m,u.share=d,u.pagecontent="",function(){i(),e.getFileList().then(function(t){p=t.data,u.dataready=!1,console.log("static pages list ready")}),t.DEBUG_MODE&&console.log("staticpagesconsole page Loaded!")}()}angular.module("app").controller("staticpagesconsole",t),t.$inject=["$rootScope","staticpages","dialog","SERVER_URL","$timeout"]}(),function(){"use strict";function t(t,e,n,a,s){function i(){r="",t.content.forEach(function(t){2==t.scope&&1==t.ismp&&null!=t.slug&&(r+="<url><loc>https://rank-x.com/rankSummary/"+t.slug+"</loc></url>")}),r=r.replace(/\/url>/g,"/url>&&&"),o.sitemap=r.split("&&&")}var o=this;o.title="sitemap",o.createSitemap=i;var r="";o.sitemap="",function(){console.log("sitemap console loaded")}()}angular.module("app").controller("sitemap",t),t.$inject=["$rootScope","staticpages","dialog","SERVER_URL","$timeout"]}(),function(){"use strict";function t(t,e,n,a,s,i,o){function r(){console.log("query Answer"),p.ansOpts=[];for(var t=0;t<e.answers.length;t++)p.ansOpts.push(e.answers[t].name)}function l(){for(var t=0;t<e.answers.length;t++)p.answername==e.answers[t].name&&(p.answer=e.answers[t]);p.answer.ansLocs=[],p.locations=[],p.answer&&p.answer.family&&(p.answer.ansLocs=p.answer.family.split(":").map(Number)),d(p.answer)}function c(){for(var t=0;t<e.answers.length;t++)if(p.brothername==e.answers[t].name){for(var n=!1,a=0;a<p.answer.ansLocs.length;a++)if(p.answer.ansLocs[a]==e.answers[t].id){n=!0,console.log("flag repeated");break}e.answers[t].id==p.answer.id&&(console.log("flag2"),n=!0),n||(console.log("Added brother"),p.answer.ansLocs.push(e.answers[t].id))}console.log("@ addBrother ---\x3e vm.answer.ansLocs",p.answer.ansLocs),console.log("@ addBrother ---\x3e vm.answer",p.answer),d(),p.brothername=""}function d(){var t=0;if(p.answer.ansLocs){p.locations=[];for(var n=0;n<p.answer.ansLocs.length;n++)t=e.answers.map(function(t){return t.id}).indexOf(p.answer.ansLocs[n]),p.locations.push(e.answers[t])}}function g(t){for(var e=0;e<p.locations.length;e++)p.locations[e].id==t.id&&(p.locations.splice(e,1),p.answer.ansLocs.splice(e,1));d(),console.log("vm.answer ",p.answer)}function m(){i.confirmSiblings(p.answer,u)}function u(){var t=p.answer.ansLocs,e="";t.push(p.answer.id),console.log("bros - ",t);for(var n=0;n<t.length;n++){e="";for(var a=0;a<t.length;a++)n!=a&&(e=e+":"+t[a]);e=e.substring(1),o.updateAnswer(t[n],["family"],[e]),console.log("updated answer ",t[n]," brothers: ",e)}p.answer=void 0,p.locations=void 0,p.brothername="",p.answername=""}var p=this;p.title="sibLocs",p.selAns=l,p.addBrother=c,p.remAns=g,p.confirm=m,function(){r(),console.log("sibLocs page Loaded!")}()}angular.module("app").controller("sibLocs",t),t.$inject=["$location","$rootScope","$state","catans","$http","dialog","answer"]}(),function(){"use strict";function t(t,e,n,a,s,i,o,r,l,c,d){function g(){function t(t){return t}var n=new Date,a=n.getTimezoneOffset();n.setMinutes(n.getMinutes()-a);var s=t(n.getMonth()+1)+"/"+t(n.getDate())+"/"+n.getFullYear();C=i.date2number(s),m(),e.DEBUG_MODE&&console.log("rodconsole page Loaded!")}function m(){R=[],a.getall().then(function(t){R=t,R.forEach(function(t){if(t.datenum=i.date2number(t.date),t.category){var n=e.categories.map(function(t){return t.id}).indexOf(t.category);n>-1&&(t.title=e.categories[n].category.replace("@Nh","San Diego"),t.fimage=e.categories[n].fimage,t.introtext||null!=e.categories[n].introtext&&void 0!=e.categories[n].introtext&&""!=e.categories[n].introtext&&(t.introtext=e.categories[n].introtext),t.fc=e.categories[n].fc,t.bc=e.categories[n].bc,t.shade=e.categories[n].shade),void 0!=t.fimage&&""!=t.fimage?t.imageok=!0:t.imageok=!1,void 0!=t.introtext&&""!=t.introtext?t.textok=!0:t.textok=!1}}),S.dataReady=!0,S.rods=R}),S.addopts=[];for(var t=0;t<e.categories.length;t++)S.addopts.push(e.categories[t].category)}function u(){for(var t=0;t<e.categories.length;t++)S.addval==e.categories[t].category&&(console.log(S.rank.id,S.addval),a.update(S.rank.id,["category"],[e.categories[t].id]))}function p(t){if("all"==t&&(S.next20IsSelected=!1,S.allIsSelected=!0),"next20"==t&&(S.next20IsSelected=!0,S.allIsSelected=!1),S.rods=[],S.next20IsSelected)for(var e=0;e<R.length;e++)R[e].datenum>=C&&S.rods.push(R[e]);else S.rods=R}function v(t){S.overview=!1,S.detail=!0,S.addval="",S.rank=t,void 0!=S.rank.fimage&&""!=S.rank.fimage&&(S.rank.image3=S.rank.image2,S.rank.image2=S.rank.image1,S.rank.image1=S.rank.fimage),console.log("selRank",S.rank),console.log(S.rank.bc),null!=S.rank.bc?(D="h"!=S.rank.bc.charAt(0)?S.rank.bc:s.hsl2rgb(S.rank.bc),S.rank.bc2=s.shadeColor(D,S.rank.shade/10)):(S.rank.bc="hsl(240, 100%, 99%)",S.rank.bc2=s.shadeColor(S.rank.bc,-.3)),e.cmd1exe=!1}function b(){S.overview=!0,S.detail=!1}function h(){e.$emit("backToResults")}function f(){S.rank.shade=S.rank.shade+1,S.rank.shade>10&&(S.rank.shade=10),D=s.hsl2rgb(S.rank.bc),S.rank.bc2=s.shadeColor(D,S.rank.shade/10)}function y(){S.rank.shade=S.rank.shade-1,S.rank.shade<-10&&(S.rank.shade=-10),D=s.hsl2rgb(S.rank.bc),S.rank.bc2=s.shadeColor(D,S.rank.shade/10)}function w(){P?(S.rank.fimage=e.blobimage,S.rank.image1=S.rank.fimage):(S.rank.fimage=e.blobimage,S.rank.image3=S.rank.image2,S.rank.image2=S.rank.image1,S.rank.image1=S.rank.fimage),e.cmd1exe=!1}function k(){if(void 0!=S.rank.fimage&&""!=S.rank.fimage){var t=["fimage","bc","fc","shade"];"h"==S.rank.bc.charAt(0)&&(S.rank.bc=s.hsl2rgb(S.rank.bc)),"h"==S.rank.fc.charAt(0)&&(S.rank.fc=s.hsl2rgb(S.rank.fc));var n=[S.rank.fimage,S.rank.bc,S.rank.fc,S.rank.shade],a="",i=[];if(S.rank.isatomic)console.log("rank:",S.rank.title),l.update(S.rank.rankid,t,n).then(function(){o.getDialog("rodimageuploadsuccess"),loadData(),b()});else{S.dataReady=!1,S.loadText="Saving data...",a=S.rank.title.replace(" in San Diego","");for(var c=0;c<e.content.length;c++)e.content[c].title.indexOf(a)>-1&&i.push(l.update(e.content[c].id,t,n));r.all(i).then(function(){S.dataReady=!0,o.getDialog("rodimageuploadsuccess"),loadData(),b()})}}else o.getDialog("nouploadedimage")}function x(){d.update(S.rank.category,["introtext"],[S.rank.introtext]).then(function(){o.getDialog("introTextSaved"),m()});var t=S.rank.introtext;a.update(S.rank.id,["introtext"],[""]).then(function(){}),""==S.rank.introtext&&(S.rank.introtext=t)}function A(){if(void 0!=S.rank.fimage&&""!=S.rank.fimage){c.deleteBlob(S.rank.fimage);var t=e.content.map(function(t){return t.id}).indexOf(S.rank.rankid),n=s.defaultRankColor(e.content[t]),a=["fimage","bc","fc","shade"],i=["",n[0],n[1],0],d="",g=[];if(S.rank.isatomic)l.update(S.rank.rankid,a,i).then(function(){o.getDialog("rodimagedeletesuccess"),loadData(),b()});else{S.dataReady=!1,S.loadText="Deleting image...",d=S.rank.title.replace(" in San Diego","");for(var m=0;m<e.content.length;m++)e.content[m].title.indexOf(d)>-1&&g.push(l.update(e.content[m].id,a,i));r.all(g).then(function(){S.dataReady=!0,o.getDialog("rodimagedeletesuccess"),loadData(),b()})}}else o.getDialog("nouploadedimage")}var S=this;S.title="rodconsole",S.selRank=v,S.goBack=b,S.plusShade=f,S.minusShade=y,S.refreshImages=w,S.filterData=p,S.goSaveImage=k,S.goSaveText=x,S.goDeleteImage=A,S.addCategory=u,S.dataReady=!1;var R=[],C=0;S.overview=!0,S.detail=!1,S.rank={},S.sm=e.sm,S.allIsSelected=!0,S.next20IsSelected=!1,S.loadText="Loading data...";var P=!1;e.canswer={},e.canswer.id="featuredImages",S.testimage=e.EMPTY_IMAGE;var D="";e.$on("fileUploaded",function(t,a){e.cmd1exe=!!e.cmd1exe&&e.cmd1exe,"rodconsole"!=n.current.name||e.cmd1exe||(e.cmd1exe=!0,e.blobimage=a,w())}),o.enterPassword(g,h)}angular.module("app").controller("rodconsole",t),t.$inject=["$location","$rootScope","$state","rankofday","color","datetime","dialog","$q","table","imagelist","categories"]}(),function(){"use strict";function t(t,e,n,a){function s(){for(var t=0;t<i.queries.length;t++)a.deleteRec(i.queries[t].id)}var i=this;i.title="queries",i.clearDb=s,i.isAdmin=e.isAdmin,function(){a.getQueries().then(function(t){i.queries=t,console.log("Queries Loaded!")})}()}angular.module("app").controller("queries",t),t.$inject=["$location","$rootScope","$state","query"]}(),function(){"use strict";function t(t,e,n,a,s,i,o,r,l,c,d,g,m){function u(){console.log("Plan admin page Loaded!")}function p(t){i.changeCodePriceDlg(t,v)}function v(t,e){b.isSaving=!0,g.setCodePrice(t,e).then(function(e){b.isSaving=!1,"Custom Rank"==t.code?(b.notifications.push({message:"Custom Rank Price $ "+e.data.plan.amount/100+" has changed successfully",type:"success"}),t.price=e.data.plan.amount/100):(b.notifications.push({message:"Premium Plan "+t.code+" Price $ "+e.data.plan.amount/100+" has changed successfully",type:"success"}),t.price=e.data.plan.amount/100)}).catch(function(t){b.notifications.push({message:t.data.err.message,type:"error"})})}var b=this;b.title="plan",b.dataReady=!1,b.changeCodePrice=p,b.customranking={},b.notifications=[],b.isAdmin=e.isAdmin,b.isSaving=!1,function(){o.all([d.get(),g.getSetting()]).then(function(t){b.codeprices=t[0],b.STRIPE_COMMISSION_PERCENTAGE=t[1].STRIPE_COMMISSION_PERCENTAGE,b.CUSTOM_RANK_PRICE=t[1].CUSTOM_RANK_PRICE,b.customranking={code:"Custom Rank",price:b.CUSTOM_RANK_PRICE},b.codeprices.push(b.customranking),b.dataReady=!0,u()})}()}angular.module("app").controller("plan",t),t.$inject=["$location","$rootScope","$state","$stateParams","table","dialog","$q","useraccnt","promoter","answer","codeprice","setting","$timeout"]}(),function(){"use strict";function t(t,e,n,a,s,i,o,r,l,c,d,g,m){function u(){i.changeCommissionDlg(A.STRIPE_COMMISSION_PERCENTAGE,p)}function p(t){g.setSetting({STRIPE_COMMISSION_PERCENTAGE:parseInt(t)/100}).then(function(t){A.STRIPE_COMMISSION_PERCENTAGE=t.STRIPE_COMMISSION_PERCENTAGE})}function v(t){
-1!=A.selectedPromoters.indexOf(t)?A.selectedPromoters.splice(A.selectedPromoters.indexOf(t),1):A.selectedPromoters.push(t)}function b(){A.selectedPromoters.forEach(function(t){A.payPromoter(t)})}function h(t){t.stripeid?r.payPromoter(t,A.STRIPE_COMMISSION_PERCENTAGE).then(function(e){A.notifications.push({message:"$"+t.balance*A.STRIPE_COMMISSION_PERCENTAGE+"transfered successfully to Promoter: "+t.firstname+" "+t.lastname,type:"success"}),t.lastPaymentDate=e.data.lastPaymentDate,t.payedThisMonth=!0}).catch(function(e){A.notifications.push({message:"$"+t.balance*A.STRIPE_COMMISSION_PERCENTAGE+"  to Promoter: "+t.firstname+" "+t.lastname+" transfer failed. ",type:"error"})}):window.alert("The promoter"+t.firstname+" "+t.lastname+" need to connect stipe account.")}function f(t){c.getAnswer(t.answer).then(function(e){t.answerObj=e})}function y(t){A.currentPromoter=t,A.detailview=!0,A.overview=!1}function w(){if(1==A.detailview)return A.overview=!0,void(A.detailview=!1)}function k(t){i.showBusinessDetailDlg(t,A.STRIPE_COMMISSION_PERCENTAGE,A.CUSTOM_RANK_PRICE)}function x(t){n.go("answerDetail",{index:t.slug})}var A=this;A.title="payment",A.dataReady=!1,A.promoters=[],A.isAdmin=e.isAdmin,A.detailview=!1,A.overview=!0,A.notifications=[],A.selectedPromoters=[],A.payPromoter=h,A.gotoanswer=x,A.goBack=w,A.goDetailView=y,A.showBusinessDetail=k,A.addOrRemovePromoter=v,A.paySelectedPromoters=b,A.changeCommission=u,function(){o.all([l.getall(),r.getallaccnts(),d.get(),g.getSetting()]).then(function(t){var n=t[1],a=t[2];A.STRIPE_COMMISSION_PERCENTAGE=t[3].STRIPE_COMMISSION_PERCENTAGE?t[3].STRIPE_COMMISSION_PERCENTAGE:.2,A.CUSTOM_RANK_PRICE=t[3].CUSTOM_RANK_PRICE,t[0].forEach(function(t){var s=angular.copy(t);s.businesses=[];for(var i=0;i<n.length;i++)if(n[i].promocode==t.code){var o=angular.copy(n[i]);"Basic"==o.status&&(o.style="background-color:#bfbfbf"),o.istrial?(o.status="On Trial "+Math.ceil(moment.duration(moment(o.discountEndDate)-moment()).asDays())+" Days left",o.style="background-color:#b3b300"):(o.status="Active",o.style="background-color:#009900");for(var r=0;r<a.length;r++)if(a[r].code==o.bizcat){o.price=a[r].price;break}o.totalCommission=0,o.ispremium&&(o.totalCommission+=o.price*A.STRIPE_COMMISSION_PERCENTAGE),o.hasranks&&(o.totalCommission+=o.ranksqty*A.CUSTOM_RANK_PRICE*A.STRIPE_COMMISSION_PERCENTAGE),s.businesses.push(o),f(s.businesses[s.businesses.length-1])}for(s.payedThisMonth=!0,s.lastPaymentDate||(s.payedThisMonth=!1),(moment(s.lastPaymentDate).year()==moment(e.setting.serverDate).year()&&moment(s.lastPaymentDate).month()<moment(e.setting.serverDate).month()||moment(s.lastPaymentDate).year()<moment(e.setting.serverDate).year())&&(s.payedThisMonth=!1),s.balance=0,i=0;i<s.businesses.length;i++)"Active"==s.businesses[i].status&&(s.balance+=s.businesses[i].monthlyCost);s.activeCount=s.businesses.filter(function(t){return"Active"==t.status}).length,s.ontrialCount=s.businesses.filter(function(t){return-1!=t.status.indexOf("On Trial")}).length,A.promoters.push(s)}),A.dataReady=!0})}(),function(){console.log("payment admin page Loaded!")}()}angular.module("app").controller("payment",t),t.$inject=["$location","$rootScope","$state","$stateParams","table","dialog","$q","useraccnt","promoter","answer","codeprice","setting","$timeout"]}(),function(){"use strict";function t(t,e,n,a,s,i,o){function r(){console.log("@getData"),console.log("$rootScope.catansrecs.length ",e.catansrecs.length),b.idx=h;var t={},n={},a=0,s=0;b.ans1=e.dupAns[h].ans1,b.ans2=e.dupAns[h].ans2,m(),b.ans1.catans=[],a=b.ans1.id;for(var i=0;i<e.catansrecs.length;i++)if(a==e.catansrecs[i].answer){t=e.catansrecs[i];for(var o=0;o<e.content.length;o++)e.catansrecs[i].category==e.content[o].id&&(t.rank=e.content[o].title);b.ans1.catans.push(t)}b.ans2.catans=[],s=b.ans2.id;for(var i=0;i<e.catansrecs.length;i++)if(s==e.catansrecs[i].answer){n=e.catansrecs[i];for(var o=0;o<e.content.length;o++)e.catansrecs[i].category==e.content[o].id&&(n.rank=e.content[o].title);b.ans2.catans.push(n)}console.log("vm.ans1.catans.length ",b.ans1.catans.length),console.log("vm.ans2.catans.length ",b.ans2.catans.length)}function l(t){h-=t,h<0&&(h=0),r()}function c(t){h+=t,h>=b.tot&&(h=b.tot),r()}function d(t){1==t&&(i.deleteAnswer(e.dupAns[h].ans1.id),a.deleteAnswer(e.dupAns[h].ans1.id)),2==t&&(i.deleteAnswer(e.dupAns[h].ans2.id),a.deleteAnswer(e.dupAns[h].ans2.id))}function g(t){if(1==t){b.addcts1opts=[];for(var e="",n=0;n<f.length;n++)f[n].indexOf("@neighborhood")>-1?(e=f[n].replace("@neighborhood",b.ans1.cityarea),b.addcts1opts.push(e)):b.addcts1opts.push(f[n]);b.addcts1active=!0}if(2==t){b.addcts2opts=[];for(var a="",n=0;n<f.length;n++)f[n].indexOf("@neighborhood")>-1?(a=f[n].replace("@neighborhood",b.ans2.cityarea),b.addcts2opts.push(a)):b.addcts2opts.push(f[n]);b.addcts2active=!0}}function m(){f=[];for(var t="",n=0;n<e.content.length;n++)e.content[n].title.indexOf("in Hillcrest")>-1&&(t=e.content[n].title.replace("Hillcrest","@neighborhood"),f.push(t)),e.content[n].ismp&&f.push(e.content[n].title)}function u(t){var n="",s={},i=0;1==t&&(n=b.addcts1val,s=b.ans1,void 0!=b.cat1isdup&&b.cat1isdup),2==t&&(n=b.addcts2val,s=b.ans2,void 0!=b.cat2isdup&&b.cat2isdup);for(var o=0;o<e.content.length;o++)if(e.content[o].title==n){i=e.content[o].id;break}a.postRec2(s.id,i),1==t&&(b.addcts1active=!1),2==t&&(b.addcts2active=!1),setTimeout(function(){r()},1e3)}function p(t){a.deleteRec(t.answer,t.category),setTimeout(function(){r()},1e3)}function v(t){1==t&&n.go("editAnswer",{index:b.ans1.id}),2==t&&n.go("editAnswer",{index:b.ans2.id})}var b=this;b.title="mergeAnswers";var h=0;b.goPrev=l,b.goNext=c,b.delAnswer=d,b.addCatans=g,b.addcts=u,b.delCatans=p,b.editAnswer=v,b.addcts1active=!1,b.addcts2active=!1;var f=[];!function(){b.tot=e.dupAns.length-1,m(),r(),console.log("mergeAnswers page Loaded!")}()}angular.module("app").controller("mergeAnswers",t),t.$inject=["$location","$rootScope","$state","catans","$http","answer","$stateParams"]}(),function(){"use strict";function t(t,e,n,a,s,i){function o(){b.locs=[];var e={},n=[];b.locations=t.locations.slice(1),b.locations.forEach(function(a){n=a.sub_areas.split(",").map(Number),a.sa=[],n.forEach(function(n){var s=t.locations.map(function(t){return t.id}).indexOf(n);s>-1&&(e={},e.id=n,e.name=t.locations[s].nh_name,e.sel=!0,a.sa.push(e))}),a.sel=!1,b.locs.push(a.nh_name)})}function r(){var e="";b.locations.forEach(function(t){e+=","+t.id}),e=e.substring(1),console.log("str - ",e);var n=t.locations.map(function(t){return t.nh_name}).indexOf("San Diego");i.update(t.locations[n].id,["sub_areas"],[e])}function l(){b.showAddLocation=!0}function c(){var e={};e.nh_name=b.locname,e.cityid=t.locations[0].cityid,e.cityname=t.locations[0].cityname,e.sub_areas="",i.addLocation(e).then(function(){b.showAddLocation=!1,o()})}function d(t){b.locations.forEach(function(t){t.sel=!1}),t.sel=!0}function g(t){t.sel?t.sel=!1:t.sel=!0}function m(e){var a={};a.sel=!0,a.name=b.newsa;var s=t.locations.map(function(t){return t.nh_name}).indexOf(b.newsa);s>-1?(a.id=t.locations[s].id,e.sa.push(a),b.newsa=""):n.getDialog("subAreaInvalid")}function u(e){var n="";e.sa.forEach(function(t){t.sel&&(n+=","+t.id)}),n=n.substring(1),t.DEBUG_MODE&&console.log("str - ",n),i.update(e.id,["sub_areas"],[n]),e.sel=!1,o()}function p(t){i.deleteRec(t.id).then(function(){o()})}function v(t){t.sel=!1}var b=this;b.title="locations",b.getLocations=o,b.update=r,b.enableAddLocation=l,b.addLocation=c,b.editLocation=d,b.selsa=g,b.addsa=m,b.savesa=u,b.deleteloc=p,b.cancel=v,function(){b.showAddLocation=!1,b.opts=["San Diego"],b.locs=[],t.DEBUG_MODE&&console.log("locations page Loaded!")}()}angular.module("app").controller("locations",t),t.$inject=["$rootScope","staticpages","dialog","SERVER_URL","$timeout","locations"]}(),function(){"use strict";function t(t,e,n,a){function s(){r.uuis=t.uuis}function i(t){e.deleteRecord(t.id).then(s)}function o(i){var o=t.answers.map(function(t){return t.id}).indexOf(i.answer);t.answers[o].imageurl==i.imageurl&&a.updateAnswer(t.answers[o].id,["imageurl"],[t.EMPTY_IMAGE]),n.deleteBlob(i.imageurl),e.deleteRecord(i.id).then(s)}var r=this;r.title="imagesmod",r.dataready=!1,r.removeImage=o,r.approveImage=i,function(){e.getRecords().then(function(){r.dataready=!0,s()}),t.DEBUG_MODE&&console.log("imagesmod page Loaded!")}()}angular.module("app").controller("imagesmod",t),t.$inject=["$rootScope","useruploadedimages","imagelist","answer"]}(),function(){"use strict";function t(t,e,n,a,s,i,o){function r(){console.log("getRanks");for(var t="",n=0;n<e.content.length;n++)e.content[n].tags.indexOf("food")>-1&&(t=t+":"+e.content[n].id);for(var s=t.substring(1),i=s.split(":").map(Number),o={},r=0,c=0,g=[],m=!1,u="",n=0;n<e.catansrecs.length;n++){o=e.catansrecs[n];for(var p=0;p<i.length;p++)if(o.category==i[p]){if(r=o.answer,c=e.answers.map(function(t){return t.id}).indexOf(r),c<0&&(console.log("idx - ",r,"catansrec - ",o.id,o.answer,o.category),a.deleteRec(o.answer,o.category)),m=!1,g.length>0&&c>0)for(var v=0;v<g.length;v++)if(g[v].id==e.answers[c].id){m=!0;break}m||(u=u+":"+e.answers[c].id,g.push(e.answers[c]))}}d=g.map(function(t){return t.id}),l(0),console.log("Answers Ids: - ",u.substring(1)),console.log("Food answers length: - ",g.length)}function l(t){d.indexOf(e.answers[t].id)>-1?(i.updateAnswer(e.answers[t].id,["isfood"],[!0]),o(function(){t++,console.log(t," ",e.answers[t].name,", isfood is TRUE"),t<e.answers.length&&l(t)},100)):(i.updateAnswer(e.answers[t].id,["isfood"],[!1]),o(function(){t++,console.log(t," ",e.answers[t].name,", isfood is FALSE"),t<e.answers.length&&l(t)},100))}var c=this;c.title="foodRanks";var d=[];c.getRanks=r,function(){console.log("foodRanks page Loaded!")}()}angular.module("app").controller("foodRanks",t),t.$inject=["$location","$rootScope","$state","catans","$http","answer","$timeout"]}(),function(){"use strict";function t(t,e,n,a,s,i,o){function r(){a.getFlags().then(function(t){p.flags=t,console.log("flags - ",p.flags);for(var e=0;e<p.flags.length;e++){if("comment-rank"==p.flags[e].type||"comment-answer"==p.flags[e].type)switch(p.flags[e].flag){case 1:p.flags[e].desc="Off-Topic";break;case 2:p.flags[e].desc="Offensive";break;case 3:p.flags[e].desc="Spam"}if("answer"==p.flags[e].type)switch(p.flags[e].flag){case 1:p.flags[e].desc="Wrong Category";break;case 2:p.flags[e].desc="No longer active";break;case 3:p.flags[e].desc="Offensive";break;case 4:p.flags[e].desc="Spam"}}})}function l(t){"answer"==t.type&&n.go("answerDetail",{index:t.number}),"comment-answer"==t.type&&n.go("answerDetail",{index:t.number}),"comment-rank"==t.type&&n.go("rankSummary",{index:t.number})}function c(t){p.viewTable=!1,p.viewDetails=!0;var n={};if(p.data={},p.catans=[],p.comments=[],p.data.type=t.type,p.data.desc=t.desc,p.data.id=t.id,"answer"==t.type){var a=e.answers.map(function(t){return t.id}).indexOf(t.number);p.data.imageurl=e.answers[a].imageurl,p.data.name=e.answers[a].name,p.data.location=e.answers[a].location,p.data.cityarea=e.answers[a].cityarea,p.data.phone=e.answers[a].phone,p.data.website=e.answers[a].website,p.data.addinfo=e.answers[a].addinfo;for(var s=0;s<e.catansrecs.length;s++)if(e.answers[a].id==e.catansrecs[s].answer){n={},n=e.catansrecs[s];for(var r=0;r<e.content.length;r++)e.catansrecs[s].category==e.content[r].id&&(n.rank=e.content[r].title);p.catans.push(n)}}if("comment-answer"==t.type){var a=e.answers.map(function(t){return t.id}).indexOf(t.number);p.data.imageurl=e.answers[a].imageurl,p.data.name=e.answers[a].name,p.data.location=e.answers[a].location,p.data.cityarea=e.answers[a].cityarea,p.data.phone=e.answers[a].phone,p.data.website=e.answers[a].website,p.data.addinfo=e.answers[a].addinfo,o.getcommentsbyanswer(t.number).then(function(t){p.comments=t})}if("comment-rank"==t.type){var a=e.content.map(function(t){return t.id}).indexOf(t.number);p.data.title=e.content[a].title,i.getcommentsbyrank(t.number).then(function(t){p.comments=t})}}function d(){p.viewTable=!0,p.viewDetails=!1}function g(t){s.deleteRec(t.answer,t.category)}function m(t){"comment-rank"==p.data.type&&i.deletecomment(t.id),"comment-answer"==p.data.type&&o.deletecomment(t.id)}function u(t){a.deleteFlag(t.id).then(function(){r()})}var p=this;p.title="flags",p.getFlags=r,p.gotoView=l,p.delCatans=g,p.delComment=m,p.seeDetails=c,p.seeFlags=d,p.deleteFlag=u,p.viewDetails=!1,p.viewTable=!0,function(){console.log("Flags page loaded!")}()}angular.module("app").controller("flags",t),t.$inject=["$location","$rootScope","$state","flag","catans","comment","comment2"]}(),function(){"use strict";function t(t,e,n,a,s,i,o,r){function l(){console.log("query Answer"),g.ansRes=[];for(var t=0,n={},a=0;a<e.answers.length;a++)e.answers[a].name.indexOf(g.val)>-1&&g.ansRes.push(e.answers[a]);for(var s=0;s<g.ansRes.length;s++){g.ansRes[s].catans=[],t=g.ansRes[s].id;for(var i=0;i<e.catansrecs.length;i++)if(t==e.catansrecs[i].answer){n=e.catansrecs[i];for(var o=0;o<e.content.length;o++)e.catansrecs[i].category==e.content[o].id&&(n.rankid=e.content[o].id,n.catid=e.content[o].cat,n.title=e.content[o].title);g.ansRes[s].catans.push(n)}}}function c(t){r.deleteRec(t.answer,t.category)}function d(t){o.deleteAnswer(t.id)}var g=this;g.title="dbQuery",g.queryAnswer=l,g.delCatans=c,g.delAnswer=d,g.isAdmin=e.isAdmin||e.dataAdmin,function(){g.isDET=e.isLoggedIn&&(12==e.user.id||30==e.user.id||41==e.user.id||42==e.user.id||30==e.user.id),console.log("dbQuery page Loaded!")}()}angular.module("app").controller("dbQuery",t),t.$inject=["$location","$rootScope","$state","$stateParams","table","dialog","answer","catans"]}(),function(){"use strict";function t(t,e,n,a,s,i,o,r,l,c,d,g,m,u,p,v,b){function h(){var t={},n=!1;j.unrefans=[],j.addctsopts=[],j.ans=-1;for(var a=0;a<e.answers.length;a++){({}),t={},t=e.answers[a],n=!1;for(var s=0;s<e.catansrecs.length;s++)if(e.catansrecs[s].answer==t.id){n=!0;break}0==n&&j.unrefans.push(t)}if(j.unrefans.length>0)for(var i=0;i<e.content.length;i++)j.addctsopts.push(e.content[i].title)}function f(t){c.deleteAnswer(t.id).then(function(){h()})}function y(t){j.ans=t.id}function w(t){var n="",a=0;n=j.addctsval;for(var s=0;s<e.content.length;s++)if(e.content[s].title==n){a=e.content[s].id;break}d.postRec2(j.ans,a).then(function(){h()})}function k(){console.log("@ Show Possible Duplicated"),console.log("answers length",e.answers.length);var t={},n={};j.dupAnswers=[];for(var a=0,s=0,i="",o=0;o<e.answers.length;o++)if(s=.75*e.answers[o].name.length,t=e.answers[o],i=e.answers[o].name.slice(0,s),"Establishment"==e.answers[o].type&&i.length>8)for(var r=0;r<e.answers.length;r++)e.answers[r].name.indexOf(i)>-1&&o!=r&&(n={},n.id=a,n.add1=t.addinfo,n.nh1=t.cityarea,n.loc1=t.location,n.name1=t.name,n.image1=t.imageurl,n.id1=t.id,n.name2=e.answers[r].name,n.idx1=o,n.idx2=r,n.loc2=e.answers[r].location,n.nh2=e.answers[r].cityarea,n.add2=e.answers[r].addinfo,n.image2=e.answers[r].imageurl,n.id2=e.answers[r].id,j.dupAnswers.push(n),a++);console.log("finished")}function x(t){for(var n=0;n<e.catansrecs.length;n++)if(t.id2==e.catansrecs[n].answer){d.updateRec(e.catansrecs[n].id,["answer"],[t.id1]);break}c.deleteAnswer(t.id2),k()}function A(t){for(var n=0;n<e.catansrecs.length;n++)if(t.id1==e.catansrecs[n].answer){d.updateRec(e.catansrecs[n].id,["answer"],[t.id2]);break}c.deleteAnswer(t.id1),k()}function S(){e.dupAns=[];var t={},n={};j.dupAnsNames=[];for(var a=0,s=0;s<e.answers.length;s++){t=e.answers[s];for(var i=0;i<e.answers.length;i++)t.name==e.answers[i].name&&t.location==e.answers[i].location&&s!=i&&(!1,n={},n.ans1=t,n.ans2=e.answers[i],e.dupAns.push(n),j.dupAnsRdy=!0,a++)}}function R(){e.fields=e.typeSchema[6].fields;for(var t={},n={},a=[],s=0,i=0;i<e.answers.length;i++)if(t=e.answers[i],void 0!=t.location&&""!=t.location)for(var o=0;o<e.answers.length;o++)void 0!=e.answers[o].location&&""!=e.answers[o].location&&t.location==e.answers[o].location&&i!=o&&(n={},n.ans1=t,n.ans2=e.answers[o],a.push(n),s++);e.dupAns=a,console.log("@finished - showDuplicatedByLocation"),j.dupAnsRdy=!0}function C(){n.go("mergeAnswers")}function P(){}function D(){for(var t=[],n=0;n<e.content.length;n++)for(var a=n;a<e.content.length;a++)e.content[n].title==e.content[a].title&&n!=a&&(console.log("duplicated rank --- ",e.content[n].title),t.push(e.content[n]))}function I(){console.log("Clearing all catans vote sums to zero")}function O(){console.log("syncUSerVotes"),g.loadAllVotes().then(function(t){e.allvotes=t,E()})}function E(){console.log("syncVotes");var t={},n={},a=[],s=[],i=0,o=0;j.syncp=[];for(var r={},l=0;l<e.catansrecs.length;l++){t=e.catansrecs[l],a=[],s=[],n={};for(var c=0;c<e.allvotes.length;c++)n=e.allvotes[c],n.catans==t.id&&(1==n.vote&&a.push(n),-1==n.vote&&s.push(n));a.length==t.upV&&s.length==t.downV||(r={},i=e.answers.map(function(t){return t.id}).indexOf(t.answer),o=e.content.map(function(t){return t.id}).indexOf(t.category),-1==i?(console.log("can not find answer ",t.answer),d.deleteCatan(t.id)):-1==o?(console.log("can not find ranking ",t.category),d.deleteCatan(t.id)):(r.answername=e.answers[i].name,r.categorytitle=e.content[o].title,r.answer=e.answers[i].id,r.catans=t.id,r.category=e.content[o].id,r.caUpV=t.upV,r.caDownV=t.downV,r.nUpVlen=a.length,r.nDownVlen=s.length,r.upVotes=a,r.downVotes=s,j.syncp.push(r)))}console.log("vm.syncp.length - ",j.syncp.length)}function T(){for(var t=0;t<j.syncp.length;t++)$(j.syncp[t])}function $(t){d.updateRec(t.catans,["upV","downV"],[t.nUpVlen,t.nDownVlen])}function N(t){for(var n=!1,a=0;a<e.allvotes.length;a++)t.user==e.allvotes[a].user&&t.vote==e.allvotes[a].vote&&t.catans==e.allvotes[a].catans&&t.answer==e.allvotes[a].answer&&(n&&g.deleteRec(e.allvotes[a].id),n=!0)}function M(){console.log("@estDistances, need to have GPS location stored-",e.answers.length),j.ans=-1,j.answerdist=[];for(var t=.017453292519943295,n=Math.cos,a=0,s=e.currentUserLatitude,i=e.currentUserLongitude,o=0,r=0,l=0,c={},d=0;d<e.answers.length;d++)"Establishment"==e.answers[d].type&&void 0!=e.answers[d].location&&""!=e.answers[d].location&&(o=e.answers[d].lat,r=e.answers[d].lng,c=e.answers[d],a=.5-n((o-s)*t)/2+n(s*t)*n(o*t)*(1-n((r-i)*t))/2,l=12742*Math.asin(Math.sqrt(a))/1.609,c.dist=l,(l>100||NaN==l)&&j.answerdist.push(c))}function L(t){n.go("answerDetail",{index:t.id})}function U(){for(var t=[],n={},a=1256,s=0;s<e.answers.length;s++)e.answers[s].imageurl.indexOf("http://")>-1&&(n={},n.id=a++,n.answer=e.answers[s].id,n.url=e.answers[s].imageurl,t.push(n));console.log(JSON.stringify(t))}function _(){var t=[],e="";u.get("../../../assets/images.json").then(function(n){t=n.data;for(var a=0;a<t.length;a++)t[a].url.indexOf("jpg")>-1&&(e="jpg"),t[a].url.indexOf("png")>-1&&(e="png"),t[a].url.indexOf("jpeg")>-1&&(e="jpeg"),c.updateAnswer(t[a].answer,["image"],["https://rankx.blob.core.windows.net/sandiego/"+t[a].answer+"/"+t[a].id+"."+e])})}function F(){var t={},n="";j.codes=[],j.catcode={},j.ans=-1;var a=p.get(),s=v.get();return i.all([a,s]).then(function(a){e.catcodes=a[0],e.codeprices=a[1];for(var s=0;s<e.codeprices.length;s++)j.codes.push(e.codeprices[s].code);console.log("Category-codes loaded..."),j.ansNoCode=[];for(var i=0;i<e.answers.length;i++)if(("Establishment"==e.answers[i].type||"PersonCust"==e.answers[i].type)&&(t={},t=e.answers[i],void 0==(n=b.getBizCat(t.id))||""==n||null==n)){t.cats=[];for(var o=0;o<e.catansrecs.length;o++)if(e.catansrecs[o].answer==t.id)for(var r=0;r<e.content.length;r++)e.content[r].id==e.catansrecs[o].category&&t.cats.push(e.content[r].title);j.ansNoCode.push(t)}})}function z(){p.post(j.catcode).then(function(){console.log("Added category code pair"),F()})}function B(t){console.log("selEditAddess - ",t),j.ans=t.id}function V(t){o.getLocationGPS(t).then(function(){c.updateAnswer(t.id,["location","lat","lng"],[t.location,t.lat,t.lng]).then(function(){M()})})}function q(){}function G(){j.catstrmode=!0;for(var t=0,n="",a=[],s=[],i=0;i<e.content.length;i++){a=[],m.getInclusiveAreas(e.content[i].nh,a),s=[];for(var o=0;o<e.content.length;o++)if(e.content[i].cat==e.content[o].cat)for(var l=0;l<a.length;l++)a[l]==e.content[o].nh&&-1==s.indexOf(e.content[o].id)&&s.push(e.content[o].id);n="";for(var c=0;c<s.length;c++)n=n+":"+s[c];n=n.substring(1),r.update(e.content[i].id,["catstr"],[n]).then(function(){t++,j.cpct=Math.floor(t/e.content.length*100)})}}var j=this;j.title="dbMaint",j.showUrefAns=h,j.delAnswer=f,j.selAns=y,j.showPossibleDuplicated=k,j.syncToFirst=x,j.syncToSecond=A,j.showDuplicatedOnlyName=S,j.showDuplicatedByLocation=R,j.findPhoneWebsite=P,j.findDuplicatedRanks=D,j.clearAllCatansVotes=I,j.syncUserVotes=O,j.getAnswerBizCode=F,j.updatecatans=$,j.estDistances=M,j.gotoAnswer=L,j.createImagesJSON=U,j.updateUrls=_,j.goMerge=C,j.getSlugs=q,j.delAnswer=f,j.addcts=w,j.selEditAddress=B,j.editAddress=V,j.addcatcode=z,j.categoryStr=G,j.deleteDupVotes=N,j.fixAll=T,j.isAdmin=e.isAdmin,j.dupAnsRdy=!1,j.catstrmode=!1,function(){console.log("dbMaint page Loaded!")}()}angular.module("app").controller("dbMaint",t),t.$inject=["$location","$rootScope","$state","$stateParams","Upload","$q","getgps","table","dialog","answer","catans","votes","common","$http","categorycode","codeprice","useraccnt"]}(),function(){"use strict";function t(t,e,n,a,s,i,o,r,l,c,d,g,m,u,p,v,b,h,f,y){function w(t){n.go("answerDetail",{index:t.slug})}function k(){E.filteredCatans=[];var t=_.groupBy(E.catans,function(t){return"cat"+t.category+"answer"+t.answer});for(var e in t)t[e].length>1&&(t[e].dup=t[e].length,E.filteredCatans.push(t[e]));E.deletingCatans=!1,E.dtInstanceCatans={},m(function(){E.dtInstanceCatans.rerender()},1e3)}function x(){E.deletingCatans=!0;var t=E.filteredCatans.filter(function(t){return t[0].checked}),e=[];t.forEach(function(t){for(var n=1;n<t.length;n++)e.push(v.deleteCatan(t[n].id))}),o.all(e).then(function(t){t.forEach(function(t){var e=E.catans.map(function(t){return t.id}).indexOf(t.resource[0].id);E.catans.splice(e,1)}),k()})}function A(){E.filteredCategories=[];var t=E.rankings.map(function(t){return t.cat});E.filteredCategories=E.categories.filter(function(e){return-1==t.indexOf(e.id)}),E.deletingCategories=!1,E.dtInstanceCategories={},m(function(){E.dtInstanceCategories.rerender()},1e3)}function S(){E.deletingCategories=!0;var t=E.filteredCategories.filter(function(t){return t.checked}),e=[];t.forEach(function(t){e.push(b.deleteRec(t.id))}),o.all(e).then(function(t){t.forEach(function(t){var e=E.categories.map(function(t){return t.id}).indexOf(t.id);E.categories.splice(e,1)}),A()})}function R(){E.filteredAnswers=[];var t=E.catans.map(function(t){return t.answer});E.filteredAnswers=E.answers.filter(function(e){return-1==t.indexOf(e.id)}),E.deletingAnswers=!1,E.dtInstanceAnswers={},m(function(){E.dtInstanceAnswers.rerender()},1e3)}function C(){E.deletingAnswers=!0;var t=E.filteredAnswers.filter(function(t){return t.checked}),e=[];t.forEach(function(t){e.push(c.deleteAnswer(t.id))}),o.all(e).then(function(t){t.forEach(function(t){var e=E.answers.map(function(t){return t.id}).indexOf(t.id);E.answers.splice(e,1)}),R()})}function P(){E.filteredRankings=[];var t=E.catans.map(function(t){return t.category});E.filteredRankings=E.rankings.filter(function(e){return-1==t.indexOf(e.id)}),E.deletingRankings=!1,E.dtInstanceRankings={},m(function(){E.dtInstanceRankings.rerender()},1e3)}function D(){E.deletingRankings=!0;var t=E.filteredRankings.filter(function(t){return t.checked}),e=[];t.forEach(function(t){e.push(s.deleteTable(t.id))}),o.all(e).then(function(t){t.forEach(function(t){var e=E.rankings.map(function(t){return t.id}).indexOf(t.id);E.rankings.splice(e,1)}),P()})}function I(){E.filteredFImages=[];var t=E.categories.map(function(t){return t.fimage});E.filteredFImages=E.fimages.filter(function(e){return-1==t.indexOf(e.url)}),E.deletingFImages=!1,E.dtInstanceFImages={},m(function(){E.dtInstanceFImages.rerender()},1e3)}function O(){E.deletingFImages=!0;var t=E.filteredFImages.filter(function(t){return t.checked}),e=[];t.forEach(function(t){e.push(y.deleteBlob(t.url))}),o.all(e).then(function(e){t.forEach(function(t){var e=E.fimages.map(function(t){return t.url}).indexOf(t.url);E.fimages.splice(e,1)}),I()})}var E=this;E.title="cleandb",E.dataReady=!1,E.catans=[],E.accounts=[],E.rankings=[],E.categories=[],E.answers=[],E.fimages=[],E.isAdmin=e.isAdmin,E.notifications=[],E.gotoanswer=w,E.filterCatans=k,E.filterCategories=A,E.filterAnswers=R,E.filterRankings=P,E.filterFImages=I,E.deleteSelectedCatans=x,E.deleteSelectedCategories=S,E.deleteSelectedAnswers=C,E.deleteSelectedRankings=D,E.deleteSelectedFImages=O,E.dtInstanceCatans={},E.dtInstanceCategories={},E.dtInstanceAnswers={},E.dtInstanceRankings={},E.dtInstanceFImages={},E.filteredCatans=[],E.filteredCategories=[],E.filteredAnswers=[],E.filteredRankings=[],E.filteredFImages=[],function(){o.all([v.getAllcatans(),r.getallaccnts(),b.getAllCategories(),f.getAllLocations(),s.getTables(),c.getAnswers(),y.getFeatureImageList()]).then(function(t){E.catans=t[0],E.accounts=t[1],E.categories=t[2],E.locations=t[3],e.categories=t[2],e.locations=t[3],e.content=t[4],h.unwrap(),E.rankings=e.content,E.answers=t[5],E.fimages=t[6],console.log("vm.fimages - ",E.fimages),E.dataReady=!0,k(),A(),R(),P(),I()})}()}angular.module("app").controller("cleandb",t),t.$inject=["$location","$rootScope","$state","$stateParams","table","dialog","$q","useraccnt","promoter","answer","codeprice","setting","$timeout","DTOptionsBuilder","DTColumnDefBuilder","catans","categories","dataloader","locations","imagelist"]}(),function(){"use strict";function t(t,e,n,a,s,i,o,r,l,c,d,g,m,u,p){function v(){console.log("bizadmin page Loaded!")}function b(t){return c.getAnswer(t.answer).then(function(e){t.answerObj=e})}function h(t){n.go("answerDetail",{index:t.slug})}function f(){return 1==S.showFilter?S.filtered=S.businesses.filter(function(t){return t.hasranks||t.haspremium}):2==S.showFilter?S.filtered=S.businesses.filter(function(t){return!(t.hasranks||t.haspremium)}):(S.loading=!1,S.dtInstance.rerender(),S.filtered=S.businesses)}function y(){S.showFilter=1,f()}function w(){S.showFilter=2,f()}function k(){S.showFilter=0,f()}function x(){S.showUserFilter=!S.showUserFilter,f()}function A(){console.log(S.filtered.filter(function(t){return t.checked}).map(function(t){return t}))}var S=this;S.title="bizadmin",S.dataReady=!1,S.businesses=[],S.isAdmin=e.isAdmin,S.notifications=[],S.gotoanswer=h,S.filterData=f,S.showFilter=0,S.showUserFilter=!0,S.setShowPurchases=y,S.setShowAll=k,S.setShowNonPurchases=w,S.showUser=x,S.deleteSelected=A,S.dtInstance={},S.filtered=[],S.loading=!1,function(){o.all([r.getallaccnts(),g.getSetting(),d.get()]).then(function(t){t[0],t[2],S.STRIPE_COMMISSION_PERCENTAGE=t[1].STRIPE_COMMISSION_PERCENTAGE?t[1].STRIPE_COMMISSION_PERCENTAGE:.2,S.CUSTOM_RANK_PRICE=t[1].CUSTOM_RANK_PRICE,t[0].forEach(function(t){var n=angular.copy(t);e.answers.map(function(t){return t.id}).indexOf(n.answer)>-1&&(b(n).then(function(){f()}),S.businesses.push(n))}),S.dataReady=!0,f()}),v()}()}angular.module("app").controller("bizadmin",t),t.$inject=["$location","$rootScope","$state","$stateParams","table","dialog","$q","useraccnt","promoter","answer","codeprice","setting","$timeout","DTOptionsBuilder","DTColumnDefBuilder"]}(),function(){"use strict";function t(t,e,n,a,s,i,o){function r(){t.answers.forEach(function(t){void 0!=t.imageurl&&-1==t.imageurl.indexOf("noimage.jpg")&&-1==t.imageurl.indexOf("rankx.blob.core")&&"Short-Phrase"!=t.type&&(d.ansimgs.push(t),console.log(t.name,t.imageurl))})}function l(){g<d.ansimgs.length&&(d.inprogress=!0,c(d.ansimgs[g].imageurl,d.ansimgs[g].slug,d.ansimgs[g].id).then(function(){console.log("processing image success - ",d.ansimgs[g].slug),g++,d.cpct=g/d.ansimgs.length*100,l()},function(t){console.log("there was error processing image: ",t),g++,d.cpct=g/d.ansimgs.length*100,l()}))}function c(t,e,n){return i({method:"POST",url:"https://server.rank-x.com/ImageServer/SaveImage",headers:{"X-Dreamfactory-API-Key":void 0,"X-DreamFactory-Session-Token":void 0},data:{imageurl:t,filename:e,answerid:n}})}var d=this;d.title="answerimages",d.ansimgs=[];var g=0;d.processAllImages=l,function(){r(),t.DEBUG_MODE&&console.log("answerimages page Loaded!")}()}angular.module("app").controller("answerimages",t),t.$inject=["$rootScope","staticpages","dialog","SERVER_URL","$timeout","$http","answer"]}(),function(){"use strict";function t(t,e,n,a,s,i,o,r,l,c,d,g,m,u,p,v,b,h,f,y,w){function k(){var e=n.getTables(),o=s.getAllCategories(),d=m.getAllLocations(),f=a.getAllAnswers(),y=u.getSpecials(),w=p.GetMatchTable(),k=v.getAllUserActivity(),x=c.getAllcatans(),A=b.getEdits(),S=l.getAllvrows(),R=i.getTables(),C=h.getallaccnts();return r.all([e,o,d,f,y,w,k,x,A,S,R,C]).then(function(e){t.content=e[0],t.categories=e[1],t.locations=e[2],t.answers=e[3],t.specials=e[4],t.mrecs=e[5],t.alluseractivity=e[6],t.catansrecs=e[7],t.edits=e[8],t.cvrows=e[9],t.customranks=e[10],t.useraccnts=e[11],g.unwrap(),g.createSearchStrings(),q.dataready=!0})}function x(){z(),q.selKeywords="active",e.go("queries")}function A(){z(),q.selViews="active",e.go("views")}function S(){z(),q.selFlags="active",e.go("flags")}function R(){z(),q.selRankings="active",e.go("addRank")}function C(){z(),q.selDbMaint="active",e.go("dbMaint")}function P(){z(),q.selQuery="active",e.go("dbQuery")}function D(){z(),q.selUpdate="active",e.go("updateHeaders")}function I(){z(),q.selFoodRanks="active",e.go("foodRanks")}function O(){z(),q.selSibLocks="active",e.go("sibLocs")}function E(){z(),q.selPayment="active",e.go("payment")}function T(){z(),q.selPlan="active",e.go("plan")}function $(){z(),q.selBizAdmin="active",e.go("bizadmin")}function N(){z(),q.selCleanDB="active",e.go("cleandb")}function M(){z(),q.selimagesMod="active",e.go("imagesmod")}function L(){z(),q.selStaticPages="active",e.go("staticpagesconsole")}function U(){z(),q.selLocations="active",e.go("locations")}function _(){z(),q.selsitemap="active",e.go("sitemap")}function F(){z(),q.selanswerimages="active",e.go("answerimages")}function z(){q.selKeywords="",q.selViews="",q.selFlags="",q.selRankings="",q.selDbMaint="",q.selQuery="",q.selUpdate="",q.selFoodRanks="",q.selPlan="",q.selPayment="",q.selBizAdmin="",q.selSibLocks="",q.selCleanDB="",q.selimagesMod="",q.selStaticPages="",q.selLocations="",q.selsitemap="",q.selanswerimages=""}function B(){e.go("content")}function V(){console.log("apply Rule")}var q=this;q.title="admin",q.selKeywords="active",q.selViews="",q.selFlags="",q.selRankings="",q.selPlan="",q.selCleanDB="",q.goBack=B,q.keywords=x,q.views=A,q.flags=S,q.addRank=R,q.dbMaint=C,q.dbQuery=P,q.update=D,q.foodranks=I,q.sibLocs=O,q.payment=E,q.plan=T,q.bizAdmin=$,q.applyRule=V,q.cleanDB=N,q.modImages=M,q.staticPages=L,q.golocations=U,q.gositemap=_,q.goanswerimages=F,q.dataready=!1,function(){t.isAdmin||t.dataAdmin||t.modAdmin?(q.isDET=t.isLoggedIn&&("10104518570729893"==t.user.id||30==t.user.id||41==t.user.id||42==t.user.id||30==t.user.id||0xaaf2b1002387==t.user.id||0xb07a74be061a==t.user.id),q.isAdmin=t.user.is_sys_admin||t.isAdmin,q.dataAdmin=t.dataAdmin,q.modAdmin=t.modAdmin,k(),t.DEBUG_MODE&&console.log("admin page Loaded!")):e.go("cwrapper")}()}angular.module("app").controller("admin",t),t.$inject=["$rootScope","$state","table","answer","categories","table2","categorycode","$q","vrows","catans","common","dataloader","locations","special","matchrec","useractivity","edit","useraccnt","staticpages","$timeout","votes"]}(),function(){"use strict";function t(t,e,n,a,s,i){function o(){d.title=c.rankTitle,d.tags=c.tags,d.keywords=c.keywords,d.type=c.type,d.question=c.question,d.views=0,d.answers=0,(null==d.title||void 0==d.title||d.title.length<10)&&(g=!1),(null==d.question||void 0==d.question||d.question.length<10)&&(u=!1),"Person"!=d.type&&"Establishment"!=d.type&&"Short-Phrase"!=d.type&&"Event"!=d.type&&"Organization"!=d.type&&"Place"!=d.type&&"Activity"!=d.type&&"Thing"!=d.type&&"PersonCust"!=d.type&&(m=!1)}function r(){if(o(),console.log("vm.allNh --- ",c.allNh),0==c.allNh||void 0==c.allNh)g&&m&&u?(s.addTable(d),
l()):g?u?i.getDialog("rankType"):i.getDialog("rankQuestion"):i.getDialog("rankTitle");else if(g&&m&&u){for(var t=0;t<e.content.length;t++)if(e.content[t].title.indexOf("Yoga studios in")>-1){var n=JSON.parse(JSON.stringify(e.content[t]));n.id=void 0;var a=n.title.replace("Yoga studios in",c.rankTitle);n.title=a;var r=c.tags;n.tags=r,a.indexOf("Pacific Beach")>-1&&(n.tags=n.tags+" pb"),a.indexOf("Ocean Beach")>-1&&(n.tags=n.tags+" ob"),a.indexOf("Mission Beach")>-1&&(n.tags=n.tags+" mb"),a.indexOf("in San Diego")>-1&&(n.tags=n.tags+" isMP",n.isatomic=!1),a.indexOf("in Downtown")>-1&&(n.isatomic=!1),n.answers=0,n.views=0,n.answertags="",n.catstr="",s.addTable(n)}l()}else g?u?i.getDialog("rankType"):i.getDialog("rankQuestion"):i.getDialog("rankTitle")}function l(){d={},c.rankTitle="",c.tags="",c.keywords="",c.type="",c.isatomic=!0,c.question="",c.image1url="",c.image2url="",c.image3url=""}var c=this;c.title="addRank";var d={},g=!0,m=!0,u=!0;c.addRanking=r,c.typeList=["Person","Establishment","Place","Activity","Short-Phrase","Organization","Event","Thing","PersonCust"],c.isAdmin=e.isAdmin,function(){console.log("addRank page Loaded!")}()}angular.module("app").controller("addRank",t),t.$inject=["$location","$rootScope","$state","$stateParams","table","dialog"]}();