function calculateAge(e){var t=Date.now()-e.getTime(),n=new Date(t);return Math.abs(n.getUTCFullYear()-1970)}!function(){"use strict";angular.module("app",["angulike","color.picker","ngFileUpload","ngAnimate","ngCookies","ngRoute","ngSanitize","ngTouch","ngMessages","oc.lazyLoad","login","ui.router","ui.bootstrap.modal","mgcrea.ngStrap","720kb.datepicker","720kb.socialshare","ngFacebook","ui.select","infinite-scroll","datatables","wu.masonry"])}(),angular.module("app").run(["$templateCache",function(e){e.put("app/answer/Partials/answerDetail.html",'<div id="veil" ng-hide="vm.dataReady"></div><div id="feedLoading" ng-hide="vm.dataReady"><div style="text-align: center" ng-if="!vm.dataReady"><div><img src="/assets/images/loading.gif" class="img" style="width:50px;height:50px"></div><p style="font-size:large">loading details...</p></div></div><div ng-if="vm.dataReady" style="margin-left: -15px; margin-right: -15px"><div class="container"><div class="text-center"><button class="btn btn-default" ng-if="vm.searchActive" ng-click="vm.backToResults()" style="margin:5px; width:100%; background-color:lightgray">Back to Results</button></div></div><cat-bar ng-if="vm.ranking" text="{{vm.ranking}}" left-fn="vm.goPrev()" right-fn="vm.goNext()" close-rank="vm.closeAnswerDetail()"></cat-bar><div class="row" style="margin:5px;"><div class="col-xs-6 col-sm-3 col-md-2"><div class="text-left"><small class="text-muted">&nbsp;&nbsp;&nbsp{{vm.answer.views}}&nbspviews</small></div></div><div class="col-xs-6 col-sm-9 col-md-10"><div ng-show="{{vm.type == \'Establishment\' || vm.type == \'PersonCust\' || vm.type == \'Event\' }}" class="text-right"><p ng-attr-style="display:{{vm.answer.hasOwner ? \'none\':\'inline\'}};" class="hiw" ng-click="vm.bizRegDialog()"><u>{{vm.bindtxt}}</u>{{vm.isAdmin?(\' \'+ vm.bizcat):\'\'}}</p><span class="glyphicon glyphicon-lock" ng-attr-style="display:{{vm.answer.hasOwner ? \'inline\':\'none\'}}"></span></div></div></div><answer-header ans="{{vm.answer}}" idx="{{vm.idx}}"></answer-header><div ng-if="vm.type == \'Event\'"><br><div ng-bind-html="vm.ehtml" ng-attr-style="{{vm.estyle}}"><br></div></div><div class="text-center" style="margin-right:20px"><a type="button" class="btn btn-default" style="vertical-align:middle;color:#0059b3;border-color:#0059b3;" ng-if="vm.answer.family" ng-click="vm.showLocations()" target="_blank">Other Locations&nbsp&nbsp<span class="fa fa-map-marker"></span></a> <a type="button" class="btn btn-default" style="vertical-align:middle;color:#0059b3;border-color:#0059b3;" ng-if="true" ng-click="vm.share()" target="_blank">Share&nbsp&nbsp<span class="fa fa-share"></span></a></div><div class="col-xs-12" ng-if="!vm.answer.isprivate"><div class="well-sm" style="background-color:#666666;color:#f8f8ff"><h3 class="sub-header text-center">Endorsements</h3></div><p class="text-left" ng-if="vm.type != \'Short-Phrase\'"><strong>{{vm.answer.name}}</strong> is featured in the following ranks:</p><div class="well well-light-ranks col-xs-12 col-sm-6 col-md-4 col-lg-4" style="padding-top:5px;" ng-repeat="r in vm.answerRanks | orderBy:\'rank\' | limitTo:vm.dispRanks"><div class="container-bgbox"><bg-box bc="#666666" shade="0" fc="#f8f8ff" text="{{(vm.type == \'Short-Phrase\') ? vm.answer.name : r.title}}" dir="horizontal" w="100%" h="40px"></bg-box></div><p class="text-center" ng-if="vm.type == \'Short-Phrase\'">on {{r.title}}</p><div class="row" ng-if="true" ng-attr-style="padding-bottom:{{(r.thumbUp == \'grey\'&&r.thumbDn == \'grey\')?\'10px\':\'0px\'}};padding-top:5px; margin:0px"><div class="col-xs-2"><img ng-attr-style="height:55px;width:auto;margin:0px;" ng-src="{{r.icon}}"></div><div class="col-xs-7"><p style="padding-top:3px;margin-bottom:5px;">Ranked <strong>#{{r.rank}}</strong> out of <strong>{{r.answers}}</strong></p><div class="text-center" style="margin-top:2px"><span ng-click="vm.UpVote(r)" ng-attr-style="color:{{r.thumbUp}};margin-right:0px;font-size:{{r.thumbUp == \'grey\'?\'18px\':\'26px\'}};" class="pull-left">&nbsp&nbsp <i class="fa fa-thumbs-up" aria-hidden="true"></i> <span style="color:black;font-size: 14px;">&nbsp;{{r.upV}}&nbsp;&nbsp;</span></span> <span ng-click="vm.DownVote(r)" ng-attr-style="color:{{r.thumbDn}};margin-right:0px;font-size:{{r.thumbDn == \'grey\'?\'18px\':\'26px\'}};" class="pull-right"><i class="fa fa-thumbs-down" aria-hidden="true"></i> <span style="color:black;font-size: 14px;">&nbsp;{{r.downV}}</span> &nbsp&nbsp</span></div></div><div class="col-xs-3" ng-attr-style="padding-right:{{vm.sm?\'0px\':\'20px\'}}"><a href="" class="text-center" ng-click="vm.gotoRank(r)">Full ranking</a></div></div><p ng-attr-style="display:{{vm.deleteButton ? \'inline\':\'none\'}};color:red" ng-click="vm.deleteThisCatans(r)">&lt;&lt;Delete&gt;&gt;</p></div><p ng-show="{{vm.answerRanks.length > 3}}" style="background-color:lightgray;cursor:pointer" ng-click="vm.showRanks()">{{vm.dispRanks > 3 ? \'Show less\':(\'Show more (\' + (vm.answerRanks.length - 3) + \')\') }}</p><div ng-if="vm.isAdmin"><div class="text-left"><button class="btn btn-primary" ng-click="vm.addCatans()">Add Catans</button></div><div class="input-group" ng-if="vm.addctsactive"><input type="text" class="form-control" ng-model="vm.addctsval" bs-options="c for c in vm.addctsopts" bs-typeahead=""> <span class="input-group-btn text-right"><button class="btn btn-success" type="button" ng-click="vm.addcts()">Add</button></span></div></div></div><div class="container col-xs-12" ng-if="vm.answer.hasranks"><div class="row" ng-if="vm.type != \'Short-Phrase\'"><div class="col-xs-12"><div class="well-sm" style="background-color:#666666;color:#f8f8ff;"><h3 class="sub-header text-center">The Favorites</h3></div></div></div><div class="row" style="padding:0px;margin:0px;border:0px"><div ng-repeat="n in vm.myranks"><div class="container col-xs-3 col-sm-2 col-md-2 col-lg-2" ng-click="vm.gotoCustomRank(n)" ng-attr-style="border-top:3px solid white;border-bottom:3px solid white;background-color:{{n.bc}};color:{{n.fc}};height:{{vm.sm ? \'90px\':\'150px\'}};margin:0px;padding:0px;position:relative;"><h3 class="hidden-xs text-center" ng-attr-style="padding:3px; margin:0px; position:absolute; top:50%; left:50%; margin-right:-50%;transform: translate(-50%,-50%);cursor:pointer;">{{n.title}}<h4 class="hidden-sm hidden-md hidden-lg hidden-xl text-center" ng-attr-style="padding:3px; margin:0px; position:absolute; top:50%; left:50%; margin-right:-50%;transform: translate(-50%,-50%);cursor:pointer;">{{n.title}}</h4></h3></div><div class="col-xs-3 col-sm-2 col-md-2 col-lg-2" ng-click="vm.gotoCustomRank(n)" style="margin:0px;padding:0px;"><img ng-src="{{n.image}}" ng-attr-style="border-top:3px solid white;border-bottom:3px solid white;width:95%;height:{{vm.sm ? \'90px\':\'150px\'}};cursor:pointer;"></div></div></div><div class="text-right"><a href="" ng-if="vm.userIsOwner" ng-click="vm.addRankforAnswer()">Edit Ranking/List</a></div></div><div class="container col-xs-12" ng-if="vm.userIsOwner&&!vm.answer.hasranks&&!vm.hideCustomRanksMsg&&!vm.answer.isprivate &&vm.answer.type==\'Establishment\'||vm.answer.type==\'PersonCust\'"><br><div class="alert alert-info">This Favorites section contains <strong>Custom Ranks</strong> and it is <strong>only visible to you</strong> Custom Ranks are:<br><br><i class="fa fa-check"></i>&nbsp<strong>Interactive lists</strong> about anything in your business.<br><i class="fa fa-check"></i>&nbsp<strong>Showcase in detail</strong> your products and/or services.<br><i class="fa fa-check"></i>&nbspA great way to <strong>engage your audience</strong>.<br><i class="fa fa-check"></i>&nbspCan be anything from <i>Food or Drink Items</i>, <i>Newest or Best-selling Products</i>, <i>Popular Services</i>, <i>Recent Projects</i>, <i>Success Stories</i>, <i>Staff Members</i> or anything you choose.<br><br>Below are some examples on how you can use Custom Ranks to enhance your business profile.<div class="well-sm" style="background-color:#666666;color:#f8f8ff;"><h3 class="sub-header text-center">The Favorites</h3></div><div class="row" style="padding:0px;margin:0px;border:0px"><div ng-repeat="n in vm.myranks"><div class="container col-xs-3 col-sm-2 col-md-2 col-lg-2" ng-click="vm.gotoCustomRank(n)" ng-attr-style="border-top:3px solid #D9EDF7;border-bottom:3px solid #D9EDF7;background-color:{{n.bc}};color:{{n.fc}};height:{{vm.sm ? \'90px\':\'150px\'}};margin:0px;padding:0px;position:relative;"><h3 class="hidden-xs text-center" ng-attr-style="padding:3px; margin:0px; position:absolute; top:50%; left:50%; margin-right:-50%;transform: translate(-50%,-50%);cursor:pointer;">{{n.title}}<h4 class="hidden-sm hidden-md hidden-lg hidden-xl text-center" ng-attr-style="padding:3px; margin:0px; position:absolute; top:50%; left:50%; margin-right:-50%;transform: translate(-50%,-50%);cursor:pointer;">{{n.title}}</h4></h3></div><div class="col-xs-3 col-sm-2 col-md-2 col-lg-2" ng-click="vm.gotoCustomRank(n)" style="margin:0px;padding:0px;"><img ng-src="{{n.image}}" ng-attr-style="border-top:3px solid #D9EDF7;border-bottom:3px solid #D9EDF7;width:95%;height:{{vm.sm ? \'90px\':\'150px\'}};cursor:pointer;"></div></div></div><div class="text-right"><button class="btn btn-default" ng-click="vm.gotoMyBusiness()" style="margin:5px">Purchase Custom Ranks</button> <button class="btn btn-default" ng-click="vm.hideCustomRanks()" style="margin:5px">Hide Message</button></div></div></div><div class="col-xs-12" ng-if="true"><div class="well-sm" style="background-color:#666666;color:#f8f8ff;"><h3 class="sub-header" style="justify-content:space-between;display:flex"><span class="alignleft" style="cursor:pointer" ng-click="vm.moreImagesRev()">&nbsp{{vm.showRev?\'&lt\':\' \'}}&nbsp</span> <span class="aligncenter">Photo Gallery</span> <span class="alignright" style="cursor:pointer" ng-click="vm.moreImagesFwd()">&nbsp{{vm.showFwd?\'&gt\':\' \'}}&nbsp</span></h3></div><div class="text-right" ng-if="vm.type != \'Short-Phrase\'"><button ng-if="!vm.igdemo" class="btn btn-success" ng-click="vm.getImages()" ng-attr-style="display:{{vm.showImageGallery == false ? \'inline\':\'none\'}};margin:5px;">Show Images</button></div><div ng-attr-style="display:{{vm.showImageGallery == true ? \'inline\':\'none\'}}"><div class="col-xs-6 col-sm-4 col-md-3 col-lg-2" ng-repeat="x in vm.images.slice(vm.i,vm.e)"><a ng-click="vm.selectPhoto($index)" class="thumbnail"><img ng-src="{{x.url}}" style="width:100%;height:120px"></a></div><div ng-if="vm.images.length == 0">No images in Photo Gallery.</div></div></div><div ng-if="vm.type != \'Short-Phrase\'" class="col-xs-12"><div class="row"><div class="col-xs-6" style="padding-top:20px;"><div class="text-center" ng-if="vm.showImageGallery && vm.isLoggedIn" ng-attr-style="display:{{vm.isLoggedIn ? \'inline\':\'none\'}};"><blob-upload></blob-upload></div></div><div class="col-xs-6"><div class="text-center" ng-if="vm.showImageGallery && vm.isLoggedIn">Get from Instagram&nbsp&nbsp&nbsp <img ng-src="/assets/images/glyph-logo_May2016.png" ng-click="vm.selectInstagramImages()" ng-attr-style="width:80px;display:{{vm.isLoggedIn ? \'inline\':\'none\'}};cursor:pointer"></div></div></div></div><div class="col-xs-12" ng-if="vm.answer.ispremium"><div ng-show="{{vm.type == \'Establishment\' || vm.type == \'PersonCust\' }}"><div class="well-sm" style="background-color:#666666;color:#f8f8ff"><h3 class="sub-header text-center">Specials</h3></div><div class="row" style="border-left:5px solid white;border-right:5px solid white;"><div ng-repeat="x in vm.specialsList"><div class="col-xs-12 col-sm-6 col-md-4 col-lg-4" ng-click="vm.showSpecial(x)" ng-attr-style="background-color:{{x.bc}};color:{{x.fc}};cursor:pointer;border:5px solid white;"><h4 class="text-center">{{x.stitle}}</h4></div></div></div><div class="text-right"><a href="" ng-if="vm.userIsOwner" ng-click="vm.openSpecials()">Edit Specials</a></div></div></div><div class="container col-xs-12" ng-if="vm.userIsOwner&&!vm.answer.ispremium&&!vm.hideGetPremiumMsg &&!vm.answer.isprivate&&vm.answer.type==\'Establishment\'||vm.answer.type==\'PersonCust\'"><div class="alert alert-info">This Specials section below is only visible when you have <strong>Premium Membership</strong>. Premium Membership allows you to:<br><br><i class="fa fa-check"></i>&nbspCommunicate to users <strong>daily specials, events and deals</strong> real time.<br><i class="fa fa-check"></i>&nbspOffer special deals and control exactly when to start and stop an offering.<br><i class="fa fa-check"></i>&nbspSpecials are shown in the <strong>rankings summary</strong> driving <strong>more customers</strong> to your profile.<br><br>Below are examples on the type of Specials and Promotions you can show with a Premium Membership.<div class="well-sm" style="background-color:#666666;color:#f8f8ff;"><h3 class="sub-header text-center">Specials</h3></div><div class="row" style="border-left:5px solid #D9EDF7;border-right:5px solid #D9EDF7;"><div ng-repeat="x in vm.specialsList"><div class="col-xs-12 col-sm-6 col-md-4 col-lg-4" ng-click="vm.showSpecial(x)" ng-attr-style="background-color:{{x.bc}};color:{{x.fc}};cursor:pointer;border:5px solid #D9EDF7;"><h4 class="text-center" style="padding-top:10px">{{x.stitle}}</h4></div></div></div><div class="text-right"><button class="btn btn-default" ng-click="vm.gotoMyBusiness()" style="margin:5px">Purchase Premium Membership</button> <button class="btn btn-default" ng-click="vm.hideGetPremium()" style="margin:5px">Hide Message</button></div></div></div><div class="col-xs-12"><div><div class="well-sm" style="background-color:#666666;color:#f8f8ff"><h3 class="sub-header text-center">Opinions</h3></div><table class="table table-hover cursor"><tbody><tr ng-repeat="item in vm.vrows | orderBy:\'-delta\'"><td align="middle" ng-attr-style="width:10%"><img ng-src="../../../assets/images/{{item.upImage}}" style="max-height:30px;margin:0px;" ng-click="vm.vrowVoteUp(item)"></td><td align="left" style="width:10%">{{item.upV}}</td><td align="middle" style="width:60%">{{item.title}}</td><td align="right" style="width:10%">{{item.downV}}</td><td align="middle" ng-attr-style="width:10%"><img ng-src="../../../assets/images/{{item.downImage}}" style="max-height:30px;margin:0px;" ng-click="vm.vrowVoteDown(item)"></td></tr></tbody></table><div class="input-group" style="padding:0px;margin:0px;"><input type="text" class="form-control" ng-model="vm.newop" maxlength="40" placeholder="{{\'Write an opinion of \'+ vm.answer.name}}"> <span class="input-group-btn text-right"><button class="btn btn-primary {{vm.addvrowbutton}}" type="button" ng-click="vm.addvrow()">Add Opinion</button></span></div><div class="text-center" style="padding-top:5px">{{40 - vm.newop.length + \' characters left\'}}</div><br></div></div><div class="col-xs-12" ng-if="false"><div ng-show="{{vm.type != \'Establishment\' && vm.type != \'PersonCust\' && vm.type != \'Event\' }}"><div class="well-sm" style="background-color:#666666;color:#f8f8ff"><h3 class="sub-header">Versus Table</h3></div><table class="table table-hover cursor"><tbody><thead><tr><th align="middle" style="width:15%">Pct (%)</th><th align="middle" style="width:60%">vs. Opponent</th><th align="middle" style="width:15%">Pct (%)</th><th align="middle" style="width:10%">GP</th></tr></thead><tbody><tr ng-repeat="x in vm.relativetable | orderBy: \'-Rank\'"><td align="middle" style="width:15%">{{x.PctF}}</td><td align="middle" style="width:60%">{{x.vsName}}</td><td align="middle" style="width:15%">{{x.PctC}}</td><td align="middle" style="width:10%">{{x.GP}}</td></tr></tbody></tbody></table></div></div><br><br><div class="btn-group" role="group"><button type="button" ng-click="vm.goBack()" class="btn btn-default">Back</button></div><button type="button" ng-click="vm.deleteAnswer()" class="btn btn-danger" ng-if="vm.deleteButton">Delete</button><br><br></div>'),e.put("app/answer/Partials/answerheader.html",'<div class="container hidden-xs" ng-if="!isShortPhrase"><div class="row"><div class="container col-sm-6 col-md-4 col-lg-4" ng-attr-style="height:{{mxheight}}px;margin:0px;padding:0px;border:0px;"><div class="container-bgbox"><bg-box bc="{{bc}}" bc2="{{bc2}}" fc="{{fc}}" text="{{idx > 0 ? idx + \'. \' + answer.name:answer.name}}" dir="vertical" w="100%" h="120px"></bg-box></div><div class="container" ng-attr-style="width:100%; height:{{mxheight-120}}px;background-color:#d8d8d8;padding-top:5px"><strong ng-if="answer.eventloc && answer.type==\'Event\'">Location:</strong> <strong ng-if="answer.eventloc && answer.type==\'PersonCust\'">Works At:</strong> <a ng-if="answer.eventloc" ng-click="gotoLocationAnswer()" target="_blank">{{answer.eventloc}}</a><br ng-if="answer.eventloc"><strong ng-if="answer.location">Address:</strong> <a ng-if="answer.location" href="http://maps.apple.com/maps?q={{answer.location}}" target="_blank">{{answer.location}}</a><font ng-if="answer.dist&&answer.location" style="color:gray">&nbsp&nbsp({{answer.dist}} mi away)</font><br ng-if="answer.location"><strong ng-if="answer.cityarea">{{(answer.cityarea) ? \'Neighborhood:\' : ""}}</strong> {{(answer.cityarea) ? answer.cityarea : ""}}<br ng-attr-style="display:{{(answer.cityarea) ? \'inline\' : \'none\'}}"><strong ng-if="answer.phone">Phone:</strong> <a ng-if="answer.phone" href="tel:{{answer.phone}}">{{answer.phone}}</a><br ng-attr-style="display:{{(answer.phone) ? \'inline\' : \'none\'}}"><strong ng-if="answer.website">Website:</strong> <a ng-if="answer.website.indexOf(\'http\') >=0" href="{{answer.website}}" target="_blank">{{answer.website}}</a> <a ng-if="answer.website.indexOf(\'http\') == -1" href="http://{{answer.website}}" target="_blank">{{answer.website}}</a><br ng-if="answer.website"><strong ng-if="answer.email">{{(answer.email) ? \'Email:\' : ""}}</strong> {{(answer.email) ? answer.email : ""}}<br ng-attr-style="display:{{(answer.email) ? \'inline\' : \'none\'}}"><i ng-attr-style="display:{{hrset ? \'inline\':\'none\'}}">{{hourstr}}</i><div class="text-center answer_info_buttons"><br><a type="button" class="btn btn-default" style="vertical-align:middle;color:#0059b3;border-color:#0059b3;" ng-if="!answer.hasOwner || userIsOwner" ng-click="editAnswer()" target="_blank">Edit&nbsp&nbsp<span class="fa fa-pencil"></span></a><a type="button" class="btn btn-default" style="vertical-align:middle;color:#0059b3;border-color:#0059b3;" ng-if="isMobile && answer.phone" href="tel:{{answer.phone}}" target="_blank">Call&nbsp&nbsp<span class="fa fa-phone"></span></a> <a type="button" class="btn btn-default" style="vertical-align:middle;color:#0059b3;border-color:#0059b3;" ng-if="answer.lat && answer.lng" href="http://maps.apple.com/maps?q={{answer.lat}}, {{answer.lng}}" target="_blank">Directions&nbsp&nbsp<span class="fa fa-arrow-right"></span></a> <a type="button" class="btn btn-default hidden-md hidden-lg hidden-xl" style="vertical-align:middle;color:#0059b3;border-color:#0059b3;" ng-if="answer.lat && answer.lng" ng-click="toggleimgmode()">{{imgmode}}&nbsp&nbsp<span class="{{imgmodeicon}}"></span></a></div></div></div><div class="col-sm-6 col-md-4 col-lg-4" style="margin:0px;padding:0px;border:0px;"><img class="displayed" ng-src="{{answer.imageurl}}" alt="Moustiers Sainte Marie" ng-attr-style="height:{{mxheight}}px;width:100%;margin-left:auto;margin-right:auto;" ng-click="showUrl()" ng-if="modeIsImage"> <img class="displayed" ng-src="https://maps.googleapis.com/maps/api/staticmap?center={{answer.location}}&zoom=13&size={{width2}}x{{mxheight}}&maptype=roadmap &markers=color:red%7Clabel:%7C{{answer.lat}},{{answer.lng}}&key=AIzaSyDKXsql-P8czb4nAQMXjkFpm_I5HqKsQpo" ng-if="!modeIsImage"></div><div class="hidden-sm col-md-4 col-lg-4" style="margin:0px;padding:0px;border:0px;"><img class="displayed" ng-src="https://maps.googleapis.com/maps/api/staticmap?center={{answer.location}}&zoom=13&size={{width3}}x{{mxheight}}&maptype=roadmap &markers=color:red%7Clabel:%7C{{answer.lat}},{{answer.lng}}&key=AIzaSyDKXsql-P8czb4nAQMXjkFpm_I5HqKsQpo" ng-if="hasMap"><div class="container" ng-attr-style="background-color:#d8d8d8;width:{{width3}}px;height:{{mxheight}}px;margin-left:auto;margin-right:auto;" ng-if="!hasMap"></div></div></div></div><div class="container hidden-sm hidden-md hidden-lg hidden-xl" ng-if="!isShortPhrase"><div class="container-bgbox"><bg-box bc="{{bc}}" bc2="{{bc2}}" fc="{{fc}}" text="{{idx > 0 ? idx + \'. \' + answer.name:answer.name}}" dir="vertical" w="100%" h="75px"></bg-box></div><div class="container" style="margin:0px;padding:0px;border:0px;"><img class="displayed" ng-src="{{answer.imageurl}}" alt="Moustiers Sainte Marie" style="height:auto;width:100%;" ng-click="showUrl()" ng-if="modeIsImage"> <img class="displayed" ng-src="https://maps.googleapis.com/maps/api/staticmap?center={{answer.location}}&zoom=13&size={{width}}x{{mxheight}}&maptype=roadmap &markers=color:red%7Clabel:%7C{{answer.lat}},{{answer.lng}}&key=AIzaSyDKXsql-P8czb4nAQMXjkFpm_I5HqKsQpo" ng-if="!modeIsImage"></div></div><div class="container-answer" style="width:100%;height:auto" ng-if="isShortPhrase"><br><h2 style="text-align:center"><strong>{{answer.name}}</strong></h2><br><h4 style="text-align:center">{{answer.addinfo}}</h4></div><div class="answer_info row" ng-if="!isShortPhrase" style="padding:0px;margin:0px;border:0px;"><div class="container hidden-sm hidden-md hidden-lg hidden-xl"><br ng-if="answer.eventloc"><strong ng-if="answer.eventloc && answer.type==\'Event\'">Location:</strong> <strong ng-if="answer.eventloc && answer.type==\'PersonCust\'">Works At:</strong> <a ng-if="answer.eventloc" ng-click="gotoLocationAnswer()" target="_blank">{{answer.eventloc}}</a><br ng-if="answer.location"><strong ng-if="answer.location">Address:</strong> <a ng-if="answer.location" href="http://maps.apple.com/maps?q={{answer.location}}" target="_blank">{{answer.location}}</a><font ng-if="answer.dist&&answer.location" style="color:gray">&nbsp&nbsp({{answer.dist}} mi away)</font><br ng-if="answer.location"><div class="row"><div class="col-xs-9"><strong ng-if="answer.cityarea">{{(answer.cityarea) ? \'Neighborhood:\' : ""}}</strong> {{(answer.cityarea) ? answer.cityarea : ""}}<br ng-attr-style="display:{{(answer.cityarea) ? \'inline\' : \'none\'}}"><strong ng-if="answer.phone">Phone:</strong> <a ng-if="answer.phone" href="tel:{{answer.phone}}">{{answer.phone}}</a><br ng-attr-style="display:{{(answer.phone) ? \'inline\' : \'none\'}}"><strong ng-if="answer.website">Website:</strong> <a ng-if="answer.website.indexOf(\'http\') >=0" href="{{answer.website}}" target="_blank">{{answer.website}}</a> <a ng-if="answer.website.indexOf(\'http\') == -1" href="http://{{answer.website}}" target="_blank">{{answer.website}}</a><br ng-if="answer.website"><strong ng-if="answer.email">{{(answer.email) ? \'Email:\' : ""}}</strong> {{(answer.email) ? answer.email : ""}}<br ng-attr-style="display:{{(answer.email) ? \'inline\' : \'none\'}}"></div><div class="col-xs-3 text-left"><a type="button" class="btn btn-default" style="vertical-align:middle;color:#0059b3;border-color:#0059b3;margin-top:15px;" ng-if="!answer.hasOwner || userIsOwner" ng-click="editAnswer()" target="_blank">&nbsp&nbsp<span class="fa fa-pencil"></span></a></div></div><i ng-attr-style="display:{{hrset ? \'inline\':\'none\'}}">{{hourstr}}</i></div><div class="hidden-sm hidden-md hidden-lg hidden-xl text-center answer_info_buttons" style="padding-top:10px;"><a type="button" class="btn btn-default" style="vertical-align:middle;color:#0059b3;border-color:#0059b3;" ng-if="isMobile && answer.phone" href="tel:{{answer.phone}}" target="_blank">Call&nbsp&nbsp<span class="fa fa-phone"></span></a> <a type="button" class="btn btn-default" style="vertical-align:middle;color:#0059b3;border-color:#0059b3;" ng-if="answer.lat && answer.lng" href="http://maps.apple.com/maps?q={{answer.lat}}, {{answer.lng}}" target="_blank">Directions&nbsp&nbsp<span class="fa fa-arrow-right"></span></a> <a type="button" class="btn btn-default" style="vertical-align:middle;color:#0059b3;border-color:#0059b3;" ng-if="answer.lat && answer.lng" ng-click="toggleimgmode()">{{imgmode}}&nbsp&nbsp<span class="{{imgmodeicon}}"></span></a></div></div><div style="padding:5px"></div><div ng-if="!isShortPhrase && !isEvent" ng-attr-style="display:{{answer.addinfo ? \'inline\':\'none\'}};"><span>{{answer.addinfo_teaser}}</span> <span ng-show="completeinfo">{{answer.addinfo_complete}}</span> <span ng-if="answer.addinfo.length > 0" ng-click="showcomplete()" style="background-color:lightgray;cursor:pointer">{{moretext}}</span><br ng-attr-style="display:{{answer.addinfo ? \'inline\':\'none\'}}"></div><div ng-if="workhere.length > 0"><strong>Work here:</strong><br><a ng-repeat="x in workhere" ng-click="gotoprofile(x)">{{x.name}}</a></div>'),e.put("app/answer/Partials/blobupload.html",'<button type="file" ngf-select="uploadFiles($file, $invalidFiles)" accept="image/*" ngf-max-size="3MB" class="btn btn-primary text-center" ngf-resize="{width: 100, height: 100, quality: .1, type: \'image/jpeg\', ratio: \'19:11\', centerCrop: true, pattern=\'.jpg\', restoreExif: false}" role="button" ngf-validate-after-resize="boolean" ngf-model-invalid="invalidFiles">Upload New Image</button><br><br><div style="font:smaller">{{errFile.name}} {{errorMsg}}</div><div style="font:smaller"><span class="progress" ng-show="f.progress >= 0"><div ng-attr-style="width:{{f.progress}}%" ng-bind="f.progress + \'%\'"></div></span></div><br>'),e.put("app/answer/Partials/catbar.html",'<div class="container"><div class="row"><div class="container-bgbox col-xs-1"><bg-box bc="{{bc}}" bc2="{{bc}}" fc="{{fc}}" text="<" dir="horizontal" w="100%" h="{{ht}}px" ng-click="goPrev()" style="cursor:pointer"></bg-box></div><div class="container-bgbox col-xs-10"><bg-box bc="{{bc}}" bc2="{{bc2}}" fc="{{fc}}" text="{{text}}" dir="horizontal" w="100%" h="{{ht}}px" ng-click="selRank()" style="cursor:pointer"></bg-box></div><div class="container-bgbox col-xs-1"><bg-box bc="{{bc2}}" bc2="{{bc2}}" fc="{{fc}}" text=">" dir="horizontal" w="100%" h="{{ht}}px" ng-click="goNext()" style="cursor:pointer"></bg-box></div></div></div>'),e.put("app/common/partials/bgbox.html",'<div ng-if="dirHor"><div class="container" ng-attr-style="color:{{fc}};margin:0px;padding:0px;border:0px;position:relative;width:{{w}};height:{{h}}; background: {{bc}}; background: -webkit-linear-gradient(left, {{bc}}, {{bc2}}); background: -o-linear-gradient(right, {{bc}}, {{bc2}}); background: -moz-linear-gradient(right, {{bc}}, {{bc2}}); background: linear-gradient(to right, {{bc}}, {{bc2}});"><h4 class="text-center" style="padding:3px; margin:0px; position:absolute; top:50%; left:50%; margin-right:-50%;transform: translate(-50%,-50%)">{{text}}</h4></div></div><div ng-if="dirVer"><div class="container" ng-attr-style="color:{{fc}};margin:0px;padding:0px;border:0px;position:relative;width:{{w}};height:{{h}}; background: {{bc}}; background: -webkit-linear-gradient({{bc}}, {{bc2}}); background: -o-linear-gradient({{bc}}, {{bc2}}); background: -moz-linear-gradient({{bc}}, {{bc2}}); background: linear-gradient({{bc}}, {{bc2}});"><h3 class="hidden-xs text-center" style="padding:3px; margin:0px; position:absolute; top:50%; left:50%; margin-right:-50%;transform: translate(-50%,-50%)">{{text}}</h3><h4 class="hidden-sm hidden-md hidden-lg hidden-xl text-center" style="padding:3px; margin:0px; position:absolute; top:50%; left:50%; margin-right:-50%;transform: translate(-50%,-50%)">{{text}}</h4></div></div>'),e.put("app/common/partials/bgbox2.html",'<div ng-if="dirHor"><div class="container" ng-attr-style="color:{{fc}};margin:0px;padding:0px;border:0px;position:relative;width:{{w}};height:{{h-30}}px;cursor:pointer; background: {{bc}}; background: -webkit-linear-gradient(left, {{bc}}, {{bc2}}); background: -o-linear-gradient(right, {{bc}}, {{bc2}}); background: -moz-linear-gradient(right, {{bc}}, {{bc2}}); background: linear-gradient(to right, {{bc}}, {{bc2}});"><h4 ng-if="!isRankOfDay" class="text-center" ng-attr-style="padding:3px; margin:0px; position:absolute; top:60%; left:50%; margin-right:-50%;transform: translate(-50%,-50%)">{{text}}</h4><p ng-if="!isRankOfDay" ng-attr-style="padding:3px; margin:0px; position:absolute; bottom:0px; left:50%; margin-right:-50%;transform: translate(-50%,-50%)">{{question}}</p><div ng-if="isRankOfDay" ng-attr-style="padding:3px; margin:0px; position:absolute; top:50%; left:50%; margin-right:-50%;transform: translate(-50%,-50%)"><h3 class="text-center" style="padding-top:8px">{{title}}</h3><p>{{question}}</p></div></div><div class="container" ng-attr-style="color:{{fc}};margin:0px;padding:0px;border:0px;position:relative;width:{{w}};height:{{30}}px;cursor:pointer; background: {{bc}}; background: -webkit-linear-gradient(left, {{bc}}, {{bc2}}); background: -o-linear-gradient(right, {{bc}}, {{bc2}}); background: -moz-linear-gradient(right, {{bc}}, {{bc2}}); background: linear-gradient(to right, {{bc}}, {{bc2}});"><div class="text-center" ng-attr-style="color:white;font-size:small"><i class="fa fa-eye"></i> {{views}} | <i class="fa fa-list-ol"></i> {{answers}} | <i class="fa fa-comment"></i> {{comments}}</div></div></div><div ng-if="dirVer"><div class="container" style="color:{{fc}};margin:0px;padding:0px;border:0px;position:relative;width:{{w}};height:{{h}};cursor:pointer; background: {{bc}}; background: -webkit-linear-gradient({{bc}}, {{bc2}}); background: -o-linear-gradient({{bc}}, {{bc2}}); background: -moz-linear-gradient({{bc}}, {{bc2}}); background: linear-gradient({{bc}}, {{bc2}});"><h3 class="hidden-sm hidden-md hidden-lg hidden-xl text-center" ng-attr-style="padding:3px; margin:0px; position:absolute; top:50%; left:50%; margin-right:-50%;transform: translate(-50%,-50%)">{{text}}</h3></div><div class="container" ng-attr-style="color:{{fc}};margin:0px;padding:0px;border:0px;position:relative;width:{{w}};height:{{30}}px;cursor:pointer; background: {{bc}}; background: -webkit-linear-gradient(left, {{bc}}, {{bc2}}); background: -o-linear-gradient(right, {{bc}}, {{bc2}}); background: -moz-linear-gradient(right, {{bc}}, {{bc2}}); background: linear-gradient(to right, {{bc}}, {{bc2}});"><div class="text-center" style="color:white;font-size:small"><i class="fa fa-eye"></i> {{views}} | <i class="fa fa-list-ol"></i> {{answers}} | <i class="fa fa-comment"></i> {{comments}}</div></div></div>'),
e.put("app/common/partials/bgbox3.html",'<div ng-if="dirHor" ng-click="addView()"><div class="container" ng-attr-style="color:{{fc}};margin:0px;padding:0px;border:0px;position:relative;width:{{w}};height:auto;cursor:pointer; background: {{bc}}; background: -webkit-linear-gradient(left, {{bc}}, {{bc2}}); background: -o-linear-gradient(right, {{bc}}, {{bc2}}); background: -moz-linear-gradient(right, {{bc}}, {{bc2}}); background: linear-gradient(to right, {{bc}}, {{bc2}});"><p></p><p style="text-align:center"><img ng-src="{{imageurl}}" style="width:90%;min-height:100px"></p><p style="text-align:left; padding:0px;margin:0px;">&nbsp&nbsp&nbsp<u>{{type}}</u></p><h4 ng-if="sm" class="text-center" ng-attr-style="padding:3px; margin:0px;">{{text}}</h4><h3 ng-if="!sm" class="text-center" ng-attr-style="padding:3px; margin:0px;">{{text}}</h3><p></p><div class="text-center" ng-attr-style="color:white;font-size:small;min-height:30px" ng-if="showStats"><i class="fa fa-eye"></i> {{views}} | <i class="fa fa-list-ol"></i> {{answers}} | <i class="fa fa-comment"></i> {{comments}}</div></div></div><div ng-if="dirVer"><div class="container" style="color:{{fc}};margin:0px;padding:0px;border:0px;position:relative;width:{{w}};height:{{h}};cursor:pointer; background: {{bc}}; background: -webkit-linear-gradient({{bc}}, {{bc2}}); background: -o-linear-gradient({{bc}}, {{bc2}}); background: -moz-linear-gradient({{bc}}, {{bc2}}); background: linear-gradient({{bc}}, {{bc2}});"><p class="text-left">{{type}}</p><h4 ng-if="!isRankOfDay" class="text-center" ng-attr-style="padding:3px; margin:0px;">{{text}}</h4><img ng-src="{{imageurl}}"></div><div class="container" ng-attr-style="color:{{fc}};margin:0px;padding:0px;border:0px;position:relative;width:{{w}};height:{{30}}px;cursor:pointer; background: {{bc}}; background: -webkit-linear-gradient(left, {{bc}}, {{bc2}}); background: -o-linear-gradient(right, {{bc}}, {{bc2}}); background: -moz-linear-gradient(right, {{bc}}, {{bc2}}); background: linear-gradient(to right, {{bc}}, {{bc2}});"><div class="text-center" style="color:white;font-size:small"><i class="fa fa-eye"></i> {{views}} | <i class="fa fa-list-ol"></i> {{answers}} | <i class="fa fa-comment"></i> {{comments}}</div></div></div>'),e.put("app/content/partials/answer-block.html",'<div ng-class="sm?\'\':\'rank-item\'" style="padding-bottom:10px"><div class="row" ng-click="ansSel(answer)"><div class="container-bgbox col-xs-6"><div style="position:absolute; z-index: 50; padding: 2px; font-size: 17px; color: #fff"><small><i class="{{answer.icon}}" aria-hidden="true"></i> <span class="tooltiptext">{{answer.itext}}</span></small></div><bg-box2 bc="{{bc}}" shade="{{shade}}" fc="{{fc}}" text="{{answer.name}}" dir="horizontal" w="100%" h="{{sm ? \'150\':\'200\'}}" stats="{{stats}}"></bg-box2></div><div class="col-xs-6" style="margin:0px;padding:0px;border:0px;" ng-if="!isShortPhrase"><img ng-src="{{image1}}" ng-attr-style="display:{{image1 != undefined ? \'inline\':\'none\'}};width:100%;height:{{sm ? \'150px\':\'200px\'}};cursor:pointer;"></div></div></div>'),e.put("app/content/partials/content-block.html",'<div class="row"><div class="col-xs-12 col-sm-6 col-md-4" ng-repeat="ranking in initalHomeData" ng-if="initalHomeData"><rank-item rank-object="ranking"></rank-item></div></div><div class="row"><div infinite-scroll="loadMore()" infinite-scroll-distance="0" infinite-scroll-disabled="(!pageDataLoaded || scrollDataLoading) || endReached" class="col-xs-12" id="inifinite-container" style="padding:0px;margin:0px"><div class="col-xs-12 col-sm-6 col-md-4 col-lg-4" ng-repeat="rankingID in scrollingData.slice(startIndex, currentIndex)"><rank-item rank-object="uniqueResult[rankingID]"></rank-item></div><div ng-if="(pageDataLoaded || scrollDataLoading) && !endReached" class="col-xs-12 text-center"><a><img src="/assets/images/loading.gif" class="img" style="width:50px;height:50px"> Loading More...</a></div><div ng-if="endReached" class="col-xs-12 text-center" style="border: 1px solid #00b3e4;font-size: 14px">End Reached.</div></div></div>'),e.put("app/content/partials/facebook-follow.html",""),e.put("app/content/partials/rank-block.html",'<div ng-class="sm?\'\':\'rank-item\'" style="padding-bottom:10px"><div class="row" ng-click="rankSel(rank,false)"><div class="container-bgbox col-xs-6"><div style="position:absolute;background-color:red; z-index: 50; padding: 2px; font-size: 14px; color: #fff" ng-if="rod">&nbspRanking of the Day&nbsp</div><div style="position:absolute; z-index: 50; padding: 2px; font-size: 17px; color: #fff" ng-if="!rod"><small><i class="fa fa-list-ol" aria-hidden="true"></i></small></div><bg-box2 bc="{{bc}}" shade="{{shade}}" fc="{{fc}}" text="{{title}}" dir="horizontal" w="100%" h="{{sm ? \'150\':\'200\'}}" stats="{{stats}}"></bg-box2></div><div class="col-xs-6" style="margin:0px;padding:0px;border:0px;" ng-if="!isShortPhrase"><img ng-src="{{image1}}" ng-attr-style="display:{{image1 != undefined ? \'inline\':\'none\'}};width:100%;height:{{sm ? \'150px\':\'200px\'}};cursor:pointer;"></div></div></div>'),e.put("app/content/partials/rank-of-day.html",'<div ng-class="sm?\'\':\'rank-item\'" style="padding-bottom:10px"><div class="row" ng-click="rankSel(rank,false)" ng-if="isBasic"><div class="container-bgbox col-xs-12 col-sm-12" ng-if="part==\'title\'"><div style="position:absolute;background-color:red; z-index: 50; padding: 2px; font-size: 17px; color: #fff">&nbspRanking of the Day&nbsp</div><bg-box2 bc="{{bc}}" shade="{{shade}}" fc="{{fc}}" text="{{title}}" dir="horizontal" w="100%" h="{{sm ? \'150\':\'200\'}}" stats="{{stats}}" question="{{rankObject.question}}" is-rank-of-day="{{true}}"></bg-box2></div><div class="col-xs-12 col-sm-12 row" style="margin:0px; padding: 0px; border:0px;cursor:pointer;" ng-if="part==\'image\'"><div class="col-xs-6" style="padding: 0px"><img ng-src="{{image1}}" ng-attr-style="display:{{image1 != undefined ? \'inline\':\'none\'}};width:100%;height:{{sm ? \'150px\':\'200px\'}};"></div><div class="col-xs-6" style="padding: 0px" ng-if="!isShortPhrase"><img ng-src="{{image2}}" ng-attr-style="display:{{image2 != undefined ? \'inline\':\'none\'}};width:100%;height:{{sm ? \'150px\':\'200px\'}};"></div><div class="container-bgbox col-xs-6" ng-if="isShortPhrase"><bg-box bc="{{bcp}}" bc2="{{bc2p}}" fc="{{fcp}}" text="{{title1}}" dir="horizontal" w="100%" h="{{sm ? \'150px\':\'200px\'}}"></bg-box></div></div></div></div>'),e.put("app/content/partials/result-block.html",'<div ng-class="sm?\'\':\'result-item\'"><div class="row" ng-click="resSel(result)"><div class="container-bgbox col-xs-12"><bg-box3 bc="{{bc}}" shade="{{shade}}" fc="{{fc}}" text="{{title}}" dir="horizontal" introtext="{{introtext}}" w="100%" h="{{sm ? \'150\':\'200\'}}" stats="{{stats}}" type="{{type}}" imageurl="{{imageurl}}" isanswer="{{isAnswer}}"></bg-box3></div></div></div>'),e.put("app/content/partials/search-block.html",'<div class="" ng-show="contentLoaded"><div infinite-scroll="loadMore(false)" infinite-scroll-distance="3" infinite-scroll-disabled="scrollDataLoading || endReached || disableScrolling" id="inifinite-container"><div masonry=""><div class="col-xs-6 col-sm-6 col-md-4 col-lg-3 masonry-brick minxs280" ng-repeat="x in displayResults"><div style="width:95%"><result-item result-object="x"></result-item></div></div></div></div><div ng-if="scrollDataLoading && !endReached" class="col-xs-12 text-center"><a><img src="/assets/images/loading.gif" class="img" style="width:50px;height:50px"> Loading More...</a></div><div ng-if="endReached" class="col-xs-12 text-center" style="border: 1px solid #00b3e4;font-size: 20px">No more results.</div></div><div ng-attr-style="position:relative;width:100%;height:150px;" ng-if="!contentLoaded"><img src="/assets/images/loading.gif" class="img" style="width:50px;height:50px;position:absolute; top:50%; left:50%; margin-right:-50%;transform: translate(-50%,-50%)"></div>'),e.put("app/content/partials/trend-block.html",'<div class=""><div class=""><div class="col-xs-12 trend-tab" style="padding: 0px; background-color:#e6e6e6"><ul class="nav nav-tabs trend-tab" style="background-color: white"><li class="active" style="cursor: pointer"><a data-toggle="tab" href="#userfeed">Feed</a></li><li style="cursor: pointer"><a data-toggle="tab" href="#popular">Popular</a></li><li style="cursor: pointer"><a data-toggle="tab" href="#newest">Newest</a></li></ul><div class="tab-content" style=""><div class="tab-pane in active fade" style="padding-top:10px;padding-bottom:10px;" ng-class="showAll ==\'true\' ?\'\':\'trend-tab-single-page\'" id="userfeed"><userfeed-block show-all="true" show-qty="{{userfeedLimit}}"></userfeed-block><p class="text-center" style="color:blue; margin-top:10px" ng-if="showAll == \'true\'"><a class="btn btn-default" style="margin-right:20px;" ng-click="seeMore(\'userfeed\')">See More</a><a class="btn btn-default" ng-click="goBack()">Back</a></p></div><div class="tab-pane fade" style="padding-top:10px;padding-bottom:10px;" ng-class="showAll ==\'true\' ?\'\':\'trend-tab-single-page\'" id="popular"><div class="col-xs-12 media ranking-blog-item" ng-repeat="ranking in popularOrder | limitTo:popularLimit" style="cursor: pointer;" ng-click="rankSel(ranking)"><div class="profile-avatar-wrapper media-left"><img ng-src="{{ranking.realimage}}"></div><div class="media-body" style="vertical-align: middle;">{{ranking.title}} <span class="pull-right">{{ranking.views}} Views</span></div></div><p class="text-center" style="color:blue; margin-top:10px" ng-if="showAll == \'true\'"><a class="btn btn-default" style="margin-right:20px;" ng-click="seeMore(\'popular\')">See More</a><a class="btn btn-default" ng-click="goBack()">Back</a></p></div><div class="tab-pane fade" style="padding-top:10px;padding-bottom:10px;" id="newest" ng-class="showAll ==\'true\' ?\'\':\'trend-tab-single-page\'"><div class="col-xs-12 media ranking-blog-item" ng-repeat="ranking in newestOrder| limitTo:newestLimit" ng-click="rankSel(ranking)" style="cursor: pointer;"><div class="profile-avatar-wrapper media-left"><img ng-src="{{ranking.realimage}}"></div><div class="media-body" style="vertical-align: middle;">{{ranking.title}}<span class="pull-right">{{ranking.humanized}}</span></div></div><p class="text-center" style="color:blue; margin-top:10px" ng-if="showAll == \'true\'"><a class="btn btn-default" style="margin-right:20px;" ng-click="seeMore(\'newest\')">See More</a><a class="btn btn-default" ng-click="goBack()">Back</a></p></div></div><p class="text-center" style="color:blue;margin-top:10px" ng-if="showAll == \'false\'"><a class="btn btn-default" href="/trends">See More</a></p></div></div></div>'),e.put("app/content/partials/userfeed-block.html",'<button type="button" class="btn btn-default pull-right" style="vertical-align:middle;" ng-click="refreshFeed()"><span class="glyphicon glyphicon-refresh" style="padding-top:0px;padding-bottom:0px;" aria-hidden="true"></span></button><div ng-repeat="x in feeds | orderBy:\'-id\' | limitTo:fres" style="padding:0px;border:0px;margin-top:10px;"><div class="row" style="margin:4px"><div class="col-xs-12 media" style="padding-left: 5px;padding-right: 5px;"><div ng-if="!x.picture" class="profile-avatar-wrapper media-left"><div class="empty-profile-avatar-wrapper" ng-attr-style="background-color:{{x.bc}};color:{{x.fc}};">{{x.initials}}</div></div><div ng-if="x.picture" class="profile-avatar-wrapper media-left" align="middle"><img ng-src="{{x.picture}}" class="img-responsive img-circle profile-avatar"></div><div ng-if="x.action == \'addedAnswer\'" class="media-body" style="vertical-align: middle;">{{x.actorusername}} added <a ng-click="gotoAnswer(x)" style="cursor:pointer">{{x.text1}}</a> to <a ng-click="gotoRank(x)" style="cursor:pointer">{{x.text2}}</a>.</div><div ng-if="x.action == \'upVoted\'" class="media-body" style="vertical-align: middle;">{{x.actorusername}} endorsed <a ng-click="gotoAnswer(x)" style="cursor:pointer">{{x.text1}}</a> in <a ng-click="gotoRank(x)" style="cursor:pointer">{{x.text2}}</a>.</div><div ng-if="x.action == \'downVoted\'" class="media-body" style="vertical-align: middle;">{{x.actorusername}} voted down <a ng-click="gotoAnswer(x)" style="cursor:pointer">{{x.text1}}</a> in <a ng-click="gotoRank(x)" style="cursor:pointer">{{x.text2}}</a>.</div><div ng-if="x.action == \'commentR\'" class="media-body" style="vertical-align: middle;">{{x.actorusername}} posted a comment in <a ng-click="gotoRank(x)" style="cursor:pointer">{{x.text2}}</a>.</div><div ng-if="x.action == \'commentA\'" class="media-body" style="vertical-align: middle;">{{x.actorusername}} posted a comment for <a ng-click="gotoAnswer(x)" style="cursor:pointer">{{x.text1}}</a>.</div><div ng-if="x.action == \'editA\'" class="media-body" style="vertical-align: middle;">{{x.actorusername}} edited the information of <a ng-click="gotoAnswer(x)" style="cursor:pointer">{{x.text1}}</a>.</div><div ng-if="x.action == \'upVotedVrow\'" class="media-body" style="vertical-align: middle;">{{x.actorusername}} endorses the opinion: <em>{{x.text2}}</em> for <a ng-click="gotoAnswer(x)" style="cursor:pointer">{{x.text1}}</a>.</div><div ng-if="x.action == \'downVotedVrow\'" class="media-body" style="vertical-align: middle;">{{x.actorusername}} disagrees with the opinion: <em>{{x.text2}}</em> for <a ng-click="gotoAnswer(x)" style="cursor:pointer">{{x.text1}}</a>.</div><div ng-if="x.action == \'binded\'" class="media-body" style="vertical-align: middle;">{{x.actorusername}} bound account to <a ng-click="gotoAnswer(x)" style="cursor:pointer">{{x.text1}}</a>.</div><div ng-if="x.action == \'addedRank\'" class="media-body" style="vertical-align: middle;">{{x.actorusername}} added a new ranking <a ng-click="gotoRank(x)" style="cursor:pointer">{{x.text2}}</a>.</div><div ng-if="x.action == \'addedCustomRank\'" class="media-body" style="vertical-align: middle;">{{x.actorusername}} created the ranking <a ng-click="gotoRank(x)" style="cursor:pointer">{{x.text2}}</a> for <a ng-click="gotoAnswer(x)" style="cursor:pointer">{{x.text1}}</a>.</div></div></div></div>'),e.put("app/layout/Partials/cwrapper.html",""),e.put("app/layout/Partials/layout.html",'<div ui-view="navbar" style="position: fixed; z-index: 1000; width: 100%"></div><div class="container" style="padding-left:5px;padding-right:5px; margin-bottom: 20px;"><div id="veil" ng-show="vm.isLoading"></div><div id="feedLoading" ng-show="vm.isLoading"><div style="text-align: center" ng-if="vm.isLoading"><div><img src="/assets/images/loading.gif" class="img" style="width:50px;height:50px"></div><p style="font-size:large">{{vm.veilMsg}}</p></div></div><div ng-hide="vm.isLoading"><div class="container" style="margin-top: 60px" ng-show="vm.barIsActive"><div class="row" style="padding-bottom:10px"><div class="hidden-md hidden-lg hidden-xl"><div class="col-xs-12" style="padding-left:0px;padding-right:0px;"><button class="col-xs-3 btn btn-default {{vm.bi==0?\'disabled\':\'\'}}" ng-click="vm.buttonsPrev()">&lt&lt</button><div style="padding-top:7px" class="col-xs-6 text-center">Quick Filters</div><button class="col-xs-3 btn btn-default {{vm.bi == vm.buts.length-8 ? \'disabled\':\'\'}}" ng-click="vm.buttonsFwd()">&gt&gt</button></div><div class="col-xs-12" style="padding-left:0px;padding-right:0px;padding-bottom:7px"><button class="col-xs-3 btn btn-default" ng-repeat="x in vm.buts.slice(vm.bi,vm.bi+8)" ng-click="vm.quickFilter(x)" ng-attr-style="font-size:{{x.length > 11 ? \'smaller\':\'\'}};height:34px;padding-left:{{x.length > 11 ? \'2px\':\'\'}}">{{x}}</button></div></div><div class="hidden-xs hidden-sm"><div class="col-xs-4" style="padding-left:0px;padding-right:0px;padding-bottom:7px"><div style="padding-top:7px" class="col-xs-4 text-center">Quick Filters</div><button class="col-xs-4 btn btn-default" ng-repeat="x in vm.buts.slice(vm.bi,vm.bi+2)" ng-click="vm.quickFilter(x)" ng-attr-style="font-size:{{x.length > 13 ? \'smaller\':\'\'}};height:34px;">{{x}}</button><div class="col-xs-4"></div><button class="col-xs-4 btn btn-default" ng-repeat="x in vm.buts.slice(vm.bi+2,vm.bi+4)" ng-click="vm.quickFilter(x)" ng-attr-style="font-size:{{x.length > 13 ? \'smaller\':\'\'}};height:34px;">{{x}}</button></div><div class="col-xs-4" style="padding-left:0px;padding-right:0px;padding-bottom:7px"><button class="col-xs-4 btn btn-default" ng-repeat="x in vm.buts.slice(vm.bi+4,vm.bi+10)" ng-click="vm.quickFilter(x)" ng-attr-style="font-size:{{x.length > 13 ? \'smaller\':\'\'}};height:34px;">{{x}}</button></div><div class="col-xs-4" style="padding-left:0px;padding-right:0px;padding-bottom:7px"><button class="col-xs-4 btn btn-default" ng-repeat="x in vm.buts.slice(vm.bi+10,vm.bi+12)" ng-click="vm.quickFilter(x)" ng-attr-style="font-size:{{x.length > 13 ? \'smaller\':\'\'}};height:34px;">{{x}}</button> <button class="col-xs-4 btn btn-default" ng-if="vm.bi == 0" ng-click="vm.buttonsFwd()">&gt&gt</button> <button class="col-xs-4 btn btn-default" ng-if="vm.bi > 0" ng-click="vm.buttonsPrev()">&lt&lt</button> <button class="col-xs-4 btn btn-default" ng-repeat="x in vm.buts.slice(vm.bi+12,vm.bi+14)" ng-click="vm.quickFilter(x)" ng-attr-style="font-size:{{x.length > 13 ? \'smaller\':\'\'}};height:34px;">{{x}}</button><div class="col-xs-4"></div></div></div><div class="col-xs-12" style="padding-left:0px;padding-right:0px;padding-bottom:7px;" ng-show="vm.nhctrl"><div class="col-xs-3" style="padding-left:0px;padding-right:0px;"><p style="padding-top:5px">Neighborhood</p></div><div class="col-xs-5" style="padding-left:0px;padding-right:0px;"><input type="text" class="form-control" placeholder="Enter Neighborhood" ng-model="vm.nhinp" bs-options="c for c in vm.nhops" bs-typeahead=""></div><button class="col-xs-2 btn btn-success" type="submit" ng-click="vm.selectNh()">Select</button> <button class="col-xs-2 btn btn-default" type="submit" ng-click="vm.clearNh()">Clear</button></div><div class="col-xs-12" style="padding-left:0px;padding-right:0px;"><div class="col-xs-7" style="padding-left:0px;padding-right:0px;"><div class="input-group"><input type="text" class="form-control" placeholder="Search San Diego" ng-model="vm.val" ng-change="vm.getResults()" id="SearchInput"><div class="input-group-btn"><button class="btn btn-default" type="submit"><i class="glyphicon glyphicon-search"></i></button></div></div></div><div class="col-xs-3" style="padding-left:0px;padding-right:0px"><button class="btn btn-default" style="width:100%" ng-click="vm.goAddRank()">Add Rank&nbsp&nbsp</button></div><button class="col-xs-2 btn btn-default pull-right" ng-click="vm.showTrends()"><i class="fa fa-rss" aria-hidden="true"></i></button></div></div></div><div class="input-group" style="width:100%" ng-if="vm.isAdmin&&!vm.childActive"><div class="text-center" ng-attr-style="display:{{vm.isAdmin ? \'inline\':\'none\'}}"><div class="btn-group col-sm-6 col-md-6"><button class="btn btn-primary {{vm.selEditRank}}" ng-click="vm.editRank()">Edit Mode</button> <button class="btn btn-primary {{vm.selViewRank}}" ng-click="vm.viewRank()">View Mode</button></div></div></div><div ng-show="!vm.childActive"><search-block ng-click="vm.hideSearch()" query="{{vm.val}}" ans="vm.showans" ranks="true" length="vm.slen" init="vm.initready" data="vm.dataready" rod="vm.rodready" scrollactive="!vm.childActive"></search-block></div><br ng-if="vm.childActive"><br ng-if="vm.childActive"><br ng-if="vm.childActive"><div ui-view="" ng-if="!vm.isLoading && vm.childActive" class="container" id="page-containter" style=""></div></div><a href="#" class="back-to-top" style="display: inline;"><i class="fa fa-arrow-up" aria-hidden="true"></i></a></div><br><br><footer class="footer" style="position: fixed; bottom: 0px; background: white; width: 100%; padding-top: 20px;"><div class="container"><p class="text-muted">Rank-X is a registered trademark property of Rank-X LLC. San Diego, CA - 2018 <span><a ng-click="vm.goPrivacyPolicy()">Privacy Policy</a></span> <span><a ng-click="vm.goRankofDayConsole()">RoD</a></span></p></div></footer>'),e.put("app/layout/Partials/navbar.html",'<nav class="navbar navbar-inverse"><div class="container"><div class="navbar-header"><button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar"><span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span></button> <a class="navbar-brand" href="/cwrapper" ng-click="vm.gotoHome()" style="cursor:pointer;padding:0px;border:0px;margin:0px;"><img src="/assets/images/logosqwborder.jpg" style="width:60px;"></a> <a class="navbar-brand home-link" ng-click="vm.selCity()" style="font-size:medium">San Diego</a> <a class="navbar-brand navbar-profile-picture-wrapper" ng-show="vm.user" href="/favs" ng-click="vm.gotofavs()"><img class="img-responsive img-circle navbar-profile-picture" ng-src="{{vm.user.picture.data.url}}"> <span style="font-size:medium">{{vm.user.first_name}}</span></a> <a class="navbar-brand" ng-if="vm.warning" style="background-color:#33cccc;color:black;margin:2px" ng-click="vm.goWarning()"><i class="fa fa-warning"></i></a> <a class="navbar-brand" ng-if="vm.coordsRdy" ng-click="vm.goCoords()" style="margin:0px;"><i class="fa fa-location-arrow"></i></a></div><div id="navbar" class="navbar-collapse collapse"><ul class="nav navbar-nav navbar-right"><li ng-if="vm.hasBusiness"><a href="/mybusiness" ng-click="vm.gotomybusiness()">My Business</a></li><li><a href="/about" ng-click="vm.gotoAbout()">About</a></li><li><a href="/tour" ng-click="vm.gotoTour()">Tour</a></li><li ng-if="vm.isAdmin"><a href="" ng-click="vm.gotoAdmin()">Admin</a></li><li ng-if="!vm.isLoggedIn"><a ng-click="vm.goToLogin()">Login</a></li><li ng-if="vm.isLoggedIn"><a href="/logout" ng-click="vm.logout()" class="">Logout</a></li></ul></div></div></nav>'),
e.put("app/rank/Partials/RankSummary.html",'<div ng-if="!vm.foodNearMe"><div id="veil" ng-hide="vm.dataReady"></div><div id="feedLoading" ng-hide="vm.dataReady"><div style="text-align: center" ng-if="!vm.dataReady"><div><img src="/assets/images/loading.gif" class="img" style="width:50px;height:50px"></div><p style="font-size:large">loading rank...</p></div></div></div><div ng-if="vm.foodNearMe"><div id="veil" ng-show="vm.loadingAnswers"></div><div id="feedLoading" ng-show="vm.loadingAnswers"><div style="text-align: center"><div><img src="/assets/images/loading.gif" class="img" style="width:50px;height:50px"></div><p style="font-size:large">Wait a moment, finding some delicious food near by...</p></div></div></div><div ng-if="vm.dataReady && !vm.loadingAnswers"><div class="text-left"><button class="btn btn-default" ng-click="vm.backToResults()" style="margin:5px; width:100%; background-color:lightgray">Back to Results</button> <button class="btn btn-default" ng-if="vm.hasParent" ng-click="vm.gotoParentRank()" style="margin:5px; width:100%; background-color:lightgray">{{vm.parentRank.title}}</button></div><div class="text-left" ng-if="vm.isCustomRank"><button class="btn btn-default" ng-click="vm.answerDetail(vm.rankOwner)" style="margin:5px; width:100%; background-color:lightgray">Return to {{vm.rankOwner.name}}</button></div><div class="container"><div class="row"><div class="container-bgbox col-xs-6 col-sm-4 col-md-4 col-lg-3"><bg-box bc="{{vm.bc}}" shade="{{vm.shade}}" fc="{{vm.fc}}" text="{{vm.ranking}}" dir="horizontal" w="100%" h="{{vm.sm ? \'150px\':\'200px\'}}"></bg-box></div><div ng-if="!vm.isShortPhrase"><div class="col-xs-6 col-sm-4 col-md-4 col-lg-3" style="margin:0px;padding:0px;border:0px;" ng-if="!vm.isShortPhrase"><img ng-src="{{vm.image1}}" ng-attr-style="display:{{vm.image1 != undefined ? \'inline\':\'none\'}};width:100%;height:{{vm.sm ? \'150px\':\'200px\'}};"></div><div class="hidden-xs col-sm-4 col-md-4 col-lg-3" style="margin:0px;padding:0px;border:0px;" ng-if="!vm.isShortPhrase"><img ng-src="{{vm.image2}}" ng-attr-style="display:{{vm.image2 != undefined ? \'inline\':\'none\'}};width:100%;height:{{vm.sm ? \'150px\':\'200px\'}};"></div><div class="hidden-xs hidden-sm hidden-md col-lg-3" style="margin:0px;padding:0px;border:0px;" ng-if="!vm.isShortPhrase"><img ng-src="{{vm.image3}}" ng-attr-style="display:{{vm.image3 != undefined ? \'inline\':\'none\'}};width:100%;height:{{vm.sm ? \'150px\':\'200px\'}};"></div></div><div ng-if="vm.isShortPhrase&&vm.hasfimage"><div class="col-xs-6 col-sm-4 col-md-4 col-lg-3" style="margin:0px;padding:0px;border:0px;"><img ng-src="{{vm.fimage}}" ng-attr-style="display:{{vm.image1 != undefined ? \'inline\':\'none\'}};width:100%;height:{{vm.sm ? \'150px\':\'200px\'}};"></div><div class="container hidden-xs col-sm-4 col-md-4 col-lg-3" ng-attr-style="background-color:lightgray;color:black;height:{{sm ? \'150px\':\'200px\'}};margin:0px;padding:0px;border:0px;position:relative;"><div style="padding:3px; margin:0px; position:absolute; top:50%; left:50%; margin-right:-50%;transform: translate(-50%,-50%)"><h2 class="hidden-xs text-center">{{vm.title1}}</h2><h3 class="hidden-sm hidden-md hidden-lg hidden-xl text-center">{{vm.title1}}</h3></div></div><div class="container hidden-xs hidden-sm hidden-md col-lg-3" ng-attr-style="background-color:lightgray;color:black;height:{{sm ? \'150px\':\'200px\'}};margin:0px;padding:0px;border:0px;position:relative;"><div style="padding:3px; margin:0px; position:absolute; top:50%; left:50%; margin-right:-50%;transform: translate(-50%,-50%)"><h2 class="hidden-xs text-center">{{vm.title2}}</h2><h3 class="hidden-sm hidden-md hidden-lg hidden-xl text-center">{{vm.title2}}</h3></div></div></div><div ng-if="vm.isShortPhrase&&!vm.hasfimage"><div class="container col-xs-6 col-sm-4 col-md-4 col-lg-3" ng-attr-style="background-color:lightgray;color:black;height:{{sm ? \'150px\':\'200px\'}};margin:0px;padding:0px;border:0px;position:relative;"><div style="padding:3px; margin:0px; position:absolute; top:50%; left:50%; margin-right:-50%;transform: translate(-50%,-50%)"><h2 class="hidden-xs text-center">{{vm.title1}}</h2><h3 class="hidden-sm hidden-md hidden-lg hidden-xl text-center">{{vm.title1}}</h3></div></div><div class="container hidden-xs col-sm-4 col-md-4 col-lg-3" ng-attr-style="background-color:lightgray;color:black;height:{{sm ? \'150px\':\'200px\'}};margin:0px;padding:0px;border:0px;position:relative;"><div style="padding:3px; margin:0px; position:absolute; top:50%; left:50%; margin-right:-50%;transform: translate(-50%,-50%)"><h2 class="hidden-xs text-center">{{vm.title2}}</h2><h3 class="hidden-sm hidden-md hidden-lg hidden-xl text-center">{{vm.title2}}</h3></div></div><div class="container hidden-xs hidden-sm hidden-md col-lg-3" ng-attr-style="background-color:lightgray;color:black;height:{{sm ? \'150px\':\'200px\'}};margin:0px;padding:0px;border:0px;position:relative;"><div style="padding:3px; margin:0px; position:absolute; top:50%; left:50%; margin-right:-50%;transform: translate(-50%,-50%)"><h2 class="hidden-xs text-center">{{vm.title3}}</h2><h3 class="hidden-sm hidden-md hidden-lg hidden-xl text-center">{{vm.title3}}</h3></div></div></div></div></div><br ng-if="vm.introtext"><p class="text-left">{{vm.introtext}}</p><br><div class="row" style="margin:0px;padding:0px;"><div class="col-sm-9 col-md-9 col-lg-10 hidden-xs" style="margin-bottom: 10px; padding:0px"><div class="btn-group text-left"><button class="btn btn-default" ng-click="vm.sortbyHelpDialog()"><i class="fa fa-question-circle"></i></button> <span style="float: left;margin-left: 10px; margin-right: 10px;line-height: 32px">{{vm.sm ? \'\':\'Sort by:\'}}</span> <button class="btn btn-default {{vm.selRank}}" ng-click="vm.sortByRank()" ng-if="vm.type != \'Event\' && !vm.fnm">Rank</button> <button class="btn btn-default {{vm.selUpV}}" ng-click="vm.sortByUpV()">Popular</button> <button class="btn btn-default {{vm.selDistance}}" ng-click="vm.sortByDistance()" ng-show="{{vm.type == \'Establishment\' || vm.type == \'Event\' || vm.type == \'Place\'}}">Distance</button> <button class="btn btn-default {{vm.selDate}}" ng-click="vm.sortByDate()" ng-show="{{vm.type == \'Event\'}}">Date</button> <button class="btn btn-default {{vm.selTrending}}" ng-click="vm.sortByTrending()">Trending</button></div></div><div class="col-xs-8 visible-xs" style="margin-bottom: 10px; padding:0px"><div class="dropdown" style="margin:0px; padding:0px;"><button class="btn btn-default" ng-click="vm.sortbyHelpDialog()"><i class="fa fa-question-circle"></i></button> <span style="line-height:32px; margin: 0px 10px;">Sort By:</span> <button class="btn btn-default dropdown-toggle" type="button" data-toggle="dropdown">{{vm.sortByName}} <span class="caret"></span></button><ul class="dropdown-menu"><li><a class="btn btn-default {{vm.selRank}}" ng-click="vm.sortByRank()" ng-if="vm.type != \'Event\' && !vm.fnm">Rank</a></li><li><a class="btn btn-default {{vm.selUpV}}" ng-click="vm.sortByUpV()">Popular</a></li><li><a class="btn btn-default {{vm.selDistance}}" ng-click="vm.sortByDistance()" ng-show="{{vm.type == \'Establishment\' || vm.type == \'Event\' || vm.type == \'Place\'}}">Distance</a></li><li><a class="btn btn-default {{vm.selDate}}" ng-click="vm.sortByDate()" ng-show="{{vm.type == \'Event\'}}">Date</a></li><li><a class="btn btn-default {{vm.selTrending}}" ng-click="vm.sortByTrending()">Trending</a></li></ul></div></div><div class="col-xs-4 col-sm-3 col-md-3 col-lg-2 btn-group text-center"><a type="button" class="btn btn-default" style="vertical-align:middle;color:#0059b3;border-color:#0059b3;" ng-if="true" ng-click="vm.share()" target="_blank">Share&nbsp&nbsp<span class="fa fa-share"></span></a></div></div><div class="row"><div class="col-xs-12 col-sm-6 text-center" style="margin-bottom: 10px; padding:0px"><div class="btn-group" style="padding-right:20px"><button ng-click="vm.changeMode(\'endorse\')" class="btn {{vm.mode==\'endorse\' ? \'btn-primary\':\'btn-default\'}}">Endorsements</button> <button ng-click="vm.changeMode(\'specials\')" class="btn {{vm.mode==\'specials\' ? \'btn-primary\':\'btn-default\'}}">Specials</button></div><button ng-click="vm.goRank()" class="btn btn-success {{vm.rankDisabled}}" ng-if="!vm.fnm">&nbsp&nbsp&nbsp&nbspRank&nbsp&nbsp&nbsp&nbsp</button></div><div class="col-xs-12 col-sm-6 input-group" style="padding-left:15px;padding-right:15px;"><input type="text" class="form-control" bs-options="c for c in vm.opts" bs-typeahead="" placeholder="Filter by Name or Neighborhood" ng-model="vm.val" ng-change="vm.getResults()" id="SearchInput"><div class="input-group-btn"><button class="btn btn-default" type="submit" ng-click="vm.clearSearch()"><i class="glyphicon glyphicon-search"></i></button></div></div></div><br><table class="table table-hover cursor"><tbody><thead><tr><th ng-if="!vm.sm || vm.sortByName==\'Rank\'" align="middle">Rank</th><th class="capitalize" ng-repeat="h in vm.fields | filter:{isrequired:true}" align="middle">{{h.label}}</th><th ng-if="!vm.sm || vm.sortByName==\'Popular\'" align="middle" style="width:{{vm.sm?\'10px\':\'auto\'}}">Diff.</th><th ng-if="(!vm.sm || vm.sortByName==\'Distance\') && vm.haveLocation" align="middle" style="width:{{vm.sm?\'10px\':\'auto\'}}">Dist (mi)</th><th ng-if="(!vm.sm || vm.sortByName==\'Trending\')" align="middle" style="width:{{vm.sm?\'10px\':\'auto\'}}">Last month</th><th ng-if="(!vm.sm || vm.sortByName==\'Date\') && vm.type == \'Event\' && vm.mode==\'specials\'" align="middle">Date</th><th ng-if="vm.type == \'Establishment\' && vm.mode==\'specials\'" style="width:{{vm.sm?\'150px\':\'200px\'}}" class="text-center">Specials</th><th ng-if="vm.mode == \'endorse\'" style="width:{{vm.sm?\'150px\':\'200px\'}}" class="text-center">Endorsements</th><th ng-if="vm.mode==\'endorse\'">&nbsp</th></tr></thead><tbody><tr ng-repeat="x in vm.answers | limitTo: vm.limit" style="height:43px"><td ng-if="!vm.sm || vm.sortByName == \'Rank\'" align="middle">{{x.Rank}}</td><td ng-repeat="h in vm.fields | filter:{isrequired:true}"><a ng-attr-style="text-decoration: none;" href="{{x.slug ? \'/answerDetail/\' + x.slug:\'/answerDetail/\' + x.id }}" ng-click="vm.answerDetail(x)">{{ x[h.name]}}</a></td><td ng-if="(!vm.sm || vm.sortByName == \'Distance\') && vm.haveLocation" align="middle" style="width:{{vm.sm?\'10px\':\'auto\'}}" ng-click="vm.answerDetail(x)">{{x.dist}}</td><td ng-if="!vm.sm || vm.sortByName == \'Popular\'" align="middle" style="width:{{vm.sm?\'10px\':\'auto\'}}" ng-click="vm.answerDetail(x)">{{x.upV - x.downV > 0 ? (\'+\'+(x.upV-x.downV)):(x.upV-x.downV)}}</td><td ng-if="!vm.sm || vm.sortByName == \'Trending\'" align="middle" style="width:{{vm.sm?\'10px\':\'auto\'}}" ng-click="vm.answerDetail(x)">{{x.trendUpV!=undefined&&x.trendUpV!=NaN?x.trendUpV:0}}</td><td ng-if="(!vm.sm || vm.sortByName == \'Date\') && vm.type == \'Event\' && vm.mode==\'specials\'" align="middle" ng-click="vm.answerDetail(x)">{{x.date}}</td><td ng-show="vm.type == \'Establishment\' && vm.mode==\'specials\'" ng-attr-style="background-color:{{x.sp_bc}};color:{{x.sp_fc}};" ng-click="vm.answerDetail(x)">{{x.sp_title}}</td><td class="hidden-sm hidden-md hidden-lg hidden-xl" ng-if="vm.mode==\'endorse\'" style="width:{{vm.sm?\'150px\':\'200px\'}}"><div ng-if="!vm.fnm"><span ng-click="vm.UpVote(x,$event)" ng-attr-style="color:{{x.thumbUp}};margin-right: {{vm.sm?\'0px\':\'20px\'}};font-size: 18px;" class="pull-left">&nbsp&nbsp <i class="fa fa-thumbs-up" aria-hidden="true"></i> <span style="color:black;font-size: 14px;">&nbsp;{{x.upV}}&nbsp;&nbsp;</span></span> <span ng-click="vm.DownVote(x,$event)" ng-attr-style="color:{{x.thumbDn}};margin-right: {{vm.sm?\'0px\':\'20px\'}};font-size: 18px;" class="pull-right"><i class="fa fa-thumbs-down" aria-hidden="true"></i> <span style="color:black;font-size: 14px;">&nbsp;{{x.downV}}</span> &nbsp&nbsp</span></div><div class="hidden-sm hidden-md hidden-lg hidden-xl"><div ng-if="x.userObjs.length == 1"><span class="badge btn-primary" ng-click="vm.showAllFriendsList(x.userObjs, x.name)">1 friend endorses this</span></div><div ng-if="x.userObjs.length > 1"><span class="badge btn-primary" ng-click="vm.showAllFriendsList(x.userObjs, x.name)">{{x.userObjs.length}} friends endorse this</span></div></div></td><td class="hidden-xs" ng-if="vm.mode==\'endorse\'&&!vm.fnm" style="width:{{vm.sm?\'150px\':\'150px\'}}"><div><span ng-click="vm.UpVote(x,$event)" ng-attr-style="color:{{x.thumbUp}};margin-right: {{vm.sm?\'0px\':\'20px\'}};font-size: 18px;" class="pull-left">&nbsp&nbsp <i class="fa fa-thumbs-up" aria-hidden="true"></i> <span style="color:black;font-size: 14px;">&nbsp;{{x.upV}}&nbsp;&nbsp;</span></span> <span ng-click="vm.DownVote(x,$event)" ng-attr-style="color:{{x.thumbDn}};margin-right: {{vm.sm?\'0px\':\'20px\'}};font-size: 18px;" class="pull-right"><i class="fa fa-thumbs-down" aria-hidden="true"></i> <span style="color:black;font-size: 14px;">&nbsp;{{x.downV}}</span> &nbsp&nbsp</span></div></td><td class="hidden-xs" ng-if="vm.mode==\'endorse\'"><div ng-if="x.userObjs.length == 1"><span class="badge btn-primary" ng-click="vm.showAllFriendsList(x.userObjs, x.name)">1 friend endorses this</span></div><div ng-if="x.userObjs.length > 1"><span class="badge btn-primary" ng-click="vm.showAllFriendsList(x.userObjs, x.name)">{{x.userObjs.length}} friends endorse this</span></div></td></tr></tbody></tbody></table><div class="text-center" ng-if="vm.thereIsMore" style="padding-bottom:10px"><button class="btn btn-default" ng-click="vm.seeMore()">See More</button></div><div class="row" style="margin:0px;" ng-if="!vm.hasAnswerParent || vm.userIsOwner"><div class="col-xs-2" style="padding:0px"><a class="btn btn-primary" ng-click="vm.addAnswer()">+</a></div><div class="col-xs-10" ng-attr-style="display:{{vm.hideInfoBox ? \'none\':\'inline\'}};padding:0px;" ng-if="!vm.addInfoMsgAck || vm.noAnswers"><div class="alert alert-warning" style="padding-top: 5px;padding-bottom: 5px;"><a class="close" data-dismiss="alert" aria-label="close" ng-click="vm.closeAddInfoMsg()">&times;</a> <span class="glyphicon glyphicon-arrow-left"></span><strong>&nbsp;&nbsp; {{vm.noAnswers ? \'Oops, we have nothing on this list.\':\'Are we missing one?\'}}</strong>&nbsp;&nbsp;Use the \'+\' button to add a new <span ng-if="vm.type == \'Establishment\'">Establishment.</span> <span ng-if="vm.type == \'Organization\'">Organization or Company.</span> <span ng-if="vm.type == \'Person\'">Person.</span> <span ng-if="vm.type == \'PersonCust\'">Professional.</span> <span ng-if="vm.type == \'Place\'">Place.</span> <span ng-if="vm.type == \'Short-Phrase\'">Opinion.</span> <span ng-if="vm.type == \'Thing\'">Item.</span> <span ng-if="vm.type == \'Event\'">Event.</span> <span ng-if="vm.type == \'Simple\'">Item.</span></div></div></div><br><br ng-if="!vm.sm"><div class="text-center"><button ng-click="vm.loadComments()" class="btn btn-default" ng-class="vm.cm.commLoaded ? \'disabled\' : \'\'" style="background-color:#e6e6e6;width:100%">COMMENTS ({{vm.numcom}})</button></div><br ng-if="!vm.sm"><div ng-attr-style="display:{{vm.cm.commLoaded ? \'inline\':\'none\'}}"><div ng-repeat="x in vm.cm.comments"><div class="col-xs-12 media"><div ng-if="!x.picture" class="profile-avatar-wrapper media-left"><div class="empty-profile-avatar-wrapper" ng-attr-style="background-color:{{x.bc}};color:{{x.fc}};">{{x.initials}}</div></div><div ng-if="x.picture" class="profile-avatar-wrapper media-left" align="middle"><img ng-src="{{x.picture}}" class="img-responsive img-circle profile-avatar"></div><div class="media-body">{{x.body}}<br><small style="color:#bfbfbf">{{x.username}} - {{x.date}}&nbsp&nbsp <span class="dropdown"><i type="button" class="fa fa-flag dropdown-toggle" data-toggle="dropdown"></i><ul class="dropdown-menu dropdown-menu-right"><li><a ng-click="vm.cmFlag(1)">Off-Topic</a></li><li><a ng-click="vm.cmFlag(2)">Offensive</a></li><li><a ng-click="vm.cmFlag(3)">Spam</a></li></ul></span></small></div></div><br></div><div ng-attr-style="display:{{(vm.cm.commLoaded && vm.cm.comments.length == 0 && !vm.isLoggedIn) ? \'inline\':\'none\'}}"><br><p><small>Nobody has commented yet. Be the first. Log in, endorse answers and leave a comment.</small></p></div><div ng-attr-style="display:{{(vm.cm.commLoaded && vm.cm.comments.length > 0 && !vm.isLoggedIn) ? \'inline\':\'none\'}}"><br><p><small>You must log in and endorse one or more answers to leave a comment.</small></p></div><div ng-attr-style="display:{{(vm.cm.commLoaded && vm.isLoggedIn && !vm.commentAllowed) ? \'inline\':\'none\'}}"><br><p><small>Endorse one or more answers to leave a comment.</small></p></div><div ng-attr-style="display:{{(vm.isLoggedIn && vm.commentAllowed) ? \'inline\':\'none\'}}"><div class="media"><div ng-if="!user.picture.data.url" class="profile-avatar-wrapper media-left"><div class="empty-profile-avatar-wrapper" ng-attr-style="background-color:{{x.bc}};color:{{x.fc}};">{{x.initials}}</div></div><div ng-if="user.picture.data.url" class="profile-avatar-wrapper media-left" align="middle"><img ng-src="{{user.picture.data.url}}" class="img-responsive img-circle profile-avatar"></div><div class="media-body"><textarea class="form-control" ng-model="vm.cm.newComment" placeholder="Leave a comment" style="margin-left:0px;margin-right:0px;"></textarea></div></div><div class="text-right"><button ng-click="vm.postComment()" class="btn btn-primary">Post</button></div></div></div><br><div ng-if="vm.relRanks.length>0">See Also:<div class="row"><div class="col-xs-6 col-sm-3" ng-repeat="x in vm.relRanks.slice(0,4)" style="cursor:pointer;"><div href="{{\'/rankSummary/\' + x.slug }}" ng-click="vm.gotoRank(x)"><div class="text-center" style="background-color:lightgray; margin-top:10px;"><img ng-src="{{x.fimage ? x.fimage:x.image1url}}" style="height:100px;margin-top:10px;width:95%"></div><div class="container" style="background-color:lightgray;width:100%;height:65px"><div><p style="padding-top:5px">{{x.title}}</p></div></div></div></div></div></div><br ng-if="vm.relRanks"></div>'),e.put("app/admin/Partials/admin.html",'<div ui-view="navbar"></div><br><div ng-if="!vm.dataready"><h2>Please wait, loading all admin data...</h2></div><div ng-if="vm.dataready"><div class="text-center" ng-if="vm.isAdmin"><div class="btn-group"><button class="btn btn-default {{vm.selKeywords}}" ng-click="vm.keywords()">Searched-Keyword</button> <button class="btn btn-default {{vm.selViews}}" ng-click="vm.views()">Ranking-Answers Views</button> <button class="btn btn-default {{vm.selFlags}}" ng-click="vm.flags()">Answer Flags</button> <button class="btn btn-default {{vm.selAddRanking}}" ng-click="vm.addRank()">Add Ranking</button> <button class="btn btn-default {{vm.selDbMaint}}" ng-click="vm.dbMaint()">dB Maint</button> <button class="btn btn-default {{vm.selQuery}}" ng-click="vm.dbQuery()">Query</button> <button class="btn btn-default {{vm.selSibLocs}}" ng-click="vm.sibLocs()">Sibbling Locations</button> <button class="btn btn-default {{vm.selFoodRanks}}" ng-click="vm.foodranks()">Food Ranks</button> <button class="btn btn-default {{vm.selPayment}}" ng-click="vm.payment()">Payment</button> <button class="btn btn-default {{vm.selPlan}}" ng-click="vm.plan()">Plan</button> <button class="btn btn-default" ng-click="vm.bizAdmin()">Business</button> <button class="btn btn-default" ng-click="vm.cleanDB()">Clean DB</button> <button class="btn btn-default" ng-click="vm.modImages()">Moderate Images</button> <button class="btn btn-default" ng-click="vm.staticPages()">Static Pages</button> <button class="btn btn-default {{vm.selLocations}}" ng-click="vm.golocations()">Locations</button> <button class="btn btn-default {{vm.selsitemap}}" ng-click="vm.gositemap()">Sitemap</button> <button class="btn btn-danger" ng-click="vm.applyRule()">Apply Rule</button></div></div><div ng-if="vm.dataAdmin"><button class="btn btn-default {{vm.selQuery}}" ng-click="vm.dbQuery()">Query</button> <button class="btn btn-default {{vm.selSibLocs}}" ng-click="vm.sibLocs()">Sibbling Locations</button></div><div ng-if="vm.modAdmin"><button class="btn btn-default" ng-click="vm.modImages()">Moderate Images</button> <button class="btn btn-default" ng-click="vm.staticPages()">Static Pages</button></div></div><br><br><div ui-view=""></div><br><br>')}]),function(){"use strict";function e(e,t,n,a){function o(t){return e({method:"POST",data:t,url:a+"staticpages/createPageRank",headers:{"X-Dreamfactory-API-Key":void 0,"X-DreamFactory-Session-Token":void 0}})}function s(t){return e({method:"POST",data:t,url:a+"staticpages/createPageAnswer",headers:{"X-Dreamfactory-API-Key":void 0,"X-DreamFactory-Session-Token":void 0}})}function r(){return e({method:"POST",data:{},url:a+"staticpages/getFileList",headers:{"X-Dreamfactory-API-Key":void 0,"X-DreamFactory-Session-Token":void 0}})}function i(t){return e({method:"POST",data:t,url:a+"staticpages/getPageContent",headers:{"X-Dreamfactory-API-Key":void 0,"X-DreamFactory-Session-Token":void 0}})}function c(t){return e({method:"POST",data:t,url:a+"staticpages/removeFile",headers:{"X-Dreamfactory-API-Key":void 0,"X-DreamFactory-Session-Token":void 0}})}return{createPageRank:o,createPageAnswer:s,removeFile:c,getFileList:r,getPageContent:i}}angular.module("app").factory("staticpages",e),e.$inject=["$http","$q","$rootScope","SERVER_URL"]}(),function(){"use strict";function e(e,t,n,a){function o(){return e({method:"GET",url:a+"settings/",headers:{"X-Dreamfactory-API-Key":void 0,"X-DreamFactory-Session-Token":void 0}}).then(function(e){return n.setting=e.data.settings,e.data.settings})}function s(t){return e({method:"POST",url:a+"settings/",data:t,headers:{"X-Dreamfactory-API-Key":void 0,"X-DreamFactory-Session-Token":void 0}}).then(function(e){return n.setting=e.data.settings,e.data.settings})}function r(t,n){return e({method:"POST",url:a+"codeprice/",data:{codeprice:t,newPrice:n},headers:{"X-Dreamfactory-API-Key":void 0,"X-DreamFactory-Session-Token":void 0}})}return{getSetting:o,setSetting:s,setCodePrice:r}}angular.module("app").factory("setting",e),e.$inject=["$http","$q","$rootScope","SERVER_URL"]}(),function(){"use strict";function e(e,t,n,a){function o(t){return e({method:"POST",data:t,url:a+"mailing/newBizCreated",headers:{"X-Dreamfactory-API-Key":void 0,"X-DreamFactory-Session-Token":void 0}})}function s(t){return e({method:"POST",data:t,url:a+"mailing/newImageUploaded",headers:{"X-Dreamfactory-API-Key":void 0,"X-DreamFactory-Session-Token":void 0}})}function r(t){return e({method:"POST",data:t,url:a+"mailing/promoterCreated",headers:{"X-Dreamfactory-API-Key":void 0,"X-DreamFactory-Session-Token":void 0}})}function i(t){return e({method:"POST",data:t,url:a+"mailing/planPurchased",headers:{"X-Dreamfactory-API-Key":void 0,"X-DreamFactory-Session-Token":void 0}})}function c(t,n){return e({method:"POST",data:{email:t,username:n},url:a+"mailing/userSubscribed",headers:{"X-Dreamfactory-API-Key":void 0,"X-DreamFactory-Session-Token":void 0}})}return{promoterCreated:r,newBizCreated:o,planPurchased:i,subscribed:c,newImageUploaded:s}}angular.module("app").factory("mailing",e),e.$inject=["$http","$q","$rootScope","SERVER_URL"]}(),angular.module("app").factory("InstagramService",["$rootScope","$location","$http","INSTAGRAM_CLIENT_ID",function(e,t,n,a){var o,s=a,r=[],i=!1,c={_access_token:null,access_token:function(e){return angular.isDefined(e)&&(this._access_token=e),this._access_token},login:function(){var e=t.absUrl().split(t.path())[0]+"/";window.open("https://api.instagram.com/oauth/authorize/?client_id="+s+"&redirect_uri="+e+"&response_type=token&scope=likes+relationships+public_content+follower_list","Instagram Auth","width=400, height=600, centerscreen=true, chrome=yes")},getMyRecentImages:function(){return n.jsonp("https://api.instagram.com/v1/users/self/media/recent?access_token="+c.access_token()).then(function(e){return e.data.pagination.next_max_id?(i=!0,r=[e.data.pagination.next_max_id],o=0):i=!1,e.data.data})},getNextPage:function(){return n.jsonp("https://api.instagram.com/v1/users/self/media/recent?access_token="+c.access_token()+"&max_id="+r[o]).then(function(e){return e.data.pagination.next_max_id?(-1==r.indexOf(e.data.pagination.next_max_id)&&r.push(e.data.pagination.next_max_id),i=!0):i=!1,o++,e.data.data}).catch(function(e){console.log(e)})},getPreviousPage:function(){return n.jsonp("https://api.instagram.com/v1/users/self/media/recent?access_token="+c.access_token()+"&max_id="+r[o-1]).then(function(e){return o--,i=!0,e.data.data}).catch(function(e){console.log(e)})},getUserprofile:function(){return n.jsonp("https://api.instagram.com/v1/users/self/?access_token="+c.access_token()).then(function(e){return console.log(e),e}).catch(function(e){console.log(e)})},isPreviousAvailable:function(){return(1!=r.length||0!=o)&&o>=0},isNextAvailable:function(){return i}};return e.$on("igAccessTokenObtained",function(t,n){c.access_token(n.access_token.replace("#","").replace("!","")),e.$broadcast("instagramLoggedIn",{access_token:c._access_token})}),c}]),function(){"use strict";function e(e,t,n,a){function o(){return n.filterOptions?n.filterOptions=JSON.parse(n.filterOptions):n.filterOptions=c,n.filterOptions}function s(e){n.filterOptions=e,a.localStorage.setItem("Rank-X-Filters",JSON.stringify(e))}function r(){return!!n.initalHomeData&&(n.$emit("initalHomeDataLoaded"),!0)}function i(e){}var c={isNh:!1,isCity:!0,isNhRdy:"",cnh:"",isAllTopics:!0,ctopics:["LifeStyle","Social","Sports","Food","Beauty & Fashion","Family","Technology","Dating","City","Services","Health","Celebrities"]};return{loadFilterOptions:o,saveFilterOptions:s,saveInitalHomeData:i,loadInitalHomeData:r}}angular.module("app").factory("filter",e),e.$inject=["$http","$q","$rootScope","$window"]}(),function(){"use strict";function e(e,t,n,a){function o(e){c.push(e)}function s(e){var n=r(e);return n?t.when(n):a.api("/"+e+"?fields=first_name,gender,locale,picture,last_name,email","GET").then(function(e){return l.addFBUser(e),e},function(e){return null})}function r(e){return c.find(function(t){return t.id==e})}function i(e,t){for(var n=0;n<e.length;n++){var a=angular.copy(user[n]);l.getFBUserById(a[t]).then(function(e){})}return e}var c=[],l={findFBUserById:r,getFBUserById:s,addFBUser:o,loadProfilePicture:i};return l}angular.module("app").factory("fbusers",e),e.$inject=["$http","$q","$rootScope","$facebook"]}(),function(){"use strict";function e(e){function t(n,a){var o=e.locations.map(function(e){return e.id}).indexOf(n);if(o>-1){var s=e.locations[o].sub_areas.split(",").map(Number);if(e.locations[o].sub_areas){a.push(n);for(var r=0;r<s.length;r++)t(s[r],a)}else a.push(n)}else console.log("Could not find -- ",n)}function n(e){if(a(e))return e;var t=e.split("-").map(Number);return t[t.length-1]}function a(e){return!isNaN(e-0)&&null!==e&&""!==e&&!1!==e}return{getInclusiveAreas:t,getIndexFromSlug:n}}angular.module("app").service("common",e),e.$inject=["$rootScope"]}();var openModal=function(e,t){$(e).modal({backdrop:!t||1!=t.backdrop&&0!=t.backdrop?"static":t.backdrop,keyboard:t&&t.keyboard?t.keyboard:"false",show:"true"})},closeModal=function(e,t){$(e).modal("hide"),t&&t()};!function(){"user strict";angular.module("app").constant("INSTANCE_URL","https://api.rank-x.com").constant("APP_API_KEY","d85f0ae42651932fd92bb9dddfe1189c930adc3230ac4f578c4cb54073331555").constant("GOOGLE_API_KEY","AIzaSyC2gAzj80m1XpaagvunSDPgEvOCleNNe5A").constant("DEBUG_MODE",!1).constant("EMPTY_IMAGE","https://rank-x.com/assets/images/noimage.jpg").constant("INSTAGRAM_CLIENT_ID","c46745e083b7451a99461240e01da20b").constant("SERVER_URL","https://server.rank-x.com/").constant("STRIPE_CLIENT_ID","ca_AdOtLByD0cfx8W3d76nnKqLjruvHmGlh")}(),function(){"use strict";function e(e,t,n,a){a.config({loadedModules:["app"]}),t.otherwise("/home");var o=[{name:"layout",abstract:!0,url:"",views:{"@":{templateUrl:"app/layout/Partials/layout.html",controller:"layout as vm"},"navbar@layout":{templateUrl:"app/layout/Partials/navbar.html",controller:"navbar as vm"}}},{name:"cwrapper",parent:"layout",url:"/home",templateUrl:"app/layout/Partials/cwrapper.html",controller:"cwrapper as vm",resolve:{load:["$ocLazyLoad",function(e){return e.load({rerun:!0,files:["scripts/app2.js"]})}]}},{name:"rankSummary",parent:"layout",url:"/rankSummary/:index",templateUrl:"app/rank/Partials/RankSummary.html",controller:"rankSummary as vm"},{name:"editRanking",parent:"layout",url:"/editRanking/:index",templateUrl:"app/rank/Partials2/editRanking.html",controller:"editRanking as vm"},{name:"addAnswer",parent:"layout",url:"/addAnswer",templateUrl:"app/answer/Partials2/addAnswer.html",controller:"addAnswer as vm"},{name:"addEvent",parent:"layout",url:"/addEvent",templateUrl:"app/answer/Partials2/addEvent.html",controller:"addEvent as vm"},{name:"editAnswer",parent:"layout",url:"/editAnswer/:index",templateUrl:"app/answer/Partials2/editAnswer.html",controller:"editAnswer as vm"},{name:"specials",parent:"layout",url:"/specials",templateUrl:"app/customer/Partials/specials.html",controller:"specials as vm"},{name:"editspecial",parent:"layout",url:"/editspecial",templateUrl:"app/customer/Partials/editspecial.html",controller:"editspecial as vm"},{name:"addRankforAnswer",parent:"layout",url:"/addRankforAnswer",templateUrl:"app/rank/Partials2/addRankforAnswer.html",controller:"addRankforAnswer as vm"},{name:"answerDetail",parent:"layout",url:"/answerDetail/:index",templateUrl:"app/answer/Partials/answerDetail.html",controller:"answerDetail as vm"},{name:"answerRanksManager",parent:"layout",url:"/answerRanksManager",templateUrl:"app/answer/Partials2/answerRanksManager.html",controller:"answerRanksManager as vm"},{name:"editvrows",parent:"layout",url:"/editvrows",templateUrl:"app/customer/Partials/editvrows.html",controller:"editvrows as vm"},{name:"addCustomRank",parent:"layout",url:"/addCustomRank",templateUrl:"app/rank/Partials2/addCustomRank.html",controller:"addCustomRank as vm"},{name:"match",parent:"layout",url:"/match",templateUrl:"app/rank/Partials2/match.html",controller:"match as vm"},{name:"about",url:"/about",parent:"layout",templateUrl:"app/layout/Partials2/about.html",controller:"about as vm"},{name:"privacypolicy",url:"/privacypolicy",parent:"layout",templateUrl:"app/layout/Partials2/privacypolicy.html",controller:"privacypolicy as vm"},{name:"cutomertos",url:"/terms-of-service/customers",parent:"layout",templateUrl:"app/layout/Partials2/customertos.html",controller:"customertos as vm"},{name:"promotertos",url:"/terms-of-service/promoters",parent:"layout",templateUrl:"app/layout/Partials2/promotertos.html",controller:"promotertos as vm"},{name:"mybusiness",url:"/mybusiness",parent:"layout",templateUrl:"app/layout/Partials2/mybusiness.html",controller:"mybusiness as vm"},{name:"promoterconsole",url:"/promoterconsole",parent:"layout",templateUrl:"app/promoters/Partials/promoterconsole.html",controller:"promoterconsole as vm"},{name:"promotersignup",url:"/promotersignup",parent:"layout",templateUrl:"app/promoters/Partials/promotersignup.html",controller:"promotersignup as vm"},{name:"favs",parent:"layout",url:"/favs",templateUrl:"app/layout/Partials2/favs.html",controller:"favs as vm"},{name:"feeds",parent:"layout",url:"/feeds",templateUrl:"app/layout/Partials2/feeds.html",controller:"feeds as vm"},{name:"trends",parent:"layout",url:"/trends",templateUrl:"app/layout/Partials2/trends.html",controller:"trends as vm"},{name:"admin",url:"/admin",parent:"layout",templateUrl:"app/admin/Partials/admin.html",controller:"admin as vm",resolve:{load:["$ocLazyLoad",function(e){return e.load({rerun:!0,files:["scripts/admin-app.js"]})}]}}];$(o).each(function(){e.state(this)}),n.html5Mode(!0),n.hashPrefix("!")}angular.module("app").config(["$stateProvider","$urlRouterProvider","$locationProvider","$ocLazyLoadProvider",e])}(),function(){"use strict";function e(e,t,n,a){e.interceptors.push("httpInterceptor"),n.setAppId("1102409523140826"),a.resourceUrlWhitelist(["self","https://api.instagram.com/**"])}
angular.module("app").config(e),e.$inject=["$httpProvider","$locationProvider","$facebookProvider","$sceDelegateProvider"]}(),function(){"use strict";function e(e,t,n,a,o){t.defaults.headers.common["X-Dreamfactory-API-Key"]=a,t.defaults.headers.common["X-DreamFactory-Session-Token"]=e.session_token;var s=o.location.hash.replace("#access_token=","").split("&")[0];if(-1!=o.location.hash.indexOf("access_token")){console.log("opener",o.opener);o.opener.angular.element(o.opener.document).scope().$broadcast("igAccessTokenObtained",{access_token:s}),o.close()}}function t(e,t,n){n.ga("create","UA-88236718-1","auto"),n.ga("send","pageview"),e.$on("$stateChangeSuccess",function(e){n.ga("send","pageview",t.path())})}angular.module("app").run(e).run(t),e.$inject=["$cookies","$http","$rootScope","APP_API_KEY","$window"],t.$inject=["$rootScope","$location","$window"]}(),function(){"use strict";function e(e){function t(t,r){for(var i=t.length,c=i*(i-1)/2,l=r.length,d=0,u=0,g=0,m=0,p=0;p<i;p++){n[p]=new Array(i),a[p]=new Array(i);for(var f=0;f<i;f++)n[p][f]=0,a[p][f]=0;o[p]=t[p].id}for(p=0;p<l;p++)d=o.indexOf(r[p].hs),u=o.indexOf(r[p].ls),d>=0&&u>=0&&(r[p].sel==r[p].hs?n[d][u]++:r[p].sel==r[p].ls&&n[u][d]++,a[d][u]++,a[u][d]++);for(g=0,p=0;p<i;p++)for(f=0;f<i;f++)g+=a[p][f];for(m=g/(4*c),p=0;p<i;p++){for(t[p].Rank=0,g=0,f=0;f<i;f++)t[p].Rank=t[p].Rank+n[p][f],g+=a[p][f];t[p].Rank=t[p].Rank/g,g<m&&(t[p].Rank=t[p].Rank*(g/m)),isNaN(t[p].Rank)&&(t[p].Rank=0)}for(var h=0;h<i;h++)for(f=0;f<i;f++)h!=f&&t[f].Rank>=t[h].Rank&&n[h][f]>n[f][h]&&a[h][f]>=m&&(t[h].Rank=t[f].Rank+.01);s=t,e.answersR=s,e.R=n,e.GP=a,e.A=o}e.A=[];var n=[],a=[],o=[],s=[];return{computeRanking:t}}angular.module("app").service("rank",e),e.$inject=["$rootScope"]}(),function(){"use strict";function e(e,t,n){function a(t){function a(e){return n.DEBUG_MODE&&console.log("creating match record was succesful"),e.data}var o={};o.resource=[],o.resource.push(t),u.push.apply(u,t);var s=g;return e.post(s,t,{headers:{"Content-Type":"multipart/form-data"},body:o}).then(a,l)}function o(n){function a(e){return c(e.data.resource),u}if(d()&&!n)return t.when(u);var o=g;return e.get(o).then(a,l)}function s(t){function a(e){var t=e.data.resource,a=u.map(function(e){return e.id});return t.forEach(function(e){a.indexOf(e.id)<0&&u.push(e)}),n.DEBUG_MODE&&console.log("mrecsX data loaded"),t}for(var o="?filter=(",s=0;s<t.length;s++)o=o+"category="+t[s].category+")OR(";o=o.substring(0,o.length-3);var r=g;return e.get(r).then(a,l)}function r(t){function a(e){n.DEBUG_MODE&&console.log("deleting match records succesful")}for(var o=0;o<u.length;o++)u[o].ls!=t&&u[o].hs!=t||u.splice(o,1);var s=g+"?filter=(ls="+t+") OR (hs="+t+")";return e.delete(s).then(a,l)}function i(t,a){function o(e){console.log("deleting match records category-hs pair succesful")}function s(e){n.DEBUG_MODE&&console.log("deleting match records category-ls pair succesful")}for(var r=0;r<u.length;r++)u[r].ls!=a&&u[r].hs!=a||u.splice(r,1);var i=g+"?filter=(category="+t+") AND (hs="+a+")";e.delete(i).then(o,l);var c=g+"?filter=(category="+t+") AND (ls="+a+")";e.delete(c).then(s,l)}function c(e){u.length=0,e.forEach(function(e){u.push(e)})}function l(e){throw e}function d(){return u.length>0}var u=[];n.mrecs=u;var g="/api/v2/mysql/_table/matchtable";return{GetMatchTable:o,GetMatchTableX:s,postRec:a,deleteRecordsbyAnswer:r,deleteRecordsbyCatans:i}}angular.module("app").factory("matchrec",e),e.$inject=["$http","$q","$rootScope"]}(),function(){"use strict";function e(e,t,n,a,o,s,r,i,c,l,d,u,g,m,p,f,h,v,b,w,y,x,k,D,E,O,C,R,_,A,S,M,$){function P(){if(1==h.isFoodNearMe)return void B();h.cCategory=null;var e=M.getIndexFromSlug(t.index),n=0;h.isCustomRank?(n=h.customranks.map(function(e){return e.id}).indexOf(Number(e)))>-1&&(h.cCategory=h.customranks[n]):(n=h.content.map(function(e){return e.id}).indexOf(Number(e)))>-1&&(h.cCategory=h.content[n]),null!=h.cCategory?h.answersLoaded&&I():S.getRank(t.index)}function I(){Ie.dataReady=!0,Ie.ranking=h.cCategory.title,Ie.loadingAnswers=!0,R(function(){L(),Ie.loadingAnswers=!1})}function B(){1==h.isFoodNearMe&&(Ie.ranking="Food Near Me",Ie.foodNearMe=!0,Ne=!0,Ie.fnm=!0,Ie.showR=!1,h.cCategory=h.fnm,Ie.bc=h.cCategory.bc,Ie.fc=h.cCategory.fc,Ie.shade=h.cCategory.shade,Ie.fimage=h.cCategory.fimage,Ie.dataReady=!0),Ie.loadingAnswers=!0,R(function(){void 0!=h.coordsRdy&&0!=h.coordsRdy||H(),h.coordsRdy&&L(),Ie.loadingAnswers=!1,h.isFoodNearMe=!1},1e3)}function L(){Be=h.answers,Le=h.catansrecs,Ue=h.mrecs,h.inFavMode=!1,Fe=void 0!=h.rankIsNearMe&&h.rankIsNearMe,g.scrollTo(0,0),h.$emit("showLogo"),h.rankIsActive=!0,h.objNumAct=h.objNum,Y(),Ee(0),h.isLoggedIn&&h.friends_votes&&Oe(0),ce(),p.$parent.$parent.$parent.seo={pageTitle:h.cCategory.title,metaDescription:h.cCategory.question},0==Ie.answers.length?Ie.noAnswers=!0:Ie.noAnswers=!1,V(),h.cvotes?we():(h.cvotes=[],h.ceditvotes=[]),j(),J(),c.computeRanking(h.canswers,h.cmrecs),h.cmrecs.length>0&&K();for(var e=0;e<Ie.answers.length;e++)Ie.answers[e].Rank=e+1;if(void 0==h.cCategory.numcom?Ie.numcom=0:Ie.numcom=h.cCategory.numcom,!Ne)for(var e=0;e<Ie.answers.length;e++)Ie.answers[e].Rank!=Ie.answers[e].catansrank&&void 0!=Ie.answers[e].catans&&(h.DEBUG_MODE&&console.log("RS-1"),Ie.answers[e].catansrank!=Ie.answers[e].Rank&&a.updateRec(Ie.answers[e].catans,["rank"],[Ie.answers[e].Rank]));if(1==Ie.answers.length&&(Ie.numAns=1,"Short-Phrase"==h.cCategory.type?(Ie.isShortPhrase=!0,Ie.title1=Ie.answers[0].name,Ie.addinfo1=Ie.answers[0].addinfo,Ie.image1=Ie.title1+"##"+Ie.addinfo1,null!=h.cCategory.fimage&&void 0!=h.cCategory.fimage&&""!=h.cCategory.fimage?(Ie.hasfimage=!0,Ie.fimage=h.cCategory.fimage):Ie.hasfimage=!1):(Ie.isShortPhrase=!1,void 0!=Ie.answers[0].imageurl&&null!=Ie.answers[0].imageurl&&""!=Ie.answers[0].imageurl?(Ie.image1=Ie.answers[0].imageurl,Ie.image1ok=!0):Ie.image1ok=!1),Ne||h.cCategory.isGhost||(h.isCustomRank?_.update(h.cCategory.id,["answers","image1url","image2url","image3url"],[h.canswers.length,Ie.image1,"",""]):d.update(h.cCategory.id,["answers","image1url","image2url","image3url"],[h.canswers.length,Ie.image1,"",""]))),2==Ie.answers.length&&(Ie.numAns=2,"Short-Phrase"==h.cCategory.type?(Ie.isShortPhrase=!0,Ie.title1=Ie.answers[0].name,Ie.addinfo1=Ie.answers[0].addinfo,Ie.image1=Ie.title1+"##"+Ie.addinfo1,Ie.title2=Ie.answers[1].name,Ie.addinfo2=Ie.answers[1].addinfo,Ie.image2=Ie.title2+"##"+Ie.addinfo2,null!=h.cCategory.fimage&&void 0!=h.cCategory.fimage&&""!=h.cCategory.fimage?(Ie.hasfimage=!0,Ie.fimage=h.cCategory.fimage):Ie.hasfimage=!1):(Ie.isShortPhrase=!1,void 0!=Ie.answers[0].imageurl&&null!=Ie.answers[0].imageurl&&""!=Ie.answers[0].imageurl?(Ie.image1=Ie.answers[0].imageurl,Ie.image1ok=!0):Ie.image1ok=!1,void 0!=Ie.answers[1].imageurl&&null!=Ie.answers[1].imageurl&&""!=Ie.answers[1].imageurl?(Ie.image2=Ie.answers[1].imageurl,Ie.image2ok=!0):Ie.image2ok=!1),Ne||h.cCategory.isGhost||(h.isCustomRank?_.update(h.cCategory.id,["answers","image1url","image2url","image3url"],[h.canswers.length,Ie.image1,Ie.image2,""]):d.update(h.cCategory.id,["answers","image1url","image2url","image3url"],[h.canswers.length,Ie.image1,Ie.image2,""]))),Ie.answers.length>2){if(Ie.numAns=3,"Short-Phrase"==h.cCategory.type)Ie.isShortPhrase=!0,Ie.title1=Ie.answers[0].name,Ie.addinfo1=Ie.answers[0].addinfo,Ie.image1=Ie.title1+"##"+Ie.addinfo1,Ie.title2=Ie.answers[1].name,Ie.addinfo2=Ie.answers[1].addinfo,Ie.image2=Ie.title2+"##"+Ie.addinfo2,Ie.title3=Ie.answers[2].name,Ie.addinfo3=Ie.answers[2].addinfo,Ie.image3=Ie.title3+"##"+Ie.addinfo3,null!=h.cCategory.fimage&&void 0!=h.cCategory.fimage&&""!=h.cCategory.fimage?(Ie.hasfimage=!0,Ie.fimage=h.cCategory.fimage):Ie.hasfimage=!1;else{Ie.isShortPhrase=!1,Ie.image1=h.EMPTY_IMAGE,Ie.image2=h.EMPTY_IMAGE,Ie.image3=h.EMPTY_IMAGE,Ie.image1ok=!0,Ie.image2ok=!0,Ie.image3ok=!0;for(var t=1,n=0;n<Ie.answers.length;n++)if(void 0!=Ie.answers[n].imageurl&&null!=Ie.answers[n].imageurl&&""!=Ie.answers[n].imageurl&&Ie.answers[n].imageurl!=h.EMPTY_IMAGE){if(3==t){Ie.image3=Ie.answers[n].imageurl;break}2==t&&(Ie.image2=Ie.answers[n].imageurl,t++),1==t&&(Ie.image1=Ie.answers[n].imageurl,t++)}}Ne||h.cCategory.isGhost||(h.isCustomRank?_.update(h.cCategory.id,["answers","image1url","image2url","image3url"],[h.canswers.length,Ie.image1,Ie.image2,""]):d.update(h.cCategory.id,["answers","image1url","image2url","image3url"],[h.canswers.length,Ie.image1,Ie.image2,Ie.image3]))}if(void 0!=h.cCategory.fimage&&""!=h.cCategory.fimage&&h.cCategory.fimage!=Ie.image1&&(Ie.image3=Ie.image2,Ie.image2=Ie.image1,Ie.image1=h.cCategory.fimage),void 0!=h.cCategory.bc&&""!=h.cCategory.bc)Ie.bc=h.cCategory.bc,Ie.fc=h.cCategory.fc,Ie.shade=h.cCategory.shade;else{var o=s.defaultRankColor(h.cCategory);Ie.bc=o[0],Ie.fc=o[1],Ie.shade=-4}h.DEBUG_MODE&&console.log("foodNearMe, ",Ne),h.DEBUG_MODE&&console.log("rankIsNearMe, ",Fe),(Ne||Fe)&&H(),Ie.isE&&Z(),Ne&&(Ie.showR=!1),Ne||Ie.isE||(Ie.showR=!0),h.modeIsImage=!0,h.isCustomRank||h.cCategory.isGhost||Ne||_e(),Pe(),h.DEBUG_MODE&&console.log("Rank Summary Loaded!"),window.prerenderReady=!0,h.isCustomRank=!1}function U(){h.canswers4rank=[];for(var e=0;e<h.cvotes.length;e++)if(1==h.cvotes[e].vote)for(var t=0;t<h.canswers.length;t++)if(h.cvotes[e].answer==h.canswers[t].id){var n=h.catansrecs.map(function(e){return e.id}).indexOf(h.cvotes[e].catans);n>-1&&h.catansrecs[n].category==h.cCategory.id&&h.canswers4rank.push(h.canswers[t])}h.canswers4rank.length>0?Ie.commentAllowed=!0:Ie.commentAllowed=!1,T()}function T(){h.canswers4rank.length>1?Ie.rankDisabled="":Ie.rankDisabled="disabled"}function G(){w.loadVotesByUser().then(function(e){h.cvotes=e,U()})}function V(){if(h.canswers4rank=[],h.isLoggedIn){G();for(var e=0;e<h.editvotes.length;e++)if(h.editvotes[e].category==h.cCategory.id){var t=h.editvotes[e];h.ceditvotes.push(t)}h.cmrecs_user=[];for(var e=0;e<h.cmrecs.length;e++)h.cmrecs[e].user==h.user.id&&h.cmrecs_user.push(h.cmrecs[e])}}function N(e){Ie.rankOwner&&e.slug==Ie.rankOwner.slug&&(h.cCategory=h.oCategory),n.go("answerDetail",{index:e.slug})}function F(){if(h.isLoggedIn){if(!(h.canswers4rank.length>1))return void e.getDialog("answersFew");n.go("match")}else e.getDialog("notLoggedIn")}function q(){if(!h.isLoggedIn||void 0==h.cCategory)return void e.loginFacebook();if(Ge)return void e.getDialog("answersFull");if(h.cCategory.isGhost){var t={title:h.cCategory.title,type:h.cCategory.type,tags:h.cCategory.tags,keywords:h.cCategory.keywords,question:h.cCategory.question,fimage:h.cCategory.fimage,bc:h.cCategory.bc,fc:h.cCategory.fc,shade:h.cCategory.shade,introtext:h.cCategory.introtext,user:h.cCategory.user,views:0,answers:0,image1url:h.EMPTY_IMAGE,image2url:h.EMPTY_IMAGE,image3url:h.EMPTY_IMAGE,answertags:"",isatomic:1,timestmp:new Date,cat:h.cCategory.cat,nh:h.cCategory.nh};d.addTable(t).then(function(e){h.DEBUG_MODE&&console.log("table added --- ",e);var a=e.resource[0].id,o=t.title.toLowerCase();o=o.replace(/ /g,"-"),o=o.replace("/","at"),o=o+"-"+a,d.update(a,["slug"],[o]),"Event"==Ie.type?(h.eventmode="add",n.go("addEvent")):n.go("addAnswer")})}else"Event"==Ie.type?(h.eventmode="add",n.go("addEvent")):n.go("addAnswer")}function Y(){if(h.cCategory.introtext){var e=h.cCategory.introtext.indexOf("++"),t=h.cCategory.introtext.indexOf("--");Ie.introtext=e>-1&&t>-1?h.cCategory.introtext.substring(e+2,t):h.cCategory.introtext}else Ie.introtext="This is the rank for "+h.cCategory.title+".  Help shape the ranking by endorsing your favorites!.";if(0!=h.cCategory.owner&&void 0!=h.cCategory.owner)if(Ie.isCustomRank=!0,11091==h.cCategory.id||11092==h.cCategory.id||11093==h.cCategory.id)Ie.rankOwner=h.oAnswer;else{var n=h.answers.map(function(e){return e.id}).indexOf(Number(h.cCategory.owner));Ie.rankOwner=h.answers[n]}var a=0;switch(h.cCategory.type){case"Place":a=0;break;case"Person":a=1;break;case"Event":a=2;break;case"Organization":a=3;break;case"Short-Phrase":a=4;break;case"Activity":a=5;break;case"Establishment":a=6;break;case"Thing":a=7;break;case"PersonCust":a=8;break;case"Simple":a=9}var s=h.typeSchema[a].fields;if(h.fields=s,Ie.fields=h.fields,Ie.type=h.cCategory.type,"Event"==Ie.type?Ie.isE=!0:Ie.isE=!1,h.NhImplied=!1,h.NhValue="",("Establishment"==h.cCategory.type||"Place"==h.cCategory.type||"Event"==h.cCategory.type)&&void 0!=h.nhs)for(var r=h.nhs,i=0;i<r.length;i++)if(h.cCategory.title.indexOf(r[i])>-1){h.NhImplied=!0,h.NhValue=r[i];break}if(Ie.sm)for(var i=0;i<Ie.fields.length;i++)"cityarea"==Ie.fields[i].name&&(Ie.fields[i].isrequired=!1),"upV"==Ie.fields[i].name&&(Ie.fields[i].isrequired=!1),"email"==Ie.fields[i].name&&(Ie.fields[i].isrequired=!1);if(h.cCategory.isatomic&&h.NhImplied&&"San Diego"!=h.NhValue)for(var c=h.cCategory.title.replace(h.NhValue,"San Diego"),l=0;l<h.content.length;l++)h.content[l].title==c&&(Ie.hasParent=!0,Ie.parentRank=h.content[l],S.pulldata("ranks",[Ie.parentRank]));h.canswers=[];var d=[];h.ccatans=[],h.B=[];var u={},g={};if(Ne&&1==h.newCoords&&(d.length=0,h.answers.forEach(function(e){e.isfood&&Math.abs(h.currentUserLatitude-e.lat)<.0145&&Math.abs(h.currentUserLongitude-e.lng)<.0145&&d.push(e)}),h.newCoords=!1,h.canswers=d,h.fanswers=d),!Ne)for(var i=0;i<Le.length;i++){Te=h.cCategory.catstr?h.cCategory.catstr.split(":").map(Number):[h.cCategory.id];for(var l=0;l<Te.length;l++)if(Le[i].category==Te[l])for(var m=0;m<Be.length;m++)if(Le[i].answer==Be[m].id&&1!=Le[i].isdup)if(g={},g=Be[m],g.catans=Le[i].id,g.catansrank=Le[i].rank,g.upV=Le[i].upV,g.upV=Le[i].upV,g.downV=Le[i].downV,g.catans=Le[i].id,g.rank=Le[i].rank,g.uservote={},g.upVi=Le[i].upV,g.downVi=Le[i].downV,pe(g),"Event"==Ie.type){if(u=JSON.parse(Be[m].eventstr)){if(le(Be[m],u),o.eventIsCurrent(g,Be[m])){h.canswers.push(g),h.ccatans.push(Le[i]);break}break}}else if(h.isCustomRank&&g.isprivate||!h.isCustomRank&&!g.isprivate){h.canswers.push(g),h.ccatans.push(Le[i]);break}}Ne&&h.fanswers&&(h.canswers=h.fanswers),Ie.answers=h.canswers,Se(),Ie.answers.length>Ie.limit?Ie.thereIsMore=!0:Ie.thereIsMore=!1,S.pulldata("answers",h.canswers),h.currentUserLatitude&&h.currentUserLongitude?(Ie.haveLocation=!0,z()):Ie.haveLocation=!1;for(var p=new Date,f=p.getDay(),v=!1,b=0;b<Ie.answers.length;b++){v=!1;for(var i=0;i<h.specials.length;i++)if(Ie.answers[b].id==h.specials[i].answer){if("weekly"==h.specials[i].freq&&(0==f&&h.specials[i].sun&&(v=!0),1==f&&h.specials[i].mon&&(v=!0),2==f&&h.specials[i].tue&&(v=!0),3==f&&h.specials[i].wed&&(v=!0),4==f&&h.specials[i].thu&&(v=!0),5==f&&h.specials[i].fri&&(v=!0),6==f&&h.specials[i].sat&&(v=!0),v)){Ie.answers[b].sp_bc=h.specials[i].bc,Ie.answers[b].sp_fc=h.specials[i].fc,Ie.answers[b].sp_title=h.specials[i].stitle;break}if("onetime"==h.specials[i].freq&&moment().isBetween(moment(h.specials[i].sdate),moment(h.specials[i].edate),"day","[]")){Ie.answers[b].sp_bc=h.specials[i].bc,Ie.answers[b].sp_fc=h.specials[i].fc,Ie.answers[b].sp_title=h.specials[i].stitle;break}}}h.cmrecs=[];for(var i=0;i<Ue.length;i++)Ue[i].category==h.cCategory.id&&h.cmrecs.push(Ue[i]);Ie.isLoading=!1}function z(){for(var e=.017453292519943295,t=Math.cos,n=0,a=h.currentUserLatitude,o=h.currentUserLongitude,s=0,r=0,i=0,c=0;c<Ie.answers.length;c++)s=Ie.answers[c].lat,r=Ie.answers[c].lng,n=.5-t((s-a)*e)/2+t(a*e)*t(s*e)*(1-t((r-o)*e))/2,i=12742*Math.asin(Math.sqrt(n))/1.609,Ie.answers[c].dist=i<1?i.toPrecision(2):i.toPrecision(3),Ie.answers[c].dist>2e3&&(Ie.answers[c].dist=void 0)}function j(){Ge=!1}function X(){h.isLoggedIn?h.cmrecs_user.length>0?(Ie.selOverall="",Ie.selPersonal="active",Ie.numContributors=1,c.computeRanking(h.canswers,h.cmrecs_user)):e.getDialog("noPersonalRank"):e.getDialog("notLoggedIn")}function W(){Ie.selOverall="active",Ie.selPersonal="",Ie.numContributors=h.cuseractivity.length,c.computeRanking(h.canswers,h.cmrecs)}function K(){function e(e,t){return e.Rank<1||t.Rank<1?t.Rank-e.Rank:e.Rank-t.Rank}Ie.answers=Ie.answers.sort(e),ne(),h.canswers=Ie.answers,Ie.selRank="active",Ie.selDistance="",Ie.selUpV="",Ie.selDate="",Ie.selTrending="",Ie.sortByName="Rank",Ie.showR=!0}function H(){function t(e,t){return e.dist-t.dist}Ie.haveLocation?(Ie.answers=Ie.answers.sort(t),ne(),h.canswers=Ie.answers,Ie.selRank="",Ie.selDistance="active",Ie.selUpV="",Ie.selDate="",Ie.selTrending="",Ne&&(Ie.answers=Ie.answers.slice(0,99)),Ie.sortByName="Distance"):(h.loadRankWhenCoordsRdy=!0,h.rankIsNearMe=!0,e.askPermissionToLocate(),Ie.sortByName="Distance")}function J(){function e(e,t){return t.upV-t.downV-(e.upV-e.downV)}Ie.answers=Ie.answers.sort(e),ne(),h.canswers=Ie.answers,Ie.selRank="",Ie.selDistance="",Ie.selUpV="active",Ie.selDate="",Ie.selTrending="",Ie.sortByName="Popular",Ne||Ie.isE||(Ie.showR=!Ie.sm)}function Q(){function e(e,t){return 0==e.trendUpV&&0==t.trendUpV?t.upV-e.upV:t.trendUpV-e.trendUpV}Ie.answers=Ie.answers.sort(e),ne(),h.canswers=Ie.answers,Ie.selRank="",Ie.selDistance="",Ie.selUpV="",Ie.selDate="",Ie.selTrending="active",Ie.sortByName="Trending",Ne||Ie.isE||(Ie.showR=!Ie.sm)}function Z(){function e(e,t){return o.date2number(e.date)-o.date2number(t.date)}Ie.answers=Ie.answers.sort(e),ne(),h.canswers=Ie.answers,Ie.selRank="",Ie.selDistance="",Ie.selUpV="",Ie.selDate="active",Ie.selTrending="",Ie.sortByName="Date"}function ee(){y.loadComments("category",qe).then(function(){O.all(qe.comments.map(function(e){return C.getFBUserById(e.user)})).then(function(e){for(var t=0;t<qe.comments.length;t++)qe.comments[t].picture=e[t]?e[t].picture.data.url:null})})}function te(){y.postComment("category",qe)}function ne(){Ie.image2=h.EMPTY_IMAGE,Ie.image3=h.EMPTY_IMAGE,Ie.answers[0]&&(Ie.image2=Ie.answers[0].imageurl),Ie.answers[1]&&(Ie.image3=Ie.answers[1].imageurl)}function ae(){h.cCategory.title.indexOf("@")>-1?n.go("answerDetail",{index:h.cCategory.owner}):n.go("cwrapper")}function oe(){h.addInfoMsgAck=!0,Ie.hideInfoBox=!0,Ie.addInfoMsgAck=!0}function se(){e.getLocation(ie)}function re(){ye(),n.go("rankSummary",{index:Ie.parentRank.id})}function ie(){console.log("emitGetLocation"),h.$emit("getLocation")}function ce(){if(0!=h.cCategory.owner&&void 0!=h.cCategory.owner&&(Ie.hasAnswerParent=!0),h.isLoggedIn&&Ie.hasAnswerParent){var e=h.answers.map(function(e){return e.id}).indexOf(Number(h.cCategory.owner)),t=h.answers[e].owner;h.user.id==t&&(Ie.userIsOwner=!0)}}function le(e,t){e.bc=t.bc,e.fc=t.fc,e.freq=t.freq,e.edate=t.edate,e.sdate=t.sdate,e.etime=t.etime,e.etime2=t.etime2,e.stime=t.stime,e.stime2=t.stime2,e.mon=t.mon,e.tue=t.tue,e.wed=t.wed,e.thu=t.thu,e.fri=t.fri,e.sat=t.sat,e.sun=t.sun}function de(t){if(h.isLoggedIn)return h.DEBUG_MODE&&console.log("Comment Flagged"),x.flagAnswer("comment-rank",h.cCategory.id,t),void e.getDialog("commentFlagged");e.loginFacebook()}function ue(){Ie.linkurl=D+"rank"+h.cCategory.id+".html",Ie.tweet=h.cCategory.title+", endorse your favorite ones at: ";var t=h.cCategory.image1url;"Short-Phrase"==h.cCategory.type&&(t="https://rank-x.com/assets/images/rankxlogosd2_sm.png"),e.shareOptions(ge,Ie.isMobile,Ie.linkurl,"Rank-X, "+Ie.ranking+", "+h.cCategory.question+"\n"+t,p)}function ge(e){var t=h.cCategory.image1url;switch("Short-Phrase"==h.cCategory.type&&(t="https://rank-x.com/assets/images/rankxlogosd2_sm.png"),e){case"twitter":h.DEBUG_MODE&&console.log(e),k.share({provider:"twitter",attrs:{socialshareUrl:Ie.linkurl,socialshareText:Ie.tweet,socialshareHashtags:"rankxsandiego"}});break;case"facebook":h.DEBUG_MODE&&console.log(e),FB.ui({method:"feed",link:Ie.linkurl,caption:"Rank-X San Diego"},function(e){});break;case"email":h.DEBUG_MODE&&console.log(e),k.share({provider:"email",attrs:{socialshareSubject:"Rank-X, "+Ie.ranking,socialshareBody:Ie.linkurl}});break;case"gplus":h.DEBUG_MODE&&console.log(e),k.share({provider:"google",attrs:{socialshareUrl:Ie.linkurl,socialshareText:Ie.ranking+", "+h.cCategory.question,socialshareMedia:t}});break;case"pinterest":h.DEBUG_MODE&&console.log(e),k.share({provider:"pinterest",attrs:{socialshareUrl:Ie.linkurl,socialshareText:"Rank-X, "+Ie.ranking+", "+h.cCategory.question,socialshareMedia:t}});break;case"tumblr":h.DEBUG_MODE&&console.log(e),k.share({provider:"tumblr",attrs:{socialshareUrl:Ie.linkurl,socialshareText:"Rank-X, "+Ie.ranking+", "+h.cCategory.question,socialshareMedia:t}});break;case"reddit":h.DEBUG_MODE&&console.log(e),k.share({provider:"reddit",attrs:{socialshareUrl:Ie.linkurl,socialshareText:"Rank-X, "+Ie.ranking,socialshareSubreddit:h.cCategory.question}})}}function me(e){Ie.mode=e}function pe(e){h.isLoggedIn?(1==e.dV&&(e.thumbUp="#0070c0",e.thumbDn="#bfbfbf"),0==e.dV&&(e.thumbUp="#bfbfbf",e.thumbDn="#bfbfbf"),-1==e.dV&&(e.thumbUp="#bfbfbf",e.thumbDn="#0070c0")):(e.thumbUp="#bfbfbf",e.thumbDn="#bfbfbf")}function fe(t,n){if(!h.isLoggedIn)return void e.loginFacebook();switch(t.dV){case-1:t.dV=1,t.upV++,t.downV--;break;case 0:t.dV=1,t.upV++;break;case 1:t.dV=0,t.upV--}1==t.dV&&he(t),-1!=t.dV&&0!=t.dV||ve(t),pe(t),h.DEBUG_MODE&&console.log("UpVote")}function he(e){h.canswers4rank.push(e),T()}function ve(e){var t=h.canswers4rank.map(function(e){return e.id}).indexOf(e.id);t>-1&&h.canswers4rank.splice(t,1),T()}function be(t,n){if(!h.isLoggedIn)return void e.loginFacebook();switch(t.dV){case-1:t.dV=0,t.downV--;break;case 0:t.dV=-1,t.downV++;break;case 1:t.dV=-1,t.upV--,t.downV++}-1!=t.dV&&0!=t.dV||ve(t),pe(t),h.DEBUG_MODE&&console.log("DownVote")}function we(){for(var e=0;e<Ie.answers.length;e++){Ie.answers[e].voteRecordExists=!1;for(var t=0;t<h.cvotes.length;t++)if(h.cvotes[t].catans==Ie.answers[e].catans){Ie.answers[e].uservote=h.cvotes[t],Ie.answers[e].uservote.ansvidx=e,Ie.answers[e].voteRecordExists=!0;break}Ie.answers[e].voteRecordExists?Ie.answers[e].dV=Ie.answers[e].uservote.vote:Ie.answers[e].dV=0,pe(Ie.answers[e])}}function ye(){if(h.DEBUG_MODE&&console.log("UpdateRecords @answerDetail"),Ie.answers&&void 0!=h.cCategory)for(var e=0;e<Ie.answers.length;e++){var t=Ie.answers[e].voteRecordExists,n=!1,o={};try{var s=h.thisuseractivity.map(function(e){return e.category}).indexOf(h.cCategory.id)}catch(e){console.log("Error: ",e),console.log("$rootScope.cCategory - ",h.cCategory);var s=-1}s>=0?(n=!0,o=h.thisuseractivity[s]):n=!1,t&&Ie.answers[e].uservote.vote!=Ie.answers[e].dV&&0!=Ie.answers[e].dV&&(h.DEBUG_MODE&&console.log("UR-1"),w.patchRec(Ie.answers[e].uservote.id,Ie.answers[e].dV)),t&&Ie.answers[e].uservote.vote!=Ie.answers[e].dV&&0==Ie.answers[e].dV&&(h.DEBUG_MODE&&console.log("UR-2"),w.deleteRec(Ie.answers[e].uservote.id),o.votes<2?(h.DEBUG_MODE&&console.log("UR-3"),useractivity.deleteRec(o.id)):(h.DEBUG_MODE&&console.log("UR-4"),useractivity.patchRec(o.id,o.votes-1))),t||0==Ie.answers[e].dV||(h.DEBUG_MODE&&console.log("UR-5"),w.postRec(Ie.answers[e].catans,Ie.answers[e].id,h.cCategory.id,Ie.answers[e].dV),n?(h.DEBUG_MODE&&console.log("UR-6"),useractivity.patchRec(o.id,o.votes+1)):(h.DEBUG_MODE&&console.log("UR-7"),useractivity.postRec(h.cCategory.id))),Ie.answers[e].upV==Ie.answers[e].upVi&&Ie.answers[e].downV==Ie.answers[e].downVi||(h.DEBUG_MODE&&console.log("UR-8"),a.updateRec(Ie.answers[e].catans,["upV","downV"],[Ie.answers[e].upV,Ie.answers[e].downV]))}if(Ie.vrows)for(var e=0;e<Ie.vrows.length;e++){var r=Ie.vrows[e].voteExists;r&&Ie.vrows[e].dVi!=Ie.vrows[e].dV&&(h.DEBUG_MODE&&console.log("UR-9"),h.cvrowvotes[Ie.vrows[e].vidx].val=Ie.vrows[e].dV,u.patchRec(Ie.vrows[e].voteid,Ie.vrows[e].dV)),r||0==Ie.vrows[e].dV||(h.DEBUG_MODE&&console.log("UR-10"),u.postRec(Ie.vrows[e].id,Ie.vrows[e].dV)),Ie.vrows[e].upV==Ie.vrows[e].upVi&&Ie.vrows[e].downV==Ie.vrows[e].downVi||(h.DEBUG_MODE&&console.log("UR-11"),m.updateRec(Ie.vrows[e].id,["upV","downV"],[Ie.vrows[e].upV,Ie.vrows[e].downV]))}}function xe(){e.sortbyHelpDialog()}function ke(){"trends"==h.previousState?n.go("trends"):h.$emit("backToResults")}function De(){Ie.limit=Ie.limit+20,Ee(Ie.limit-20),Ie.answers.length>Ie.limit?Ie.thereIsMore=!0:Ie.thereIsMore=!1}function Ee(e){var t=Ie.answers.map(function(e){return e.id});t.length>0&&w.loadLastMonthVoting(t.slice(e,e+20)).then(function(e){e.forEach(function(e){var n=t.indexOf(e.answer);void 0==Ie.answers[n].trendUpV&&(Ie.answers[n].trendUpV=0),Ie.answers[n].trendUpV++})})}function Oe(e){var t=Ie.answers,n=-1,a=-1,o=-1;t.forEach(function(e){e.userObjs=[];for(var t=0;t<h.friends_votes.length;t++)if(h.friends_votes[t].answer==e.id){var s=Ce(h.friends_votes[t]);a=h.catansrecs.map(function(e){return e.id}).indexOf(h.friends_votes[t].catans),a>-1&&(o=h.content.map(function(e){return e.id}).indexOf(h.catansrecs[a].category)),n=e.userObjs.map(function(e){return e.id}).indexOf(s.id),n<0?(s.endorsements=[],o>-1&&s.endorsements.push(h.content[o].title),e.userObjs.push(s)):o>-1&&e.userObjs[n].endorsements.push(h.content[o].title)}})}function Ce(e){for(var t=0;t<h.user.friends.data.length;t++)if(e.user==h.user.friends.data[t].id)return h.user.friends.data[t]}function Re(t,n){e.showAllFriendsListDlg(t,n)}function _e(){h.cCategory.views++;var e=D+"databaseOps/incViews/rank/"+h.cCategory.id;f({method:"POST",url:e,headers:{"X-Dreamfactory-API-Key":void 0,"X-DreamFactory-Session-Token":void 0}})}function Ae(){var e;R.cancel(e),e=R(function(){Ie.answers=[],h.canswers.forEach(function(e){if(e.name.toLowerCase().indexOf(Ie.val.toLowerCase())>-1||e.cityarea.toLowerCase().indexOf(Ie.val.toLowerCase())>-1)Ie.answers.push(e);else if(h.locsas){var t=h.locsas.indexOf(Ie.val);if(t>-1){var n=[],a=-1,o=-1;a=h.locations.map(function(e){return e.nh_name}).indexOf(h.locsas[t]),n=h.locations[a].sub_areas.split(",").map(Number),n.forEach(function(t){o=h.locations.map(function(e){return e.id}).indexOf(t),e.cityarea==h.locations[o].nh_name&&Ie.answers.push(e)})}}}),Ie.answers.length>Ie.limit?Ie.thereIsMore=!0:Ie.thereIsMore=!1},300)}function Se(){Ie.opts=[],h.canswers.forEach(function(e){Ie.opts.indexOf(e.name)<0&&Ie.opts.push(e.name),Ie.opts.indexOf(e.cityarea)<0&&Ie.opts.push(e.cityarea)}),h.locsas&&h.locsas.forEach(function(e){Ie.opts.indexOf(e)<0&&Ie.opts.push(e)})}function Me(){Ie.val="",Ie.answers=h.canswers}function $e(e){n.go("rankSummary",{index:e.slug})}function Pe(){Ie.relRanks=[];var e=[],t=-1,n=-1,a="",o=0;if(h.locations&&(t=h.locations.map(function(e){return e.id}).indexOf(h.cCategory.nh))>-1&&(a=h.locations[t].nh_name,Ie.relRanks=$.sibblingRanks(h.cCategory,a),(n=Ie.relRanks.map(function(e){return e.id}).indexOf(h.cCategory.id))>-1&&Ie.relRanks.splice(n,1)),Ie.relRanks.length<4&&h.searchStrContent)for(var s=$.searchRelatedRanks([h.cCategory],""),r=s.map(function(e){return e.tag}),i=0;i<r.length&&Ie.relRanks.length<5;i++){if(r[o].length>3){e=$.searchRanks2(r[o]),Ie.relRanks=Ie.relRanks.concat(e);var n=Ie.relRanks.map(function(e){return e.id}).indexOf(h.cCategory.id);n>-1&&Ie.relRanks.splice(n,1)}o++}Ie.relRanks.length>0&&S.pulldata("ranks",Ie.relRanks.slice(0,4)),Ie.relRanks.forEach(function(e){e.title.length>50&&(n=e.title.indexOf(" in "),e.title=e.title.substring(0,n))})}var Ie=this;Ie.title="rankSummary",Ie.addAnswerDisabled="",Ie.mode="endorse",Ie.answerDetail=N,Ie.addAnswer=q,Ie.goRank=F,Ie.closeRank=ae,Ie.rankOverall=W,Ie.rankPersonal=X,Ie.closeAddInfoMsg=oe,Ie.whyNoDistance=se,Ie.sortByRank=K,Ie.sortByDistance=H,Ie.sortByUpV=J,Ie.sortByDate=Z,Ie.sortByTrending=Q,Ie.loadComments=ee,Ie.postComment=te,Ie.cmFlag=de,Ie.share=ue,Ie.changeMode=me,Ie.UpVote=fe,Ie.DownVote=be,Ie.sortbyHelpDialog=xe,Ie.backToResults=ke,Ie.seeMore=De,Ie.showAllFriendsList=Re,Ie.getResults=Ae,Ie.clearSearch=Me,Ie.gotoRank=$e,Ie.gotoParentRank=re,Ie.selOverall="active",Ie.selPersonal="",Ie.selRank="active",Ie.selDistance="",Ie.commLoaded=!1,Ie.userIsOwner=!1,Ie.dataReady=!1,Ie.hasAnswerParent=!1,Ie.isCustomRank=!1,Ie.user=h.user,Ie.loadingAnswers=!1,Ie.sortByName="",Ie.searchActive=h.searchActive,Ie.limit=20;var Be=[],Le=[],Ue=[],Te=[],Ge=!1,Ve=!1;Ie.foodNearMe=!1;var Ne=!1,Fe=!1;Ie.fnm=!1;var qe={};qe.commLoaded=!1,qe.initials="",qe.bc="",qe.fc="",qe.comments=[],qe.newComment="",Ie.cm=qe,Ie.isLoggedIn=void 0!=h.isLoggedIn&&h.isLoggedIn,h.userHasRank=!1,h.userActRecId=0;Ie.hideInfoBox=!1,h.addInfoMsgAck?Ie.addInfoMsgAck=h.addInfoMsgAck:Ie.addInfoMsgAck=!1;var Ye=h.$on("updateVoteTable",function(){Ve||G(),Ve=!0}),ze=h.$on("rankDataLoaded",function(){0==Ie.dataReady&&P()}),je=(h.$on("answersLoaded",function(){0==Ie.dataReady&&P()}),h.$on("coordsRdy",function(){h.DEBUG_MODE&&console.log("received coordsreadyrank"),Ie.haveLocation=!0,L(),R(function(){p.$apply()})})),Xe=h.$on("$stateChangeStart",function(e,t,n,a,o){"rankSummary"==a.name&&"rankSummary"!=t.name&&h.isLoggedIn&&ye()});p.$on("$destroy",Xe),p.$on("$destroy",Ye),p.$on("$destroy",ze),p.$on("$destroy",je),Ie.isMobile=!1,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|ipad|iris|kindle|Android|Silk|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(navigator.userAgent)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(navigator.userAgent.substr(0,4)))&&(Ie.isMobile=!0),g.innerWidth<512?(Ie.sm=!0,Ie.nsm=!1):(Ie.sm=!1,Ie.nsm=!0),null!=document.getElementById("SearchInput")&&void 0!=document.getElementById("SearchInput")&&document.getElementById("SearchInput").blur(),window.prerenderReady=!1,h.DEBUG_MODE&&console.log("$rootScope.rankSummaryDataLoaded - ",h.rankSummaryDataLoaded),h.DEBUG_MODE&&console.log("$rootScope.isCustomRank - ",h.isCustomRank),h.DEBUG_MODE&&console.log("$stateParams.index - ",t.index),h.DEBUG_MODE&&console.log("$rootScope.cCategory - ",h.cCategory.id,h.cCategory.cat),P()}angular.module("app").controller("rankSummary",e),e.$inject=["dialog","$stateParams","$state","catans","datetime","color","locations","answer","rank","$filter","table","vrowvotes","$window","vrows","$scope","$http","$rootScope","$modal","editvote","votes","commentops","flag","Socialshare","SERVER_URL","$location","$q","fbusers","$timeout","table2","categories","dataloader","common","search"]}(),function(){"use strict";function e(e,t,n){function a(a){if(u()&&!a)return t.when(m);var o=f+"?offset=0",s=e.get(o);return t.all([s]).then(function(e){return m=e[0].data.resource,n.DEBUG_MODE&&console.log("No. promoters: ",m.length),m},g)}function o(t){function n(e){return p=e.data.resource}var a=f+"/"+t;return e.get(a).then(n,g)}function s(t){function n(e){return p=e.data.resource}var a=f+"/?filter=user="+t;return e.get(a).then(n,g)}function r(t){function n(e){return p=e.data.resource}var a=f+"/?filter=code="+t;return e.get(a).then(n,g)}function i(t){function n(e){var n=t
;return n.id=e.data.resource[0].id,m.push(n),e.data}var a=f,o=[];return o.push(t),e.post(a,o,{headers:{"Content-Type":"multipart/form-data"},body:o}).then(n,g)}function c(t,a,o){function s(e){return n.DEBUG_MODE&&console.log("updating promoter succesful"),e.data}var r={};r.resource=[];var i={};i.id=t;for(var c=0;c<a.length;c++)switch(a[c]){case"firstname":i.firstname=o[c];break;case"lastname":i.lastname=o[c];break;case"email":i.email=o[c];break;case"address":i.address=o[c];break;case"phone":i.phone=o[c];break;case"code":i.code=o[c];break;case"stripeid":i.stripeid=o[c]}r.resource.push(i);for(var l=f,d=p.map(function(e){return e.id}).indexOf(t),c=0;c<a.length;c++)switch(a[c]){case"firstname":p[d].firstname=o[c];break;case"lastname":p[d].lastname=o[c];break;case"email":p[d].email=o[c];break;case"address":p[d].address=o[c];break;case"phone":p[d].phone=o[c];break;case"code":p[d].code=o[c];break;case"stripeid":p[d].stripeid=o[c]}return e.patch(l,r,{headers:{"Content-Type":"multipart/form-data"},body:r}).then(s,g)}function l(t){function a(e){return n.DEBUG_MODE&&console.log("Deleting promote was succesful"),e.data}var o={};o.resource=[];var s={};s.id=promote_id,o.resource.push(s);var r=f+"/"+t,i=m.map(function(e){return e.id}).indexOf(t);return i>-1&&m.splice(i,1),e.delete(r,s,{headers:{"Content-Type":"multipart/form-data"},body:o}).then(a,g)}function d(t){function n(e){return p=e.data.resource}var a=f+"/?filter=code="+t;return e.get(a).then(n,g)}function u(){return m.length>0}function g(e){throw e}var m=[],p={},f="/api/v2/mysql/_table/promoters";return{getall:a,get:o,getbyUser:s,getbyCode:r,add:i,update:c,deletepromoter:l,getbycode:d}}angular.module("app").factory("promoter",e),e.$inject=["$http","$q","$rootScope"]}(),function(){"use strict";function e(e,t,n,a,o,s,r,i,c,l,d,u,g,m,p,f,h){function v(){if(e.isLoggedIn){e.DEBUG_MODE&&console.log("user is logged in, loading data");var o=t.loadVotesByUser(),s=n.loadEditVotesTable(),r=a.loadVrowVotes(),i=d.getActivitybyUser(),c=g.getbyUser(e.user.id),f=m.get(),h=p.get(),v=t.loadVotesByMyFriends();return u.all([o,s,r,i,c,f,h,v]).then(function(t){e.cvotes=t[0],e.editvotes=t[1],e.cvrowvotes=t[2],e.thisuseractivity=t[3],e.userpromoter=t[4],e.catcodes=t[5],e.codeprices=t[6],e.friends_votes=t[7],l.getDemoData(),e.DEBUG_MODE&&console.log("user promoter - ",e.userpromoter),e.userDataLoaded=!0,e.$emit("userDataLoaded")})}e.DEBUG_MODE&&console.log("user is not logged in, no need to load data"),e.cvotes=[],e.editvotes=[],e.cvrowvotes=[],e.thisuseractivity=[],e.userpromoter=[],e.catcodes=[],e.codeprices=[],e.userDataLoaded=!0,e.$emit("userDataLoaded")}function b(){e.isLoggedIn&&(e.DEBUG_MODE&&console.log("user is logged in, loading loading user accounts data"),o.getuseraccnt().then(function(t){function n(e){r.customer=e.data,w()}if(e.showWarning=!1,e.useraccnts.length>0){for(var a=!0,o="",s=0;s<e.useraccnts.length;s++)if(""!=e.useraccnts[s].email&&(a=!1),void 0!=e.useraccnts[s].stripeid&&""!=e.useraccnts[s].stripeid&&0!=e.useraccnts[s].stripeid){o=h+"dreamfactory-stripe-user/"+e.useraccnts[s].stripeid+"/"+e.useraccnts[s].id;var r=e.useraccnts[s],i={method:"GET",url:o,headers:{"X-Dreamfactory-API-Key":void 0,"X-DreamFactory-Session-Token":void 0}};f(i).then(n,function(e){console.log("Error updating Stripe Invoices - ",e)}),e.DEBUG_MODE&&console.log("Retrieving latest invoice info from Stripe")}e.$emit("userAccountsLoaded"),a?(e.showWarning=!0,e.$emit("showWarning")):e.showWarning=!1}}))}function w(){if(e.isLoggedIn&&e.rankSummaryDataLoaded){e.DEBUG_MODE&&console.log("Syncing useraccnt data to answers");for(var t=0,n=0;n<e.useraccnts.length;n++){var a=[],o=[];t=e.answers.map(function(e){return e.id}).indexOf(e.useraccnts[n].answer),e.answers[t].ispremium!=e.useraccnts[n].ispremium&&(a.push("ispremium"),o.push(e.useraccnts[n].ispremium)),e.answers[t].hasranks!=e.useraccnts[n].hasranks&&(a.push("hasranks"),o.push(e.useraccnts[n].hasranks)),e.answers[t].ranksqty!=e.useraccnts[n].ranksqty&&(a.push("ranksqty"),o.push(e.useraccnts[n].ranksqty)),a.length>0&&s.updateAnswer(e.answers[t].id,a,o)}}}function y(){for(var t=[],n={},a=0;a<e.cvotes.length;a++)n={},n.id=e.cvotes[a].answer,n.answer=e.cvotes[a].answer,t.push(n);l.pulldata("answers",t),e.friendsVotes=!0;for(var o=[],a=0;a<e.friends_votes.length;a++)n={},n.id=e.friends_votes[a].answer,n.answer=e.friends_votes[a].answer,o.push(n);l.pulldata("answers",o)}return{loadUserData:v,loadUserAccount:b,pullFavoriteData:y}}angular.module("app").service("userdata",e),e.$inject=["$rootScope","votes","editvote","vrowvotes","useraccnt","answer","table2","catans","special","dataloader","useractivity","$q","promoter","categorycode","codeprice","$http","SERVER_URL"]}(),function(){"use strict";function e(e,t,n,a,o){function s(t,n){var a=o+"stripeServer/payPromoter",s={method:"POST",url:a,data:{stripeId:t.stripeid,promoterId:t.id,amount:t.balance*n},headers:{"X-Dreamfactory-API-Key":void 0,"X-DreamFactory-Session-Token":void 0}};return e(s).then(function(e){return e})}function r(t,n,a){function o(e){var t=v.map(function(e){return e.id}).indexOf(e.data.id);return v.splice(t,1),e}var s=w+"/"+n;return e.delete(s).then(o,h)}function i(t){return e({method:"GET",url:o+"stripeServer/"+t+"/invoices",headers:{"X-Dreamfactory-API-Key":void 0,"X-DreamFactory-Session-Token":void 0}}).then(function(e){return e.data})}function c(){function t(e){return v=e.data.resource}var n=w;return e.get(n).then(t,h)}function l(){function t(e){return f(e.data.resource),v}var a=w+"?filter=(user="+n.user.id+")";return e.get(a).then(t,h)}function d(t){function a(e){return e.data.resource}var o=w+"?filter=(user="+n.user.id+") AND (answer="+t+")";return e.get(o).then(a,h)}function u(t){function n(e){return b=e.data.resource}var a=w+"?filter=(promocode="+t+")";return e.get(a).then(n,h)}function g(t){function a(e){var t=o;return t.id=e.data.resource[0].id,v.push(t),t}var o={};o.user=n.user.id,o.answer=t.id,o.bizcat=p(t.id),o.status="Basic",o.stripeid="0",o.email=n.user.email,o.username=n.user.name;var s={};s.resource=[],s.resource.push(o);var r=w;return e.post(r,s,{headers:{"Content-Type":"multipart/form-data"},body:s}).then(a,h)}function m(t,a,o){function s(e){return n.$emit("clear-notification-warning"),e.data}var r={};r.resource=[];var i={};i.id=t;for(var c=0;c<a.length;c++)switch(a[c]){case"bizcat":i.bizcat=o[c];break;case"email":i.email=o[c];break;case"status":i.status=o[c];break;case"stripeid":i.stripeid=o[c];break;case"ispremium":i.ispremium=o[c];break;case"hasranks":i.hasranks=o[c];break;case"ranksqty":i.ranksqty=o[c];break;case"name":i.name=o[c]}r.resource.push(i);for(var l=w,d=v.map(function(e){return e.id}).indexOf(t),c=0;c<a.length;c++)switch(a[c]){case"bizcat":v[d].bizcat=o[c];break;case"email":v[d].email=o[c];break;case"status":v[d].status=o[c];break;case"stripeid":v[d].stripeid=o[c];break;case"ispremium":v[d].ispremium=o[c];break;case"hasranks":v[d].hasranks=o[c];break;case"ranksqty":v[d].ranksqty=o[c];break;case"name":v[d].name=o[c]}return e.patch(l,r,{headers:{"Content-Type":"multipart/form-data"},body:r}).then(s,h)}function p(e){for(var t=0,a={},o="",s=0,r=0,i=0;i<n.catansrecs.length;i++)if(n.catansrecs[i].answer==e){t=n.catansrecs[i].category;var c=n.content.map(function(e){return e.id}).indexOf(t);if(c>-1){if(a=n.content[c],null!=a.title)for(var l=0;l<n.catcodes.length;l++)if(a.title.indexOf(n.catcodes[l].category)>-1)if(""==o)o=n.catcodes[l].code;else{for(var d=0;d<n.codeprices.length;d++)n.codeprices[d].code==o&&(s=n.codeprices[d].scale),n.codeprices[d].code==n.catcodes[l].code&&(r=n.codeprices[d].scale);r>s&&(o=n.catcodes[l].code)}}else n.DEBUG_MODE&&console.log("Couldnt find rank: ",t)}return o}function f(e){v.length=0,e.forEach(function(e){v.push(e)})}function h(e){throw e}var v=[];n.useraccnts=v;var b=[],w="/api/v2/mysql/_table/useraccnts";return{getuseraccnt:l,getaccntsbycode:u,getuseraccntans:d,getallaccnts:c,adduseraccnt:g,updateuseraccnt:m,getuseraccntInvoicesAndCustomer:i,deleteAccount:r,payPromoter:s,getBizCat:p}}angular.module("app").factory("useraccnt",e),e.$inject=["$http","$q","$rootScope","login","SERVER_URL"]}(),function(){"use strict";function e(e,t,n,a,o,s,r,i,c,l){function d(){return b.loginWithFacebook().then(function(e){return c.login("public_profile,email,user_friends").then(function(e){if("connected"===e.status)return c.api("/me?fields=id,name,picture,first_name,last_name,gender,age_range,locale,email")}).then(function(e){return a.DEBUG_MODE&&console.log("My info: ",e),a.user=e,c.api("me/friends?fields=first_name,gender,locale,last_name,email,picture")}).then(function(e){a.DEBUG_MODE&&console.log("Got friends: ",e),a.user.friends=e,a.isLoggedIn=!0,l.addFBUser(a.user);try{window.localStorage.user=JSON.stringify(a.user)}catch(e){}a.DEBUG_MODE&&console.log("oauthWithFacebook succesful")}).catch(function(e){console.log(e)})})}function u(t){return console.log("login/services/login.svc.js:initiate"),e.post("/api/v2/user/session",t).then(function(t){e.defaults.headers.common["X-DreamFactory-Session-Token"]=t.data.session_token,n.session_token=t.data.session_token,a.user=t.data;try{window.localStorage.user=JSON.stringify(t.data)}catch(e){}})}function g(){a.DEBUG_MODE&&console.log("@loginWithFacebook");var e="",r=0,i=0;e=void 0==a.stateName?s.current.name:a.stateName,void 0==a.stateName?("rankSummary"==e&&(r=a.cCategory.id),"answerDetail"==e&&(r=a.canswer.id)):r=a.stateNum,i=void 0!=a.cCategory?a.cCategory.id:void 0,n.put("statename",e),n.put("statenum",r),n.put("ccategory",i);var c=t.defer(),l=o+"/api/v2/user/session?service=facebook";return c.resolve({url:l}),c.promise}function m(t){function o(t){console.log("oauth results",t),e.defaults.headers.common["X-DreamFactory-Session-Token"]=t.data.session_token,n.session_token=t.data.session_token,a.user=t.data,a.isLoggedIn=!0;try{window.localStorage.user=JSON.stringify(t.data)}catch(e){}a.DEBUG_MODE&&console.log("oauthWithFacebook succesful"),a.$emit("redirectAfterLogin")}return a.DEBUG_MODE&&console.log("@oauthWithFacebook - ",t),e.post("/api/v2/user/session?oauth_callback=true&service=facebook&"+t).then(o,f)}function p(){return e.delete("/api/v2/user/session").then(function(t){delete e.defaults.headers.common["X-DreamFactory-Session-Token"],n.remove("session_token"),delete a.user,a.isLoggedIn=!1,a.isAdmin=!1,a.dataAdmin=!1,a.$emit("adminCredentials");try{window.localStorage.removeItem("user")}catch(e){}})}function f(e){throw console.log("error",e),e}function h(t){return console.log("options",t),e.post("/api/v2/user/register?login=true",t).then(function(e){console.log("register result",e)},function(e){console.log("error",e)})}function v(){a.isLoggedIn=!0;var e=new Object;e.age_range={min:21},e.first_name="Test",e.friends={data:[{first_name:"John",gender:"male",id:"362411340826490",last_name:"Carter",locale:"en_US",picture:{data:{is_silhouette:!1,url:"https://scontent.xx.fbcdn.net/v/t1.0-1/p50x50/18034179_362408994160058_2814191765613662934_n.jpg?oh=03f00905624bc37bc3f57b76148a44aa&oe=59BC08B8"}}},{first_name:"John",gender:"male",id:"398314100568945",last_name:"Will",locale:"en_US",picture:{data:{is_silhouette:!1,url:"https://scontent.xx.fbcdn.net/v/t1.0-1/p50x50/14915696_288291968237826_1651783963192855784_n.jpg?oh=18bee38eafb63165ac9ecf37d649d8ee&oe=597C137F"}}}],summary:{}},e.gender="male",e.id="187959328383879",e.email="roy.smith0820@gmail.com",e.last_name="User",e.locale="us_EN",e.name="Test User",e.picture={data:{url:"https://scontent.xx.fbcdn.net/v/t1.0-1/p50x50/18057110_194133167766495_4123816583005617544_n.jpg?oh=7dc367a88a4d28f4f84137f9007f847e&oe=59836C25"}},a.isAdmin=!0,e.is_sys_admin=!0,n.session_token=e.session_token,a.user=e;try{return window.localStorage.user=JSON.stringify(e),{email:e.email,first_name:e.first_name,host:e.host,id:e.id,is_sys_admin:e.is_sys_admin,last_login_date:e.last_login_date,last_name:e.last_name,name:e.name,role:e.role,role_id:e.role_id,session_id:e.session_id,session_token:e.session_token}}catch(e){}}var b={initiate:u,loginWithFacebook:g,oauthWithFacebook:m,register:h,logout:p,setFakeLocalUser:v,facebookSDKLogin:d};return b}angular.module("app").factory("login",e),e.$inject=["$http","$q","$cookies","$rootScope","INSTANCE_URL","$state","$location","$window","$facebook","fbusers"]}(),function(){"use strict";angular.module("login",["ngCookies","ui.router"]).run(["$rootScope",function(e){try{e.user=JSON.parse(window.localStorage.user),e.user&&(e.isLoggedIn=!0),e.user.is_sys_admin&&(e.isAdmin=!0)}catch(e){}}]).config(function(){})}(),function(){"use strict";function e(e,t,n,a){function o(e){return e.url.indexOf("/api/v2")>-1&&(e.url=a+e.url),e.url.indexOf("api.instagram.com")>-1&&(e.headers.useXDomain=!0,e.headers.common="Content-Type: application/json",delete e.headers.common["X-Requested-With"],delete e.headers["X-DreamFactory-Session-Token"],delete e.headers["X-Dreamfactory-API-Key"]),"post"===e.method.toLowerCase()&&e.url.indexOf("/api/v2/user/session")>-1&&delete e.headers["X-DreamFactory-Session-Token"],e}function s(n){return 302==n.status?(e.path("/login"),t.reject(n)):((401===n.status||403===n.status&&n.data.error.message.indexOf("token")>-1)&&e.path("/login"),t.reject(n))}return{request:o,responseError:s}}angular.module("login").factory("httpInterceptor",e),e.$inject=["$location","$q","$injector","INSTANCE_URL"]}(),function(){"use strict";function e(e,t,n){function a(){console.log("register",a),n.register({email:s.username,password:s.password,first_name:s.firstName||"Address",last_name:s.lastName||"Book"}).then(function(){e.path("/bizlogin")},function(e){s.message=e.Message,console.log("Error: ",e)})}function o(){e.path("/bizlogin")}var s=this;s.title="register",s.username="",s.password="",s.confirm="",s.firstName="",s.lastName="",s.message="",s.register=a,s.signIn=o,function(){t.isLoggedIn=!1}()}angular.module("login").controller("register",e),e.$inject=["$location","$rootScope","login"]}(),function(){"use strict";function e(e,t,n,a,o,s,r,i,c,l,d){function u(){a.facebookSDKLogin()}function g(){console.log("submit"),a.initiate({email:b.username,password:b.password}).then(function(){n.isLoggedIn=!0,console.log("isLoggedIn",n.isLoggedIn),e.path("/")})}function m(){var e=r.get("statename"),t=r.get("statenum");"rankSummary"==e||"answerDetail"==e?s.go(e,{index:t}):s.go("cwrapper")}function p(){a.loginWithFacebook().then(function(e){console.log("result @loginWithFacebook - ",e),t.location=e.url})}function f(){e.path("/register")}function h(){s.go("cwrapper")}function v(){o.getDialog("whyFacebook")}var b=this;b.title="login",b.username="",b.password="",b.code="",b.isProgressing=!1,b.submit=g,b.register=f,b.redirectForFacebook=p,b.whyFacebookDialog=v,b.facebookLogin=u,b.goBack=h,n.$on("redirectAfterLogin",function(){m()}),n.isLoggedIn&&s.go("cwrapper")}angular.module("login").controller("login",e),e.$inject=["$location","$window","$rootScope","login","dialog","$state","$cookies","$http","$facebook","fbusers","InstagramService"]}(),function(){"use strict";function e(e,t,n,a,o,s,r){function i(){console.log("bizlogin - submit"),a.initiate({email:c.username,password:c.password}).then(function(){n.isLoggedIn=!0,console.log("isLoggedIn",n.isLoggedIn),r.go("cwrapper",{},{location:"replace"})})}var c=this;c.title="bizlogin",c.username="",c.password="",c.code="",c.isProgressing=!1,c.submit=i,function(){var e=location.search,t=e.lastIndexOf("?");t>=0&&(e=e.substr(t+1)),e&&(c.isProgressing=!0,a.oauthWithFacebook(e).then(function(e){n.isLoggedIn=!0,console.log("isLoggedIn",n.isLoggedIn),r.go("cwrapper",{},{location:"replace"})},function(){c.isProgressing=!1})),console.log("vm.code bizlogin --",c.code),n.isLoggedIn=!1}()}angular.module("login").controller("bizlogin",e),e.$inject=["$location","$window","$rootScope","login","dialog","userDetail","$state"]}(),angular.module("app").directive("userDetailModal",["$rootScope","userDetail","dialog",function(e,t,n){"use strict";return{restrict:"E",templateUrl:"app/login/partials/add-user-detail.html",link:function(a,o,s,r){a.maxDate=moment().format("YYYY-MM-DD"),e.openUserDetailModal=function(){e.user&&(e.user.gender="Male",e.user.birth_date=""),openModal("#addUserDetailModal")},e.addUserDetail=function(){t.addUserDetail().then(function(n){t.getUserDetail().then(function(t){if(0==Object.keys(t).length)e.openUserDetailModal();else{e.user.age=calculateAge(new Date(t[0].birth_date)),e.user.gender=t[0].gender,e.user.birth_date=t[0].birth_date;try{window.localStorage.user=JSON.stringify(e.user)}catch(e){}}}),closeModal("#addUserDetailModal")})},e.whyThisInfoDialog=function(){n.getDialog("whyUserData")},e.user&&(e.user.birth_date&&e.user.gender||e.openUserDetailModal())}}}]),function(){"use strict";function e(e,t){var n=[{name:"login",url:"/login",templateUrl:"app/login/partials/login.html",controller:"login as vm"},{name:"bizlogin",url:"/bizlogin",templateUrl:"app/login/partials/bizlogin.html",controller:"bizlogin as vm"},{name:"register",url:"/register",templateUrl:"app/login/partials/register.html",controller:"register as  vm"}];$(n).each(function(){e.state(this)})}angular.module("login").config(["$stateProvider","$urlRouterProvider",e])}(),function(){"use strict";function e(e,t,n){function a(e,t){"#"!=e.charAt(0)&&("red"==e?e="#ff0000":"black"==e?e="#000000":"grey"==e||"gray"==e?e="#808080":"lightgrey"==e||"lightgray"==e?e="#d3d3d3":"darkgrey"==e||"darkgray"==e?e="#a9a9a9":"green"==e?e="#008000":"brown"==e?e="#a52a2a":"blue"==e?e="#0000ff":"white"==e?e="#ffffff":n.DEBUG_MODE&&console.log("Dont know what color is ",e));var a=parseInt(e.slice(1),16),o=t<0?0:255,s=t<0?-1*t:t,r=a>>16,i=a>>8&255,c=255&a;return"#"+(16777216+65536*(Math.round((o-r)*s)+r)+256*(Math.round((o-i)*s)+i)+(Math.round((o-c)*s)+c)).toString(16).slice(1)}function o(e){var t,n,a,o,r,i,c,l,d;return l=e.match(/hsla?\((.+?)\)/)[1].split(",").map(function(e){return e.trim(),parseFloat(e)}),a=l[0],d=l[1],o=l[2],l[3],a/=360,d/=100,o/=100,0===d?c=n=t=o:(i=o<.5?o*(1+d):o+d-o*d,r=2*o-i,c=s(r,i,a+1/3),n=s(r,i,a),t=s(r,i,a-1/3)),"#"+Math.round(255*c).toString(16)+Math.round(255*n).toString(16)+Math.round(255*t).toString(16)}function s(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+(t-e)*(2/3-n)*6:e}function r(e){var t="",n="";return void 0!=e.tags&&null!=e.tags||(e.tags=""),e.tags.indexOf("food")>-1?(t="brown",n="#f8f8ff"):e.tags.indexOf("lifestyle")>-1?(t="#008080",n="#f8f8ff"):e.tags.indexOf("social")>-1?(t="#4682b4",n="#f8f8ff"):e.tags.indexOf("city")>-1?(t="gray",n="#f8f8ff"):e.tags.indexOf("neighborhood")>-1?(t="gray",n="#f8f8ff"):e.tags.indexOf("politics")>-1?(t="#595959",n="#f8f8ff"):e.tags.indexOf("sports")>-1?(t="#4682b4",n="#f8f8ff"):e.tags.indexOf("beauty")>-1?(t="#a3297a",n="#f8f8ff"):e.tags.indexOf("health")>-1?(t="green",n="#f8f8ff"):e.tags.indexOf("services")>-1?(t="#c68c53",n="#f8f8ff"):e.tags.indexOf("technology")>-1?(t="gray",n="#f8f8ff"):e.tags.indexOf("dating")>-1?(t="#b22222",n="#f8f8ff"):e.tags.indexOf("personalities")>-1?(t="#c68c53",n="#f8f8ff"):(t="gray",n="#f8f8ff"),[t,n]}return{shadeColor:a,hsl2rgb:o,hue2rgb:s,defaultRankColor:r}}angular.module("app").factory("color",e),e.$inject=["$http","$q","$rootScope"]}(),function(){"use strict";function e(e,t,n){function a(n){function a(e){return r=e.data.resource}if(o()&&!n)return t.when(r);var c=i;return e.get(c).then(a,s)}function o(){return r.length>0}function s(e){throw e}var r=[],i="/api/v2/mysql/_table/cities";return{getCities:a}}angular.module("app").factory("city",e),e.$inject=["$http","$q","$rootScope"]}(),function(){"use strict";function e(e,t,n,a,o,s,r,i,c,l,d,u){function g(){t.$emit("hideBar"),$(".navbar-collapse").collapse("hide"),a.go("mybusiness"),$(".navbar-collapse").collapse("hide")}function m(){t.$emit("hideBar"),$(".navbar-collapse").collapse("hide"),a.go("favs")}function p(){t.$emit("hideBar"),$(".navbar-collapse").collapse("hide"),a.go("promoterconsole"),$(".navbar-collapse").collapse("hide")}function f(){t.$emit("hideBar"),$(".navbar-collapse").collapse("hide"),a.go("about")}function h(){a.go("fileuploadtest")}function v(){t.$emit("hideBar"),$(".navbar-collapse").collapse("hide"),a.go("admin")}function b(){t.fbmode=!0,a.go("cwrapper",{},{reload:!0})}function w(){l.tour(),$(".navbar-collapse").collapse("hide")}function y(){l.getDialog("onlySanDiego")}function x(){t.$emit("backToResults")}function k(){a.go("customer")}function D(){t.stateName=a.current.name,"rankSummary"==t.stateName?t.stateNum=t.cCategory.id:"answerDetail"==t.stateName?t.stateNum=t.canswer.id:t.stateNum=void 0,l.loginFacebook()}function E(){n.logout().then(function(){B.user="",B.isLoggedIn=!1,B.hasBusiness=!1,B.isPromoter=!1,localStorage.clear(),t.$emit("backToResults"),t.$emit("userLoggedOut")})}function O(){openModal("#selectCityModal")}function C(e){t.DEBUG_MODE&&console.log("position.coords.latitude - ",e.coords.latitude),t.DEBUG_MODE&&console.log("position.coords.longitude - ",e.coords.longitude),t.currentUserLatitude==e.coords.latitude&&t.currentUserLongitude==e.coords.longitude||(t.newCoords=!0),t.currentUserLatitude=e.coords.latitude,t.currentUserLongitude=e.coords.longitude,r.put("currentUserLatitude",t.currentUserLatitude),r.put("currentUserLongitude",t.currentUserLongitude),t.coordsRdy=!0,M(),t.isLoggedIn&&(t.user.latitude=t.currentUserLatitude,t.user.longitude=t.currentUserLongitude,t.DEBUG_MODE&&console.log("Geo Location is set for logged in user.")),t.DEBUG_MODE&&console.log("Geo Location is set for user."),"rankSummary"==a.current.name&&t.$emit("coordsRdy")}function R(){t.DEBUG_MODE&&console.log("@autoDetectCity"),geolocator.locate(L,function(e,n){e?(t.DEBUG_MODE&&console.log("Error getting geolocation - ERROR("+e.code+"): "+e.message),l.getDialog("errorGettingGeolocation")):(t.DEBUG_MODE&&console.log(n),C(n))})}function _(){geolocator.config({language:"en",google:{version:"3",key:c}}),L={enableHighAccuracy:!0,timeout:1e4,maximumWait:1e4,maximumAge:0,desiredAccuracy:30,fallbackToIP:!0}}function A(){B.warning=!0}function S(){B.warning=!1}function M(){B.coordsRdy=!0}function P(){var e=t.answers.map(function(e){return e.id}).indexOf(t.useraccnts[0].answer);l.askEmail(t.answers[e].name)}function I(){l.askPermissionToLocate()}var B=this;B.title="navbar",B.user=t.user,B.isLoggedIn=!!t.isLoggedIn&&t.isLoggedIn,B.logout=E,B.goToLogin=D,B.gotoAbout=f,B.gotomybusiness=g,B.gotofavs=m,B.gotoFeedback=b,B.gotoTour=w,B.gotoHome=x,B.selCity=y,B.gotoAdmin=v,B.goPromoterConsole=p,B.gotoFileUpload=h,B.gotoCustomer=k,B.openCitySelection=O,B.goWarning=P,B.goCoords=I,B.isAdmin=t.isAdmin||t.dataAdmin||t.modAdmin,void 0==t.coordsRdy&&(t.coordsRdy=!1);var L={};B.warning=!1;var U=t.$on("getLocation",function(e){R()}),T=t.$on("coordsRdy",function(e){M()}),G=t.$on("adminCredentials",function(e){B.isAdmin=t.isAdmin||t.dataAdmin||t.modAdmin}),V=t.$on("showWarning",function(e){t.DEBUG_MODE&&console.log("rx showWarning"),A()}),N=t.$on("hideWarning",function(e){t.DEBUG_MODE&&console.log("rx clearWarning"),S()}),F=t.$on("useAddress",function(e,n){var a={};a.location=n.address,a.lat=0,a.lng=0,t.coordForUSer=!0,d.getLocationGPS(a)}),q=t.$on("userDataLoaded",function(e){t.isLoggedIn?(B.isPromoter=!0,t.isPromoter=!0,t.DEBUG_MODE&&console.log("User is promoter")):(t.isPromoter=!1,B.isPromoter=!1)}),Y=t.$on("userAccountsLoaded",function(e){t.isLoggedIn&&t.useraccnts.length>0?(B.hasBusiness=!0,t.hasBusiness=!0,t.DEBUG_MODE&&console.log("User has business")):(t.hasBusiness=!1,B.hasBusiness=!1)});o.$on("$destroy",U),o.$on("$destroy",T),o.$on("$destroy",G),o.$on("$destroy",V),o.$on("$destroy",N),o.$on("$destroy",F),o.$on("$destroy",q),o.$on("$destroy",Y),function(){void 0==t.hasBusiness?B.hasBusiness=!1:B.hasBusiness=t.hasBusiness,void 0==t.isPromoter?B.isPromoter=!1:B.isPromoter=t.isPromoter,t.showWarning&&A(),_(),B.coordsRdy=t.coordsRdy,t.isAdmin=!1,t.dataAdmin=!1,t.isLoggedIn&&("1599427743409374"==t.user.id&&(t.dataAdmin=!0),"10104518570729893"==t.user.id&&(t.isAdmin=!0),"10214255239240099"==t.user.id&&(t.contentAdmin=!0),"1638806919478345"==t.user.id&&(t.modAdmin=!0),B.isAdmin=t.isAdmin||t.dataAdmin||t.modAdmin),t.DEBUG_MODE&&console.log("Navbar Loaded!")}(),t.getCurrentPositionOfUser=function(){geolocator.locate(L,function(e,n){e?(t.DEBUG_MODE&&console.log("Error getting geolocation - ERROR("+e.code+"): "+e.message),l.getDialog("errorGettingGeolocation")):(t.DEBUG_MODE&&console.log(n),C(n))})}}angular.module("app").controller("navbar",e),e.$inject=["$location","$rootScope","login","$state","$scope","city","$cookies","$http","GOOGLE_API_KEY","dialog","getgps","useraccnt"]}(),function(){"use strict";function e(e,t,n,a,o,s,r,i,c,l,d,u,g,m,p,f,h,v,b,w,y,x,k,D,E,O,C,R,_,A){function S(){o.get("../../../assets/fields.json").then(function(e){t.typeSchema=e.data,M()});o.get("../../../assets/dialogs.json").then(function(e){t.dialogs=e.data})}function M(){W(),_.getSetting()}function $(){void 0==t.pageDataLoaded&&(t.pageDataLoaded=!1),void 0==t.userDataLoaded&&(t.userDataLoaded=!1),window.location.href.indexOf("rankSummary")>-1?t.dataIsLoaded=t.userDataLoaded:window.location.href.indexOf("answerDetail")>-1?t.dataIsLoaded=t.userDataLoaded:(t.dataIsLoaded=t.initalHomeDataLoaded,C.go("cwrapper")),Z.isLoading=!t.dataIsLoaded,t.DEBUG_MODE&&console.log("@loadingDone - $rootScope.dataIsLoaded -",t.dataIsLoaded),t.DEBUG_MODE&&console.log("@loadingDone - $rootScope.pageDataLoaded -",t.pageDataLoaded),t.DEBUG_MODE&&console.log("@loadingDone - $rootScope.userDataLoaded -",t.userDataLoaded)}function P(){var e=navigator.userAgent||navigator.vendor||window.opera;return e.indexOf("FBAN")>-1||e.indexOf("FBAV")>-1}function I(){Z.childActive=!0,Z.barIsActive=!1,C.go("privacypolicy")}function B(){Z.childActive=!0,Z.barIsActive=!1,C.go("rodconsole")}function L(){1==Z.val.length&&(Z.showans=!0),t.searchActive=!0,Z.searchActive=t.searchActive,Z.childActive=!t.searchActive,t.isqf=!1}function U(){Z.searchActive=!1,Z.childActive=!0,Z.barIsActive=!1}function T(){Z.searchActive=!0,Z.childActive=!1,Z.barIsActive=!0,"cwrapper"==C.current.name&&(Z.val="")}function G(){Z.childActive=!1,Z.barIsActive=!0,t.cCategory=void 0,"cwrapper"==C.current.name&&(Z.val=""),C.go("cwrapper"),void 0!=t.inputVal&&""!=t.inputVal&&(t.searchActive=!0,Z.searchActive=!0,Z.childActive=!1),c(function(){n.scrollTo(0,t.pageYOffset)})}function V(){t.isLoggedIn?(Z.childActive=!0,Z.barIsActive=!1,t.cCategory=void 0,C.go("addCustomRank")):b.loginFacebook()}function N(){t.editMode=!0,Z.selEditRank="active",Z.selViewRank="",t.DEBUG_MODE&&console.log("$rootScope.editMode -- ",t.editMode)}function F(){t.editMode=!1,Z.selEditRank="",Z.selViewRank="active"}function q(){t.$emit("applyRule")}function Y(e){Z.showans=!1,"Neighborhood"==e||e==Z.nh?(0==Z.nhctrl?Z.nhctrl=!0:Z.nhctrl=!1,1==Z.nhctrl&&(Z.nhops=t.nhs)):""==Z.nh?Z.val=e:Z.val=Z.nh+" "+e,t.isqf=!0}function z(){if(Z.nhops.indexOf(Z.nhinp)>-1){Z.nh=Z.nhinp,Z.nhctrl=!1,Z.val=Z.nh;var e=Z.buts.indexOf("Neighborhood");Z.buts[e]=Z.nh}}function j(){var e=Z.buts.indexOf(Z.nh);Z.buts[e]="Neighborhood",Z.nhinp="",Z.nh="",Z.nhctrl=!1,Z.val=""}function X(){t.DEBUG_MODE&&console.log("@prepareNewCatansOptions - $rootScope.content.length ",t.content.length),t.ctsOptions=[];for(var e=0;e<t.categories.length;e++)t.ctsOptions.push(t.categories[e].category)}function W(){window.location.href.indexOf("rankSummary")>-1&&window.location.href.indexOf("food-near-me")<0?(Z.childActive=!0,Z.barIsActive=!1):window.location.href.indexOf("answerDetail")>-1?(Z.childActive=!0,Z.barIsActive=!1):(t.SCOPE=2,R.getInitialData(),t.childActive=!1)}function K(){Z.childActive=!0,Z.barIsActive=!1,t.cCategory=void 0,C.go("trends")}function H(){Z.buts=["Food","Coffee","Activities","Nightlife","Shopping","Beauty","Events","Health","Fitness","Sports","Services","Neighborhood","Culture","People","City","Family","Groups","Technology","Religion","Pets","Home","Cars"],Z.bi=0}function J(){(t.DISPLAY_XSMALL||t.DISPLAY_SMALL)&&(Z.bi=Z.bi+=8,Z.bi+8>Z.buts.length&&(Z.bi=Z.buts.length-8)),(t.DISPLAY_MEDIUM||t.DISPLAY_LARGE)&&(Z.bi=Z.bi+=14,Z.bi+14>Z.buts.length&&(Z.bi=Z.buts.length-14))}function Q(){(t.DISPLAY_XSMALL||t.DISPLAY_SMALL)&&(Z.bi=Z.bi-=8,Z.bi<0&&(Z.bi=0)),(t.DISPLAY_MEDIUM||t.DISPLAY_LARGE)&&(Z.bi=Z.bi-=14,Z.bi<0&&(Z.bi=0))}var Z=this;Z.title="layout",Z.header="",i.$parent.seo={pageTitle:"Rank-X",metaDescription:"Rank-X creates collective rankings on everything in your city."},Z.veilMsg="Just a moment, loading the best information about San Diego",Z.hidelogo=!1,Z.getResults=L,Z.hideSearch=U,Z.gotoHome=T,Z.goAddRank=V,Z.quickFilter=Y,Z.buttonsFwd=J,Z.buttonsPrev=Q,Z.foodNearMe=!1,-1!=n.location.href.indexOf("rankSummary/food-near-me-9521")&&(Z.foodNearMe=!0,Z.veilMsg="Just a moment, finding some delicious food..."),Z.dataready=!1,Z.initready=!1,Z.barIsActive=!0,Z.childActive=!1,Z.rodready=!1,Z.showans=!1,Z.editRank=N,Z.viewRank=F,Z.applyRule=q,Z.selCityActive=!1,Z.selectNh=z,Z.clearNh=j,Z.nhctrl=!1,Z.nh="",Z.showTrends=K,Z.goPrivacyPolicy=I,Z.goRankofDayConsole=B,t.inputVal=Z.val,jQuery(document).ready(function(){jQuery(window).scroll(function(){jQuery(this).scrollTop()>250?jQuery(".back-to-top").fadeIn(300):jQuery(".back-to-top").fadeOut(300)}),jQuery(".back-to-top").click(function(e){return e.preventDefault(),jQuery("html, body").animate({scrollTop:0},300),!1})}),Z.showFilters=!1,Z.toggleFilterBox=function(){Z.showFilters=!Z.showFilters},Z.hideFilterBox=function(){Z.showFilters=!1};var ee=t.$on("refreshRanks",function(){"cwrapper"==C.current.name&&(Z.hidelogo=t.hidelogo)}),te=t.$on("showLogo",function(){"rankSummary"==C.current.name||C.current.name}),ne=t.$on("userDataLoaded",function(){t.DEBUG_MODE&&console.log("RX - userDataLoaded"),$()}),ae=t.$on("homeDataLoaded",function(){t.DEBUG_MODE&&console.log("RX - homeDataLoaded"),Z.isLoading=!1,Z.dataready=!0,X(),t.isLoggedIn&&v.pullFavoriteData()}),oe=t.$on("rankDataLoaded",function(){t.DEBUG_MODE&&console.log("RX - rankDataLoaded"),1!=t.initalHomeDataLoaded&&(R.getInitialData(),t.isLoggedIn&&v.pullFavoriteData()),$()}),se=t.$on("answerDataLoaded",function(){t.DEBUG_MODE&&console.log("RX - answerDataLoaded"),1!=t.initalHomeDataLoaded&&(R.getInitialData(),t.isLoggedIn&&v.pullFavoriteData()),$()}),re=t.$on("initalHomeDataLoaded",function(){t.DEBUG_MODE&&console.log("RX - initialHomeLoaded"),t.initalHomeDataLoaded=!0,Z.initready=!0,$()}),ie=t.$on("mainView",function(e){Z.childActive=!1,T()}),ce=t.$on("hideBar",function(e){Z.childActive=!0,Z.barIsActive=!1}),le=t.$on("backToResults",function(e){G()}),de=t.$on("userLoggedOut",function(e){Z.isAdmin=!1}),ue=t.$on("rodReady",function(e){Z.rodready=!0,void 0!=t.rankofday&&(t.DEBUG_MODE&&console.log("$rootScope.rankofday - ",t.rankofday),R.pulldata("ranks",t.rankofday))});t.$on("$locationChangeSuccess",function(){window.location.href.indexOf("home")>-1&&(Z.childActive=!1,Z.barIsActive=!0),window.location.href.indexOf("rankSummary")>-1&&(Z.childActive=!0,Z.barIsActive=!1),window.location.href.indexOf("answerDetail")>-1&&(Z.childActive=!0,Z.barIsActive=!1),window.location.href.indexOf("trends")>-1&&(Z.childActive=!0,Z.barIsActive=!1)});i.$on("$destroy",de),i.$on("$destroy",le),i.$on("$destroy",ce),i.$on("$destroy",ie),i.$on("$destroy",re),i.$on("$destroy",se),i.$on("$destroy",oe),i.$on("$destroy",ae),i.$on("$destroy",ne),i.$on("$destroy",te),i.$on("$destroy",ee),i.$on("$destroy",ue),n.innerWidth<512?(Z.logoimage="/assets/images/rankxlogosd2_sm.png",t.sm=!0,Z.sm=!0,t.DISPLAY_XSMALL=!0,t.numInitItems=12):(Z.logoimage="/assets/images/rankxlogosd2_sm.png",t.sm=!1,Z.sm=!1),n.innerWidth>=512&&n.innerWidth<768&&(t.DISPLAY_SMALL=!0,t.numInitItems=12),t.md=!1,n.innerWidth>=768&&n.innerWidth<991&&(t.md=!0,t.DISPLAY_MEDIUM=!0,t.numInitItems=16),n.innerWidth>991&&(t.DISPLAY_LARGE=!0,t.numInitItems=24),t.$on("$stateChangeSuccess",function(e,n,a,o,s){Z.hideFilterBox(),t.previousState=o.name});var ge=r.get("tourviewed");void 0==ge&&(ge=!1),function(){t.isAdmin=!1,t.dataAdmin=!1,t.isLoggedIn&&("1599427743409374"==t.user.id&&(t.dataAdmin=!0),"10104518570729893"==t.user.id&&(t.isAdmin=!0),
"10214255239240099"==t.user.id&&(t.contentAdmin=!0),"1638806919478345"==t.user.id&&(t.modAdmin=!0)),Z.isAdmin=t.isAdmin||t.contentAdmin,t.$emit("adminCredentials"),t.DEBUG_MODE=l,t.EMPTY_IMAGE=d,t.facebookAppId="",t.facebookUrl="https://www.facebook.com/Rank-X-San-Diego-582174448644554",void 0==t.dataIsLoaded?(Z.isLoading=!0,S()):M(),H(),v.loadUserData(),v.loadUserAccount(),t.isFacebookApp=P(),t.DEBUG_MODE&&console.log("Layout Loaded!")}()}angular.module("app").controller("layout",e),e.$inject=["$location","$rootScope","$window","$q","$http","pvisits","$cookies","$scope","$timeout","DEBUG_MODE","EMPTY_IMAGE","rankofday","answer","table","special","datetime","uaf","userdata","dialog","matchrec","edit","useractivity","vrows","headline","cblock","catans","$state","dataloader","setting","filter"]}(),function(){"use strict";function e(e,t,n,a,o,s,r,i,c,l,d,u,g,m,p,f,h,v,b){function w(){_.scrollDataLoading=!0,f(function(){_.currentIndex+_.loadingCountOneScroll>_.scrollingData.length-1&&(_.current=_.scrollingData.length,_.endReached=!0),_.currentIndex+=_.loadingCountOneScroll,_.currentIndex-_.startIndex>_.scrollingItemsOnePage&&(_.startIndex=_.currentIndex-_.scrollingItemsOnePage),_.scrollDataLoading=!1},500)}function y(){_.startIndex>=3&&(_.startIndex-=3,_.currentIndex-=3)}function x(t){1==t&&(_.isNh=!1,_.isCity=!0,e.isNh=!1,e.isCity=!0,e.$emit("loadNh"),_.searchScope="all San Diego",_.ranks=e.cityranks,_.querybc="white"),2==t&&(_.isNh=!0,_.isCity=!1,e.isNh=!0,e.isCity=!1,_.val="",e.searchActive=!1,e.isNhRdy&&e.$emit("loadNh"),_.searchScope="Neighborhood",_.ranks=e.nhranks,_.querybc="#428bca"),_.searchActive=e.searchActive}function k(t){e.cnh=t,_.cnh=t,_.isNhRdy=!0,e.isNhRdy=_.isNhRdy,_.inputVal="",_.searchActive=!1,e.$emit("loadNh"),_.searchScope=t,_.val="",$("#nhdropdown").dropdown("toggle")}function D(){for(var n=!1,a=0,o=e.content.length-1;!n;)a=Math.floor(Math.random()*(o-0+1))+0,e.content[a].ismp&&(n=!0);t.go("rankSummary",{index:e.content[a].id})}function E(){t.go("rankSummary",{index:6949})}function O(){_.val=""}function C(e){t.go("answerDetail",{index:e.answer})}function R(e){t.go("rankSummary",{index:e.category})}var _=this;o.$parent.$parent.$parent.seo={pageTitle:"",metaDescription:"Rank-X creates collective rankings on everything in your city. Find the best restaurants, services, activities, events, places, events and more."};var A={};A.get=function(e,t,n){f(function(){for(var a=[],o=e;o<=e+t-1;o++)a.push("item #"+o);n(a)},100)},_.sm=e.sm,_.md=e.md,_.datasource=A,f(function(){var e=$("#facebook-container").width();$("#facebook-display").html(""),$("#facebook-display").html('<div class="fb-page"                 ng-if="vm.pageDataLoaded"                           data-href="https://www.facebook.com/rankxsandiego/"                  data-tabs="timeline"                  data-height="70"                 data-width="'+e+'"                 data-small-header="false"                  data-adapt-container-width="true"                  data-hide-cover="false"                 data-show-facepile="true">                     <blockquote cite="https://www.facebook.com/rankxsandiego/" class="fb-xfbml-parse-ignore">                    <a href="https://www.facebook.com/rankxsandiego/">Rank-X San Diego</a></blockquote>            </div>'),FB.XFBML.parse()},2e3),_.title="cwrapper",_.switchScope=x,void 0==e.hidelogo?_.hidelogo=!1:_.hidelogo=e.hidelogo,_.events=E,_.selfimprove=D,_.selnh=k,_.goHome=O,_.gotoAnswer=C,_.gotoRank=R,e.editMode=!1,_.content=[],_.emptyspace="",_.fbm=!!e.fbmode;var S=e.$on("mainView",function(e){"cwrapper"==t.current.name&&O()});_.loadMore=w,_.showLess=y,e.$on("filterOptionChanged",function(){}),e.$on("initalHomeDataLoaded",function(){}),e.$on("homeDataLoaded",function(){_.content=angular.copy(e.content)}),o.$on("$destroy",S),window.prerenderReady=!1}angular.module("app").controller("cwrapper",e),e.$inject=["$rootScope","$state","$http","$stateParams","$scope","query","table","dialog","uaf","$window","userdata","$location","color","fbusers","$q","$timeout","filter","search","mailing"]}(),function(){"use strict";function e(e,t,n,a){function o(n){function a(e){return d(e.data.resource),m}if(u()&&!n)return t.when(m);var o=h;return e.get(o).then(a,g)}function s(a){function o(e){n.DEBUG_MODE&&console.log("specialsX data loaded");var t=e.data.resource,a=m.map(function(e){return e.id});return t.forEach(function(e){a.indexOf(e.id)<0&&m.push(e)}),t}var s=[];if(a.forEach(function(e){p.indexOf(e.answer)<0&&(s.push(e),p.push(e.answer))}),0==s.length)return t.when(!1);for(var r="?filter=(",i=0;i<s.length;i++)r=r+"answer="+s[i].answer+")OR(";r=r.substring(0,r.length-3);var c=h+r;return e.get(c).then(o,g)}function r(t){function a(e){var t=e.data.resource,a=m.map(function(e){return e.id});return t.forEach(function(e){a.indexOf(e.id)<0&&m.push(e)}),f=t,n.DEBUG_MODE&&console.log("gotSpecial for answer! ",f),t}var o=h+"/?filter=answer="+t;return e.get(o).then(a,g)}function i(t){function a(e){var a=t;return a.id=e.data.resource[0].id,m.length>0&&m.push(a),f.length>0&&f.push(a),n.DEBUG_MODE&&console.log("result",e),e.data}var o=h,s=[];return s.push(t),e.post(o,s,{headers:{"Content-Type":"multipart/form-data"},body:s}).then(a,g)}function c(t,a,o){function s(e){return n.DEBUG_MODE&&console.log("updating special succesful"),e.data}var r={};r.resource=[];var i={};i.id=t;for(var c=0;c<a.length;c++)i[a[c]]=o[c];r.resource.push(i);for(var l=h,d=m.map(function(e){return e.id}).indexOf(t),c=0;c<a.length;c++)m[d][a[c]]=o[c];for(var u=f.map(function(e){return e.id}).indexOf(t),c=0;c<a.length;c++)f[u][a[c]]=o[c];return e.patch(l,r,{headers:{"Content-Type":"multipart/form-data"},body:r}).then(s,g)}function l(t){function n(e){return-1!=r.indexOf("https://rankx.blob")&&a.deleteBlob(r),console.log("Deleting special was succesful"),e.data}var o={};o.resource=[];var s={};s.id=t,o.resource.push(s);var r,i=h+"/"+t;if(m.length>0){var c=m.map(function(e){return e.id}).indexOf(t);r=m[c].image,c>-1&&m.splice(c,1)}if(f.length>0){var c=f.map(function(e){return e.id}).indexOf(t);c>-1&&f.splice(c,1)}return e.delete(i,s,{headers:{"Content-Type":"multipart/form-data"},body:o}).then(n,g)}function d(e){m.length=0,e.forEach(function(e){m.push(e)})}function u(){return m.length>0}function g(e){throw e}var m=[],p=[];n.specials=m;var f=[],h="/api/v2/mysql/_table/specials";return{getSpecials:o,getSpecialsX:s,addSpecial:i,updateSpecial:c,deleteSpecial:l,getSpecialsbyAnswer:r}}angular.module("app").factory("special",e),e.$inject=["$http","$q","$rootScope","imagelist"]}(),function(){"use strict";function e(e){function t(e){if("onetime"==e.freq){n(e,"stime"),n(e,"etime");var t=new Date(e.sdate),a=t.toString();e.sdate=a.substring(0,15),t=new Date(e.edate),a=t.toString(),e.edate=a.substring(0,15)}"weekly"==e.freq&&(n(e,"stime2"),n(e,"etime2"))}function n(e,t){var n="";switch(t){case"stime":n=e.stime;break;case"etime":n=e.etime;break;case"stime2":n=e.stime2;break;case"etime2":n=e.etime2}if(null!=n&&void 0!=n&&(n.indexOf("00:00")>-1||n.indexOf("30:00")>-1)){n=n.replace("00:00","00"),n=n.replace("30:00","30");var a=parseInt(n.substring(0,2))<12;if(n+=a?" AM":" PM",!a){var o=parseInt(n.substring(0,2))-12,s="";s=o<10?"0"+o.toString():o.toString(),n=n.replace(n.substring(0,2),s)}}switch(t){case"stime":e.stime=n;break;case"etime":e.etime=n;break;case"stime2":e.stime2=n;break;case"etime2":e.etime2=n}}function a(e){var t=new Date(e),n=t.getFullYear().toString()+(t.getMonth()+1<10?"0"+(t.getMonth()+1).toString():(t.getMonth()+1).toString())+(t.getDate()<10?"0"+t.getDate().toString():t.getDate().toString());return Number(n)}function o(t){return a(t)-e.dateTodayNum>=0}function s(t,n){var o=0,s=!1,r=0,i=!1;if(void 0!=n.edate&&""!=n.edate&&(o=a(n.edate.slice(4)),s=!0),r=a(n.sdate.slice(4)),s)if(o>=e.dateTodayNum)if(i=!0,r>=e.dateTodayNum)t.date=n.sdate.slice(4);else{var c=new Date(e.dateToday),l=c.toString();t.date=l.substring(0,15).slice(4)}else i=!1,t.date=n.edate.slice(4);else r>=e.dateTodayNum?(i=!0,t.date=n.sdate.slice(4)):(i=!1,t.date=n.sdate.slice(4));return i}return{formatdatetime:t,formatTime:n,date2number:a,dateIsCurrent:o,eventIsCurrent:s}}angular.module("app").service("datetime",e),e.$inject=["$rootScope"]}(),function(){"use strict";function e(e,t,n,a,o,s){function r(){return e.get(w+"?order=views DESC&offset=0&limit=8&filter=ismp=1").then(function(e){n.initalHomeData=e.data.resource,s.saveInitalHomeData(n.initalHomeData),n.$emit("initalHomeDataLoaded")}),!0}function i(a){var o=w+"?offset=0",s=e.get(o);return t.all([s]).then(function(e){return f(e[0].data.resource),n.DEBUG_MODE&&console.log("tables length: ",v.length),v},h)}function c(a){var o=[];if(a.forEach(function(e){b.indexOf(e.answer)<0&&(o.push(e),b.push(e.answer))}),0==o.length)return t.when(!1);for(var s="?filter=(",r=0;r<o.length;r++)s=s+"owner="+o[r].answer+")OR(";s=s.substring(0,s.length-3);var i=w+s,c=e.get(i);return t.all([c]).then(function(e){var t=e[0].data.resource,a=v.map(function(e){return e.id});return t.forEach(function(e){a.indexOf(e.id)<0&&v.push(e)}),n.DEBUG_MODE&&console.log("getTablesX 'custom ranks' ",v.length),v},h)}function l(a){var o=[];if(a.forEach(function(e){b.indexOf(e.category)<0&&(o.push(e),b.push(e.category))}),0==o.length)return t.when(!1);for(var s="?filter=(",r=0;r<o.length;r++)s=s+"id="+o[r].category+")OR(";s=s.substring(0,s.length-3);var i=w+s,c=e.get(i);return t.all([c]).then(function(e){var t=e[0].data.resource,a=v.map(function(e){return e.id});return t.forEach(function(e){a.indexOf(e.id)<0&&v.push(e)}),n.DEBUG_MODE&&console.log("getTablesD 'custom ranks' ",v.length),v},h)}function d(a){var o=w+"/?filter=id="+a,s=e.get(o);return t.all([s]).then(function(e){var t=e[0].data.resource[0];return v.map(function(e){return e.id}).indexOf(t.id)<0&&v.push(t),n.DEBUG_MODE&&console.log("single table loaded: ",t),v},h)}function u(t){function a(e){var a=t;a.id=e.data.resource[0].id,v.push(a);var o=a.tags+" "+a.title;n.searchStr.push(o);var s=a.title.toLowerCase();return s=s.replace(/ /g,"-"),s=s.replace("/","at"),s=s.replace("?",""),s=s+"-"+e.data.resource[0].id,p(e.data.resource[0].id,["slug"],[s]),n.DEBUG_MODE&&console.log("result",e),e.data}t.isatomic=!0;var o=w,s=[];return s.push(t),e.post(o,s,{headers:{"Content-Type":"multipart/form-data"},body:s}).then(a,h)}function g(t,o,s){function r(e){var r=t;r.id=e.data.resource[0].id,v.push(r);var i=r.tags+" "+r.title;n.searchStr.push(i);var c=r.title.toLowerCase();c=c.replace(/ /g,"-"),c=c.replace("/","at"),c=c+"-"+e.data.resource[0].id,p(e.data.resource[0].id,["slug"],[c]);var l={};l.id=e.data.resource[0].id,l.bc=o[0],l.fc=o[1];var d="",u=[];return void 0!=n.canswer.ranks&&null!=n.canswer.ranks&&""!=n.canswer.ranks?(d=n.canswer.ranks,u=JSON.parse(d),u.push(l),d=JSON.stringify(u),a.updateAnswer(s,["ranks"],[d])):(d="["+JSON.stringify(l)+"]",a.updateAnswer(s,["ranks"],[d])),n.DEBUG_MODE&&console.log("result",e),e.data}t.isatomic=!0;var i=w,c=[];return c.push(t),e.post(i,c,{headers:{"Content-Type":"multipart/form-data"},body:c}).then(r,h)}function m(t){function a(e){return n.DEBUG_MODE&&console.log("Deleting table was succesful"),e.data}var o={};o.resource=[];var s={};s.id=t,o.resource.push(s);var r=w+"/"+t,i=v.map(function(e){return e.id}).indexOf(t);return i>-1&&v.splice(i,1),e.delete(r,s,{headers:{"Content-Type":"multipart/form-data"},body:o}).then(a,h)}function p(t,a,o){function s(e){return n.DEBUG_MODE&&console.log("updating ranking record succesful"),e.data}var r={};r.resource=[];var i={};i.id=t;for(var c=0;c<a.length;c++)i[a[c]]=o[c];r.resource.push(i);for(var l=w,d=v.map(function(e){return e.id}).indexOf(t),c=0;c<a.length;c++)v[d][a[c]]=o[c];return e.patch(l,r,{headers:{"Content-Type":"multipart/form-data"},body:r}).then(s,h)}function f(e){v.length=0,e.forEach(function(e){v.push(e)})}function h(e){throw e}var v=[],b=[];n.customranks=v;var w="/api/v2/mysql/_table/customranks";return{getTables:i,getTablesX:c,getTablesD:l,getSingleTable:d,update:p,addTable:u,addTableforAnswer:g,deleteTable:m,getMostPopularData:r}}angular.module("app").factory("table2",e),e.$inject=["$http","$q","$rootScope","answer","$state","filter"]}(),function(){"use strict";function e(e,t,n,a,o,s,r,i,c,l){function d(a){for(var o="?filter=(",s=0;s<a.length;s++)o=o+"id="+a[s]+")OR(";o=o.substring(0,o.length-3);var r=C+o+"&fields="+_,i=e.get(r);return t.all([i]).then(function(e){return k(e[0].data.resource),n.DEBUG_MODE&&console.log("_tables length after initialhomedata load: ",O.length),O},E)}function u(a){var o=C+"?offset=0&filter=scope="+a+"&fields="+_,s=C+"?offset=1000&filter=scope="+a+"&fields="+_,r=C+"?offset=2000&filter=scope="+a+"&fields="+_,i=C+"?offset=3000&filter=scope="+a+"&fields="+_,c=e.get(o),l=e.get(s),d=e.get(r),u=e.get(i);return t.all([c,l,d,u]).then(function(e){return x(e[0].data.resource.concat(e[1].data.resource,e[2].data.resource,e[3].data.resource)),n.DEBUG_MODE&&console.log("tables length: ",O.length),O},E)}function g(a){for(var o="?filter=(",s=0;s<a.length;s++)o=o+"id="+a[s].category+")OR(";o=o.substring(0,o.length-3);var r=C+o+"&fields="+_,i=e.get(r);return t.all([i]).then(function(e){var t=e[0].data.resource;return x(t),n.DEBUG_MODE&&console.log("tables L length: ",O.length),t},E)}function m(a){var o=C+"?offset=0",s=C+"?offset=1000",r=C+"?offset=2000",i=C+"?offset=3000",c=e.get(o),l=e.get(s),d=e.get(r),u=e.get(i);return t.all([c,l,d,u]).then(function(e){return x(e[0].data.resource.concat(e[1].data.resource,e[2].data.resource,e[3].data.resource)),n.DEBUG_MODE&&console.log("tables length: ",O.length),O},E)}function p(a){var o=C+"/?filter=id="+a+"&fields="+_,s=e.get(o);return t.all([s]).then(function(e){var t=e[0].data.resource[0];return k([t]),n.DEBUG_MODE&&console.log("single table loaded: ",t),t},E)}function f(t){function a(e){var a=t;a.id=e.data.resource[0].id;var o=n.categories.map(function(e){return e.id}).indexOf(a.cat),s=n.categories[o],i=n.locations.map(function(e){return e.id}).indexOf(a.nh),c=n.locations[i],l=s.category.replace("@Nh",c.nh_name);a.title=l,a.fimage=s.fimage,a.tags=s.tags,a.keywords=s.keywords,a.fc=s.fc,a.bc=s.bc,a.shade=s.shade,a.type=s.type,a.user=n.user.id,a.introtext=s.introtext;var d=a.tags+" "+a.title;n.searchStr.push(d);var u=a.title.toLowerCase();return u=u.replace(/ /g,"-"),u=u.replace("/","at"),u=u.replace("?",""),u=u+"-"+e.data.resource[0].id,a.slug=u,O.push(a),w(e.data.resource[0].id,["slug"],[u]),r.post("addedRank",["category"],[a.id]),n.DEBUG_MODE&&console.log("result",e),e.data.resource[0].id}t.scope=n.SCOPE;var o=C,s=[];return s.push(t),e.post(o,s,{headers:{"Content-Type":"multipart/form-data"},body:s}).then(a,E)}function h(e,n){console.log("addGhostTableWithAnswer ",e,n);var o=[],s=[],r=[],i=[];return s.push(a.addAnswer(n,[])),e.forEach(function(e){e.isghost?(r.push(e),s.push(f(e))):o.push(e.id)}),t.all(s).then(function(e){var t=e[0].resource[0].id;console.log("answer id - ",t);for(var n=1;n<e.length;n++)o.push(e[n]),i.push(e[n]);return v(r,i),console.log("tids - ",o),o.forEach(function(e){c.postRec2(t,e)}),e})}function v(e,t){console.log("@ _updateCatstr ",e,t);for(var n=[],a="",o=0;o<e.length;o++)n=[],a="",O.forEach(function(s){if(s.cat==e[o].cat&&1==s.nh){console.log("Found parent rank"),n=s.catstr.split(":").map(Number),n.push(t[o]),a="";for(var r=0;r<n.length;r++)a=a+":"+n[r];a=a.substring(1),console.log("updated catstr for table - ",s.id),w(s.id,["catstr"],[a])}})}function b(t){function a(e){var a="rank"+t+".html",o={};return o.filename=a,l.removeFile(o),n.DEBUG_MODE&&console.log("Deleting table was succesful"),e.data}var o={};o.resource=[];var s={};s.id=t,o.resource.push(s);var r=C+"/"+t,i=O.map(function(e){return e.id}).indexOf(t);return i>-1&&O.splice(i,1),e.delete(r,s,{headers:{"Content-Type":"multipart/form-data"},body:o}).then(a,E)}function w(t,a,o){function s(e){return n.updated_rank_id=e.data.resource[0].id,n.DEBUG_MODE&&console.log("updating ranking record succesful"),e.data}var r={};r.resource=[];var i={};i.id=t;for(var c=0;c<a.length;c++)i[a[c]]=o[c];r.resource.push(i);for(var l=C,d=O.map(function(e){return e.id}).indexOf(t),c=0;c<a.length;c++)O[d][a[c]]=o[c];return e.patch(l,r,{headers:{"Content-Type":"multipart/form-data"},body:r}).then(s,E)}function y(e){var t=[],n=0;e.forEach(function(e){(n=O.map(function(e){return e.id}).indexOf(e))>-1&&t.push(O[n])}),i.localStorage.setItem("Ranks-HomeData",JSON.stringify(t))}function x(e){O.length=0,e.forEach(function(e){O.push(e)}),D()}function k(e){e.forEach(function(e){O.map(function(e){return e.id}).indexOf(e.id)<0&&O.push(e)})}function D(){var e={};e.title="Food Near Me",e.slug="food-near-me",e.tags="food",e.type="Establishment",e.bc="gray",e.fc="#f8f8ff",e.shade=4,e.introtext="These are some great food places near you.",e.fimage="https://rankx.blob.core.windows.net/sandiego/featuredImages/food-near-me-1490.jpg",e.isfoodnearme=!0,void 0==n.fnm&&O.push(e),n.fnm=e}function E(e){throw e}var O=[];n.content=O;var C="/api/v2/mysql/_table/ranking",R={getTables:m,getSingleTable:p,update:w,addTable:f,deleteTable:b,getTablesX:u,getTablesL:g,getInitialHomeData:d,ghostTablesWithAnswer:h,storeInitialHomeData:y},_="";return _+="id,type,tags,keywords,question,image1url,image2url,image3url,",_+="catstr,owner,slug,views,answers,numcom,scope,isatomic,ismp,cat,nh,timestmp",R}angular.module("app").factory("table",e),e.$inject=["$http","$q","$rootScope","answer","$state","filter","uaf","$window","catans","staticpages"]}(),function(){"use strict";function e(e){function t(t){var n="",a="",o=[],s=t,r=!1,i="";if(s&&s.length>=3)for(var c=s,l=c.split(" "),d=0;d<e.answers.length;d++){i=e.answers[d].name,r=!0;for(var u=0;u<l.length;u++){n=l[u].charAt(0).toUpperCase()+l[u].slice(1),a=l[u].charAt(0).toLowerCase()+l[u].slice(1);var g=!1,m=i.toLowerCase().split(" ").filter(function(e){return e==l[u].toLowerCase()});m.length>=1&&(g=!0),r=r&&(i.indexOf(l[u])>-1||i.indexOf(l[u].toUpperCase())>-1||i.indexOf(n)>-1||i.indexOf(a)>-1||g)}r&&(e.isNh?e.answers[d].cityarea==e.cnh&&o.push(e.answers[d]):o.push(e.answers[d]))}return o}function n(t,n){var a="",o="",s=[],r="",i=n;if(i){for(var c=i,l=[],d=!0,u=c.split(" "),g=0;g<e.searchStrContent.length;g++){r=e.searchStrContent[g],e.content[g],d=!0;for(var m=0;m<u.length;m++)a=u[m].charAt(0).toUpperCase()+u[m].slice(1),o=u[m].charAt(0).toLowerCase()+u[m].slice(1),r||console.log(g),d=d&&(r.indexOf(u[m])>-1||r.indexOf(u[m].toUpperCase())>-1||r.indexOf(a)>-1||r.indexOf(o)>-1);d&&t?e.content[g].mp&&l.push(e.content[g]):d&&l.push(e.content[g])}s=l}return s}function a(t,n){function a(e,t){return t.ctr-e.ctr}var o=[],s=[],r=[],i=!1,c="",l=0,d={};t.isatomic?r.push(t.id):r=t.catstr.split(":").map(Number);for(var u=0,g=0;g<e.catansrecs.length;g++)for(var m=0;m<r.length;m++)if(e.catansrecs[g].category==r[m]){for(var p=0;p<e.catansrecs.length;p++)if(e.catansrecs[p].answer==e.catansrecs[g].answer&&(u=e.content.map(function(e){return e.id}).indexOf(e.catansrecs[p].category))>-1){i=!1;for(var f=0;f<o.length;f++)o[f].title.substr(0,6)==e.content[u].title.substr(0,6)&&(o[f].ctr++,i=!0);i||(d=e.content[u],d.ctr=1,o.push(d))}if(++l>=50)break}for(var g=0;g<o.length;g++)if(o[g].isatomic&&o[g].ismp&&s.push(o[g]),o[g].isatomic||1==t.nh){if(o[g].isatomic&&!o[g].ismp||!o[g].isatomic&&1!=o[g].nh)for(var p=0;p<e.locations.length;p++)if(o[g].title.indexOf(e.locations[p].nh_name)>-1){c=o[g].title.replace(e.locations[p].nh_name,n);for(var h=!1,f=0;f<e.content.length;f++)if(e.content[f].title==c){d=e.content[f],d.ctr=o[g].ctr,d.isghost=!1,s.push(d),h=!0;break}if(!h){e.DEBUG_MODE&&console.log("Couldnt find: ",c," made it ghost :)");var v={};v.title=c,v.cat=o[g].cat;var b=e.locations.map(function(e){return e.nh_name}).indexOf(n);v.nh=e.locations[b].id,v.isghost=!0,v.isatomic=!0,e.DEBUG_MODE&&console.log("ghost - ",v),s.push(v)}}}else s.push(o[g]);return s=s.sort(a),s.length>8?s.slice(0,8):s}function o(t){var n="",a="",o="",s="",i=[],c=["pb","ob","dt","mb"],l=["Pacific Beach","Ocean Beach","Downtown","Mission Beach"];if(!e.locations)return[];for(var d=e.locations.map(function(e){return e.nh_name}),u=0;u<l.length;u++){var g=d.indexOf(l[u]);if(-1!=g){var m=angular.copy(e.locations[g]);m.nh_short_name=c[u],i.push(m)}}var p=!1,f=[],h=t;if(h)if(h.indexOf("best")>-1&&(h=h.replace("best","")),h.indexOf("Best")>-1&&(h=h.replace("Best","")),h.indexOf("top")>-1&&(h=h.replace("top","")),h.indexOf("Top")>-1&&(h=h.replace("Top","")),h.indexOf("great")>-1&&(h=h.replace("great","")),h.indexOf("Great")>-1&&(h=h.replace("Great","")),h.indexOf("awesome")>-1&&(h=h.replace("awesome","")),h.indexOf("Awesome")>-1&&(h=h.replace("Awesome","")),h.indexOf("amazing")>-1&&(h=h.replace("amazing","")),h.indexOf("Amazing")>-1&&(h=h.replace("Amazing","")),h.indexOf("most")>-1&&(h=h.replace("most","")),h.indexOf("Most")>-1&&(h=h.replace("Most","")),h.indexOf("the ")>-1&&(h=h.replace("the ","")),h.indexOf("The ")>-1&&(h=h.replace("The ","")),h.indexOf("shops")>-1&&(h=h.replace("shops","")),h.indexOf("Shops")>-1&&(h=h.replace("Shops","")),h.indexOf("places")>-1&&(h=h.replace("places","")),h.indexOf("Places")>-1&&(h=h.replace("Places","")),h.indexOf("delicious")>-1&&(h=h.replace("delicious","")),h.indexOf("Delicious")>-1&&(h=h.replace("Delicious","")),h.indexOf("what ")>-1&&(h=h.replace("what ","")),h.indexOf("What ")>-1&&(h=h.replace("What ","")),h.indexOf("are ")>-1&&(h=h.replace("are ","")),h.indexOf("where ")>-1&&(h=h.replace("where ","")),h.indexOf("Where ")>-1&&(h=h.replace("Where ","")),h.length>=3){var v=h;v.indexOf("near me")>-1||v.indexOf("near")>-1||v.indexOf("close")>-1||v.indexOf("close to")>-1||v.indexOf("close to me")>-1?(!0,v=v.replace("near me","in San Diego"),v=v.replace("near","in San Diego"),v=v.replace("close to me","in San Diego"),v=v.replace("close to","in San Diego"),v=v.replace("close","in San Diego")):!1,"Food"==v&&(v=v.replace("Food","Food Near Me")),"food"==v&&(v=v.replace("food","Food Near Me")),e.isNh&&(v=v+" "+e.cnh);for(var b=[],w=[],y={},x=[],k=!0,D=!0,E=!1,O=[],C=v.toLowerCase().split(" "),R=0;R<C.length;R++){if(o=C[R].charAt(0).toUpperCase()+C[R].slice(1),s=C[R].charAt(0).toLowerCase()+C[R].slice(1),C[R].length>=3&&"car"!=C[R]&&"del"!=C[R]&&"bar"!=C[R])for(var _=0;_<e.locations.length;_++)(e.locations[_].nh_name.toLowerCase().indexOf(C[R])>-1||e.locations[_].nh_name.toLowerCase().indexOf(C[R].toUpperCase())>-1||e.locations[_].nh_name.indexOf(o)>-1||e.locations[_].nh_name.indexOf(s)>-1)&&(r(e.locations[_],O),E=!0,x.push(R));if(2==C[R].length)for(var _=0;_<i.length;_++)(i[_].nh_short_name.toLowerCase().indexOf(C[R])>-1||i[_].nh_short_name.toLowerCase().indexOf(C[R].toUpperCase())>-1||i[_].nh_short_name.indexOf(o)>-1||i[_].nh_short_name.indexOf(s)>-1)&&(r(i[_],O),E=!0,x.push(R))}x.push(C.indexOf("la"));for(var A=0;A<e.categories.length;A++)if(e.categories[A].category.indexOf("@Nh")>-1){a=e.searchStr[A],n=e.categories[A].category,e.categories[A],k=!0,D=!0;for(var R=0;R<C.length;R++)x.indexOf(R)<0&&(o=C[R].charAt(0).toUpperCase()+C[R].slice(1),s=C[R].charAt(0).toLowerCase()+C[R].slice(1),a||console.log(A),k=k&&(a.indexOf(C[R])>-1||a.indexOf(C[R].toUpperCase())>-1||a.indexOf(o)>-1||a.indexOf(s)>-1),D=D&&(n.indexOf(C[R])>-1||n.indexOf(C[R].toUpperCase())>-1||n.indexOf(o)>-1||n.indexOf(s)>-1));if(D){if(y={},y=JSON.parse(JSON.stringify(e.categories[A])),E)for(var S=0;S<O.length;S++)y={},y=JSON.parse(JSON.stringify(e.categories[A])),y.title=y.category.replace("@Nh",O[S].nh_name),y.locationId=O[S].id,y.useTemp=!0,w.push(y);else y.title=y.category.replace("@Nh","San Diego"),y.locationId=1,y.useTemp=!0,w.push(y);p=!0}else if(k)if(y={},y=JSON.parse(JSON.stringify(e.categories[A])),E)for(var S=0;S<O.length;S++)y={},y=JSON.parse(JSON.stringify(e.categories[A])),y.title=y.category.replace("@Nh",O[S].nh_name),y.locationId=O[S].id,y.useTemp=!0,b.push(y);else y.title=y.category.replace("@Nh","San Diego"),y.locationId=1,y.useTemp=!0,b.push(y)}p&&(f=f.concat(w)),f=f.concat(b)}else f=[];return f}function s(t){var n="",a="",o="",s="",r=["pb","ob","dt","mb"],c=["Pacific Beach","Ocean Beach","Downtown","Mission Beach"],l=!1,d=[],u=t;if(u)if(u.indexOf("best")>-1&&(u=u.replace("best","")),u.indexOf("Best")>-1&&(u=u.replace("Best","")),u.indexOf("top")>-1&&(u=u.replace("top","")),u.indexOf("Top")>-1&&(u=u.replace("Top","")),u.indexOf("great")>-1&&(u=u.replace("great","")),u.indexOf("Great")>-1&&(u=u.replace("Great","")),u.indexOf("awesome")>-1&&(u=u.replace("awesome","")),u.indexOf("Awesome")>-1&&(u=u.replace("Awesome","")),u.indexOf("amazing")>-1&&(u=u.replace("amazing","")),u.indexOf("Amazing")>-1&&(u=u.replace("Amazing","")),u.indexOf("most")>-1&&(u=u.replace("most","")),u.indexOf("Most")>-1&&(u=u.replace("Most","")),u.indexOf("the ")>-1&&(u=u.replace("the ","")),u.indexOf("The ")>-1&&(u=u.replace("The ","")),u.indexOf("shops")>-1&&(u=u.replace("shops","")),u.indexOf("Shops")>-1&&(u=u.replace("Shops","")),u.indexOf("places")>-1&&(u=u.replace("places","")),u.indexOf("Places")>-1&&(u=u.replace("Places","")),u.indexOf("delicious")>-1&&(u=u.replace("delicious","")),u.indexOf("Delicious")>-1&&(u=u.replace("Delicious","")),u.length>=3){var g=u;"pho"!=g&&"Pho"!=g||(g="vietnamese"),e.isNh&&(g=g+" "+e.cnh);for(var m=[],p=[],f={},h=!0,v=!0,b=!1,w=g.toLowerCase().split(" "),y=0;y<w.length;y++){if(o=w[y].charAt(0).toUpperCase()+w[y].slice(1),s=w[y].charAt(0).toLowerCase()+w[y].slice(1),w[y].length>=3&&!e.isqf&&"car"!=w[y]&&"del"!=w[y]&&"bar"!=w[y])for(var x=0;x<e.locations.length;x++)(e.locations[x].nh_name.toLowerCase().indexOf(w[y])>-1||e.locations[x].nh_name.toLowerCase().indexOf(w[y].toUpperCase())>-1||e.locations[x].nh_name.indexOf(o)>-1||e.locations[x].nh_name.indexOf(s)>-1)&&(b=!0);if(2==w[y].length)for(var x=0;x<r.length;x++)r[x]!=w[y]&&r[x]!=w[y].toUpperCase()&&r[x]!=o&&r[x]!=s||(b=!0,w[y]=c[x])}for(var k=0;k<e.content.length;k++)if(a=e.searchStrContent[k],n=e.content[k].title,e.content[k],n&&a){h=!0,v=!0;for(var y=0;y<w.length;y++)o=w[y].charAt(0).toUpperCase()+w[y].slice(1),s=w[y].charAt(0).toLowerCase()+w[y].slice(1),a||console.log(k),h=h&&(a.indexOf(w[y])>-1||a.indexOf(w[y].toUpperCase())>-1||a.indexOf(o)>-1||a.indexOf(s)>-1),v=v&&(n.indexOf(w[y])>-1||n.indexOf(w[y].toUpperCase())>-1||n.indexOf(o)>-1||n.indexOf(s)>-1);v?(f={},f=JSON.parse(JSON.stringify(e.content[k])),f.useTemp=!1,b?p.push(f):f.ismp&&p.push(f),l=!0):h&&(f={},f=JSON.parse(JSON.stringify(e.content[k])),f.useTemp=!1,b?m.push(f):f.ismp&&m.push(f))}else console.log("this has issues - content.id - ",e.content[k]);if(p.length>2&&i(p),l&&(d=d.concat(p)),m.length>2&&i(m),d=d.concat(m),"food"==t||"Food"==t){var D=e.content.map(function(e){return e.title}).indexOf("Food Near Me");d=[e.content[D]].concat(d)}}else d=[];return d}function r(e,t){for(var n=!1,a=0;a<t.length;a++)if(e.nh_name==t[a].nh_name){n=!0;break}n||t.push(e)}function i(e){for(var t,n,a=e.length;0!==a;)n=Math.floor(Math.random()*a),a-=1,t=e[a],e[a]=e[n],e[n]=t;return e}function c(e,t){for(var n=[],a=[],o="",s=0,r={},i=0;i<e.length;i++)if(1==e[i].isAnswer||"Food Near Me"==e[i].title);else{o=e[i].tags.replace(/,/g," "),a=o.split(" ");for(var c=0;c<a.length;c++)"isMP"!=a[c]&&a[c]!=t&&(s=n.map(function(e){return e.tag}).indexOf(a[c]),s<0?(r={},r.tag=a[c],r.ctr=1,n.push(r)):n[s].ctr++)}return n=n.sort(l)}function l(e,t){return t.ctr-e.ctr}return{searchRanks:o,searchRanks2:s,searchAnswers:t,searchRanksMainPage:n,sibblingRanks:a,searchRelatedRanks:c}}angular.module("app").service("search",e),e.$inject=["$rootScope"]}(),function(){"use strict";function e(e,t,n){function a(a){function o(e){return e}function s(a){if(0!=a.data.resource.length){var o=a.data.resource[0],s="/api/v2/mysql/_table/categories/?filter=id="+o.category,r="/api/v2/mysql/_table/ranking/?filter=(cat="+o.category+") AND (nh=1)",c=e.get(s),l=e.get(r);return t.all([c,l]).then(function(e){var t=e[1].data.resource[0],a=e[0].data.resource[0];return t.title=a.category.replace("@Nh","San Diego"),t.fimage=a.fimage,t.introtext=a.introtext,t.tags=a.tags,t.question=a.question,t.type=a.type,t.fc=a.fc,t.bc=a.bc,t.shade=a.shade,i.push(t),n.$emit("rodReady"),i},function(e){console.log("Error getting rank of day data: ",e)})}}var c=new Date,d=c.getTimezoneOffset();c.setMinutes(c.getMinutes()-d);var u=o(c.getMonth()+1)+"/"+o(c.getDate())+"/"+c.getFullYear(),g=l+"/?filter=date="+u;return e.get(g).then(s,r)}function o(){function t(e){return c=e.data.resource}var n=l;return e.get(n).then(t,r)}function s(t,n,a){function o(e){return console.log("updating rank of day succesful"),e.data}var s={};s.resource=[];var i={};i.id=t;for(var d=0;d<n.length;d++)i[n[d]]=a[d];s.resource.push(i);for(var u=l,g=c.map(function(e){return e.id}).indexOf(t),d=0;d<n.length;d++)c[g][n[d]]=a[d];return e.patch(u,s,{headers:{"Content-Type":"multipart/form-data"},body:s}).then(o,r)}function r(e){throw e}var i=[];n.rankofday=i;var c=[],l="/api/v2/mysql/_table/rankofday";return{getrankofday:a,getall:o,update:s}}angular.module("app").factory("rankofday",e),e.$inject=["$http","$q","$rootScope"]}(),function(){"use strict";function e(e,t,n){function a(n){function a(e){return l=e.data.resource}if(i()&&!n)return t.when(l);var o=d;return e.get(o).then(a,c)}function o(t){function a(e){var t=e.data.resource[0].id;return l[l.length-1].id=t,n.DEBUG_MODE&&console.log("creating pvisits record was succesful"),e.data}var o={};o.date=t,o.nvisits=1;var s={};s.resource=[],s.resource.push(o),l.push(o);var r=d;return e.post(r,s,{headers:{"Content-Type":"multipart/form-data"},body:s}).then(a,c)}function s(t,a){function o(e){return n.DEBUG_MODE&&console.log("Updating pvisits record was succesful"),e.data}var s={};s.resource=[];var r={};r.id=t,r.nvisits=a,s.resource.push(r);var i=d;return e.patch(i,s,{headers:{"Content-Type":"multipart/form-data"},body:s}).then(o,c)}function r(t){function a(e){return n.DEBUG_MODE&&console.log("Deleting user activity record was succesful"),e.data}for(var o=0;o<l.length;o++)l[o].id==t&&l.splice(o,1);var s=d+"/"+t;return e.delete(s).then(a,c)}function i(){return l.length>0}function c(e){throw e}var l=[],d="/api/v2/mysql/_table/pvisits";return{getpvisits:a,postRec:o,patchRec:s,deleteRec:r}}angular.module("app").factory("pvisits",e),e.$inject=["$http","$q","$rootScope"]}(),function(){"use strict";function e(e,t,n){function a(a){if(u.length>0&&!a)return t.when(u);var o=g+"?offset=0",s=e.get(o);return t.all([s]).then(function(e){return l(e[0].data.resource),n.DEBUG_MODE&&console.log("No. Categories ",u.length),u},d)}function o(a){for(var o="?filter=(",s=0;s<a.length;s++)o=o+"id="+a[s].nh+")OR(";o=o.substring(0,o.length-3);var r=g+o,i=e.get(r);return t.all([i]).then(function(e){return l(e[0].data.resource),n.DEBUG_MODE&&console.log("No. Categories ",_categories.length),u},d)}function s(a){var o=g+"/?filter=id="+a,s=e.get(o);return t.all([s]).then(function(e){var t=e[0].data.resource;return n.DEBUG_MODE&&console.log("loaded single location ",t),t},d)}function r(t){function a(e){var a=t;return a.id=e.data.resource[0].id,u.push(a),n.DEBUG_MODE&&console.log("adding locationx succesful",e),e.data}var o=g,s=[];return s.push(t),e.post(o,s,{headers:{"Content-Type":"multipart/form-data"},body:s}).then(a,d)}function i(t,a,o){function s(e){return n.DEBUG_MODE&&console.log("updating locationx succesful"),e.data}var r={};r.resource=[];var i={};i.id=t;for(var c=0;c<a.length;c++)i[a[c]]=o[c];r.resource.push(i);for(var l=g,m=u.map(function(e){return e.id}).indexOf(t),c=0;c<a.length;c++)u[m][a[c]]=o[c];return e.patch(l,r,{headers:{"Content-Type":"multipart/form-data"},body:r}).then(s,d)}function c(t){function a(e){return n.DEBUG_MODE&&console.log("Deleting location was succesful"),e.data}var o={};o.resource=[];var s={};s.id=t,o.resource.push(s);var r=g+"/"+t,i=u.map(function(e){return e.id}).indexOf(t);return i>-1&&u.splice(i,1),e.delete(r,s,{headers:{"Content-Type":"multipart/form-data"},body:o}).then(a,d)}function l(e){u.length=0,e.forEach(function(e){u.push(e)})}function d(e){throw e}var u=[];n.locations=u;var g="/api/v2/mysql/_table/locations";return{getAllLocations:a,getLocationsL:o,getLocation:s,addLocation:r,update:i,deleteRec:c}}
angular.module("app").factory("locations",e),e.$inject=["$http","$q","$rootScope"]}(),function(){"use strict";function e(e,t,n){function a(n){if(i()&&!n)return t.when(l);var a=d+"?offset=0",o=e.get(a);return t.all([o]).then(function(e){return r(e[0].data.resource),l},c)}function o(t){function a(e){var a=t;return a.id=e.data.resource[0].id,l.push(a),n.DEBUG_MODE&&console.log("result",e),e.data}var o=d,s=[];return s.push(t),e.post(o,s,{headers:{"Content-Type":"multipart/form-data"},body:s}).then(a,c)}function s(t,a,o){function s(e){return console.log("updating headlines succesful"),e.data}var r={};r.resource=[];var i={};i.id=t;for(var u=0;u<a.length;u++)switch(a[u]){case"city":i.city=o[u];break;case"nh":i.nh=o[u];break;case"title":i.title=o[u];break;case"filter":i.filter=o[u];break;case"bc":i.bc=o[u];break;case"fc":i.fc=o[u]}r.resource.push(i);for(var g=d,m=l.map(function(e){return e.id}).indexOf(t),u=0;u<a.length;u++)switch(a[u]){case"city":n.content[m].city=o[u];break;case"nh":n.content[m].nh=o[u];break;case"title":n.content[m].title=o[u];break;case"filter":n.content[m].filter=o[u];break;case"bc":n.content[m].bc=o[u];break;case"fc":n.content[m].fc=o[u]}return e.patch(g,r,{headers:{"Content-Type":"multipart/form-data"},body:r}).then(s,c)}function r(e){l.length=0,e.forEach(function(e){l.push(e)})}function i(){return l.length>0}function c(e){throw e}var l=[];n.headlines=l;var d="/api/v2/mysql/_table/headlines";return{getheadlines:a,addheadline:o,update:s}}angular.module("app").factory("headline",e),e.$inject=["$http","$q","$rootScope"]}(),function(){"use strict";function e(e,t,n,a,o,s,r,i,c,l,d,u,g,m,p,f,h,v,b,w,y,x,k){function D(){n.DEBUG_MODE&&console.log("get initial data called"),L();var e=c.getInitialHomeData(j),a=x.getInitialHomeData(X);t.all([e,a]).then(function(e){C(),B(e[1]),M("ranks",e[0]).then(function(){m(function(){E(n.SCOPE)},50)})})}function E(e){n.DEBUG_MODE&&console.log("gethomedataX called"),n.pageDataLoaded=!1;var a=c.getTablesX(e),o=x.getAllCategoriesX(e),s=k.getAllLocations();i.getAnswersX(e,1).then(function(){n.isLoggedIn&&_(),O(),c.storeInitialHomeData(j),x.storeInitialHomeData(X),n.pageDataLoaded=!0,I()});return t.all([a,o,s]).then(function(e){C(),S(),n.nhs=n.locations.map(function(e){return e.nh_name}),n.locsas=n.locations.filter(function(e){return void 0!=e.sub_areas&&""!=e.sub_areas&&"San Diego"!=e.nh_name}).map(function(e){return e.nh_name}),n.DEBUG_MODE&&console.log("cwrapper data ready!"),n.$emit("homeDataLoaded")})}function O(){u.getactions(),b.getheadlines()}function C(){n.DEBUG_MODE&&console.log("dataloader.unwrap");for(var e={},t={},a=-1,o=-1,a=0,s=0;s<n.content.length;s++)a=n.locations.map(function(e){return e.id}).indexOf(n.content[s].nh),e=n.locations[a],o=n.categories.map(function(e){return e.id}).indexOf(n.content[s].cat),t=n.categories[o],void 0==e&&(e={},e.nh_name="San Diego",e.id=1,e.sub_areas=""),t?(n.content[s].title=t.category.replace("@Nh",e.nh_name),n.content[s].fimage=t.fimage,n.content[s].bc=t.bc,n.content[s].fc=t.fc,n.content[s].tags=t.tags,n.content[s].keywords=t.keywords,n.content[s].type=t.type,n.content[s].question=t.question,n.content[s].shade=t.shade,1==n.content[s].nh?n.content[s].introtext=t.introtext:n.content[s].introtext="",n.content[s].user=t.user,e.sub_areas&&t.category.indexOf("@Nh")>-1?n.content[s].isatomic=!1:n.content[s].isatomic=!0,null!=t.ismp&&void 0!=t.ismp?n.content[s].ismp=t.ismp:1==e.id?n.content[s].ismp=!0:n.content[s].ismp=!1):n.DEBUG_MODE&&console.log("Couldnt find this category --- ",n.content[s].cat)}function R(e,t,a){n.DEBUG_MODE&&console.log("dataloader.unwrapSingle");var o=n.content.map(function(e){return e.id}).indexOf(e.id),s=n.content[o];s.title=t.category.replace("@Nh",a.nh_name),s.fimage=t.fimage,s.bc=t.bc,s.fc=t.fc,s.tags=t.tags,s.keywords=t.keywords,s.type=t.type,s.question=t.question,s.shade=t.shade,1==s.nh?s.introtext=t.introtext:s.introtext="",s.user=t.user,a.sub_areas&&t.category.indexOf("@Nh")>-1?s.isatomic=!1:s.isatomic=!0,null!=t.ismp&&void 0!=t.ismp?s.ismp=t.ismp:1==a.id?s.ismp=!0:s.ismp=!1}function _(){var e=[{category:11091,id:11091},{category:11092,id:11092},{category:11093,id:11093}];o.getTablesD(e).then(function(){G=!0,A()}),y.getAllcatansX(e).then(function(e){0!=e?i.getAnswersFromCatans(e).then(function(){V=!0,A()}):(V=!0,A())}),l.getSpecialsbyAnswer(1).then(function(){N=!0,A()})}function A(){F=G&&V&&N}function S(){n.searchStr=[];for(var e=0;e<n.categories.length;e++)n.searchStr[e]=(n.categories[e].tags?n.categories[e].tags:"")+" "+(n.categories[e].title?n.categories[e].title:"");n.searchStrContent=[];for(var e=0;e<n.content.length;e++)n.searchStrContent[e]=(n.content[e].tags?n.content[e].tags:"")+" "+(n.content[e].title?n.content[e].title:"")}function M(e,t){if("ranks"==e)return y.getAllcatansX(t).then(function(e){if(e)for(var t=0,n=e.length>200?200:e.length;t<e.length;)i.getAnswersFromCatans(e.slice(t,n)),l.getSpecialsX(e.slice(t,n)),v.getVrowsX(e.slice(t,n)),p.GetMatchTableX(e.slice(t,n)),f.getEditsX(e.slice(t,n)),o.getTablesX(e.slice(t,n)),t=n,(n+=200)>e.length&&(n=e.length)});"answers"==e&&(i.getAnswers(t),y.getAllcatansY(t).then(function(e){if(e){for(var n=0,a=e.length>200?200:e.length;n<e.length;)l.getSpecialsX(e.slice(n,a)),v.getVrowsX(e.slice(n,a)),p.GetMatchTableX(e.slice(n,a)),f.getEditsX(e.slice(n,a)),o.getTablesX(e.slice(n,a)).then(function(e){0!=e&&M("ranks",e)}),n=a,(a+=200)>e.length&&(a=e.length);var s=[],r={};t.forEach(function(e){if(null!=e.ranks&&e.ranks.length>2){r=JSON.parse(e.ranks);for(var t=0;t<r.length;t++)s.push(r[t])}}),s.length>0&&M("ranks",s)}}))}function $(e){n.DEBUG_MODE&&console.log("getRank exec");var a=g.getIndexFromSlug(e);if(n.isCustomRank){var s=o.getSingleTable(a);y.getAllcatansX([{id:a}]).then(function(e){if(e){var a=i.getAnswersFromCatans(e),r=l.getSpecialsX(e),c=v.getVrowsX(e),d=p.GetMatchTableX(e),u=f.getEditsX(e),g=o.getTablesX(e);t.all([s,a,r,c,d,u,g]).then(function(){n.$emit("rankDataLoaded")})}})}else var s=c.getSingleTable(a).then(function(e){var a=e,s=x.getCategory(a.cat),r=k.getLocation(a.nh);y.getAllcatansX([a]).then(function(e){if(e){var c=i.getAnswersFromCatans(e),d=l.getSpecialsX(e),u=v.getVrowsX(e),g=p.GetMatchTableX(e),m=f.getEditsX(e),h=o.getTablesX(e);t.all([s,r,c,d,u,g,m,h]).then(function(e){var t=e[0][0],o=e[1][0];R(a,t,o),n.$emit("rankDataLoaded")})}}),void 0==n.SCOPE&&(n.SCOPE=a.scope)})}function P(e){var a=g.getIndexFromSlug(e),s={};s.id=a,s.answer=a;var r=i.getAnswer(a),d=l.getSpecialsX([s]),u=p.GetMatchTableX([s]),m=f.getEditsX([s]),h=o.getTablesX([s]),b=v.getVrowsX([s]);y.getAllcatansY([s]).then(function(e){if(e)var a=c.getTablesL(e).then(function(e){e.constructor===Array||(e=[e]);var o=x.getCategoriesL(e),s=k.getLocationsL(e);t.all([r,d,u,m,h,b,a,o,s]).then(function(e){var t=e[0];C(),void 0==n.SCOPE&&(n.SCOPE=t.scope),n.$emit("answerDataLoaded")})});else n.$emit("answerDataLoaded")})}function I(){n.pageDataLoaded&&T&&!q&&(n.rankSummaryDataLoaded=!0,n.answerDetailLoaded=!0,n.$emit("rankDataLoaded"))}function B(a){var o=[];a.forEach(function(t){null!=t.fimage&&void 0!=t.fimage&&t.fimage.indexOf("rankx")>-1&&o.push(e.get(t.fimage))}),t.all(o).then(function(){n.$emit("initalHomeDataLoaded")})}function L(){for(var e=Y.length,t=[],n=0;t.length<12;)n=Math.floor(Math.random()*e),-1==t.indexOf(n)&&t.push(n);t.forEach(function(e){j.push(Y[e]),X.push(z[e])})}var U={gethomedataX:E,getRank:$,getAnswer:P,getInitialData:D,unwrap:C,unwrapSingle:R,createSearchStrings:S,pulldata:M,getDemoData:_},T=!1,G=!1,V=!1,N=!1,F=!1,q=!1,Y=[1733,11619,11285,11288,11673,9734,468,9822,11271,11927,11241,7674,368,43,1728,7965,9735,192,10339,9903,11598,12041,93,12020,3125],z=[1164,1130,1403,1407,1313,1275,1149,1276,1390,1475,1367,1241,1128,1092,1161,1260,1277,1112,1305,1293,1106,1542,1104,1535,1200],j=[],X=[];return U}angular.module("app").factory("dataloader",e),e.$inject=["$http","$q","$rootScope","pvisits","table2","dialog","rankofday","answer","table","special","datetime","uaf","common","$timeout","matchrec","edit","useractivity","vrows","headline","cblock","catans","categories","locations"]}(),function(){"use strict";function e(e,t,n){function a(a){if(l()&&!a)return t.when(u);var o=g+"?offset=0",s=e.get(o);return t.all([s]).then(function(e){return u=e[0].data.resource,n.DEBUG_MODE&&console.log("No. C-Blocks: ",u.length),u},d)}function o(){var a=g+"/?filter=ismp=true",o=e.get(a);return t.all([o]).then(function(e){return u=e[0].data.resource,n.DEBUG_MODE&&console.log("No. C-Blocks: ",u.length),u},d)}function s(){var a=g+"/?filter=ismp=false",o=e.get(a);return t.all([o]).then(function(e){return u=u.concat(e[0].data.resource),n.DEBUG_MODE&&console.log("No. C-Blocks: ",u.length),u},d)}function r(t){function n(e){var n=t;return n.id=e.data.resource[0].id,u.push(n),console.log("adding cblock succesful",e),e.data}var a=g,o=[];return o.push(t),e.post(a,o,{headers:{"Content-Type":"multipart/form-data"},body:o}).then(n,d)}function i(t,n,a){function o(e){return console.log("updating cblocks succesful"),e.data}var s={};s.resource=[];var r={};r.id=t;for(var i=0;i<n.length;i++)switch(n[i]){case"catstr":r.catstr=a[i];break;case"ismp":r.ismp=a[i]}s.resource.push(r);for(var c=g,l=u.map(function(e){return e.id}).indexOf(t),i=0;i<n.length;i++)switch(n[i]){case"catstr":u[l].catstr=a[i];break;case"ismp":u[l].ismp=a[i]}return e.patch(c,s,{headers:{"Content-Type":"multipart/form-data"},body:s}).then(o,d)}function c(t){function n(e){return console.log("Deleting cblock was succesful"),e.data}var a={};a.resource=[];var o={};o.id=t,a.resource.push(o);var s=g+"/"+t,r=u.map(function(e){return e.id}).indexOf(t);return r>-1&&u.splice(r,1),e.delete(s,o,{headers:{"Content-Type":"multipart/form-data"},body:a}).then(n,d)}function l(){return u.length>0}function d(e){throw e}var u=[],g="/api/v2/mysql/_table/cblocks";return{getcblocks:a,getcblocksmain:o,getcblocksall:s,addcblock:r,update:i,deleteRec:c}}angular.module("app").factory("cblock",e),e.$inject=["$http","$q","$rootScope"]}(),function(){"use strict";function e(e,t,n,a){function o(a){for(var o="?filter=(",s=0;s<a.length;s++)o=o+"id="+a[s]+")OR(";o=o.substring(0,o.length-3);var r=v+o,i=e.get(r);return t.all([i]).then(function(e){return p(e[0].data.resource),n.DEBUG_MODE&&console.log("categories length: ",h.length),h},f)}function s(a){var o=v+"?offset=0",s=e.get(o);return t.all([s]).then(function(e){return m(e[0].data.resource),n.DEBUG_MODE&&console.log("No. Categories ",h.length),h},f)}function r(a){var o=v+"?offset=0&filter=scope="+a,s=e.get(o);return t.all([s]).then(function(e){return m(e[0].data.resource),n.DEBUG_MODE&&console.log("No. Categories ",h.length),h},f)}function i(a){for(var o="?filter=(",s=0;s<a.length;s++)o=o+"id="+a[s].cat+")OR(";o=o.substring(0,o.length-3);var r=v+o,i=e.get(r);return t.all([i]).then(function(e){return p(e[0].data.resource),n.DEBUG_MODE&&console.log("No. Categories ",h.length),h},f)}function c(a){var o=v+"/?filter=id="+a,s=e.get(o);return t.all([s]).then(function(e){var t=e[0].data.resource;return n.DEBUG_MODE&&console.log("loaded single category ",t),t},f)}function l(t){function a(e){var n=t;return n.id=e.data.resource[0].id,h.push(n),console.log("adding categoryx succesful",e),e.data}t.scope=n.SCOPE;var o=v,s=[];return s.push(t),e.post(o,s,{headers:{"Content-Type":"multipart/form-data"},body:s}).then(a,f)}function d(t,a,o){function s(e){for(var s=h.map(function(e){return e.id}).indexOf(t),r=0;r<a.length;r++)h[s][a[r]]=o[r];for(var r=0;r<n.content.length;r++)if(n.content[r].cat==h[s].id){for(var i=0;i<a.length;i++)n.content[r][a[i]]=o[i];n.searchStrContent[r]=n.content[r].tags+n.content[r].title}return n.DEBUG_MODE&&console.log("updating categoryx succesful"),e.data}var r={};r.resource=[];var i={};i.id=t;for(var c=0;c<a.length;c++)i[a[c]]=o[c];r.resource.push(i);var l=v;return e.patch(l,r,{headers:{"Content-Type":"multipart/form-data"},body:r}).then(s,f)}function u(t){function a(e){return n.DEBUG_MODE&&console.log("Deleting category was succesful"),e.data}var o={};o.resource=[];var s={};s.id=t,o.resource.push(s);var r=v+"/"+t,i=h.map(function(e){return e.id}).indexOf(t);return i>-1&&h.splice(i,1),e.delete(r,s,{headers:{"Content-Type":"multipart/form-data"},body:o}).then(a,f)}function g(e){var t=[],n=0;e.forEach(function(e){(n=h.map(function(e){return e.id}).indexOf(e))>-1&&t.push(h[n])}),a.localStorage.setItem("Categories-HomeData",JSON.stringify(t))}function m(e){h.length=0,e.forEach(function(e){h.push(e)})}function p(e){e.forEach(function(e){h.map(function(e){return e.id}).indexOf(e.id)<0&&h.push(e)})}function f(e){throw e}var h=[];n.categories=h;var v="/api/v2/mysql/_table/categories";return{getAllCategories:s,getAllCategoriesX:r,getCategoriesL:i,getCategory:c,addCategory:l,update:d,deleteRec:u,getInitialHomeData:o,storeInitialHomeData:g}}angular.module("app").factory("categories",e),e.$inject=["$http","$q","$rootScope","$window"]}(),angular.module("app").directive("userfeedBlock",["$rootScope","$state","fbusers","$q","uaf","color","dataloader",function(e,t,n,a,o,s,r){"use strict";return{templateUrl:"app/content/partials/userfeed-block.html",transclude:!0,scope:{showAll:"@",showQty:"@"},controller:["$scope","$window","uaf",function(t,n,a){var o=t;o.title="mycontent",o.sm=e.sm,n.innerWidth<768&&(o.thumbheight="80px"),n.innerWidth>=768&&n.innerWidth<992&&(o.thumbheight="100px"),n.innerWidth>=992&&n.innerWidth<1200&&(o.thumbheight="80px"),n.innerWidth>1200&&(o.thumbheight="100px")}],link:function(i){function c(){l(),0==i.feeds.length&&(i.feeds=e.uafs),i.fres=i.showQty}function l(){i.feeds=[],a.all(e.uafs.map(function(e){return n.getFBUserById(e.userid)})).then(function(t){i.feeds=[];for(var n=0;n<e.uafs.length;n++){var a=angular.copy(e.uafs[n]);a.picture=t[n]?t[n].picture.data.url:null,i.feeds[n]=a}})}function d(e){for(var t=[],n=[],a={},o=0;o<e.length;o++)a={},"addedCustomRank"==e[o].action&&(a.id=e[o].answer,n.push(a)),"addedRank"==e[o].action&&(a.id=e[o].category,t.push(a)),"binded"==e[o].action&&(a.id=e[o].answer,n.push(a)),"downVotedVrow"==e[o].action&&(a.id=e[o].answer,n.push(a)),"upVotedVrow"==e[o].action&&(a.id=e[o].answer,n.push(a)),"editA"==e[o].action&&(a.id=e[o].answer,n.push(a)),"commentA"==e[o].action&&(a.id=e[o].answer,n.push(a)),"commentR"==e[o].action&&(a.id=e[o].category,t.push(a)),"downVoted"==e[o].action&&(a.id=e[o].category,t.push(a),a={},a.id=e[o].answer,n.push(a)),"upVoted"==e[o].action&&(a.id=e[o].category,t.push(a),a={},a.id=e[o].answer,n.push(a)),"addedAnswer"==e[o].action&&(a.id=e[o].category,t.push(a),a={},a.id=e[o].answer,n.push(a));n.length>0&&r.pulldata("answers",n),t.length>0&&r.pulldata("ranks",t)}var u=0;d(e.uafs.slice(u,i.showQty)),void 0==i.isDestroyed&&c();var g="#595959",m=s.shadeColor(g,.5);i.headerStyle="color:#f8f8ff;width:100%;border-style:none;background:#595959;background: -webkit-linear-gradient(left,#595959,"+m+");background: -o-linear-gradient(right,"+g+","+m+");background: -moz-linear-gradient(right,"+g+", "+m+");background: linear-gradient(to right,"+g+", "+m+");",i.$watch("showQty",function(){u=i.fres,i.fres=i.showQty,d(e.uafs.slice(u,i.showQty))}),i.refreshFeed=function(){e.DEBUG_MODE&&console.log("refreshFeed"),o.getactions().then(function(t){e.uafs=t,c()})},i.gotoAnswer=function(e){t.go("answerDetail",{index:e.answer})},i.gotoRank=function(e){t.go("rankSummary",{index:e.category})},i.$on("$destroy",function(){i.isDestroyed=!0})}}}]),angular.module("app").directive("trendBlock",["$rootScope","$state","answer","table","catans","$timeout","vrows","$window","cblock","color","search","dataloader",function(e,t,n,a,o,s,r,i,c,l,d,u){"use strict";return{templateUrl:"app/content/partials/trend-block.html",transclude:!0,scope:{showAll:"@"},controller:["$scope","query","$http","answer","table","catans","$timeout","vrows","$window","cblock","color","search",function(t,n,a,o,s,r,i,c,l,d,u,g){var m=t;m.title="mycontent",m.sm=e.sm,l.innerWidth<768&&(m.thumbheight="80px"),l.innerWidth>=768&&l.innerWidth<992&&(m.thumbheight="100px"),l.innerWidth>=992&&l.innerWidth<1200&&(m.thumbheight="80px"),l.innerWidth>1200&&(m.thumbheight="100px")}],link:function(n){n.isDestroyed,n.popularLimit=10;var a=0;n.newestLimit=10;var o=0;n.userfeedLimit=10,n.seeTab=function(e){1==e&&(n.popular=!0,n.newest=!1),2==e&&(n.newest=!0,n.popular=!1)},n.seeTab(1),function(){var t=angular.copy(e.content.filter(function(e){return 1==e.ismp}));t.sort(function(e,t){var n=e.views?e.views:0,a=t.views?t.views:0;return e.id==t.id?0:n<a?1:-1}),t.forEach(function(t){t.fimage&&""!=t.fimage?t.realimage=t.fimage:t.image1url&&""!=t.image1url?t.realimage=t.image1url:t.realimage=e.EMPTY_IMAGE,t.humanized=moment(t.timestmp).fromNow()}),n.popularOrder=t,u.pulldata("ranks",n.popularOrder.slice(a,n.popularLimit)),t=angular.copy(e.content.filter(function(e){return 1==e.ismp})),t.sort(function(e,t){var n=e.timestmp?e.timestmp:0,a=t.timestmp?t.timestmp:0;return e.id==t.id?0:n<a?1:-1}),t.forEach(function(t){t.fimage&&""!=t.fimage?t.realimage=t.fimage:t.image1url&&""!=t.image1url?t.realimage=t.image1url:t.realimage=e.EMPTY_IMAGE,t.humanized=moment(t.timestmp).fromNow()}),n.newestOrder=t,u.pulldata("ranks",n.newestOrder.slice(o,n.newestLimit))}(),n.seeMore=function(e){"newest"==e&&(o=n.newestLimit,n.newestLimit+=8,u.pulldata("ranks",n.newestOrder.slice(o,n.newestLimit))),"popular"==e&&(a=n.popularLimit,n.popularLimit+=8,u.pulldata("ranks",n.popularOrder.slice(a,n.popularLimit))),"userfeed"==e&&(n.userfeedLimit+=8)},n.goBack=function(){e.$emit("backToResults")},n.rankSel=function(n,a){e.rankIsNearMe=!!a,e.editMode?t.go("editRanking",{index:n.slug}):t.go("rankSummary",{index:n.slug})},n.$on("$destroy",function(){n.isDestroyed=!0}),n.getHumanized=function(e){return moment(e).fromNow()}}}}]),angular.module("app").directive("searchBlock",["$rootScope","$state","search","$timeout","$window","dataloader","$http","$q",function(e,t,n,a,o,s,r,i){"use strict";return{templateUrl:"app/content/partials/search-block.html",transclude:!0,scope:{query:"@",ans:"=",ranks:"=",length:"=",init:"=",data:"=",rod:"=",scrollactive:"="},controller:["$scope",function(e){o.innerWidth<768&&(e.itemWidth=(o.innerWidth-8)/2),o.innerWidth>=768&&o.innerWidth<992&&(e.itemWidth=(o.innerWidth-8)/3),o.innerWidth>=992&&o.innerWidth<1200&&(e.itemWidth=(o.innerWidth-8)/4),o.innerWidth>1200&&(e.itemWidth=(o.innerWidth-8)/6)}],link:function(t){function c(){a.cancel(w),w=a(function(){if(t.query.length>=2&&(t.disableScrolling=!1,t.endReached=!1,t.getResults(t.query)),0==t.query.length){var n=m.map(function(t){return t.id==e.updated_rank_id&&e.content.map(function(n){if(n.id==e.updated_rank_id)return t=angular.copy(n)}),t});m=n,t.searchResults=m,t.endReached=!1,t.displayResults=t.searchResults.slice(0,t.scrollingItemsOnePage)}},300)}function l(e,t){s.pulldata(e,t)}function d(e){var n=[];return t.contentLoaded=!1,e.forEach(function(e){e.isAnswer||null!=e.fimage&&void 0!=e.fimage&&e.fimage.indexOf("rankx")>-1&&n.push(r.get(e.fimage))}),i.all(n)}function u(e){for(var t,n,a=e.length;0!==a;)n=Math.floor(Math.random()*a),a-=1,t=e[a],e[a]=e[n],e[n]=t;return e}var g=[],m=[],p=!1,f=-1,h=-1,v=0,b=0;t.contentLoaded=!1,1==e.DISPLAY_XSMALL&&(v=400),1==e.DISPLAY_SMALL&&(v=400),1==e.DISPLAY_MEDIUM&&(v=400),1==e.DISPLAY_LARGE&&(v=300),1!=e.DISPLAY_XSMALL&&1!=e.DISPLAY_SMALL||(b=1e3),1!=e.DISPLAY_MEDIUM&&1!=e.DISPLAY_LARGE||(b=1e3),t.resRanks=[],t.resAnswers=[],t.searchResults=[],t.displayResults=[],t.maxRes=4e3;var w;t.$watch("query",function(){p?c():t.contentLoaded=!1}),e.$on("updateSearch",function(){c()}),t.getResults=function(){t.useTemp=!1,t.resRanks=[];var o=[];t.resRanks=n.searchRanks2(t.query),o=n.searchRanks(t.query);for(var s=t.resRanks.map(function(e){return e.cat}),r=0;r<o.length;r++)s.indexOf(o[r].id)<0&&t.resRanks.push(o[r]);t.resRanks.length>0&&(t.disableScrolling=!1,t.currentIndex=t.intialDataCount,t.startIndex=0,t.endReached=!1),t.resAnswers=[],t.ans&&(t.resAnswers=n.searchAnswers(t.query));for(var r=0;r<t.resAnswers.length;r++)t.resAnswers[r].isAnswer=!0,"Establishment"==t.resAnswers[r].type&&(t.resAnswers[r].itext="Establishment",t.resAnswers[r].icon="fa fa-building-o"),"Person"==t.resAnswers[r].type&&(t.resAnswers[r].itext="Public Figure",t.resAnswers[r].icon="fa fa-male"),"PersonCust"==t.resAnswers[r].type&&(t.resAnswers[r].itext="Contractor",t.resAnswers[r].icon="fa fa-male"),"Short-Phrase"==t.resAnswers[r].type&&(t.resAnswers[r].itext="Opinion",t.resAnswers[r].icon="fa fa-comment-o"),"Event"==t.resAnswers[r].type&&(t.resAnswers[r].itext="Event",t.resAnswers[r].icon="fa fa-calendar-o"),"Organization"==t.resAnswers[r].type&&(t.resAnswers[r].itext="Brand",t.resAnswers[r].icon="fa fa-trademark"),"Place"==t.resAnswers[r].type&&(t.resAnswers[r].itext="Place",t.resAnswers[r].icon="fa fa-map-marker");t.length=t.resRanks.length+t.resAnswers.length,t.searchResults=t.resRanks.concat(t.resAnswers),d(t.searchResults.slice(0,t.scrollingItemsOnePage)).then(function(){t.contentLoaded=!0,t.displayResults=t.searchResults.slice(0,t.scrollingItemsOnePage),t.loadMore(!0),a(function(){e.$broadcast("masonry.reload")},500)}),g=t.searchResults.slice(0,t.scrollingItemsOnePage);for(var i=[],c=[],r=0;r<g.length;r++)g[r].isAnswer?c.push(g[r]):i.push(g[r]);i.length>0&&l("ranks",i),c.length>0&&l("answers",c),t.relTags=n.searchRelatedRanks(i,t.query),t.relTagsIdx=0,t.searchResults.length<3?t.disableScrolling=!0:t.disableScrolling=!1};var y;t.$watch("init",function(){a.cancel(y),y=a(function(){t.init&&t.getContent()},50)}),t.getContent=function(){m=[],e.content.length<50?m=JSON.parse(JSON.stringify(e.content)):e.content.forEach(function(e){e.ismp&&m.push(e)}),m.length>0&&(u(m),t.disableScrolling=!1,t.currentIndex=t.intialDataCount,t.startIndex=0,t.endReached=!1),p=!1,t.searchResults=m,t.displayResults=t.searchResults.slice(0,t.scrollingItemsOnePage),t.contentLoaded=!0,a(function(){e.$broadcast("masonry.reload")},1500)};var x;t.$watch("data",function(){a.cancel(x),x=a(function(){t.data&&t.addContent()},50)}),t.addContent=function(){var n=m.map(function(e){return e.id});e.content.forEach(function(e){n.indexOf(e.id)<0&&e.ismp&&m.push(e)}),t.searchResults=JSON.parse(JSON.stringify(m)),p=!0,t.contentLoaded=!0,c()};var k;t.$watch("rod",function(){a.cancel(k),k=a(function(){if(1==t.rod&&e.rankofday){var n=e.rankofday;n[0].isrod=!0,m[0]=n[0],t.displayResults[0]=n[0]}},50)}),t.$watch("scrollactive",function(){t.disableScrolling=!t.scrollactive,a(function(){e.$broadcast("masonry.reload")},750)}),e.sm?(t.scrollingItemsOnePage=6,t.loadingCountOneScroll=3):(t.loadingCountOneScroll=6,t.scrollingItemsOnePage=12),t.scrollingItemsOnePage=12,t.scrollingData=[],t.scrollDataLoading=!1,t.content=[],t.intialDataCount=e.numInitItems,t.endReached=!1,t.disableScrolling=!0,t.scrollingData=[],t.uniqueResult=[],function(e){t.currentIndex=12,t.startIndex=0,t.loadingCountOneScroll=6,t.scrollingData=[],t.scrollDataLoading=!1,t.content=[],t.endReached=!1,t.scrollingData=[]}(),t.loadMore=function(s){if(f=o.pageYOffset,Math.abs(f-h)<v&&!s);else if(h=f,t.scrollactive){t.scrollDataLoading=!0;var r=t.displayResults.length;g=[];for(var i=r;i<r+t.scrollingItemsOnePage;i++)if(t.searchResults[i]){var c=t.displayResults.map(function(e){return e.id}).indexOf(t.searchResults[i].id);c<0&&(t.displayResults.push(t.searchResults[i]),g.push(t.searchResults[i]))}if(g.length>0&&l("ranks",g),t.scrollDataLoading=!1,t.searchResults.length-t.displayResults.length<12&&void 0!=t.relTags&&void 0!=t.relTags[t.relTagsIdx]){var d=n.searchRanks2(t.relTags[t.relTagsIdx].tag);t.relTagsIdx++,d.forEach(function(e){t.searchResults.map(function(e){return e.id}).indexOf(e.id)<0&&1==e.ismp&&t.searchResults.push(e)})}void 0!=t.relTags&&t.relTagsIdx==t.relTags.length-1&&(t.relTags=n.searchRelatedRanks(t.searchResults,t.query),t.relTagsIdx=0),t.displayResults.length==t.searchResults.length&&p&&(void 0!=t.relTags?t.relTagsIdx==t.relTags.length-1&&(t.endReached=!0):t.endReached=!0),a(function(){e.$broadcast("masonry.reload")},b)}}}}}]),angular.module("app").directive("resultItem",["$rootScope","$state","answer","table","catans","$timeout","vrows","$window","cblock","color","search",function(e,t,n,a,o,s,r,i,c,l,d){"use strict";return{templateUrl:"app/content/partials/result-block.html",transclude:!0,scope:{resultObject:"="},controller:["$scope","query","$http","answer","table","catans","$timeout","vrows","$window","cblock","color","search",function(t,n,a,o,s,r,i,c,l,d,u,g){var m=t;m.title="mycontent",m.sm=e.sm,l.innerWidth<768&&(m.thumbheight="80px"),l.innerWidth>=768&&l.innerWidth<992&&(m.thumbheight="100px"),l.innerWidth>=992&&l.innerWidth<1200&&(m.thumbheight="80px"),l.innerWidth>1200&&(m.thumbheight="100px")}],link:function(n,a,o){void 0==n.isDestroyed&&function(){var t=i.innerWidth-20;n.w2=Math.round(t/2),n.w4=Math.round(t/4)-5,n.w8=Math.round(t/8);var a={};a={},a=n.resultObject,n.result=a,1==a.isAnswer?n.title=a.name:n.title=a.title,1==a.isAnswer?n.imageurl=a.imageurl:n.imageurl=a.fimage,void 0==n.imageurl&&(n.imageurl=e.EMPTY_IMAGE),n.isAnswer=void 0!=a.isAnswer&&a.isAnswer,a.isAnswer?("Establishment"==a.type&&(n.type="Establishment"),"Event"==a.type&&(n.type="Event"),"Organization"==a.type&&(n.type="Organization"),"Person"==a.type&&(n.type="Public Figure"),"PersonCust"==a.type&&(n.type="Professional"),"Place"==a.type&&(n.type="Place"),"Short-Phrase"==a.type&&(n.type="Opinion")):n.type="Ranking",void 0==n.type&&(n.type=""),n.stats={},n.stats.views=a.views,n.stats.answers=a.answers,n.stats.numcom=a.numcom,void 0!=n.stats.numcom&&null!=n.stats.numcom||(n.stats.numcom=0),a.isAnswer?("Organization"==a.type&&(n.bc="brown",n.fc="#f8f8ff"),"Establishment"==a.type&&(n.bc="#4682b4",n.fc="#f8f8ff"),"Place"==a.type&&(n.bc="#008080",n.fc="#f8f8ff"),"Short-Phrase"==a.type&&(n.bc="#2d5a6a",n.fc="#f8f8ff"),"Event"==a.type&&(n.bc="#176ced",n.fc="#f8f8ff"),"Person"!=a.type&&"PersonCust"!=a.type||(n.bc="#c68c53",n.fc="#f8f8ff"),n.shade=-4,""==n.type&&(n.bc="#d3d3d3",n.fc="gray",n.shade=4)):(void 0!=n.imageurl&&""!=n.imageurl&&null!=n.imageurl&&n.imageurl!=e.EMPTY_IMAGE||(n.imageurl=a.image1url),n.bc="gray",n.fc="#f8f8ff",n.shade=4),"Short-Phrase"==a.type&&(n.image1=e.EMPTY_IMAGE)}(),n.resSel=function(a){1==a.isfoodnearme&&(e.isFoodNearMe=!0),e.pageYOffset=i.pageYOffset,n.stats.views++,a.isAnswer?(e.cCategory=void 0,t.go("answerDetail",{index:a.id})):e.editMode?t.go("editRanking",{index:a.slug}):t.go("rankSummary",{index:a.slug})},n.$on("$destroy",function(){n.isDestroyed=!0})}}}]),angular.module("app").directive("rankOfDay",["$rootScope","$state","answer","table","catans","$timeout","vrows","$window","cblock","color","search",function(e,t,n,a,o,s,r,i,c,l,d){"use strict";return{templateUrl:"app/content/partials/rank-of-day.html",transclude:!0,scope:{part:"="},controller:["$scope","$rootScope","query","$http","answer","table","catans","$timeout","vrows","$window","cblock","color","search","rankofday",function(e,t,n,a,o,s,r,i,c,l,d,u,g,m){function p(){var t=l.innerWidth-20;e.w2=Math.round(t/2),e.w4=Math.round(t/4)-5,e.w8=Math.round(t/8);var n={};if(n={},n=JSON.parse(JSON.stringify(e.rankObject)),f(n),h(n),e.rank=n,e.title=n.title,e.stats={},e.stats.views=n.views,e.stats.answers=n.answers,e.stats.numcom=n.numcom,void 0!=e.stats.numcom&&null!=e.stats.numcom||(e.stats.numcom=0),e.isBasic=!0,void 0!=n.fimage&&""!=n.fimage)e.image4=n.image3url,e.image3=n.image2url,e.image2=n.image1url,e.image1=n.fimage,e.bc=n.bc,e.fc=n.fc,e.shade=n.shade;else{var a=u.defaultRankColor(n);e.bc=a[0],e.fc=a[1],e.shade=-4,e.image3=n.image3url,e.image2=n.image2url,e.image1=n.image1url}}function f(e){e.titlex=e.title.replace(" in San Diego",""),0==e.answers&&"Short-Phrase"!=e.type&&(e.image1url=t.EMPTY_IMAGE)}function h(t){if("Short-Phrase"==t.type){if(t.isShortPhrase=!0,void 0!=t.image1url){var n=t.image1url.split("##");e.title1=n[0],e.addinfo1=n[1]}if(void 0!=t.image2url){var a=t.image2url.split("##");e.title2=a[0],e.addinfo2=a[1]}if(void 0!=t.image3url){var o=t.image3url.split("##");e.title3=o[0],e.addinfo3=o[1]}e.isShortPhrase=!0,e.bcp="#2952a3",e.bc2p="#5c85d6",e.fcp="#e6e6e6"}}var v=e;v.title="mycontent",t.rankofday?(e.rankObject=t.rankofday,p()):m.getrankofday().then(function(n){e.rankObject=t.rankofday=n,p()}),v.sm=t.DISPLAY_XSMALL,v.maxRes=2,l.innerWidth<768&&(v.thumbheight="80px"),l.innerWidth>=768&&l.innerWidth<992&&(v.thumbheight="100px"),l.innerWidth>=992&&l.innerWidth<1200&&(v.thumbheight="80px"),l.innerWidth>1200&&(v.thumbheight="100px")}],link:function(n){n.rankSel=function(n,a){a?$rootscope.rankIsNearMe=!0:e.rankIsNearMe=!1,e.editMode?t.go("editRanking",{index:n.slug}):t.go("rankSummary",{index:n.slug})},n.$on("$destroy",function(){n.isDestroyed=!0})}}}]),angular.module("app").directive("rankItem",["$rootScope","$state","answer","table","catans","$timeout","vrows","$window","cblock","color","search",function(e,t,n,a,o,s,r,i,c,l,d){"use strict";return{templateUrl:"app/content/partials/rank-block.html",transclude:!0,scope:{rankObject:"="},controller:["$scope","query","$http","answer","table","catans","$timeout","vrows","$window","cblock","color","search",function(t,n,a,o,s,r,i,c,l,d,u,g){var m=t;m.title="mycontent",m.sm=e.sm,l.innerWidth<768&&(m.thumbheight="80px"),l.innerWidth>=768&&l.innerWidth<992&&(m.thumbheight="100px"),l.innerWidth>=992&&l.innerWidth<1200&&(m.thumbheight="80px"),l.innerWidth>1200&&(m.thumbheight="100px")}],link:function(n){function a(t){0==t.answers&&"Short-Phrase"!=t.type&&(t.image1url=e.EMPTY_IMAGE)}void 0==n.isDestroyed&&function(){var e=i.innerWidth-20;n.w2=Math.round(e/2),n.w4=Math.round(e/4)-5,n.w8=Math.round(e/8);var t={};if(t={},t=n.rankObject,n.rank=t,a(n.rankObject),n.title=t.title,n.rod=t.isrod,n.stats={},n.stats.views=t.views,n.stats.answers=t.answers,n.stats.numcom=t.numcom,void 0!=n.stats.numcom&&null!=n.stats.numcom||(n.stats.numcom=0),void 0!=t.fimage&&""!=t.fimage)if(n.image4=t.image3url,n.image3=t.image2url,n.image2=t.image1url,n.image1=t.fimage,void 0!=t.bc&&""!=t.bc)n.bc=t.bc,n.fc=t.fc,n.shade=t.shade;else{var o=l.defaultRankColor(t);n.bc=o[0],n.fc=o[1],n.shade=-4}else{var o=l.defaultRankColor(t);n.bc=o[0],n.fc=o[1],n.shade=-4,n.image3=t.image3url,n.image2=t.image2url,n.image1=t.image1url}}(),n.rankSel=function(n,a){e.rankIsNearMe=!!a,e.editMode?t.go("editRanking",{index:n.slug}):t.go("rankSummary",{index:n.slug})},n.$on("$destroy",function(){n.isDestroyed=!0})}}}]),angular.module("app").directive("rankBlock",["$rootScope","$state","answer","table","catans","$timeout","vrows","$window","cblock","color","search",function(e,t,n,a,o,s,r,i,c,l,d){"use strict";return{templateUrl:"app/content/partials/rank-block.html",transclude:!0,scope:{theme:"@",type:"@"},controller:["$scope","query","$http","answer","table","catans","$timeout","vrows","$window","cblock","color","search",function(t,n,a,o,s,r,i,c,l,d,u,g){var m=t;m.title="mycontent",m.sm=e.sm,l.innerWidth<768&&(m.thumbheight="80px"),l.innerWidth>=768&&l.innerWidth<992&&(m.thumbheight="100px"),l.innerWidth>=992&&l.innerWidth<1200&&(m.thumbheight="80px"),l.innerWidth>1200&&(m.thumbheight="100px")}],link:function(n){function a(e){for(var t,n,a=e.length;0!==a;)n=Math.floor(Math.random()*a),a-=1,t=e[a],e[a]=e[n],e[n]=t;return e}function o(t){t.titlex=t.title.replace(" in San Diego",""),0==t.answers&&"Short-Phrase"!=t.type&&(t.image1url=e.EMPTY_IMAGE)}function s(e){if("Short-Phrase"==e.type){if(e.isShortPhrase=!0,void 0!=e.image1url){var t=e.image1url.split("##");e.title1=t[0],e.addinfo1=t[1]}if(void 0!=e.image2url){var n=e.image2url.split("##");e.title2=n[0],e.addinfo2=n[1]}if(void 0!=e.image3url){var a=e.image3url.split("##");e.title3=a[0],e.addinfo3=a[1]}}}void 0==n.isDestroyed&&function(){console.log("-------------------load content------------------");var t="",r=[],c=0;n.results=[];var d=i.innerWidth-20;n.w2=Math.round(d/2),n.w4=Math.round(d/4)-5,n.w8=Math.round(d/8);for(var u=0;u<e.cblocks.length;u++)if("city"==e.cblocks[u].scope&&e.isCity&&e.cblocks[u].type==n.theme){t=e.cblocks[u].catstr,r=t.split(":"),a(r);for(var g=0;g<r.length;g++)c=e.content.map(function(e){return e.id}).indexOf(Number(r[g])),
n.results.push(e.content[c]);break}n.resultsTop=[];var m={},p=n.results.length;if(p>0)for(var f=0;f<p;f++)m={},m=JSON.parse(JSON.stringify(n.results[f])),n.results[f].image1url!=e.EMPTY_IMAGE&&void 0!=n.results[f].image1url&&""!=n.results[f].image1url&&(o(m),s(m),"Short-Phrase"==m.type&&void 0==m.fimage||n.resultsTop.push(m));var h=n.resultsTop[0];if(n.title=h.title,n.stats={},n.stats.views=h.views,n.stats.answers=h.answers,n.stats.numcom=h.numcom,void 0!=n.stats.numcom&&null!=n.stats.numcom||(n.stats.numcom=0),"basic"==n.type&&(n.isBasic=!0),"grid4"==n.type&&(n.isGrid4=!0),void 0!=h.fimage&&""!=h.fimage)n.image4=h.image3url,n.image3=h.image2url,n.image2=h.image1url,n.image1=h.fimage,n.bc=h.bc,n.fc=h.fc,n.shade=h.shade;else{var v=l.defaultRankColor(h);n.bc=v[0],n.fc=v[1],n.shade=-4,n.image3=h.image3url,n.image2=h.image2url,n.image1=h.image1url}}(),n.rankSel=function(n,a){e.rankIsNearMe=!!a,e.editMode?t.go("editRanking",{index:n.slug}):t.go("rankSummary",{index:n.slug})},n.$on("$destroy",function(){n.isDestroyed=!0})}}}]),angular.module("app").directive("facebookFollow",["$rootScope","$state","answer","table","catans","$timeout","vrows","$window","cblock","color","search",function(e,t,n,a,o,s,r,i,c,l,d){"use strict";return{templateUrl:"app/content/partials/facebook-follow.html",transclude:!0,scope:{theme:"@",type:"@"},controller:["$scope","query","$http","answer","table","catans","$timeout","vrows","$window","cblock","color","search",function(e,t,n,a,o,s,r,i,c,l,d,u){}],link:function(e){}}}]),angular.module("app").directive("contentBlock",["$rootScope","$state","search","$timeout","$window",function(e,t,n,a,o){"use strict";return{templateUrl:"app/content/partials/content-block.html",transclude:!0,scope:{query:"@",ans:"=",ranks:"=",length:"="},controller:["$scope",function(e){o.innerWidth<768&&(e.itemWidth=(o.innerWidth-8)/2),o.innerWidth>=768&&o.innerWidth<992&&(e.itemWidth=(o.innerWidth-8)/3),o.innerWidth>=992&&o.innerWidth<1200&&(e.itemWidth=(o.innerWidth-8)/4),o.innerWidth>1200&&(e.itemWidth=(o.innerWidth-8)/6)}],link:function(o){o.rankSel=function(n,a){if(o.disableScrolling=!0,n.useTemp){e.rankIsNearMe=!!a;for(var s={},r=0;r<e.content.length;r++)n.id==e.content[r].cat&&n.locationId==e.content[r].nh&&(s=e.content[r]);if(void 0==s.id){var i=0;e.content.forEach(function(e){e.id>i&&(i=e.id)}),i++;var c=n.title.toLowerCase();c=c.replace(/ /g,"-"),c=c.replace("/","at"),c=c+"-"+i;var l={id:i,catstr:""+i,slug:c,isGhost:!0,title:n.title,type:n.type,tags:n.tags,keywords:n.keywords,question:n.question,fimage:n.fimage,bc:n.bc,fc:n.fc,shade:n.shade,introtext:n.introtext,user:n.user,views:0,answers:0,image1url:e.EMPTY_IMAGE,image2url:e.EMPTY_IMAGE,image3url:e.EMPTY_IMAGE,answertags:"",isatomic:1,timestmp:new Date,cat:n.id,nh:n.locationId};e.content.push(l),e.searchStrContent.push(l.tags?l.tags:""),t.go("rankSummary",{index:c})}else e.editMode?t.go("editRanking",{index:s.slug}):t.go("rankSummary",{index:s.slug})}else e.editMode?t.go("editRanking",{index:n.slug}):t.go("rankSummary",{index:n.slug})},o.ansSel=function(n){e.cCategory=void 0,o.disableScrolling=!0,t.go("answerDetail",{index:n.slug})},o.resRanks=[],o.resAnswers=[],o.searchResults=[],o.maxRes=4e3;var s;o.$watch("query",function(){a.cancel(s),s=a(function(){o.getResults()},300)}),o.getResults=function(){o.useTemp=!1,o.resRanks=[];var e=[];if(o.ranks){e=[],o.resRanks=n.searchRanks2(o.query),e=n.searchRanks(o.query);for(var t=o.resRanks.map(function(e){return e.cat}),a=0;a<e.length;a++)t.indexOf(e[a].id)<0&&o.resRanks.push(e[a]);o.resRanks.length>0&&(o.disableScrolling=!1,o.currentIndex=o.intialDataCount,o.startIndex=0,o.endReached=!1)}o.length=o.resRanks.length+o.resAnswers.length,o.searchResults=o.resRanks},o.currentIndex=0,o.startIndex=0,e.sm?(o.scrollingItemsOnePage=6,o.loadingCountOneScroll=3):(o.loadingCountOneScroll=6,o.scrollingItemsOnePage=6),o.scrollingItemsOnePage=1e3,o.scrollingData=[],o.scrollDataLoading=!1,o.content=[],o.intialDataCount=12,o.endReached=!1,o.disableScrolling=!0,o.scrollingData=[],o.uniqueResult=[],function(e){o.currentIndex=12,o.startIndex=0,o.loadingCountOneScroll=6,o.scrollingData=[],o.scrollDataLoading=!1,o.content=[],o.endReached=!1,o.scrollingData=[]}(),o.loadMore=function(){o.scrollDataLoading=!0,a(function(){o.currentIndex=o.currentIndex+12,o.currentIndex>=o.searchResults.length&&(o.endReached=!0),o.currentIndex-o.startIndex>o.scrollingItemsOnePage&&(o.startIndex=o.currentIndex-o.scrollingItemsOnePage),o.scrollDataLoading=!1},500)}}}}]),angular.module("app").directive("answerItem",["$rootScope","$state","answer","table","catans","$timeout","vrows","$window","cblock","color","search",function(e,t,n,a,o,s,r,i,c,l,d){"use strict";return{templateUrl:"app/content/partials/answer-block.html",transclude:!0,scope:{answerObject:"="},controller:["$scope","query","$http","answer","table","catans","$timeout","vrows","$window","cblock","color","search",function(t,n,a,o,s,r,i,c,l,d,u,g){var m=t;m.title="mycontent",m.sm=e.sm,l.innerWidth<768&&(m.thumbheight="80px"),l.innerWidth>=768&&l.innerWidth<992&&(m.thumbheight="100px"),l.innerWidth>=992&&l.innerWidth<1200&&(m.thumbheight="80px"),l.innerWidth>1200&&(m.thumbheight="100px")}],link:function(n){function a(e){if("Short-Phrase"==e.type){if(e.isShortPhrase=!0,void 0!=e.image1url){var t=e.image1url.split("##");e.title1=t[0],e.addinfo1=t[1]}if(void 0!=e.image2url){var n=e.image2url.split("##");e.title2=n[0],e.addinfo2=n[1]}if(void 0!=e.image3url){var a=e.image3url.split("##");e.title3=a[0],e.addinfo3=a[1]}}}void 0==n.isDestroyed&&function(){var t=i.innerWidth-20;n.w2=Math.round(t/2),n.w4=Math.round(t/4)-5,n.w8=Math.round(t/8);var o={};o={},o=JSON.parse(JSON.stringify(n.answerObject)),n.answer=o,"Short-Phrase"==o.type&&a(o),n.stats={},n.stats.views=o.views,n.stats.answers=o.answers,n.stats.numcom=o.numcom,void 0!=n.stats.numcom&&null!=n.stats.numcom||(n.stats.numcom=0);var s=Math.floor(5*Math.random())+1;1==s&&(n.bc="brown",n.fc="#f8f8ff"),2==s&&(n.bc="#4682b4",n.fc="#f8f8ff"),3==s&&(n.bc="#008080",n.fc="#f8f8ff"),4==s&&(n.bc="gray",n.fc="#f8f8ff"),5==s&&(n.bc="#c68c53",n.fc="#f8f8ff"),n.shade=-4,void 0!=o.imageurl&&""!=o.imageurl&&null!=o.imageurl?n.image1=o.imageurl:n.image1=e.EMPTY_IMAGE,"Short-Phrase"==o.type&&(n.image1=e.EMPTY_IMAGE)}(),n.ansSel=function(e){t.go("answerDetail",{index:e.slug})},n.$on("$destroy",function(){n.isDestroyed=!0})}}}]),angular.module("app").directive("fileModel",["$parse",function(e){"use strict";return{restrict:"A",link:function(t,n,a){var o=e(a.fileModel),s=o.assign;n.bind("change",function(){t.$apply(function(){s(t,n[0].files[0])})})}}}]),angular.module("app").directive("bgBox3",["color","$timeout","$rootScope",function(e,t,n){"use strict";return{templateUrl:"app/common/partials/bgbox3.html",transclude:!0,scope:{bc:"@",bc2:"@",fc:"@",shade:"@",text:"@",dir:"@",stats:"@",w:"@",h:"@",introtext:"@",type:"@",imageurl:"@",isAnswer:"@"},link:function(a){t(function(){a.showStats="Ranking"==a.type&&"Food Near Me"!=a.text;var t=JSON.parse(a.stats);a.views=t.views,a.answers=t.answers,a.comments=t.numcom,1==n.DISPLAY_XSMALL?a.sm=!0:a.sm=!1,"horizontal"==a.dir&&(a.dirHor=!0,a.dirVer=!1),"vertical"==a.dir&&(a.dirHor=!1,a.dirVer=!0),void 0==a.bc2&&(a.bc2=e.shadeColor(a.bc,a.shade/10))}),a.$on("$destroy",function(){a.isDestroyed=!0}),a.addView=function(){a.views++}}}}]),angular.module("app").directive("bgBox2",["color","$timeout",function(e,t){"use strict";return{templateUrl:"app/common/partials/bgbox2.html",transclude:!0,scope:{bc:"@",bc2:"@",fc:"@",shade:"@",text:"@",dir:"@",stats:"@",w:"@",h:"@",question:"@",isRankOfDay:"@"},link:function(n,a,o){t(function(){var t=JSON.parse(n.stats);n.views=t.views,n.answers=t.answers,n.comments=t.numcom,"horizontal"==n.dir&&(n.dirHor=!0,n.dirVer=!1),"vertical"==n.dir&&(n.dirHor=!1,n.dirVer=!0),void 0==n.bc2&&(n.bc2=e.shadeColor(n.bc,n.shade/10))}),n.$on("$destroy",function(){n.isDestroyed=!0})}}}]),angular.module("app").directive("bgBox",["color",function(e){"use strict";return{templateUrl:"app/common/partials/bgbox.html",transclude:!0,scope:{bc:"@",bc2:"@",fc:"@",shade:"@",text:"@",dir:"@",w:"@",h:"@"},link:function(t){"horizontal"==t.dir&&(t.dirHor=!0,t.dirVer=!1),"vertical"==t.dir&&(t.dirHor=!1,t.dirVer=!0),void 0==t.bc2&&(t.bc2=e.shadeColor(t.bc,t.shade/10))}}}]),function(){"use strict";function e(e,t,n,a){function o(a){function o(e){return d=e.data.resource}if(c()&&!a)return t.when(d);var s=u+"?filter=user="+n.user.id;return e.get(s).then(o,l)}function s(t,o){function s(e){var t=i;return t.id=e.data.resource[0].id,d.push(t),n.cvrowvotes.push(t),1==i.val&&a.post("upVotedVrow",["answer","vrow"],[i.answer,t.vrow]),-1==i.val&&a.post("downVotedVrow",["answer","vrow"],[i.answer,t.vrow]),n.DEBUG_MODE&&console.log("Creating new vrowvoting record was succesful"),e.data}var r={};r.resource=[];var i={};i.user=n.user.id,i.answer=n.canswer.id,i.vrow=t,i.val=o,i.timestmp=Date.now(),r.resource.push(i);var c=u;return e.post(c,r,{headers:{"Content-Type":"multipart/form-data"},body:r}).then(s,l)}function r(t,a){function o(e){return n.DEBUG_MODE&&console.log("Updating vrow vote record was succesful"),e.data}var s={};s.resource=[];var r={};r.id=t,r.val=a,r.timestmp=Date.now(),s.resource.push(r);var i=u,c=d.map(function(e){return e.id}).indexOf(t);return d[c].vote=a,d[c].timestmp=r.timestmp,e.patch(i,s,{headers:{"Content-Type":"multipart/form-data"},body:s}).then(o,l)}function i(t){function a(e){return n.DEBUG_MODE&&console.log("Deleting vrow votes records was succesful"),e.data}for(var o=0;o<d.length;o++)d[o].vrow==t&&d.splice(o,1);var s=u+"?filter=vrow="+t;return e.delete(s).then(a,l)}function c(e){return d.length>0}function l(e){throw e}var d=[],u="/api/v2/mysql/_table/vrowvotes";return{loadVrowVotes:o,patchRec:r,postRec:s,deleteVrowVotesbyVrow:i}}angular.module("app").factory("vrowvotes",e),e.$inject=["$http","$q","$rootScope","uaf"]}(),function(){"use strict";function e(e,t,n,a){function o(a){var o=h+"?offset=0",s=e.get(o);return t.all([s]).then(function(e){return g(e[0].data.resource),n.DEBUG_MODE&&console.log("No. Vrows: ",p.length),p},m)}function s(a){var o=[];if(a.forEach(function(e){f.indexOf(e.answer)<0&&(o.push(e),f.push(e.answer))}),0==o.length)return t.when(!1);for(var s="?filter=(",r=0;r<o.length;r++)s=s+"answer="+o[r].answer+")OR(";s=s.substring(0,s.length-3);var i=h+s,c=e.get(i);return t.all([c]).then(function(e){var t=e[0].data.resource,a=p.map(function(e){return e.id});return t.forEach(function(e){a.indexOf(e.id)<0&&p.push(e)}),n.DEBUG_MODE&&console.log("No. Vrows: ",p.length),t},m)}function r(t){function a(e){var t=o;return t.id=e.data.resource[0].id,p.push(t),e.data}var o={};o.title=t,o.answer=n.canswer.id,o.gtitle="",o.user=n.user.id,o.gnum=0,o.upV=0,o.downV=0,o.timestmp=Date.now();var s={};s.resource=[],s.resource.push(o);var r=h;return e.post(r,s,{headers:{"Content-Type":"multipart/form-data"},body:s}).then(a,m)}function i(t){function n(e){for(var t=p.length-1,n=e.data.resource.length-1;n>=0;n--)p[t].id=e.data.resource[n].id,t--;return e.data}var a={};a.resource=[],a.resource.push(t),p.push.apply(p,t);var o=h;return e.post(o,t,{headers:{"Content-Type":"multipart/form-data"},body:a}).then(n,m)}function c(t){function o(e){for(var t=0;t<e.data.resource.length;t++)a.deleteVrowVotesbyVrow(e.data.resource[t].id);return n.DEBUG_MODE&&console.log("Deleting vrows records for answer was succesful"),e.data}for(var s=0;s<p.length;s++)p[s].answer==t&&p.splice(s,1);var r=h+"?filter=answer="+t;return e.delete(r).then(o,m)}function l(t,o){function s(e){for(var t=0;t<e.data.resource.length;t++)a.deleteVrowVotesbyVrow(e.data.resource[t].id);return n.DEBUG_MODE&&console.log("Deleting vrows records for group was succesful"),e.data}for(var r=p.length-1;r>=0;r--)p[r].gnum==t&&p.splice(r,1);var i=h+"?filter=(gnum="+t+") AND (answer="+o+")";return e.delete(i).then(s,m)}function d(t){function o(e){for(var t=0;t<e.data.resource.length;t++)a.deleteVrowVotesbyVrow(e.data.resource[t].id);return n.DEBUG_MODE&&console.log("Deleting vrow was succesful"),e.data}var s={};s.resource=[];var r={};r.id=t,s.resource.push(r);var i=h+"/"+t,c=p.map(function(e){return e.id}).indexOf(t);return c>-1&&p.splice(c,1),e.delete(i,r,{headers:{"Content-Type":"multipart/form-data"},body:s}).then(o,m)}function u(t,a,o){function s(e){return n.DEBUG_MODE&&console.log("updating vrows record succesful"),e.data}var r={};r.resource=[];var i={};i.id=t;for(var c=0;c<a.length;c++)i[a[c]]=o[c];r.resource.push(i);for(var l=h,d=p.map(function(e){return e.id}).indexOf(t),c=0;c<a.length;c++)p[d][a[c]]=o[c];return e.patch(l,r,{headers:{"Content-Type":"multipart/form-data"},body:r}).then(s,m)}function g(e){p.length=0,e.forEach(function(e){p.push(e)})}function m(e){throw e}var p=[],f=[];n.cvrows=p;var h="/api/v2/mysql/_table/vrows";return{getAllvrows:o,getVrowsX:s,postRec:r,postRec2:i,deleteVrowByAnswer:c,deleteVrow:d,updateRec:u,deleteVrowByGroup:l}}angular.module("app").factory("vrows",e),e.$inject=["$http","$q","$rootScope","vrowvotes"]}(),function(){"use strict";function e(e,t,n,a){function o(a){function o(e){return p=e.data.resource}if(u()&&!a)return t.when(p);var s=f+"/?filter=user="+n.user.id;return e.get(s).then(o,g)}function s(t){function a(e){return e.data.resource}for(var o="",s=0;s<n.user.friends.data.length;s++)o+="(user=",o+=n.user.friends.data[s].id,o+=")",s!=n.user.friends.data.length-1&&(o+=" or ");var r=f+"/?filter="+o;return e.get(r).then(a,g)}function r(t){function n(e){return p=e.data.resource}var a=f;return e.get(a).then(n,g)}function i(t,o,s,r){function i(e){var t=l;return t.id=e.data.resource[0].id,p.push(t),1==l.vote&&a.post("upVoted",["answer","category"],[o,s]),-1==l.vote&&a.post("downVoted",["answer","category"],[o,s]),n.$emit("updateVoteTable"),console.log("Creating new voting record was succesful"),e.data}var c={};c.resource=[];var l={};l.user=n.user.id,l.catans=t,l.answer=o,l.vote=r,l.timestmp=Date.now(),c.resource.push(l);var d=f;return e.post(d,c,{headers:{"Content-Type":"multipart/form-data"},body:c}).then(i,g)}function c(t,a){function o(e){return n.DEBUG_MODE&&console.log("Updating vote record was succesful"),e.data}var s={};s.resource=[];var r={};r.id=t,r.vote=a,r.timestmp=Date.now(),s.resource.push(r);var i=f,c=p.map(function(e){return e.id}).indexOf(t);return p[c].vote=a,p[c].timestmp=r.timestmp,e.patch(i,s,{headers:{"Content-Type":"multipart/form-data"},body:s}).then(o,g)}function l(t){function a(e){return n.DEBUG_MODE&&console.log("Deleting vote records by Catans was succesful"),e.data}for(var o=0;o<p.length;o++)p[o].catans==t&&p.splice(o,1);var s=f+"/?filter=catans="+t;return e.delete(s).then(a,g)}function d(t){function a(e){return n.DEBUG_MODE&&console.log("Deleting vote record was succesful"),e.data}for(var o=0;o<p.length;o++)p[o].id==t&&p.splice(o,1);var s=f+"/"+t;return e.delete(s).then(a,g)}function u(e){return p.length>0}function g(e){throw e}function m(t){function n(e){return e.data.resource}for(var a="(",o=0;o<t.length;o++)a+="(answer=",a+=t[o],a+=")",o!=t.length-1&&(a+=" or ");a+=" and (timestmp > "+moment().subtract(1,"month").startOf("month").format("YYYY-MM-DD")+")",a+=" and (vote = 1))";var s=f+"/?filter="+a;return e.get(s).then(n,g)}var p=[],f="/api/v2/mysql/_table/votetable";return{loadVotesByUser:o,loadAllVotes:r,patchRec:c,postRec:i,deleteVotesbyCatans:l,deleteRec:d,loadVotesByMyFriends:s,loadLastMonthVoting:m}}angular.module("app").factory("votes",e),e.$inject=["$http","$q","$rootScope","uaf"]}(),function(){"use strict";function e(e,t,n){function a(t){function n(e){return l(e.data.resource),u}var a=p;return e.get(a).then(n,d)}function o(a){function o(e){var t=e.data.resource,a=u.map(function(e){return e.id});return t.forEach(function(e){a.indexOf(e.id)<0&&u.push(e)}),n.DEBUG_MODE&&console.log("useractivityX loaded"),u}var s=[];if(0!=a&&a.forEach(function(e){g.indexOf(e.category)<0&&(s.push(e),g.push(e.category))}),0==s.length)return t.when(!1);for(var r="?filter=(",i=0;i<s.length;i++)r=r+"category="+s[i].category+")OR(";r=r.substring(0,r.length-3);var c=p+r;return e.get(c).then(o,d)}function s(){function t(e){return m=e.data.resource}var a=p+"/?filter=user="+n.user.id;return e.get(a).then(t,d)}function r(t){function a(e){var t=o;return t.id=e.data.resource[0].id,u.push(t),n.thisuseractivity.push(t),n.DEBUG_MODE&&console.log("creating useractivity record was succesful"),e.data}var o={};o.user=n.user.id,o.category=t,o.votes=1,o.timestmp=Date.now();var s={};s.resource=[],s.resource.push(o);var r=p;return e.post(r,s,{headers:{"Content-Type":"multipart/form-data"},body:s}).then(a,d)}function i(t,a){function o(e){return n.DEBUG_MODE&&console.log("Updating useractivity record was succesful"),e.data}var s={};s.resource=[];var r={};r.id=t,r.user=n.user.id,r.votes=a,r.timestmp=Date.now(),s.resource.push(r);var i=p,c=u.map(function(e){return e.id}).indexOf(t);return u[c].votes=a,e.patch(i,s,{headers:{"Content-Type":"multipart/form-data"},body:s}).then(o,d)}function c(t){function a(e){return n.DEBUG_MODE&&console.log("Deleting user activity record was succesful"),e.data}var o=u.map(function(e){return e.id}).indexOf(t);o>-1&&u.splice(o,1);var s=p+"/"+t;return e.delete(s).then(a,d)}function l(e){u.length=0,e.forEach(function(e){u.push(e)})}function d(e){throw e}var u=[],g=[];n.alluseractivity=u;var m=[],p="/api/v2/mysql/_table/useractivity";return{getAllUserActivity:a,getAllUserActivityX:o,getActivitybyUser:s,postRec:r,patchRec:i,deleteRec:c}}angular.module("app").factory("useractivity",e),e.$inject=["$http","$q","$rootScope"]}(),function(){"use strict";function e(e,t,n){function a(a){var o=u+"?limit=100&order=id%20DESC",s=e.get(o);return t.all([s]).then(function(e){return c(e[0].data.resource),n.DEBUG_MODE&&console.log("No. user actions: ",d.length),d},l)}function o(a){var o=u+"?limit=20&order=id%20DESC&offset="+n.uafs.length,s=e.get(o);return t.all([s]).then(function(e){var t=e[0].data.resource,a=d.map(function(e){return e.id});return t.forEach(function(e){a.indexOf(e.id)<0&&d.push(e)}),n.DEBUG_MODE&&console.log("No. user actions: ",d.length),d},l)}function s(t,a,o){function s(e){var t=g;return t.id=e.data.resource[0].id,d.push(t),n.DEBUG_MODE&&console.log("Posted user activity feed"),e.data}var r=u,c={};c.bc="",c.fc="";var g={},m=0;g.userid=n.user.id,g.action=t,g.initials=n.user.name.replace(/[^A-Z]/g,""),i(n.user.id,c),g.fc=c.fc,g.bc=c.bc,g.date=moment().format("YYYY-MM-DD"),g.actorusername=n.user.first_name;for(var p=0;p<a.length;p++)switch(a[p]){case"answer":g.answer=o[p],m=n.answers.map(function(e){return e.id}).indexOf(g.answer),g.text1=n.answers[m].name;break;case"category":g.category=o[p],m=n.content.map(function(e){return e.id}).indexOf(g.category),g.text2=n.content[m].title;break;case"comment":g.comment=o[p];break;case"edit":g.edit=o[p],m=n.edits.map(function(e){return e.id}).indexOf(g.edit),g.text2=n.edits[m].field;break;case"vrow":g.vrow=o[p],m=n.cvrows.map(function(e){return e.id}).indexOf(g.vrow),g.text2=n.cvrows[m].title;break;case"text1":g.text1=o[p];break;case"text2":g.text2=o[p]}var f=[];return f.push(g),e.post(r,f,{headers:{"Content-Type":"multipart/form-data"},body:f}).then(s,l)}function r(t){function a(e){return n.DEBUG_MODE&&console.log("Deleting user activity feed was succesful"),e.data}var o={};o.resource=[];var s={};s.id=t,o.resource.push(s);var r=u+"/"+t,i=d.map(function(e){return e.id}).indexOf(t);return i>-1&&d.splice(i,1),e.delete(r,s,{headers:{"Content-Type":"multipart/form-data"},body:o}).then(a,l)}function i(e,t){switch(e%10){case 0:t.bc="#b3b3b3",t.fc="black";break;case 1:t.bc="#666666",t.fc="white";break;case 2:t.bc="#006bb3",t.fc="white";break;case 3:t.bc="#009933",t.fc="white";break;case 4:t.bc="#cc0000",t.fc="white";break;case 5:t.bc="#538cc6",t.fc="black";break;case 6:t.bc="#b36b00",t.fc="white";break;case 7:t.bc="#999966",t.fc="black";break;case 8:t.bc="#4d0099",t.fc="white";break;case 9:t.bc="#009999",t.fc="black"}}function c(e){d.length=0,e.forEach(function(e){d.push(e)})}function l(e){throw e}var d=[];n.uafs=d;var u="/api/v2/mysql/_table/useractivityfeed";return{getactions:a,post:s,deletebyId:r,getnext10actions:o}}angular.module("app").factory("uaf",e),e.$inject=["$http","$q","$rootScope"]}(),function(){"use strict";function e(e,t){function n(n){function a(e){return i=e.data.resource}if(o()&&!n)return t.when(i);var r=c;return e.get(r).then(a,s)}function a(t,n){function a(e){return r=e.data}var o=c+"/?fields=field&filter=tableid="+t;return e.get(o).then(a,s)}function o(){return i.length>0}function s(e){throw e}var r,i=[],c="/api/v2/mysql/_table/tablefield";return{getAllTableFields:n,getTableFields:a}}angular.module("app").factory("tablefield",e),e.$inject=["$http","$q"]}(),function(){"use strict";function e(e,t,n,a){function o(o){delete e.defaults.headers.common["X-Dreamfactory-API-Key"],delete e.defaults.headers.common["X-DreamFactory-Session-Token"];var c=r+"?key="+i+"&q="+o+"&image_type=photo";return e.get(c).then(function(o){return s=[],s=o.data.hits,t.DEBUG_MODE&&console.log("pixabay results success! - ",o),e.defaults.headers.common["X-Dreamfactory-API-Key"]=n,e.defaults.headers.common["X-DreamFactory-Session-Token"]=a.session_token,s},function(){e.defaults.headers.common["X-Dreamfactory-API-Key"]=n,e.defaults.headers.common["X-DreamFactory-Session-Token"]=a.session_token,t.DEBUG_MODE&&console.log("Problem getting Pixabay Images")})}var s=[],r="https://pixabay.com/api/",i="5296312-7285c9a61e74685606fe28209";return{search:o}}angular.module("app").factory("pixabay",e),e.$inject=["$http","$rootScope","APP_API_KEY","$cookies"]}(),function(){"use strict";function e(e,t,n,a,o){function s(o){delete e.defaults.headers.common["X-Dreamfactory-API-Key"],delete e.defaults.headers.common["X-DreamFactory-Session-Token"],e.defaults.headers.common.Authorization=l,console.log("$http.defaults ",e.defaults);var s=c+"/v1/search?query="+o;return e.get(s).then(function(o){return i=[],i=o.data.photos,t.DEBUG_MODE&&console.log("pexels results success! - ",results),delete e.defaults.headers.common.Authorization,e.defaults.headers.common["X-Dreamfactory-API-Key"]=n,e.defaults.headers.common["X-DreamFactory-Session-Token"]=a.session_token,i},function(){delete e.defaults.headers.common.Authorization,e.defaults.headers.common["X-Dreamfactory-API-Key"]=n,e.defaults.headers.common["X-DreamFactory-Session-Token"]=a.session_token,t.DEBUG_MODE&&console.log("Problem getting pexels Images")})}function r(t){var n={};return n.query=t,e({method:"POST",data:n,url:o+"ImageServer/requestPexels",headers:{"X-Dreamfactory-API-Key":void 0,"X-DreamFactory-Session-Token":void 0}})}var i=[],c="http://api.pexels.com",l="563492ad6f9170000100000116ed76e3fd2b47bb574fb0174737aaf8";return{search:s,reqFromServer:r}}angular.module("app").factory("pexels",e),e.$inject=["$http","$rootScope","APP_API_KEY","$cookies","SERVER_URL"]}(),function(){"use strict";function e(e,t){function n(){t.igimages=[];var n=(t.canswer.name.replace(" ",""),"https://api.instagram.com/v1/tags/rankxdemo/media/recent?access_token=4368719989.c46745e.407288e972a64c119093166b8ba280c0&callback=JSON_CALLBACK");return t.DEBUG_MODE&&console.log(n),e.jsonp(n).success(function(e){var n={};t.DEBUG_MODE&&console.log(e);for(var a=0;a<e.data.length;a++)n={},n.url=e.data[a].images.standard_resolution.url,n.caption=e.data[a].caption?e.data[a].caption.text:void 0,n.from=e.data[a].user.username,t.igimages.push(n),t.DEBUG_MODE&&console.log(e.data[a].images.standard_resolution.url)})}return{getImages:n}}angular.module("app").factory("instagram",e),e.$inject=["$http","$rootScope"]}(),function(){"use strict";function e(e,t){function n(){function n(e){var n=new X2JS,a=n.xml_str2json(e.data),o={},s=[],r=a.EnumerationResults.Blobs.Blob;if(r&&r.constructor===Array)for(var i=0;i<r.length;i++)o={},o.url="https://rankx.blob.core.windows.net/sandiego/"+r[i].Name,o.type="azure-uploaded",o.size=r[i].Properties["Content-Length"]/1024,s.push(o);else r&&r.constructor===Object&&(o={},o.url="https://rankx.blob.core.windows.net/sandiego/"+r.Name,o.type="Uploaded",o.size=r.Properties["Content-Length"]/1024,s.push(o));return t.DEBUG_MODE&&console.log("query succeded"),s}function a(e){t.DEBUG_MODE&&console.log("image query failed")}return e.get("https://rankx.blob.core.windows.net/sandiego?restype=container&comp=list&prefix=featuredImages/&sv=2015-04-05&ss=bfqt&srt=sco&sp=rwdlacup&se=2018-08-30T01:15:12Z&st=2016-08-29T17:15:12Z&spr=https,http&sig=PpyWE0X%2Fpz9SuRje5GtHh44WaWIii0GBU9PbIcDIka8%3D").then(n,a)}function a(){function n(e){var n=new X2JS,a=n.xml_str2json(e.data),o={},s=a.EnumerationResults.Blobs.Blob;if(void 0!=s)if(s&&s.constructor===Array)for(var r=0;r<s.length;r++)o={},o.url="https://rankx.blob.core.windows.net/sandiego/"+s[r].Name,o.type="azure-uploaded",t.blobs.push(o);else s&&s.constructor===Object&&(o={},o.url="https://rankx.blob.core.windows.net/sandiego/"+s.Name,o.type="Uploaded",t.blobs.push(o));else t.blobs=[];t.DEBUG_MODE&&console.log("query succeded")}function a(e){t.DEBUG_MODE&&console.log("image query failed")}var o="https://rankx.blob.core.windows.net/sandiego?restype=container&comp=list&prefix="+t.canswer.id+"/&sv=2015-04-05&ss=bfqt&srt=sco&sp=rwdlacup&se=2018-08-30T01:15:12Z&st=2016-08-29T17:15:12Z&spr=https,http&sig=PpyWE0X%2Fpz9SuRje5GtHh44WaWIii0GBU9PbIcDIka8%3D";return e.get(o).then(n,a)}function o(n){function a(e){t.$emit("refreshImages"),t.DEBUG_MODE&&console.log("Blob image deleted succesfully")}function o(e){t.DEBUG_MODE&&console.log("Blob image delete failed")}t.DEBUG_MODE&&console.log("blobname, ",n);var s=n+"?sv=2015-04-05&ss=bfqt&srt=sco&sp=rwdlacup&se=2018-08-30T01:15:12Z&st=2016-08-29T17:15:12Z&spr=https,http&sig=PpyWE0X%2Fpz9SuRje5GtHh44WaWIii0GBU9PbIcDIka8%3D";return e.delete(s).then(a,o)}return{getImageList:a,deleteBlob:o,getFeatureImageList:n}}angular.module("app").factory("imagelist",e),e.$inject=["$http","$rootScope"]}(),function(){"use strict";function e(e,t){function n(e,n,r){function i(e){return t.DEBUG_MODE&&console.log("query succeded"),s=e,o(s)}function c(e){t.DEBUG_MODE&&console.log("image query failed")}return a(e,n,r).then(i,c)}function a(n,a,o){var s="",r="",i="",c="";t.cCategory&&(c=t.cCategory.keywords);for(var l=[],d=0;d<n.length;d++)"edit"==o?l[d]=n[d].cval:"add"==o&&(l[d]=n[d].val);switch(1==n.length&&l[0]&&(r=l[0]),2==n.length&&(l[0]&&(r=l[0]),l[1]&&(i=l[1])),3==n.length&&(l[0]&&(r=l[0]),l[1]&&(i=l[1]),l[2]&&l[2]),n.length>3&&(l[0]&&(r=l[0]),l[1]&&(i=l[1]),l[2]&&l[2],l[3]&&l[3]),a){case 1:s="q="+r+" "+i+" "+c;break;case 2:case 3:s="q="+r+" "+c;break;case 4:s="q="+r+" "+i+" "+c}var u="https://www.googleapis.com/customsearch/v1?"+s+"&cx=000139851817949790257%3Aqwkdgi2q2ew&num=10&searchType=image&fileType=jpg%2C+png%2C+bmp&imgType=photo&imgSize=large&filter=1&key=AIzaSyBr143lDEROCrUWdKvqPQmhQ5BoFo13oSE";return e.get(u)}function o(e){for(var t=[],n=!1,a=!1,o=0,s=0,i=0,c=0;c<r;c++)if(n=!1,a=!1,s=e.data.items[c].image.height,i=e.data.items[c].image.width,i>s&&i/s<1.8&&(n=!0),o=e.data.items[c].link.length,("g"==e.data.items[c].link[o-1]||"p"==e.data.items[c].link[o-1])&&e.data.items[c].link.indexOf("https")>-1&&(a=!0),n&&a){var l=e.data.items[c].link;t.push(l)}return t}var s=[],r=10;return{imageSearch:a,getImageLinks:n,filterImageResults:o}}angular.module("app").factory("image",e),e.$inject=["$http","$rootScope"]}(),function(){"use strict";function e(e){function t(e){var t="";if("weekly"==e.freq){t=a("Every: "+(e.mon?" - Monday":"")+(e.tue?" - Tuesday":"")+(e.wed?" - Wednesday":"")+(e.thu?" - Thursday":"")+(e.fri?" - Friday":"")+(e.sat?" - Saturday":"")+(e.sun?" - Sunday":""))+"<br>From: "+e.stime2+" to "+e.etime2}if("onetime"==e.freq){t=e.sdate==e.edate?e.sdate+" from "+e.stime+" to "+e.etime:"Starts: "+e.sdate+" at "+e.stime+"<br>Ends: "+e.edate+" at "+e.etime}var n=a(e.details);return'<div style="background-color:'+e.bc+";color:"+e.fc+';"><div class="text-center"><h3>'+e.stitle+"</h3><p>"+t+"</p><p>"+n+"</p></div></div>"}function n(e){var t="",n="";if("weekly"==e.freq&&(n=e.sdate+" to "+e.edate+"<br>"+a("Every: "+(e.mon?" - Monday":"")+(e.tue?" - Tuesday":"")+(e.wed?" - Wednesday":"")+(e.thu?" - Thursday":"")+(e.fri?" - Friday":"")+(e.sat?" - Saturday":"")+(e.sun?" - Sunday":""))+"<br>"+(void 0==e.stime2?"":"From: "+e.stime2)+(void 0==e.etime2?"":" to "+e.etime2)),"onetime"==e.freq){n=e.sdate==e.edate?e.sdate+" from "+e.stime+" to "+e.etime:(void 0==e.edate?"":"Starts: ")+e.sdate+(void 0==e.stime?"":" at "+e.stime)+(void 0==e.edate?"":"<br>Ends: "+e.edate)+(void 0==e.etime?"":" at "+e.etime)}return t='<div style="background-color:'+e.bc+";color:"+e.fc+';"><p>'+n+"</p>"+(void 0!=e.addinfo?"<p>"+a(e.addinfo)+"</p>":"")+"</div>",t}function a(t){var n=0;e.DISPLAY_XSMALL&&(n=45),e.DISPLAY_SMALL&&(n=60),e.DISPLAY_MEDIUM&&(n=90),e.DISPLAY_LARGE&&(n=150);var a=0,o="";if(void 0==t)return"";if(t.length>n)for(var s=0;s<t.length;s++)a>n-5&&" "==t[s]&&(o+="<br>",a=0),o+=t[s],a++;else o=t;return o}return{specialHtml:t,eventHtml:n}}angular.module("app").service("htmlops",e),e.$inject=["$rootScope"]}(),function(){"use strict";function e(e,t,n,a,o){function s(a){delete t.defaults.headers.common["X-Dreamfactory-API-Key"],delete t.defaults.headers.common["X-DreamFactory-Session-Token"];var s="https://en.wikipedia.org/w/api.php?action=query&format=json&origin=*&prop=extracts&list=&meta=&continue=&titles="+a;return t.post(s,{},{headers:{"Content-Type":"multipart/form-data"}}).then(function(a){var s=JSON.stringify(a.data.query.pages),r=s.slice(s.indexOf("<p><b>"),s.indexOf("<h2>"));r=r.replace(/<p>/g,""),r=r.replace(/<\/p>/g,""),r=r.replace(/<i>/g,""),r=r.replace(/<\/i>/g,""),r=r.replace(/<small>/g,""),r=r.replace(/<\/small>/g,""),r=r.replace(/<span title\=\\"Representation in the International Phonetic Alphabet \(IPA\)\\">/g,""),r=r.replace(/<\/span>/g,""),r=r.replace(/<b>/g,""),r=r.replace(/<\/b>/g,""),r=r.replace(/.\\n\\n/g,"."),r=r.replace(/.\\n/g,"."),r=r.replace(/<(?:.|\n)*?>/gm,""),e.DEBUG_MODE&&console.log("1. wiki results res - ",r),t.defaults.headers.common["X-Dreamfactory-API-Key"]=n,t.defaults.headers.common["X-DreamFactory-Session-Token"]=o.session_token,e.$emit("wikiReady",r)})}return{getWiki:s}}angular.module("app").service("getwiki",e),e.$inject=["$rootScope","$http","APP_API_KEY","GOOGLE_API_KEY","$cookies"]}(),function(){"use strict";function e(e,t,n,a,o,s){function r(s){delete t.defaults.headers.common["X-Dreamfactory-API-Key"],delete t.defaults.headers.common["X-DreamFactory-Session-Token"],s.location=s.location.replace("#","");for(var r="",i=e.nhs,c=!1,l=0;l<i.length;l++)if(s.location.indexOf(i[l])>-1){c=!0;break}r=!c&&s.location.indexOf("San Diego")<0?s.location+" San Diego, CA":s.location;var d="https://maps.googleapis.com/maps/api/geocode/json?address="+r+"&key="+a;return t.get(d,{},{headers:{"Content-Type":"multipart/form-data"}}).then(function(a){s.location=a.data.results[0].formatted_address,s.lat=a.data.results[0].geometry.location.lat,s.lng=a.data.results[0].geometry.location.lng,t.defaults.headers.common["X-Dreamfactory-API-Key"]=n,t.defaults.headers.common["X-DreamFactory-Session-Token"]=o.session_token,void 0!=s.location&&null!=s.location&&void 0!=s.lat&&null!=s.lat&&void 0!=s.lng&&null!=s.lng&&(e.coordForUSer?(e.currentUserLatitude==s.lat&&e.currentUserLongitude==s.lng||(e.newCoords=!0),e.currentUserLatitude=s.lat,e.currentUserLongitude=s.lng,e.coordForUSer=!1,e.coordsRdy=!0,e.$emit("coordsRdy"),e.DEBUG_MODE&&console.log("@gps - 71")):e.$emit("answerGPSready"))})}return{getLocationGPS:r}}angular.module("app").service("getgps",e),e.$inject=["$rootScope","$http","APP_API_KEY","GOOGLE_API_KEY","$cookies","$state"]}(),function(){"use strict";function e(e,t,n){function a(t,a,o){function s(e){return console.log("creating flag answer record was succesful"),e.data}var i={};i.user=n.user.id,i.number=a,i.type=t,i.flag=o,i.timestmp=Date.now();var l={};l.resource=[],l.resource.push(i);var d=c;return e.post(d,l,{headers:{"Content-Type":"multipart/form-data"},body:l}).then(s,r)}function o(){function t(e){return i=e.data.resource}var n=c
;return e.get(n).then(t,r)}function s(t){function a(e){return n.DEBUG_MODE&&console.log("Deleting flag was succesful"),e.data}var o={};o.resource=[];var s={};s.id=t,o.resource.push(s);var i=c+"/"+t;return e.delete(i,s,{headers:{"Content-Type":"multipart/form-data"},body:o}).then(a,r)}function r(e){throw e}var i=[],c="/api/v2/mysql/_table/flagtable";return{flagAnswer:a,getFlags:o,deleteFlag:s}}angular.module("app").factory("flag",e),e.$inject=["$http","$q","$rootScope"]}(),function(){"use strict";function e(e,t,n){this.uploadFileToUrl=function(t,n){delete e.defaults.headers.common["X-Dreamfactory-API-Key"],delete e.defaults.headers.common["X-DreamFactory-Session-Token"],delete e.defaults.headers.common.Accept,delete e.defaults.headers.common["Accept-Language"],delete e.defaults.headers.common["Accept-Encoding"],delete e.defaults.headers.common.Referer,delete e.defaults.headers.common.origin,delete e.defaults.headers.common.Connection;var a="https://rankx.file.core.windows.net/sandiego/est/"+t.name,o=(new Date).toUTCString();console.log("date in UTC format --- ",o);var s="x-ms-date:"+o+"\nx-ms-version:2015-02-21",r="/sandiego/est/"+t.name,i="PUT\n\nmultipart/form-data\n\n"+s+r;console.log("StringToSign",i);var c=CryptoJS.enc.Base64.parse("XvsnVKjNv25OVh37Z6UviHjw0DCfo0V5XTXpxqktR9PxHBw=="),l=CryptoJS.enc.Utf8.stringify(c.words),d=CryptoJS.enc.Utf8.parse(i),u=CryptoJS.HmacSHA256(d.sigBytes,l),g=CryptoJS.enc.Base64.stringify(u);return console.log("signature---",g),e.put(a,t,{headers:{"Content-Type":"multipart/form-data","x-ms-date":o,"x-ms-version":"2015-02-21",Authorization:"SharedKey rankx:"+g}}).success(function(e){console.log("Uploading file was succesful")}).error(function(e){console.log("There was a problem uploading your file")})}}angular.module("app").service("fileupload",e),e.$inject=["$http","$cookies","APP_API_KEY"]}(),function(){"use strict";function e(e,t){function n(t){function n(e){return $rootScope.DEBUG_MODE&&console.log("result",e),e.data}console.log("file",t);var a=s+"/"+t.name;return e.post(a,t,{headers:{"Content-Type":"multipart/form-data"}}).then(n,o)}function a(n){function a(e){return e.data}var r=s+"/"+encodeURIComponent(n);return e.get(r,{params:{api_key:t}}).then(a,o)}function o(e){throw console.log("Error: ",e),e}var s="/api/v2/files/images";return{uploadFile:n,getFile:a}}angular.module("app").factory("file",e),e.$inject=["$http","APP_API_KEY"]}(),function(){"use strict";function e(e,t,n,a,o){function s(a){if(u()&&!a)return t.when(f);var o=h+"?offset=0",s=h+"?offset=1000",r=e.get(o),i=e.get(s);return t.all([r,i]).then(function(e){return f=e[0].data.resource.concat(e[1].data.resource),n.DEBUG_MODE&&console.log("No. events: ",f.length),f},m)}function r(n,a){function o(e){return p=e.data}if(g(n)&&!a)return t.when(p);var s=h+"/"+n;return e.get(s).then(o,m)}function i(t){function n(e){var n=t;return n.id=e.data.resource[0].id,f.push(n),e.data}var a=h,o=[];return o.push(t),e.post(a,o,{headers:{"Content-Type":"multipart/form-data"},body:o}).then(n,m)}function c(t,a,o){function s(e){return n.DEBUG_MODE&&console.log("updating event succesful"),e.data}var r={};r.resource=[];var i={};i.id=t;for(var c=0;c<a.length;c++)i[a[c]]=o[c];r.resource.push(i);for(var l=h,d=f.map(function(e){return e.id}).indexOf(t),c=0;c<a.length;c++)f[d][a[c]]=o[c];return e.patch(l,r,{headers:{"Content-Type":"multipart/form-data"},body:r}).then(s,m)}function l(t,a){function o(e){return n.DEBUG_MODE&&console.log(" event flagged succesful"),e.data}var s={};s.resource=[];var r={};r.id=t,r.flag=a,s.resource.push(r);var i=h;return e.patch(i,s,{headers:{"Content-Type":"multipart/form-data"},body:s}).then(o,m)}function d(t){function a(e){return n.DEBUG_MODE&&console.log("Deleting event was succesful"),e.data}var o={};o.resource=[];var s={};s.id=t,o.resource.push(s);var r=h+"/"+t,i=f.map(function(e){return e.id}).indexOf(t);return i>-1&&f.splice(i,1),e.delete(r,s,{headers:{"Content-Type":"multipart/form-data"},body:o}).then(a,m)}function u(){return f.length>0}function g(e){return p&&p.id==e}function m(e){throw e}var p,f=[],h="/api/v2/mysql/_table/events";return{getevents:s,getevent:r,addevent:i,update:c,deleteEvent:d,flagEvent:l}}angular.module("app").factory("event",e),e.$inject=["$http","$q","$rootScope","catans","vrows"]}(),function(){"use strict";function e(e,t,n,a){function o(a){function o(e){return u=e.data.resource}if(l()&&!a)return t.when(u);var s=g+"/_table/editvotetable/?filter=user="+n.user.id;return e.get(s).then(o,d)}function s(t){function o(e){for(var o={},s=0;s<e.data.resource.length;s++)o=t[s],o.id=e.data.resource[s].id,u.push(o),n.ceditvotes.push(o),1==o.vote&&a.post("upVotedEdit",["answer","edit"],[o.answer,o.edit]),-1==o.vote&&a.post("downVotedEdit",["answer","edit"],[o.answer,o.edit]);return n.DEBUG_MODE&&console.log("Creating new voting record for edit was succesful"),e.data}var s={};s.resource=[],s.resource.push(t);var r=g+"/_table/editvotetable";return e.post(r,t,{headers:{"Content-Type":"multipart/form-data"},body:t}).then(o,d)}function r(t,a){function o(e){return n.DEBUG_MODE&&console.log("Updating vote record for edit was succesful"),e.data}var s={};s.resource=[];var r={};r.id=t,r.vote=a,r.timestmp=Date.now(),s.resource.push(r);var i=g+"/_table/editvotetable",c=u.map(function(e){return e.id}).indexOf(t);return u[c].vote=a,u[c].timestmp=r.timestmp,e.patch(i,s,{headers:{"Content-Type":"multipart/form-data"},body:s}).then(o,d)}function i(t){function a(e){return n.DEBUG_MODE&&console.log("Deleting edit vote records for answer was succesful"),e.data}for(var o=0;o<u.length;o++)u[o].answer==t&&u.splice(o,1);var s=g+"/_table/editvotetable?filter=answer="+t;return e.delete(s).then(a,d)}function c(t){function a(e){return n.DEBUG_MODE&&console.log("Deleting edit vote records for answer was succesful"),e.data}for(var o=0;o<u.length;o++)u[o].edit==t&&u.splice(o,1);var s=g+"/_table/editvotetable?filter=edit="+t;return e.delete(s).then(a,d)}function l(e){return u.length>0}function d(e){throw e}var u=[],g="/api/v2/mysql";return{loadEditVotesTable:o,patchEditVoteRec:r,postEditVoteRec:s,deleteEditVotes:c,deleteEditVotesbyAnswer:i}}angular.module("app").factory("editvote",e),e.$inject=["$http","$q","$rootScope","uaf"]}(),function(){"use strict";function e(e,t,n,a){function o(t){function a(e){return d(e.data.resource),n.DEBUG_MODE&&console.log("Edits Loaded"),g}var o=p;return e.get(o).then(a,u)}function s(a){function o(e){var t=e.data.resource,a=n.edits.map(function(e){return e.id});return t.forEach(function(e){a.indexOf(e.id)<0&&g.push(e)}),n.DEBUG_MODE&&console.log("editsX data loaded - ",t),t}var s=[];if(a.forEach(function(e){m.indexOf(e.answer)<0&&(s.push(e),m.push(e.answer))}),0==s.length)return t.when(!1);for(var r="?filter=(",i=0;i<s.length;i++)r=r+"answer="+s[i].answer+")OR(";r=r.substring(0,r.length-3);var c=p+r;return e.get(c).then(o,u)}function r(t){function o(e){var o=t;return o.id=e.data.resource[0].id,g.push(o),console.log("newEditx - ",o),console.log("_edits - ",g),console.log("$rootScope.edits - ",n.edits),a.post("editA",["answer","edit"],[o.answer,o.id]),n.DEBUG_MODE&&console.log("Adding new Edit succesful",e),e.data}var s=p,r=[];return r.push(t),e.post(s,r,{headers:{"Content-Type":"multipart/form-data"},body:r}).then(o,u)}function i(t,a,o){function s(e){return n.DEBUG_MODE&&console.log("updating edit vote counts succesful"),e.data}var r={};r.resource=[];var i={};i.id=t,i.upV=a,i.downV=o,r.resource.push(i);var c=p;return e.patch(c,r,{headers:{"Content-Type":"multipart/form-data"},body:r}).then(s,u)}function c(t){function a(e){return n.DEBUG_MODE&&console.log("Deleting edit was succesful"),e.data}var o={};o.resource=[];var s={};s.id=t,o.resource.push(s);var r=p+"/"+t,i=g.map(function(e){return e.id}).indexOf(t);return i>-1&&g.splice(i,1),e.delete(r,s,{headers:{"Content-Type":"multipart/form-data"},body:o}).then(a,u)}function l(t){function a(e){return n.DEBUG_MODE&&console.log("Deleting edits for answer was succesful"),e.data}for(var o=0;o<g.length;o++)g[o].answer==t&&g.splice(o,1);var s=p+"?filter=answer="+t;return e.delete(s).then(a,u)}function d(e){g.length=0,m.length=0,e.forEach(function(e){g.push(e),m.push(e.id)})}function u(e){throw e}var g=[],m=[];n.edits=g;var p="/api/v2/mysql/_table/edittable";return{getEdits:o,getEditsX:s,addEdit:r,updateEdit:i,deleteEdit:c,deleteEditbyAnswer:l}}angular.module("app").factory("edit",e),e.$inject=["$http","$q","$rootScope","uaf"]}(),function(){"use strict";function e(e,t,n,a,o,s,r,i,c,l,d,u,g){function m(e,t){BootstrapDialog.TYPE_PRIMARY,BootstrapDialog.show({title:e,message:t,buttons:[{id:"btn-ok",label:"OK",cssClass:"btn-primary",autospin:!1,action:function(e){e.close()}}]})}function p(e){m(t.dialogs["dialog."+e+".title"],t.dialogs["dialog."+e+".text"])}function f(e,t,n){var a="",o="",s="",r="";a="Please Confirm",s="Cancel",r="Confirm","image"==t&&(o="You want to change the image of <strong><em>"+e.name+"</em></strong> to this one: </br><img src="+e.imageURL+' class="thumbnail" style="width:60%; max-height:150px">'),"field"==t&&"addinfo"!=e.field&&(o='You want to change the <strong class="capitalize"><em>'+e.field+"</em></strong> of <strong><em>"+e.name+"</em></strong> to <strong><em>"+e.nval+"</em></strong>."),"field"==t&&"addinfo"==e.field&&(o="You want to change the information of <strong><em>"+e.name+"</em></strong> to: <br><br>"+e.nval+"</br>."),BootstrapDialog.confirm({type:BootstrapDialog.TYPE_PRIMARY,title:a,message:o,closable:!0,draggable:!0,btnCancelLabel:s,btnOKLabel:r,btnOKClass:"btn-primary",btnCancelAction:function(e){e.close()},callback:function(t){t&&n(e)}})}function h(e,n,a,o){for(var s="",r="",i="",c=(t.cCategory.id,0);c<t.fields.length;c++){switch(t.fields[c].name){case"name":i='<strong class="capitalize">Name</strong>: '+e.name+"</br>";break;case"location":i=e.location?'<strong class="capitalize">Location</strong>: '+e.location+"</br>":"<strong>Location</strong>: </br>";break;case"cityarea":i='<strong class="capitalize">City Area</strong>: '+e.cityarea+"</br>";break;case"addinfo":i=e.addinfo?'<strong class="capitalize">Additional Info</strong>: '+e.addinfo+"</br>":"<strong>Additional Info</strong>: </br>";break;case"phone":i=e.phone?'<strong class="capitalize">Phone</strong>: '+e.phone+"</br>":"<strong>Phone</strong>: </br>";break;case"website":i=e.website?'<strong class="capitalize">Website</strong>: '+e.website+"</br>":"<strong>Website</strong>: </br>";break;case"email":i=e.email?'<strong class="capitalize">Email</strong>: '+e.email+"</br>":"<strong>Email</strong>: </br>";break;case"worksat":i=e.eventloc?'<strong class="capitalize">Works At</strong>: '+e.eventloc+"</br>":"<strong>Works At</strong>: </br>"}s+=i}for(var l=0;l<n.length;l++)n[l].sel&&(r=r+"<em>"+n[l].title+"</em></br>");v(e,r,s,a,o)}function v(e,t,n,a,o){var s="",r="",i="",c="";s="Please Confirm",i="Cancel",c="Confirm",r="You want to add the following: </br></br>"+n+'</br>With the following image:<div class="text-center"><img src='+a+' class="thumbnail" style="width:60%; max-height:150px"></div>to the rankings:<br><div class="text-center" style="padding-top:10px">'+t+"</div>",BootstrapDialog.confirm({type:BootstrapDialog.TYPE_PRIMARY,title:s,message:r,closable:!0,draggable:!0,btnCancelLabel:i,btnOKLabel:c,btnOKClass:"btn-primary",btnCancelAction:function(e){e.close()},callback:function(t){t&&o(e)}})}function b(e,t,n,a){var o="",s="";"approve"==n&&"addinfo"!=e.field&&(o="Changed Approved",s="Congrats! With your vote, the change of <strong>"+e.field+"</strong> of <strong>"+e.name+"</strong> to <strong>"+e.nval+"</strong> gets approved."),"approve"==n&&"addinfo"==e.field&&(o="Changed Approved",s="Congrats! With your vote, the information of <strong>"+e.name+"</strong> to <br><br>"+e.nval+"</br> gets approved."),"reject"==n&&(o="Changed Rejected",s="Congrats! With your vote, the change of <strong>"+e.field+"</strong> of <strong>"+e.name+"</strong> to <strong>"+e.nval+"</strong> has been rejected."),BootstrapDialog.show({type:BootstrapDialog.TYPE_PRIMARY,title:o,message:s,buttons:[{id:"btn-ok",label:"OK",cssClass:"btn-primary",autospin:!1,action:function(e,o){a(t,n),e.close()}}]})}function w(e){var t="",n="";"editAnswer"==e&&(n="Information Edits",t="Use edits to correct, add or update information in a profile. All edits need to be accepted by other users before they are approved. </br></br>An edit or change becomes approved when the number of people that agree exceeds the number of people that disagree by 3. </br></br>An edit or change gets rejected when the number of people that disagree exceeds those that agree by 3. </br></br> Only one edit per field at a time is allowed. Make sure you vote on the edits you agree or disagree."),"addAnswer"==e&&(n="Add a new answer",t="1. Fill out the form. The fields marked with ** are required. All other fields are not required but recommended. <br/><br/>2. Click the 'Get Images' button. <br/><br/>3. Use '>>' and '<<' buttons to browse through the images. You can 'Get More Images' button to load more images.<br/><br/>4. When the image you want shows in the image box, click the button 'Add' to add the new answer to the list.<br/><br/>NOTE: Not all images will correspond to your answer. Entering all fields will help with the image results."),"shortPhrase"==e&&(n="Add an Answer",t="Fill out the form. The fields marked with ** are required. <br/><br/> - The <strong>Title</strong> is the main idea of your answer. <br/><br/> - In the <strong>Details</strong> box, write additional details about your answer. You can also write arguments on why it should be included in this list.<br/><br/>For example: <br/><br/>In the rank <strong><em>Reasons why dogs are awesome</em></strong> you can add following answer: <br/><br/><strong>Title:</strong> They enjoy the simple things in life <br/><br/><strong>Details:</strong> Dogs dont need much to be happy, they are happy with simple things like a belly rub, a walk around the block, playing in the snow or going for a drive."),BootstrapDialog.show({type:BootstrapDialog.TYPE_PRIMARY,title:n,message:t,buttons:[{id:"btn-ok",label:"OK",cssClass:"btn-primary",autospin:!1,action:function(e){e.close()}}]})}function y(e){BootstrapDialog.show({type:BootstrapDialog.TYPE_PRIMARY,title:"Image URL",message:e,buttons:[{id:"btn-ok",label:"OK",cssClass:"btn-primary",autospin:!1,action:function(e){e.close()}}]})}function x(e,n,a,o){for(var s="",r="",i="",c="",l=0;l<t.fields.length;l++){switch(t.fields[l].name){case"name":i='<strong class="capitalize">Name</strong>: '+e.name+"</br>",c='<strong class="capitalize">Name</strong>: '+n.name+"</br>";break;case"location":i=e.location?'<strong class="capitalize">Location</strong>: '+e.location+"</br>":"<strong>Location</strong>: </br>",c=n.location?'<strong class="capitalize">Location</strong>: '+n.location+"</br>":"<strong>Location</strong>: </br>";break;case"cityarea":i='<strong class="capitalize">City Area</strong>: '+e.cityarea+"</br>",c='<strong class="capitalize">City Area</strong>: '+n.cityarea+"</br>";break;case"addinfo":i=e.addinfo?'<strong class="capitalize">Additional Infob</strong>: '+e.addinfo+"</br>":"<strong>Additional Info</strong>: </br>",c=n.addinfo?'<strong class="capitalize">Additional Infob</strong>: '+n.addinfo+"</br>":"<strong>Additional Info</strong>: </br>";break;case"phone":i=e.phone?'<strong class="capitalize">Phoneb</strong>: '+e.phone+"</br>":"<strong>Phone</strong>: </br>",c=n.phone?'<strong class="capitalize">Phoneb</strong>: '+n.phone+"</br>":"<strong>Phone</strong>: </br>";break;case"website":i=e.website?'<strong class="capitalize">Websiteb</strong>: '+e.website+"</br>":"<strong>Website</strong>: </br>",c=n.website?'<strong class="capitalize">Websiteb</strong>: '+n.website+"</br>":"<strong>Website</strong>: </br>";break;case"email":i=e.email?'<strong class="capitalize">Emailb</strong>: '+e.email+"</br>":"<strong>Email</strong>: </br>",c=n.email?'<strong class="capitalize">Emailb</strong>: '+n.email+"</br>":"<strong>Email</strong>: </br>"}s+=i,r+=c}k(e,s,n,r,a,o)}function k(e,n,a,o,s,r){var i="",c="",l="",d="";i="Just checking",l="No, they are different",d="Yeah, same",c="Are these the same "+t.cCategory.type+'? </br></br><div class="row"><div class="col-sm-6">'+n+"</br><img src="+e.imageurl+' class="thumbnail" style="width:60%; max-height:150px"></div><div class="col-sm-6">'+o+"</br><img src="+a.imageurl+' class="thumbnail" style="width:60%; max-height:150px"></div></div>',BootstrapDialog.confirm({type:BootstrapDialog.TYPE_PRIMARY,title:i,message:c,closable:!0,draggable:!0,btnCancelLabel:l,btnOKLabel:d,btnOKClass:"btn-primary",btnCancelAction:function(e){e.close()},callback:function(t){t?r():s(e)}})}function D(e,n){var a="",o="",s="",r="";a="Scope of Delete",s="Just in the category: "+t.cCategory.title,r="Everywhere",o="Choose scope to delete:",BootstrapDialog.confirm({type:BootstrapDialog.TYPE_DANGER,title:a,message:o,closable:!0,draggable:!0,btnCancelLabel:s,btnOKLabel:r,btnOKClass:"btn-primary",btnCancelAction:function(e){e.close()},callback:function(t){t?n():e()}})}function E(e,t,n){var a="",o="",s="",r="";a="Confirm Delete",s="Cancel",r="Delete",o="This will delete the CatAns record for <strong>"+e+"</strong> in the category of <strong>"+t+"</strong>.",BootstrapDialog.confirm({type:BootstrapDialog.TYPE_DANGER,title:a,message:o,closable:!0,draggable:!0,btnCancelLabel:s,btnOKLabel:r,btnOKClass:"btn-primary",btnCancelAction:function(e){e.close()},callback:function(e){e&&n()}})}function O(e,t){var n="",a="",o="",s="";n="Special Preview",o="Back",s="Save Special";var r=d.specialHtml(e);a='This is how this special will look: </br></br>In the ranking summary:<br><table class="table table-hover cursor "><thead><tr><th>Rank</th><th>Name</th><th>Distance</th><th>Specials</th></tr></thead><tbody><tr><td>1</td><td>'+e.name+'</td><td>1.5</td><td style="background-color:'+e.bc+";color:"+e.fc+';">'+e.stitle+"<td></tr></tbody></table><br>Inside your business profile:<br>"+r+"</br>With the following image:<img src="+e.image+' class="thumbnail" style="width:70%; max-height:150px">',BootstrapDialog.confirm({type:BootstrapDialog.TYPE_PRIMARY,title:n,message:a,closable:!0,draggable:!0,btnCancelLabel:o,btnOKLabel:s,btnOKClass:"btn-primary",btnCancelAction:function(e){e.close()},callback:function(e){e&&t()}})}function C(e,t,n){var a="",o="",s="",r="";a="Yes, Delete",s="Cancel",r="Delete",o=n?"Just confirming, do you want to delete the special <strong>"+e.stitle+"</strong>?":"Just confirming, do you want to delete the ranking <strong>"+e.title+"</strong>?",BootstrapDialog.confirm({type:BootstrapDialog.TYPE_DANGER,title:a,message:o,closable:!0,draggable:!0,btnCancelLabel:s,btnOKLabel:r,btnOKClass:"btn-primary",btnCancelAction:function(e){e.close()},callback:function(e){e&&t()}})}function R(e){var t="",n="",a="",o="";t="Share Location",a="Not Now",o="Ok",n="Please allow browser share location so we can calculate distance to the best places.",BootstrapDialog.confirm({type:BootstrapDialog.TYPE_PRIMARY,title:t,message:n,closable:!0,draggable:!0,btnCancelLabel:a,btnOKLabel:o,btnOKClass:"btn-primary",btnCancelAction:function(e){e.close()},callback:function(t){t&&e()}})}function _(e){var t="",n="",a="",o="";t="Do you own this business?",a="Cancel",o="Bind",n="If you own or represent this business, please bind to your account so only you can change or edit its information.<br><br><strong>* Name of Business</strong><br><strong>* Address</strong><br><strong>* Phone Number</strong><br><strong>* Main Photo</strong><br><strong>* Hours</strong><br><br>Binding this business to your account is free.",BootstrapDialog.confirm({type:BootstrapDialog.TYPE_PRIMARY,title:t,message:n,closable:!0,draggable:!0,btnCancelLabel:a,btnOKLabel:o,btnOKClass:"btn-primary",btnCancelAction:function(e){e.close()},callback:function(t){t&&e()}})}function A(e,t,n){var a="",o="",s="",r="";a="Confirmation",s="Cancel",r="Yes, bind this business to my account",o="<br><strong>Note:</strong> Claiming to have false authority over a business is against the law.<br><br>Please confirm:<br><br>You, <strong>"+e+"</strong>, have the authority to represent <strong>"+t+"</strong>.",BootstrapDialog.confirm({type:BootstrapDialog.TYPE_PRIMARY,title:a,message:o,closable:!0,draggable:!0,btnCancelLabel:s,btnOKLabel:r,btnOKClass:"btn-primary",btnCancelAction:function(e){e.close()},callback:function(e){e&&n()}})}function S(e,t){var n="",a="";n="Enter Data",a="<br> Enter new vote row to be added in Group: <strong>"+e.gtitle+'</strong><br><br>Vote Row Name:<input class="form-control" type="text" placeholder="Enter Vote Row Name"><br><br>',BootstrapDialog.show({type:BootstrapDialog.TYPE_PRIMARY,title:n,message:a,closable:!0,draggable:!0,buttons:[{label:"Cancel",action:function(e){e.close()}},{label:"OK",action:function(n,a){var o=n.getModalBody().find("input").val();a&&t(e,o),n.close()}}]})}function M(e,t){var n="",a="",o="",s="";n="Please Confirm",o="Cancel",s="Yes, Delete",a="<br>Please confirm, you want to delete vote row <strong>"+e.title+"</strong> from <strong>"+e.gtitle+"</strong>.<br><br><strong>Note:</strong> All vote records will be lost",BootstrapDialog.confirm({type:BootstrapDialog.TYPE_DANGER,title:n,message:a,closable:!0,draggable:!0,btnCancelLabel:o,btnOKLabel:s,btnOKClass:"btn-default",btnCancelAction:function(e){e.close()},callback:function(n){n&&t(e)}})}function P(e,t){var n="",a="";n="Enter Data",a='<br>Enter name of Vote Group you want to create: <br><br>Group Name:<input class="form-control" type="text" placeholder="Enter Vote Row Group Name"><br><br>',BootstrapDialog.show({type:BootstrapDialog.TYPE_PRIMARY,title:n,message:a,closable:!0,draggable:!0,buttons:[{label:"Cancel",action:function(e){e.close()}},{label:"OK",action:function(n,a){var o=n.getModalBody().find("input").val();a&&t(e,o),n.close()}}]})}function I(e,t,n){var a="",o="";a="Enter Data",o='<br>Enter new name of Vote Group: <br><br>Group Name:<input class="form-control" type="text" placeholder="'+e.gtitle+'"><br><br>',BootstrapDialog.show({type:BootstrapDialog.TYPE_PRIMARY,title:a,message:o,closable:!0,draggable:!0,buttons:[{label:"Cancel",action:function(e){e.close()}},{label:"Edit",action:function(n,a){var o=n.getModalBody().find("input").val();a&&t(e,o),n.close()}},{label:"Delete",action:function(t,a){a&&n(e),t.close()}}]})}function B(e,t){var n="",a="",o="",s="";n="Please Confirm",o="Cancel",s="Yes, Delete",a="<br>Please confirm, you want to delete the vote group <strong>"+e.gtitle+"</strong> and all the items within it.<br><br><strong>Note:</strong> All vote records for all items will be lost",BootstrapDialog.confirm({type:BootstrapDialog.TYPE_DANGER,title:n,message:a,closable:!0,draggable:!0,btnCancelLabel:o,btnOKLabel:s,btnOKClass:"btn-default",btnCancelAction:function(e){e.close()},callback:function(n){n&&t(e)}})}function L(e,t,n){var a="",o='<p style="text-align:left">';e.name&&(o=o+'<strong class="capitalize">Name</strong>: '+e.name+"</br>"),e.eventloc&&(o=o+'<strong class="capitalize">Venue</strong>: '+e.eventloc+"</br>"),e.location&&(o=o+'<strong class="capitalize">Address</strong>: '+e.location+"</br>"),e.cityarea&&(o=o+'<strong class="capitalize">Neighborhood</strong>: '+e.cityarea+"</br>"),e.phone&&(o=o+'<strong class="capitalize">Phone Number</strong>: '+e.phone+"</br>"),e.website&&(o=o+'<strong class="capitalize">Website</strong>: '+e.website+"</br>"),a=o+"</p>",U(e,a,d.eventHtml(e),e.imageurl,t,n)}function U(e,n,a,o,s,r){var i="",c="",l="",d="";"add"==s?c="You want to add the following event to <strong>"+t.cCategory.title+"</strong>. </br><p></p>"+n+a+"</br>With the following image:<img src="+o+' class="thumbnail" style="width:60%; max-height:150px">':"edit"==s&&(c="Please confirm the new information. </br><p></p>"+n+a+"</br>With the following image:<img src="+o+' class="thumbnail" style="width:60%; max-height:150px">'),i="Please Confirm",l="Cancel",d="Confirm",BootstrapDialog.confirm({type:BootstrapDialog.TYPE_PRIMARY,title:i,message:c,closable:!0,draggable:!0,btnCancelLabel:l,btnOKLabel:d,btnOKClass:"btn-primary",btnCancelAction:function(e){e.close()},callback:function(t){t&&r(e)}})}function T(){function e(e,t){return'<div><br><br><div class="progress"><div class="progress-bar progress-bar-success" role="progressbar" aria-valuemin="0" aria-valuemax="100"style="width:'+e+'%"></div></div>'+t+"<br><br><br></div>"}var n="",a="",o="Releasing tracking birds to find you...",s="Gathering long measuring sticks...",r="Hiring lots of little green men to measure distances...";n="Please Confirm",a='<div class="text-left">Is it ok if we locate your position?</div><br><div class="row"><div class="container col-xs-12"><div class="text-left" style="color:blue">Option 1</div><div class="text-center" style="border:2px"><button class="btn btn-success" id="useGeo">Yes, you can locate me</button></div><br><div class="text-left" style="color:blue">Option 2 <small>(recommended for accuracy)</small></div><br><p>Yes, use this address as my current location</p><div class="input-group"><input id="address" type="text" class="form-control" placeholder="Enter address"><span class="input-group-btn text-right"><button class="btn btn-success" type="button" id="gobutton">Go</button></span></div><br><br></div><div class="container col-xs-12"><div class="text-center" style="border:2px"><button class="btn btn-default" id="noapprove">No, I don\'t approve</button></div></div></div>',BootstrapDialog.show({type:BootstrapDialog.TYPE_PRIMARY,title:n,message:function(n){var i=$(a);return i.find("#useGeo").click({},function(){if(t.isFacebookApp)p("FacebookAppNotSupported");else{var a=n;t.$emit("getLocation"),a.enableButtons(!1),a.setClosable(!1),a.getModalBody().html(e(0,o)),a.setTitle("Please wait"),setTimeout(function(){a.getModalBody().html(e(10,o))},1e3),setTimeout(function(){a.getModalBody().html(e(20,o))},2e3),setTimeout(function(){a.getModalBody().html(e(30,s))},3e3),setTimeout(function(){a.getModalBody().html(e(40,s))},4e3),setTimeout(function(){a.getModalBody().html(e(50,r))},5e3),setTimeout(function(){a.getModalBody().html(e(60,r))},6e3),setTimeout(function(){a.getModalBody().html(e(70,r))},7e3),setTimeout(function(){a.getModalBody().html(e(80,"Punching in the numbers..."))},8e3),setTimeout(function(){a.getModalBody().html(e(100,"Done!"))},9e3),setTimeout(function(){a.close()},1e4)}}),i.find("#gobutton").click({},function(){var e=i.find("input").val(),a=n;t.$emit("useAddress",{address:e}),a.close()}),i.find("#noapprove").click({},function(){var e=n;"Food Near Me"==t.cCategory.title&&c.go("cwrapper"),e.close()}),i},closable:!1,draggable:!0,btnCancelLabel:"No, I don't approve",btnOKLabel:"Yes, locate me",btnOKClass:"btn-success",btnCancelClass:"btn-warning",btnCancelAction:function(e){"Food Near Me"==t.cCategory.title&&c.go("cwrapper"),e.close()}})}function G(e){var a="",o="";a="Missing info",o='<div class="text-left">Let\'s stay in touch. Please provide us an email address where we can keep you updated on everything related to the <strong>'+e+'</strong> account.</div><br><div class="input-group"><input id="email" type="text" class="form-control" placeholder="Enter email address"><span class="input-group-btn text-right"><button class="btn btn-primary" type="button" id="gobutton">Submit</button></span></div><br>',BootstrapDialog.show({type:BootstrapDialog.TYPE_PRIMARY,title:a,message:function(e){var a=$(o);return a.find("#gobutton").click({},function(){var o=a.find("input").val(),s=e;t.showWarning=!1,n.updateuseraccnt(t.useraccnts[0].id,["email"],[o]),s.close(),t.$emit("hideWarning")}),a},closable:!0,draggable:!0,btnCancelLabel:"No, I don't approve",btnOKLabel:"Yes, locate me",btnOKClass:"btn-success",btnCancelClass:"btn-warning",btnCancelAction:function(e){e.close()}})}function V(e,n,a,o){var s="",r="",i=n,c=e.length,l="";l=(t.sm,"width:100%;height:auto"),s="Photos - "+a.name;var d="",u="",g="",m="",p="";o?(d='<div class="row"><div class="text-left col-xs-3 col-md-4"><button class="btn btn-default pull-left" id="prevbutton">&lt;&lt</button></div><div class="text-middle col-xs-5 col-md-4"><button class="btn btn-default" id="makeprimary">Make Main Photo</button></div><div class="text-right col-xs-4 col-md-4"><button class="btn btn-default pull-right" id="nextbutton">&gt;&gt</button></div></div>',m='<div class="text-right"><button type="button" class="btn btn-default pull-right" style="vertical-align:middle;" id="trashbutton"><span class="glyphicon glyphicon-trash" style="padding-top:0px;padding-bottom:0px;" aria-hidden="true"></span></button></div><br/>'):(d='<div class="row"><div class="text-left col-xs-6"><button class="btn btn-default pull-left" id="prevbutton">&lt;&lt</button></div><div class="text-right col-xs-6"><button class="btn btn-default pull-right" id="nextbutton">&gt;&gt</button></div></div>',m="<br/>"),u='<br><div class="text-center"><img id="image" class="displayed" src="',g='" style="'+l+'"></div><p>Photo from &nbsp<strong id="source">'+e[i].type+"</strong></p></br><br/>",p=void 0!=e[i].from?'<p id="credit">Photo by:&nbsp<strong>@'+e[i].from+'</strong></p></br><p id="caption">'+(e[i].caption?e[i].caption:"")+"</p>":'<p id="credit"></p><p id="caption"></p>';r=d+u+e[i].url+g+m+p,BootstrapDialog.show({type:BootstrapDialog.TYPE_PRIMARY,title:s,message:function(t){var n=$(r),o=t;return n.find("#prevbutton").click({},function(){i-=1,i<0&&(i=c-1),n.find("#image").attr("src",e[i].url),n.find("#source").html(e[i].type),void 0!=e[i].from?$("#credit").html("Photo by:&nbsp<strong>@"+e[i].from+"</strong></br>"):$("#credit").html(""),void 0!=e[i].caption?$("#caption").html(e[i].caption):$("#caption").html("")}),n.find("#nextbutton").click({},function(){i+=1,i>=c&&(i=0),n.find("#image").attr("src",e[i].url),n.find("#source").html(e[i].type),void 0!=e[i].from?$("#credit").html("Photo by:&nbsp<strong>@"+e[i].from+"</strong></br>"):$("#credit").html(""),void 0!=e[i].caption?$("#caption").html(e[i].caption):$("#caption").html("")}),n.find("#trashbutton").click({},function(){N(e,i,a),o.close()}),n.find("#makeprimary").click({},function(){F(e,i,a),o.close()}),n},closable:!0,draggable:!0,btnCancelLabel:"No, I don't approve",btnOKLabel:"Yes, locate me",btnOKClass:"btn-success",btnCancelClass:"btn-warning",btnCancelAction:function(e){e.close()}})}function N(e,n,o){var s="",r="",i="",c="";s="Please Confirm",i="Cancel",c="Yes, Delete",r='<br>Please confirm, you want to delete this photo: <br/><img id="image" class="displayed" src="'+e[n].url+'" style="width:100%;height:auto"><br><br>',BootstrapDialog.confirm({type:BootstrapDialog.TYPE_DANGER,title:s,message:r,closable:!0,draggable:!0,btnCancelLabel:i,btnOKLabel:c,btnOKClass:"btn-default",btnCancelAction:function(e){e.close()},callback:function(s){if(s)if(t.DEBUG_MODE&&console.log(e),"Instagram"==e[n].type){var r=o.ig_image_urls.indexOf(e[n].url);-1!=r&&(o.ig_image_urls=o.ig_image_urls.substr(0,r-1)+o.ig_image_urls.substr(r+e[n].url.length),te(o.id,o.ig_image_urls).then(function(e){t.$emit("refreshImages")}))}else a.deleteBlob(e[n].url)}})}function F(e,t,n){var a="",s="",r="",i="";a="Please Confirm",r="Cancel",i="Yes, make primary",s='<br>Please confirm, you want to make this the primary photo: <br/><img id="image" class="displayed" src="'+e[t].url+'" style="width:100%;height:auto"><br><br>',BootstrapDialog.confirm({type:BootstrapDialog.TYPE_PRIMARY,title:a,message:s,closable:!0,draggable:!0,btnCancelLabel:r,btnOKLabel:i,btnOKClass:"btn-default",btnCancelAction:function(e){e.close()},callback:function(a){if(a){var s=e[t].url;o.updateAnswer(n.id,["imageurl"],[s])}}})}function q(){var e="",n="";e="Login required",n="You must be logged in to add rankings, answers, opinions, endorse establishments and participate in the rankings.</br></br>Do you want to log in?",BootstrapDialog.show({title:e,message:n,buttons:[{label:"Not now",action:function(e){e.close()}},{icon:"fa fa-facebook",label:"Login",cssClass:"btn-primary",action:function(e){t.stateName=c.current.name,
"rankSummary"==t.stateName?t.stateNum=t.cCategory.id:"answerDetail"==t.stateName?t.stateNum=t.canswer.id:t.stateNum=void 0,s.facebookSDKLogin().then(function(){e.close(),c.go(c.current,{},{reload:!0})})}}]})}function Y(e,t,n,a,o){var s="",r="";s="Share Options",r='<div class="row"><div class="col-xs-3 col-sm-3 col-md-2 col-lg-2 text-center" style="cursor: pointer"><img src="/assets/images/1485385043_mail.png" id="email" style="width:50px;margin-bottom:20px"></div><div class="col-xs-3 col-sm-3 col-md-2 col-lg-2 text-center" style="cursor: pointer"><img src="/assets/images/1485384809_2_-_Facebook.png" id="facebook" style="width:50px;margin-bottom:20px"></div><div class="col-xs-3 col-sm-3 col-md-2 col-lg-2 text-center" style="cursor: pointer"><img src="/assets/images/1485384868_1_-_Twitter.png" id="twitter" style="width:50px;margin-bottom:20px"></div><div class="col-xs-3 col-sm-3 col-md-2 col-lg-2 text-center" style="cursor: pointer"><img src="/assets/images/1485384841_13_-_Pintrest.png" id="pinterest" style="width:50px;margin-bottom:20px"></div><div class="col-xs-3 col-sm-3 col-md-2 col-lg-2 text-center" style="cursor: pointer"><img src="/assets/images/1485384824_6_-_Google_Plus.png" id="gplus" style="width:50px;margin-bottom:20px"></div><div class="col-xs-3 col-sm-3 col-md-2 col-lg-2 text-center" style="cursor: pointer"><img src="/assets/images/1485384853_5_-_Tumbler.png" id="tumblr" style="width:50px;margin-bottom:20px"></div><div class="col-xs-3 col-sm-3 col-md-2 col-lg-2 text-center" style="cursor: pointer"><img src="/assets/images/1485425301_reddit.png" id="reddit" style="width:50px;margin-bottom:20px"></div><div class="col-xs-3 col-sm-3 col-md-2 col-lg-2 text-center style="cursor: pointer""><a href="#" socialshare socialshare-provider="whatsapp" socialshare-text="'+a+'" socialshare-url="'+n+'"><img src="/assets/images/1485384832_16_-_Whatsapp.png" id="whatsapp" style="width:50px;margin-bottom:20px;display:'+(t?"inline":"none")+'"> </a></div><div class="col-xs-3 col-sm-3 col-md-2 col-lg-2 text-center style="cursor: pointer""><a href="#" socialshare socialshare-provider="facebook-messenger" socialshare-url="'+n+'"><img src="/assets/images/1485385110_Facebook_Messenger.png" id="messenger" style="width:50px;margin-bottom:20px;display:'+(t?"inline":"none")+'"> </a></div><div class="col-xs-3 col-sm-3 col-md-2 col-lg-2 text-center style="cursor: pointer""><a href="#" socialshare socialshare-provider="sms" socialshare-text="'+a+'" socialshare-url="'+n+'"><img src="/assets/images/1485385026_sms.png" id="sms" style="width:50px;margin-bottom:20px;display:'+(t?"inline":"none")+'"> </a></div></div>';var i=l(r)(o);BootstrapDialog.show({title:s,message:function(t){var n=$(i),a=t;return n.find("#twitter").click({},function(){e("twitter"),a.close()}),n.find("#facebook").click({},function(){e("facebook"),a.close()}),n.find("#email").click({},function(){e("email"),a.close()}),n.find("#pinterest").click({},function(){e("pinterest"),a.close()}),n.find("#gplus").click({},function(){e("gplus"),a.close()}),n.find("#reddit").click({},function(){e("reddit"),a.close()}),n.find("#tumblr").click({},function(){e("tumblr"),a.close()}),n.find("#whatsapp").click({},function(){a.close()}),n.find("#messenger").click({},function(){a.close()}),n.find("#sms").click({},function(){a.close()}),n},buttons:[{label:"Cancel",action:function(e){e.close()}}]})}function z(){var e="",t="",n=1,a="";a="width:100%;max-width:450px;height:auto;margin-left:auto;margin-right:auto;",e="Rank-X Intro Tour";var o="";o='<img id="image" class="displayed" src="/assets/images/rxtour1.jpg" style="'+a+'">',t=o,BootstrapDialog.show({type:BootstrapDialog.TYPE_PRIMARY,title:e,message:t,closable:!0,draggable:!0,buttons:[{id:"btn1",label:"No, thanks",action:function(e,t){1==n?(i.put("tourviewed",!0),e.close()):(n-=1,1==n?($("#btn1").text("No, thanks"),$("#btn2").text("Yes, take tour")):17==n?($("#btn1").text("Back"),$("#btn2").text("Close"),i.put("tourviewed",!0)):($("#btn1").text("Back"),$("#btn2").text("Next")),o='<img id="image" class="displayed" src="/assets/images/rxtour'+n+'.jpg" style="'+a+'">',e.setMessage(o))}},{id:"btn2",label:"Yes, take tour",action:function(e,t){17==n?(i.put("tourviewed",!0),e.close()):(17==n?e.getButton(this.id).label="Close":(n+=1,1==n?($("#btn1").text("No, thanks"),$("#btn2").text("Yes, take tour")):17==n?($("#btn1").text("Back"),$("#btn2").text("Close"),i.put("tourviewed",!0)):($("#btn1").text("Back"),$("#btn2").text("Next"))),o='<img id="image" class="displayed" src="/assets/images/rxtour'+n+'.jpg" style="'+a+'">',e.setMessage(o))}}]})}function j(e,t){var n="",a="",o="",s="";n="Confirm Unbind",o="Cancel",s="Yes, Unbind",a="Just confirming, do you want to unbind <strong>"+e.name+"</strong> from your account?",BootstrapDialog.confirm({type:BootstrapDialog.TYPE_DANGER,title:n,message:a,closable:!0,draggable:!0,btnCancelLabel:o,btnOKLabel:s,btnOKClass:"btn-primary",btnCancelAction:function(e){e.close()},callback:function(e){e&&t()}})}function X(e,t,n){var a="",o="",s="",r="";"Premium"==t&&(r="Cancel Premium Membership",o="Do you want to cancel your Premium Membership for <strong>"+e.name+"</strong>?"),"Ranks"==t&&(r="Cancel All Custom Ranks",o="Do you want to cancel all of your Custom Ranks for <strong>"+e.name+"</strong>?"),"All"==t&&(r="Cancel All Subscriptions",o="Do you want to cancel all of your Subscriptions for <strong>"+e.name+"</strong>?"),a="Please confirm",s="Back",BootstrapDialog.confirm({type:BootstrapDialog.TYPE_DANGER,title:a,message:o,closable:!0,draggable:!0,btnCancelLabel:s,btnOKLabel:r,btnOKClass:"default",btnCancelAction:function(e){e.close()},callback:function(e){e&&n()}})}function W(e,t){var n="Buy or Cancel Custom Ranks",a="",o=1,s=e.ranksQty,r="purchase",i="You have selected to <strong>purchase "+o+"</strong> Custom Ranks.<br><br>If purchasing Custom Ranks you will be ask for your payment info after clicking the Purchase button.",a="<p>You are currently subscribed to <strong>"+s+'</strong> Custom Ranks.</p><br><p class="text-left">Select what you want to do.</p><br><div class="radio"><label><input type="radio" value="0" checked name="radiogrp">PURCHASE CUSTOM RANKINGS</label></div><div class="radio"><label><input type="radio" value="1" name="radiogrp">CANCEL CUSTOM RANKINGS</label></div><br><div class="row"><div class="col-xs-7"><p class="text-right">Select quantity:</p></div><div class="col-xs-5"><div class="input-group"><span class="input-group-btn"><button class="btn btn-primary" id="btn_minus"><i class="fa fa-minus"></i></button></span><input style="text-align:center" id="numRanks" class="form-control" type="text" placeholder="'+o+'"><span class="input-group-btn"><button class="btn btn-primary" id="btn_plus"><i class="fa fa-plus"></i></button></span></div></div></div><br><p class="text-left" id="mytext">'+i+"</p>";n="Please confirm",BootstrapDialog.show({type:BootstrapDialog.TYPE_PRIMARY,title:n,message:function(e){var t=$(a),n="",i="<br><br>If purchasing Custom Ranks you will be ask for your payment info after clicking the Purchase button.",c="<br><br>Your Custom Ranks will be active until last day of your subscription.";return t.find("#btn_minus").click({},function(){o-=1,o<1&&(o=1),t.find("#numRanks").val(o),"purchase"==r?(n="You have selected to <strong>purchase "+o+"</strong> Custom Ranks. "+i,$("#btn2").text("Purchase "+o+" Custom Rankings")):(n="You have selected to <strong>cancel "+o+"</strong> Custom Ranks. "+c,$("#btn2").text("Cancel "+o+" Custom Rankings")),$("#mytext").html(n)}),t.find("#btn_plus").click({},function(){o+=1,o>10&&(o=10),"cancel"==r&&o>=s&&(o=s),t.find("#numRanks").val(o),"purchase"==r?(n="You have selected to <strong>purchase "+o+"</strong> Custom Ranks. "+i,$("#btn2").text("Purchase "+o+" Custom Rankings")):(n="You have selected to <strong>cancel "+o+"</strong> Custom Ranks. "+c,$("#btn2").text("Cancel "+o+" Custom Rankings")),$("#mytext").html(n)}),t.find("input[type=radio][name=radiogrp]").change(function(){o=1,0==this.value?(r="purchase",$("#btn2").text("Purchase "+o+" Custom Rankings"),n="You have selected to <strong>purchase "+o+"</strong> Custom Ranks. "+i):1==this.value&&(r="cancel",$("#btn2").text("Cancel "+o+" Custom Rankings"),n="You have selected to <strong>cancel "+o+"</strong> Custom Ranks. "+c),t.find("#numRanks").val(o),$("#mytext").html(n)}),t},closable:!0,draggable:!0,buttons:[{id:"btn1",label:"Back",action:function(e){e.close()}},{id:"btn2",label:"Purchase "+o+" Custom Rankings",action:function(e,n){t(r,o),e.close()}}]})}function K(e,t,n,a){var o="",s="";o="Edit Information",s="<p>Please verify the information is correct.</p>";for(var r=0;r<e.length;r++)s=s+'<div class="input-group"><label class="input-group-addon">'+t[r]+':</label><input type="text" class="form-control" id="'+e[r]+'" value="'+n[r]+'"></div>';BootstrapDialog.show({type:BootstrapDialog.TYPE_PRIMARY,title:o,message:function(e){return $(s)},closable:!0,draggable:!0,btnCancelLabel:"Cancel",btnOKLabel:"Save",btnOKClass:"btn-success",btnCancelClass:"btn-warning",btnCancelAction:function(e){e.close()},buttons:[{id:"btn1",label:"Cancel",action:function(e){e.close()}},{id:"btn2",label:"Save",action:function(t,n){for(var o=[],s="",r=0;r<e.length;r++)s=t.getModalBody().find("#"+e[r])[0].value,o.push(s);a(o),t.close()}}]})}function H(e,t,n){var e=e,t=t;BootstrapDialog.show({type:BootstrapDialog.TYPE_PRIMARY,title:e,message:t,buttons:[{id:"btn-ok",label:"OK",cssClass:"btn-primary",autospin:!1,action:function(e){n(),e.close()}}]})}function J(e,t){var e=e,t=t;BootstrapDialog.show({type:BootstrapDialog.TYPE_SUCCESS,title:e,message:t,buttons:[{id:"btn-ok",label:"OK",cssClass:"btn-primary",autospin:!1,action:function(e){e.close()}}]})}function Q(e,t){var e=e,t=t;BootstrapDialog.show({type:BootstrapDialog.TYPE_DANGER,title:e,message:t,buttons:[{id:"btn-ok",label:"OK",cssClass:"btn-primary",autospin:!1,action:function(e){e.close()}}]})}function Z(e){var t="";"Establishment"==e&&(t="establishment"),"Person"==e&&(t="person"),"Place"==e&&(t="place"),"Organization"==e&&(t="organization"),"PersonCust"==e&&(t="person"),"Event"==e&&(t="event"),"Thing"==e&&(t="item"),"Short-Phrase"==e&&(t="answer");var n="Switch to Vote Mode to Vote! <br><br>Your endorsements make the rankings! <br><br>Give a <strong>thumb up</strong> if you <strong>endorse</strong> this "+t+" in each ranking; a <strong>thumb down</strong> if you <strong>do not endorse</strong>.";BootstrapDialog.show({type:BootstrapDialog.TYPE_PRIMARY,title:"Endorse!",message:n,buttons:[{id:"btn-ok",label:"Got it",cssClass:"btn-primary",autospin:!1,action:function(e){e.close()}}]})}function ee(e,t){var n="",a="";n="Password Required",a='<br> Please enter access password:<br><br><input class="form-control" type="text" placeholder="Enter password"><br><br>',BootstrapDialog.show({type:BootstrapDialog.TYPE_PRIMARY,title:n,message:a,closable:!1,draggable:!0,buttons:[{id:"btn1",label:"Cancel",action:function(e){t(),e.close()}},{id:"btn2",label:"Go",action:function(n){"S@nDieg0"==n.getModalBody().find("input").val()?e():(t(),p("wrongPassword")),n.close()}}]})}function te(e,t){return o.updateAnswer(e,["ig_image_urls"],[t])}function ne(e,n,a,o){var s="",r="",i=(e.length,"");i=(t.sm,"width:100%;height:auto"),s="My Instagram Photos";var c="",l="",d="",u="";c='<div class="row"><div class="col-xs-12">',g.isPreviousAvailable()&&(c+='<button class="btn btn-default pull-left" id="previgpage">Previous</button>'),g.isNextAvailable()&&(c+='<button class="btn btn-default pull-right" id="nextigpage">Next</button>'),c+="</div>",u='<div class="text-right"></div><br/>';var m="";l='<img id="image" class="displayed col-xs-3 thumbnail" src="',d='" style="'+i+'">',m='<div class="row">';for(var p=0;p<e.length;p++)if("image"==e[p].type){m+='<div class="col-xs-6 col-md-4" style="position:relative">',m+=l+e[p].images.low_resolution.url+d;var f=0;-1!=n.ig_image_urls.indexOf(e[p].images.low_resolution.url)&&(f=.7),m+='<div id="add_photo" style="background-color: grey;opacity:'+f+';position: absolute;left: 19px;right: 19px;top: 4px;bottom: 24px;border-radius: 5px;display: flex;align-items: center;">',m+='<i class="fa fa-check-circle-o" aria-hidden="true" style="color: #2d6c38;font-size: 100px;margin: auto" ></i>',m+="</div>",m+="</div>"}m+="</div>",r=c+m+u,BootstrapDialog.show({size:BootstrapDialog.SIZE_WIDE,type:BootstrapDialog.TYPE_PRIMARY,cssClass:"instagram-image-dialog",title:s,message:function(e){var a=$(r);return a.find("#previgpage").click({},function(){e.close(),o("previous")}),a.find("#nextigpage").click({},function(){e.close(),o("next")}),a.find("#add_photo").click({},function(){console.log(n.ig_image_urls);var e=$(this).parent().children("#image").attr("src");if(-1!=n.ig_image_urls.indexOf(e)){var a=this,o=n.ig_image_urls.indexOf(e);-1!=o&&(n.ig_image_urls=n.ig_image_urls.substr(0,o-1)+n.ig_image_urls.substr(o+e.length),te(n.id,n.ig_image_urls).then(function(e){t.$emit("refreshImages"),$(a).css("opacity",0)}))}else{var a=this;n.ig_image_urls+=";"+e,te(n.id,n.ig_image_urls).then(function(e){t.$emit("refreshImages"),$(a).css("opacity",.7)})}}),a},buttons:[{label:"Close",action:function(e){e.close()}}],closable:!0,draggable:!0,btnCancelLabel:"No, I don't approve",btnOKLabel:"Yes, locate me",btnOKClass:"btn-success",btnCancelClass:"btn-warning",btnCancelAction:function(e){e.close()}})}function ae(){BootstrapDialog.show({type:BootstrapDialog.TYPE_PRIMARY,title:"Ranking Question",message:'The <strong>Ranking Question</strong> is what you ask users when comparing two items in the rank. It is the question to determine which item deserves the higher ranking.<br><br>For example, if ranking the "Hamburgers in Pacific Beach", the <strong>Ranking Question</strong> would be "Who makes the better burgers?".<br><br>The Ranking Question is shown in the Rank Console, when users rank their endorsements.<br><br><img style="width:100%;height:auto" src="/assets/images/whatisrankquestion.png">',buttons:[{id:"btn-ok",label:"Got it",cssClass:"btn-primary",autospin:!1,action:function(e){e.close()}}]})}function oe(e,t){for(var n="",a=0;a<e.length;a++){n+='<div class="row" style="padding-bottom:10px">',n+='<div class="col-xs-3 col-md-3 text-center">',n+='<img src="'+e[a].picture.data.url+'" class="img-responsive img-circle profile-avatar" style="width: 100%;height: 100%;"/>',n+="</div>",n+='<div class="col-xs-9 col-md-9 text-center">',n+='<div class="text-left"><strong>'+e[a].first_name+" "+e[a].last_name+"</strong> endorsed in: </div>";for(var o=0;o<e[a].endorsements.length;o++)n+="<i>"+e[a].endorsements[o]+"</i></br>";n+="</div>",n+="</div>"}BootstrapDialog.show({size:BootstrapDialog.SIZE_SM,type:BootstrapDialog.TYPE_PRIMARY,cssClass:"fav-list-user-image-dialog",title:"Friends that like "+t,message:function(e){var t=$(n);return t},buttons:[{label:"Close",action:function(e){e.close()}}],closable:!0,draggable:!0,btnCancelLabel:"OK",btnOKLabel:"Close",btnOKClass:"btn-success",btnCancelClass:"btn-warning",btnCancelAction:function(e){e.close()}})}function se(e,t,n){var a='<div class="row"> <div class="col-xs-12"> <tr ng-repeat-end> <td colspan=3> <table class="table" > <thead style="border-style:none;"> <tr>    <th style="width:45%" text-align="center">Subscription</th>    <th style="width:15%" text-align="center">Commission</th> </tr> </thead> <tbody> ';e.ispremium&&(a+='<tr style="cursor:pointer;">   <td style="width:45%">Premium Membership</td>    <td style="width:15%">'+e.price*t+"</td></tr>"),e.hasranks&&(a+='<tr style="cursor:pointer;"><td style="width:45%">'+e.ranksqty+' Custom Ranks</td><td style="width:15%">$'+e.ranksqty*n*t+"</td></tr>"),a+='                <tr>                    <td style="width:45%">Total</td>                    <td style="width:15%; background-color: darkgray;">$'+e.totalCommission+"</td>                </tr>            </tbody>        </table>    </td></tr></div></div>",BootstrapDialog.show({size:BootstrapDialog.SIZE_SM,type:BootstrapDialog.TYPE_PRIMARY,cssClass:"admin-payment-business-detail-dialog",title:e.answerObj.name+" Details",message:function(e){var t=$(a);return t},buttons:[{label:"Close",action:function(e){e.close()}}],closable:!0,draggable:!0,btnCancelLabel:"OK",btnOKLabel:"Close",btnOKClass:"btn-success",btnCancelClass:"btn-warning",btnCancelAction:function(e){e.close()}})}function re(e,t){var n='<div class="row"> <div class="col-xs-12"> <div class="form-group">    <label for="commission-percent">Please Type Commission Percentage.</label>     <div class="col-xs-11"><input type="commission-percent" class="form-control" id="commission-percent" value="'+100*e+'"> </div>    <div class="col-xs-1" style="padding: 10px;padding-left: 0px;"><span>%</span></div></div>';BootstrapDialog.show({size:BootstrapDialog.SIZE_SM,type:BootstrapDialog.TYPE_PRIMARY,cssClass:"change-commission-percentage-dialog",title:"Change Commmission",message:function(e){var t=$(n);return t},buttons:[{label:"Close",action:function(e){e.close()}},{label:"OK",action:function(e,n){var a=e.getModalBody().find("input").val();n&&t(a),e.close()}}],closable:!0,draggable:!0,btnCancelLabel:"OK",btnOKLabel:"Close",btnOKClass:"btn-success",btnCancelClass:"btn-warning",btnCancelAction:function(e){e.close()}})}function ie(e,t){var n='<div class="row"> <div class="col-xs-12"> <div class="form-group">    <label for="commission-percent">Please Enter '+e.code+' plan price.</label>     <div class="col-xs-11"><input type="commission-percent" class="form-control" id="commission-percent" value="'+e.price+'"> </div>    <div class="col-xs-1" style="padding: 10px;padding-left: 0px;"><span>$</span></div></div>';BootstrapDialog.show({size:BootstrapDialog.SIZE_SM,type:BootstrapDialog.TYPE_PRIMARY,cssClass:"change-commission-percentage-dialog",title:"Change "+e.code+" Price",message:function(e){var t=$(n);return t},buttons:[{label:"Close",action:function(e){e.close()}},{label:"Change",action:function(n,a){var o=n.getModalBody().find("input").val();a&&t(e,o),n.close()}}],closable:!0,draggable:!0,btnCancelLabel:"OK",btnOKLabel:"Close",btnOKClass:"btn-success",btnCancelClass:"btn-warning",btnCancelAction:function(e){e.close()}})}function ce(e){var n='<div class="row"> <div class="col-xs-12"> <div class="form-group">    <p>Hey there, enjoying <strong>Rank-X</strong>? <br><br> Let\'s stay in touch!<br><br> Enter your email address below to subscribe to our newsletter to get <strong>updates</strong> about new and popular rankings and <strong>stay informed</strong> of local deals and events!</p><br>    <div class="col-xs-11"><input type="text" id="subscribe-email" class="form-control"      value="'+(t.user?t.user.email:"")+'" placeholder="Enter your email here"> </div></div>';BootstrapDialog.show({size:BootstrapDialog.SIZE_SM,type:BootstrapDialog.TYPE_PRIMARY,cssClass:"subscription-dialog",title:"Sign up for our newsletter!",message:function(e){var t=$(n);return t},buttons:[{label:"Not Now",action:function(e){e.close()}},{label:"Subscribe",cssClass:"btn-success",action:function(t,n){var a=t.getModalBody().find("input").val();n&&e(a),t.close()}}],closable:!0,draggable:!0})}function le(e,t){var n=de(e),a="",o="",s="",r="";a="Just checking",s="No, different one",r="Yes, that's it",o="Do you mean this <strong>"+e.name+"</strong>? </br></br>"+n+'</br><div class="row"><div class="col-xs-2 col-sm-3 col-md-3"></div><div class="col-xs-8 col-sm-6 col-md-6"><img src='+e.imageurl+' class="thumbnail" style="width:100%; max-height:200px;" id="ansimage"></div><div class="col-xs-2 col-sm-3 col-md-3"></div></div>',BootstrapDialog.confirm({type:BootstrapDialog.TYPE_PRIMARY,title:a,message:o,closable:!0,draggable:!0,btnCancelLabel:s,btnOKLabel:r,btnOKClass:"btn-primary",btnCancelAction:function(e){e.close()},callback:function(e){e&&t()}})}function de(e){for(var n="",a="",o=0;o<t.fields.length;o++){switch(t.fields[o].name){case"name":a='<strong class="capitalize">Name</strong>: '+e.name+"</br>";break;case"location":a=e.location?'<strong class="capitalize">Location</strong>: '+e.location+"</br>":"<strong>Location</strong>: </br>";break;case"cityarea":a='<strong class="capitalize">Neighborhood</strong>: '+e.cityarea+"</br>";break;case"addinfo":a=e.addinfo?'<strong class="capitalize">Additional Info</strong>: '+e.addinfo+"</br>":"<strong>Additional Info</strong>: </br>";break;case"phone":a=e.phone?'<strong class="capitalize">Phone</strong>: '+e.phone+"</br>":"<strong>Phone</strong>: </br>";break;case"website":a=e.website?'<strong class="capitalize">Website</strong>: '+e.website+"</br>":"<strong>Website</strong>: </br>";break;case"email":a=e.email?'<strong class="capitalize">Email</strong>: '+e.email+"</br>":"<strong>Email</strong>: </br>"}n+=a}return n}function ue(e,n){var a="",o="",s="",r="",i=de(e[0]),c=0;a="Just checking",s="None of the options",r="Yes, that's it",o="<p>We have "+e.length+" records for <strong>"+e[0].name+"</strong>. Please browse these records to see if the one wish to add to the ranking <strong><i>"+t.cCategory.title+'</i></strong> already exists.</p></br><div class="text-center"><div class="row"><button class="btn btn-default" id="nextbutton">Next</button><p id="number">&nbsp&nbsp'+(c+1)+'</p></div></div><br><p id="answerinfo">'+i+'</p></br><div class="row"><div class="col-xs-2 col-sm-3 col-md-3"></div><div class="col-xs-8 col-sm-6 col-md-6"><img src='+e[0].imageurl+' class="thumbnail" style="width:100%; max-height:200px;" id="ansimage"></div><div class="col-xs-2 col-sm-3 col-md-3"></div></div>',BootstrapDialog.confirm({type:BootstrapDialog.TYPE_PRIMARY,title:a,message:function(t){var n=$(o);return n.find("#nextbutton").click({},function(){c+=1,c>e.length-1&&(c=0),i=de(e[c]),$("#number").html(c+1),$("#answerinfo").html(i),n.find("#ansimage").attr("src",e[c].imageurl)}),n},closable:!0,draggable:!0,btnCancelLabel:s,btnOKLabel:r,btnOKClass:"btn-primary",btnCancelAction:function(e){e.close()},callback:function(e){e&&n(c)}})}function ge(){BootstrapDialog.confirm({type:BootstrapDialog.TYPE_PRIMARY,title:"Terms of Service",message:$("<div></div>").load("/assets/partials/tospromoter.tem"),closable:!0,draggable:!0,btnOKLabel:"Back",btnOKClass:"btn-primary",size:BootstrapDialog.SIZE_WIDE})}function me(e){BootstrapDialog.show({type:BootstrapDialog.TYPE_PRIMARY,title:"Sorting Options",message:"<p style='text-align:left'><strong>Rank</strong>. Sorts list by rank points, which are a mix of endorsements and rank matches.</p><p style='text-align:left'><strong>Popular</strong>. Sorts list by votes (endorsements) in this ranking.</p><p style='text-align:left'><strong>Distance</strong>. Sorts list by distance closest to you. </p><p style='text-align:left'><strong>Trending</strong>. Sorts list by votes (endorsements) in the last month.</p>",buttons:[{id:"btn-ok",label:"Got it",cssClass:"btn-primary",autospin:!1,action:function(e){e.close()}}]})}function pe(e,t,n){var a="",o="",s="",r="";a="Just checking",s="Cancel",r="My opinion is different, add it",o='Your opinion:<br><p class="text-center"><i>'+e+'</i></p>might be similar to these already existing opinions: <br><br><p class="text-center">';for(var i=0;i<t.length;i++)o=o+"<i>"+t[i].title+"</i><br>";o+="</p>Double check you are not adding an opinion that is essentially same as one already there.<br>",BootstrapDialog.confirm({type:BootstrapDialog.TYPE_PRIMARY,title:a,message:o,closable:!0,draggable:!0,btnCancelLabel:s,btnOKLabel:r,btnOKClass:"btn-primary",btnCancelAction:function(e){e.close()},callback:function(e){e&&n()}})}function fe(e){var n="",a="";u.formatdatetime(e);var o=d.specialHtml(e),s="background-color:"+e.bc+";color:"+e.fc+";white-space:pre;";e.style=s,void 0!=e.image&&e.image!=t.EMPTY_IMAGE?e.hasimage=!0:e.hasimage=!1,t.DISPLAY_XSMALL&&(a="width:100%;height:auto;"),t.DISPLAY_SMALL&&(a="width:100%;height:auto;max-height:300px;"),t.DISPLAY_MEDIUM&&(a="width:100%;height:auto;max-height:350px;"),t.DISPLAY_LARGE&&(a="width:100%;height:auto;max-height:400px;"),n='<div ng-attr-style="'+e.style+'">'+o+"</div>"+(e.hasimage?'<div class="text-middle"><img class="displayed" src='+e.image+' style="'+a+'margin-left:auto;margin-right:auto;"></div><br>':"<br>"),BootstrapDialog.show({type:BootstrapDialog.TYPE_PRIMARY,title:"Special Details",message:n,buttons:[{id:"btn-ok",label:"OK",cssClass:"btn-primary",autospin:!1,action:function(e,t){e.close()}}]})}function he(e,t){var n="";n="Can not add an answer of type <em>"+("Establishment"==t||"Place"==t||"Organization"==t?"Establishment or Place":"")+("PersonCust"==t?"Freelancer":"")+("Short-Phrase"==t?"Opinion":"")+("Event"==t?"Event":"")+("Thing"==t?"Item":"")+("Simple"==t?"Private Item":"")+"</em> to a ranking of type <em>"+("Establishment"==e||"Place"==e||"Organization"==e?"Establishment or Place":"")+("PersonCust"==e?"Freelancer":"")+("Short-Phrase"==e?"Opinion":"")+("Event"==e?"Event":"")+("Thing"==e?"Item":"")+("Simple"==e?"Private Item":"")+"</em>.",BootstrapDialog.show({type:BootstrapDialog.TYPE_PRIMARY,title:"Type MisMatch",message:n,buttons:[{id:"btn-ok",label:"OK",cssClass:"btn-primary",autospin:!1,action:function(e,t){e.close()}}]})}function ve(e,t,n){var a="",o="",s="",r="";a="Please Confirm",o="This will add "+t.name+" to <em>"+e.title+"</em>.",s="Cancel",r="Ok",BootstrapDialog.confirm({type:BootstrapDialog.TYPE_PRIMARY,title:a,message:o,closable:!0,draggable:!0,btnCancelLabel:s,btnOKLabel:r,btnOKClass:"default",btnCancelAction:function(e){e.close()},callback:function(a){a&&n(e,t)}})}function be(e,t,n){var a="",o="",s="",r="";a="Please Confirm",o="This will remove "+t.name+" from <em>"+e.title+"</em>.",s="Cancel",r="Yes, delete",BootstrapDialog.confirm({type:BootstrapDialog.TYPE_PRIMARY,title:a,message:o,closable:!0,draggable:!0,btnCancelLabel:s,btnOKLabel:r,btnOKClass:"default",btnCancelAction:function(e){e.close()},callback:function(a){a&&n(e,t)}})}function we(e,n){for(var a="",o="",s="",r="",i='<div class="text-center">',c=0,l=0;l<e.ansLocs.length;l++)c=t.answers.map(function(e){return e.id}).indexOf(e.ansLocs[l]),i=i+t.answers[c].name+"</br>";i+="</div>",a="Please Confirm",o="This will add the following sibling Establishments: <br>"+i+"<br> to <strong>"+e.name+"</strong>.",s="Cancel",r="Ok",BootstrapDialog.confirm({type:BootstrapDialog.TYPE_PRIMARY,title:a,message:o,closable:!0,draggable:!0,btnCancelLabel:s,btnOKLabel:r,btnOKClass:"default",btnCancelAction:function(e){e.close()},callback:function(e){e&&n()}})}function ye(e){var t="",n="";n='<ul class="list-group">';for(var a=0;a<e.length;a++)n=n+'<li id="item'+a+'"class="list-group-item" style="cursor:pointer;"><strong>'+e[a].name+"</strong>,&nbsp"+e[a].location+",&nbsp"+e[a].cityarea+"</li>";n+="</ul>",t=n,BootstrapDialog.show({type:BootstrapDialog.TYPE_PRIMARY,title:"Additional Locations",message:function(n){var a=$(t);return a.find("#item0").click({},function(){r.scrollTo(0,0),c.go("answerDetail",{index:e[0].id}),n.close()}),a.find("#item1").click({},function(){r.scrollTo(0,0),c.go("answerDetail",{index:e[1].id}),n.close()}),a.find("#item2").click({},function(){r.scrollTo(0,0),c.go("answerDetail",{index:e[2].id}),n.close()}),a.find("#item3").click({},function(){r.scrollTo(0,0),c.go("answerDetail",{index:e[3].id}),n.close()}),a.find("#item4").click({},function(){r.scrollTo(0,0),c.go("answerDetail",{index:e[4].id}),n.close()}),a},buttons:[{id:"btn-ok",label:"OK",cssClass:"btn-primary",autospin:!1,action:function(e,t){e.close()}}]})}function xe(e){var n='<div class="text-center"><iframe width="'+(t.sm?"300":"500")+'" height="'+(t.sm?"200":"350")+'" src="'+e+'?autoplay=1" frameborder="0" allowfullscreen></iframe></div>';BootstrapDialog.show({size:BootstrapDialog.SIZE_WIDE,type:BootstrapDialog.TYPE_PRIMARY,title:"Learn More",message:function(e){return $(n)},buttons:[{id:"btn-ok",label:"I got it.",cssClass:"btn-primary",autospin:!1,action:function(e,t){e.close()}}]})}function ke(){BootstrapDialog.show({type:BootstrapDialog.TYPE_PRIMARY,title:"Image Banks",message:'<strong>Pixabay</strong> and <strong>Pexels</strong> are databases of royalty free images. We encourage you to visit their websites to learn more about the services they offer. <br><br><div class="row"><div class="col-xs-12 col-sm-6"><img src="../../../assets/images/pixabay-logo.png" alt="Pixabay"style="width:100%;height:45px;padding:3px;border-style:solid;border-width:1px;"><div class="text-center"><a href="https://www.pixabay.com/">Visit Pixabay</a></div></div><div class="col-xs-12 col-sm-6"><img src="../../../assets/images/pexels-logo.png" alt="Pexels"style="width:100%;height:45px;padding:3px;border-style:solid;border-width:1px;"><div class="text-center"><a href="https://www.pexels.com/">Visit Pexels</a></div></div></div>',buttons:[{id:"btn-ok",label:"OK",cssClass:"btn-primary",autospin:!1,action:function(e){e.close()}}]})}return{editConfirm:f,getDialog:p,showDialog:m,howItWorks:w,addAnswer:h,showAddAnswer:v,editChangeEffective:b,checkSameAnswer:x,showSameAnswer:k,confirmSameAnswer:le,deleteType:D,deleteThisCatans:E,deleteRank:C,getLocation:R,url:y,createSpecialPreview:O,bizRegistration:_,bindAccount:A,addVRow:S,deleteVRow:M,addVRowGroup:P,editVRowGroup:I,deleteVRowGroup:B,showAddEvent:U,createEventPreview:L,askPermissionToLocate:T,askEmail:G,seePhotos:V,loginFacebook:q,shareOptions:Y,tour:z,unbindAccount:j,confirmCancel:X,editNumRanks:W,editInfo:K,notificationWithCallback:H,notificationSuccess:J,notificationDanger:Q,enterPassword:ee,endorse:Z,chooseImgFromIgDlg:ne,showAllFriendsListDlg:oe,showBusinessDetailDlg:se,whatisrankquestion:ae,changeCommissionDlg:re,changeCodePriceDlg:ie,openSubscriptionDlg:ce,generateAnswerHtml:de,confirmSameAnswerMultiple:ue,showTOSPromotersDlg:ge,showTOSCustomersDlg:ge,sortbyHelpDialog:me,maybeRepeatVrows:pe,showSpecial:fe,typemismatch:he,confirmAddRank:ve,confirmRemoveRank:be,confirmSiblings:we,showLocations:ye,showLearnMore:xe,imageBank:ke}}angular.module("app").factory("dialog",e),e.$inject=["$q","$rootScope","useraccnt","imagelist","answer","login","$window","$cookies","$state","$compile","htmlops","datetime","InstagramService"]}(),function(){"use strict";function e(e,t,n,a,o){function s(t,n){if(!n.commLoaded){if(n.commLoaded=!0,e.isLoggedIn&&(n.initials=e.user.name.replace(/[^A-Z]/g,""),i(e.user.id,l),n.bc=l.bc,n.fc=l.fc),"answer"==t)return o.getcomments().then(function(e){function t(e){return e<10?"0"+e:e}n.comments=e;for(var a=0;a<n.comments.length;a++){n.comments[a].initials=n.comments[a].username.replace(/[^A-Z]/g,"");var o=new Date,s=o.getTimezoneOffset(),r=n.comments[a].timestmp.split(/[- :]/),c=new Date(r[0],r[1]-1,r[2],r[3],r[4],r[5]);c.setMinutes(c.getMinutes()-s);var d=c.getMonth()+1+"/"+c.getDate()+"/"+c.getFullYear(),u=c.getHours(),g=u>12?u%12+":"+t(c.getMinutes())+" PM":u+":"+t(c.getMinutes())+" AM";n.comments[a].date=d+" "+g,i(n.comments[a].user,l),n.comments[a].bc=l.bc,n.comments[a].fc=l.fc}});if("category"==t)return a.getcomments().then(function(e){function t(e){return e<10?"0"+e:e}n.comments=e;for(var a=0;a<n.comments.length;a++){n.comments[a].initials=n.comments[a].username.replace(/[^A-Z]/g,"");var o=new Date,s=o.getTimezoneOffset(),r=n.comments[a].timestmp.split(/[- :]/),c=new Date(r[0],r[1]-1,r[2],r[3],r[4],r[5]);c.setMinutes(c.getMinutes()-s);var d=c.getMonth()+1+"/"+c.getDate()+"/"+c.getFullYear(),u=c.getHours(),g=u>12?u%12+":"+t(c.getMinutes())+" PM":u+":"+t(c.getMinutes())+" AM";n.comments[a].date=d+" "+g,i(n.comments[a].user,l),n.comments[a].bc=l.bc,n.comments[a].fc=l.fc}})}}function r(s,r){var c={};c.body=r.newComment,c.username=e.user.name,c.user=e.user.id,c.picture=e.user.picture.data.url,c.timestmp=Date.now(),r.newComment="","category"==s&&(c.category=e.cCategory.id,a.addcomment(c).then(function(){c.initials=e.user.name.replace(/[^A-Z]/g,""),i(e.user.id,l),c.fc=l.fc,c.bc=l.bc,c.date="Just now",r.comments.push(c),t.update(e.cCategory.id,["numcom"],[r.comments.length])})),"answer"==s&&(c.answer=e.canswer.id,o.addcomment(c).then(function(){c.initials=e.user.name.replace(/[^A-Z]/g,""),i(e.user.id,l),c.fc=l.fc,c.bc=l.bc,c.date="Just now",r.comments.push(c),
n.updateAnswer(e.canswer.id,["numcom"],[r.comments.length])}))}function i(e,t){switch(e%10){case 0:t.bc="#b3b3b3",t.fc="black";break;case 1:t.bc="#666666",t.fc="white";break;case 2:t.bc="#006bb3",t.fc="white";break;case 3:t.bc="#009933",t.fc="white";break;case 4:t.bc="#cc0000",t.fc="white";break;case 5:t.bc="#538cc6",t.fc="black";break;case 6:t.bc="#b36b00",t.fc="white";break;case 7:t.bc="#999966",t.fc="black";break;case 8:t.bc="#4d0099",t.fc="white";break;case 9:t.bc="#009999",t.fc="black"}}var c={loadComments:s,postComment:r,getIconColors:i},l={};return l.bc="",l.fc="",c}angular.module("app").service("commentops",e),e.$inject=["$rootScope","table","answer","comment","comment2"]}(),function(){"use strict";function e(e,t,n,a){function o(t){function a(e){return u=e.data.resource}var o=g+"/?filter=answer="+n.canswer.id;return e.get(o).then(a,d)}function s(t){function n(e){return u=e.data.resource}var a=g+"/?filter=answer="+t;return e.get(a).then(n,d)}function r(t){function o(e){return t.id=e.data.resource[0].id,a.post("commentA",["answer","comment"],[t.answer,t.body]),n.DEBUG_MODE&&console.log("Adding new comment succesful",e),e.data}var s=g,r=[];return r.push(t),e.post(s,r,{headers:{"Content-Type":"multipart/form-data"},body:r}).then(o,d)}function i(t,a,o){function s(e){return n.DEBUG_MODE&&console.log("updating comment vote counts succesful"),e.data}var r={};r.resource=[];var i={};i.id=t,i.upV=a,i.downV=o,r.resource.push(i);var c=g;return e.patch(c,r,{headers:{"Content-Type":"multipart/form-data"},body:r}).then(s,d)}function c(t){function a(e){return n.DEBUG_MODE&&console.log("Deleting comment was succesful"),e.data}var o={};o.resource=[];var s={};s.id=t,o.resource.push(s);var r=g+"/"+t,i=u.map(function(e){return e.id}).indexOf(t);return i>-1&&u.splice(i,1),e.delete(r,s,{headers:{"Content-Type":"multipart/form-data"},body:o}).then(a,d)}function l(t){function a(e){return n.DEBUG_MODE&&console.log("Deleting comments for answer was succesful"),e.data}for(var o=0;o<u.length;o++)u[o].user==t&&u.splice(o,1);var s=g+"?filter=user="+t;return e.delete(s).then(a,d)}function d(e){throw e}var u=[],g="/api/v2/mysql/_table/comments2";return{getcomments:o,getcommentsbyanswer:s,addcomment:r,updatecomment:i,deletecomment:c,deletecommentsbyuser:l}}angular.module("app").factory("comment2",e),e.$inject=["$http","$q","$rootScope","uaf"]}(),function(){"use strict";function e(e,t,n,a){function o(t){function a(e){return u=e.data.resource}var o=g+"/?filter=category="+n.cCategory.id;return e.get(o).then(a,d)}function s(t){function n(e){return u=e.data.resource}var a=g+"/?filter=category="+t;return e.get(a).then(n,d)}function r(t){function o(e){return t.id=e.data.resource[0].id,a.post("commentR",["category"],[t.category]),n.DEBUG_MODE&&console.log("Adding new comment succesful",e),e.data}var s=g,r=[];return r.push(t),e.post(s,r,{headers:{"Content-Type":"multipart/form-data"},body:r}).then(o,d)}function i(t,a,o){function s(e){return n.DEBUG_MODE&&console.log("updating comment vote counts succesful"),e.data}var r={};r.resource=[];var i={};i.id=t,i.upV=a,i.downV=o,r.resource.push(i);var c=g;return e.patch(c,r,{headers:{"Content-Type":"multipart/form-data"},body:r}).then(s,d)}function c(t){function a(e){return n.DEBUG_MODE&&console.log("Deleting comment was succesful"),e.data}var o={};o.resource=[];var s={};s.id=t,o.resource.push(s);var r=g+"/"+t,i=u.map(function(e){return e.id}).indexOf(t);return i>-1&&u.splice(i,1),e.delete(r,s,{headers:{"Content-Type":"multipart/form-data"},body:o}).then(a,d)}function l(t){function a(e){return n.DEBUG_MODE&&console.log("Deleting comments for answer was succesful"),e.data}for(var o=0;o<u.length;o++)u[o].user==t&&u.splice(o,1);var s=g+"?filter=user="+t;return e.delete(s).then(a,d)}function d(e){throw e}var u=[],g="/api/v2/mysql/_table/comments";return{getcomments:o,getcommentsbyrank:s,addcomment:r,updatecomment:i,deletecomment:c,deletecommentsbyuser:l}}angular.module("app").factory("comment",e),e.$inject=["$http","$q","$rootScope","uaf"]}(),function(){"use strict";function e(e,t,n,a,o){function s(t){function n(e){return e.data}var a=x+"/"+t;return e.get(a).then(n,v)}function r(a){var o=x+"?offset=0",s=x+"?offset=1000",r=x+"?offset=2000",i=x+"?offset=3000",c=x+"?offset=4000",l=x+"?offset=5000",d=x+"?offset=6000",u=x+"?offset=7000",g=x+"?offset=8000",m=x+"?offset=9000",p=e.get(o),f=e.get(s),w=e.get(r),y=e.get(i),k=e.get(c),D=e.get(l),E=e.get(d),O=e.get(u),C=e.get(g),R=e.get(m);return t.all([p,f,w,y,k,D,E,O,C,R]).then(function(e){return h(e[0].data.resource.concat(e[1].data.resource,e[2].data.resource,e[3].data.resource,e[4].data.resource,e[5].data.resource,e[6].data.resource,e[7].data.resource,e[8].data.resource,e[9].data.resource)),n.DEBUG_MODE&&console.log("No. Cat-Ans: ",b.length),b},v)}function i(a){var o=[];if(a.length>0&&a.forEach(function(e){e.id&&y.indexOf(e.id)<0&&(o.push(e),y.push(e.id))}),0==o.length)return t.when(!1);for(var s="?filter=(",r=0;r<o.length;r++)if(o[r].catstr)for(var i=o[r].catstr.split(":").map(Number),c=0;c<i.length;c++)s=s+"category="+i[c]+")OR(";else s=s+"category="+o[r].id+")OR(";s=s.substring(0,s.length-3);var l=x+s+"&fields="+k,d=e.get(l);return t.all([d]).then(function(e){var t=e[0].data.resource,a=b.map(function(e){return e.id});return t.forEach(function(e){a.indexOf(e.id)<0&&b.push(e)}),n.DEBUG_MODE&&console.log("getAllCatansX loaded: ",t.length),t},v)}function c(a){var o=[];if(a.length>0&&a.forEach(function(e){w.indexOf(e.id)<0&&(o.push(e),w.push(e.id))}),0==o.length)return t.when(!1);for(var s="?filter=(",r=0;r<o.length;r++)s=s+"answer="+o[r].id+")OR(";s=s.substring(0,s.length-3);var i=x+s+"&fields="+k,c=e.get(i);return t.all([c]).then(function(e){var t=e[0].data.resource,a=b.map(function(e){return e.id});return t.forEach(function(e){a.indexOf(e.id)<0&&b.push(e)}),n.DEBUG_MODE&&console.log("getAllCatansY loaded: ",t.length),t},v)}function l(t){function o(e){for(var t=0;t<e.data.resource.length;t++)a.deleteVotesbyCatans(e.data.resource[t].id);return n.DEBUG_MODE&&console.log("Deleting catans records was succesful"),e.data}for(var s=0;s<b.length;s++)if(b[s].id==t){b.splice(s,1);break}var r=x+"?filter=id="+t;return e.delete(r).then(o,v)}function d(t){function a(e){return b.forEach(function(t){t.category==s.category&&t.answer==s.answer&&(t.id=e.data.resource[0].id)}),o.post("addedAnswer",["answer","category"],[s.answer,s.category]),n.DEBUG_MODE&&console.log("creating catans record was succesful"),e.data}var s={};s.answer=t,s.category=n.cCategory.id,s.upV=0,s.downV=0,s.user=n.user.id,s.timestmp=Date.now();var r={};r.resource=[],b.push(s),r.resource.push(s);var i=x;return e.post(i,r,{headers:{"Content-Type":"multipart/form-data"},body:r}).then(a,v)}function u(t,a){function s(e){return b.forEach(function(t){t.category==r.category&&t.answer==r.answer&&(t.id=e.data.resource[0].id)}),o.post("addedAnswer",["answer","category"],[t,a]),console.log("@postRec2 creating catans record was succesful"),e.data}var r={};r.answer=t,r.category=a,r.upV=0,r.downV=0,r.user=n.user.id,r.timestmp=Date.now();var i={};i.resource=[],b.push(r),i.resource.push(r);var c=x;return e.post(c,i,{headers:{"Content-Type":"multipart/form-data"},body:i}).then(s,v)}function g(t){function o(e){for(var t=0;t<e.data.resource.length;t++)a.deleteVotesbyCatans(e.data.resource[t].id);return n.DEBUG_MODE&&console.log("Deleting catans records was succesful"),e.data}for(var s=0;s<b.length;s++)b[s].answer==t&&b.splice(s,1);var r=x+"?filter=answer="+t;return e.delete(r).then(o,v)}function m(t,o){function s(e){for(var t=0;t<e.data.resource.length;t++)a.deleteVotesbyCatans(e.data.resource[t].id);return n.DEBUG_MODE&&console.log("Deleting catans records by answer and category was succesful"),e.data}for(var r=0;r<b.length;r++)b[r].answer==t&&b[r].category==o&&b.splice(r,1);var i=x+"?filter=(answer="+t+") AND (category="+o+")";return e.delete(i).then(s,v)}function p(t){function o(e){for(var t=0;t<e.data.resource.length;t++)a.deleteVotesbyCatans(e.data.resource[t].id);return n.DEBUG_MODE&&console.log("Deleting catans records by category was succesful"),e.data}for(var s=0;s<b.length;s++)b[s].category==t&&b.splice(s,1);var r=x+"?filter=category="+t;return e.delete(r).then(o,v)}function f(t,a,o){function s(e){return n.DEBUG_MODE&&console.log("updating catans record succesful"),e.data}var r={};r.resource=[];var i={};i.id=t;for(var c=0;c<a.length;c++)i[a[c]]=o[c];r.resource.push(i);for(var l=x,d=b.map(function(e){return e.id}).indexOf(t),c=0;c<a.length;c++)b[d][a[c]]=o[c];return e.patch(l,r,{headers:{"Content-Type":"multipart/form-data"},body:r}).then(s,v)}function h(e){b.length=0,e.forEach(function(e){b.push(e)})}function v(e){throw e}var b=[],w=[],y=[];n.catansrecs=b;var x="/api/v2/mysql/_table/catans",k="";return k+="category,answer,upV,downV,rank,scope,id",{getAllcatans:r,getAllcatansX:i,getAllcatansY:c,postRec:d,postRec2:u,deleteRec:m,deleteAnswer:g,updateRec:f,deletebyCategory:p,getCatan:s,deleteCatan:l}}angular.module("app").factory("catans",e),e.$inject=["$http","$q","$rootScope","votes","uaf"]}(),function(){"use strict";function e(e,t,n,a,o,s,r){function i(a){var o=O+"?offset=0",s=O+"?offset=1000",r=O+"?offset=2000",i=O+"?offset=3000",c=O+"?offset=4000",l=O+"?offset=5000",d=O+"?offset=6000",u=O+"?offset=7000",g=e.get(o),m=e.get(s),p=e.get(r),f=e.get(i),h=e.get(c),v=e.get(l),w=e.get(d),y=e.get(u);return t.all([g,m,p,f,h,v,w,y]).then(function(e){return b(e[0].data.resource.concat(e[1].data.resource,e[2].data.resource,e[3].data.resource,e[4].data.resource,e[5].data.resource,e[6].data.resource,e[7].data.resource)),n.DEBUG_MODE&&console.log("No. Answers: ",D.length),D},k)}function c(a,o){var s="";1==o&&(s+="id,name"),2==o&&(s+="id,imageurl,type,isfood,lat,lng,eventlocid");var r=O+"?offset=0&filter=scope="+a+"&fields="+s,i=O+"?offset=1000&filter=scope="+a+"&fields="+s,l=O+"?offset=2000&filter=scope="+a+"&fields="+s,d=O+"?offset=3000&filter=scope="+a+"&fields="+s,u=O+"?offset=4000&filter=scope="+a+"&fields="+s,g=O+"?offset=5000&filter=scope="+a+"&fields="+s,m=O+"?offset=6000&filter=scope="+a+"&fields="+s,p=O+"?offset=7000&filter=scope="+a+"&fields="+s,f=e.get(r),h=e.get(i),v=e.get(l),E=e.get(d),C=e.get(u),R=e.get(g),_=e.get(m),A=e.get(p);return t.all([f,h,v,E,C,R,_,A]).then(function(e){var t=e[0].data.resource.concat(e[1].data.resource,e[2].data.resource,e[3].data.resource,e[4].data.resource,e[5].data.resource,e[6].data.resource,e[7].data.resource);return 1==o&&(0==D.length?b(t):w(D,t),n.answersLoaded=!0,n.$emit("answersLoaded"),c(n.SCOPE,2)),2==o&&(y(t),x()),n.DEBUG_MODE&&console.log("No. Answers: ",D.length),D},k)}function l(a){var o=[];if(a.forEach(function(e){E.indexOf(e.answer)<0&&(o.push(e),E.push(e.answer))}),0==o.length)return t.when(!1);for(var s="?filter=(",r=0;r<o.length;r++)s=s+"id="+o[r].answer+")OR(";s=s.substring(0,s.length-3);var i=O+s,c=e.get(i);return t.all([c]).then(function(e){var t=e[0].data.resource;return t.constructor===Array?w(D,t):w(D,[t]),n.DEBUG_MODE&&console.log("answer.getAnswersFromCatans ",t),t},k)}function d(a){var o=[];if(a.forEach(function(e){E.indexOf(e.id)<0&&(o.push(e),E.push(e.id))}),0==o.length)return t.when(!1);for(var s="?filter=(",r=0;r<o.length;r++)s=s+"id="+o[r].id+")OR(";s=s.substring(0,s.length-3);var i=O+s,c=e.get(i);return t.all([c]).then(function(e){var t=e[0].data.resource;return t.constructor===Array?w(D,t):w(D,[t]),n.DEBUG_MODE&&console.log("answer.getAnswers ",t),t},k)}function u(a){var o=O+"/?filter=id="+a,s=e.get(o);return t.all([s]).then(function(e){var t=e[0].data.resource[0];return w(D,[t]),n.DEBUG_MODE&&console.log("single answer loaded: ",_answerx),t})}function g(t){function n(e){return e.data}var a=O+"/?filter=customer="+t;return e.get(a).then(n,k)}function m(t,o){function s(e){var s=t;s.id=e.data.resource[0].id;var r=s.name.toLowerCase();r=r.replace(/ /g,"-"),r=r.replace("/","at"),r=r+"-"+e.data.resource[0].id,s.slug=r,D.push(s),f(e.data.resource[0].id,["slug"],[r]),"Establishment"==s.type&&(n.estNames.push(s.name),n.estAnswers.push(s)),"Person"==s.type&&(n.pplNames.push(s.name),n.pplAnswers.push(s)),"Place"==s.type&&(n.plaNames.push(s.name),n.plaAnswers.push(s));for(var i=0;i<o.length;i++)a.postRec2(s.id,o[i].id);return n.DEBUG_MODE&&console.log("created catans for a new answer"),n.DEBUG_MODE&&console.log("result",e),e.data}t.scope=n.SCOPE;var r=O,i=[];return void 0!=n.cCategory.owner&&0!=n.cCategory.owner?t.isprivate=!0:t.isprivate=!1,i.push(t),e.post(r,i,{headers:{"Content-Type":"multipart/form-data"},body:i}).then(s,k)}function p(t,o){function s(e){var s=t;s.id=e.data.resource[0].id;var r=s.name.toLowerCase();r=r.replace(/ /g,"-"),r=r.replace("/","at"),r=r+"-"+e.data.resource[0].id,s.slug=r,D.push(s),f(e.data.resource[0].id,["slug"],[r]),"Establishment"==s.type&&(n.estNames.push(s.name),n.estAnswers.push(s)),"Person"==s.type&&(n.pplNames.push(s.name),n.pplAnswers.push(s)),"Place"==s.type&&(n.plaNames.push(s.name),n.plaAnswers.push(s));for(var i=0;i<o.length;i++)a.postRec2(s.id,o[i]);return n.DEBUG_MODE&&console.log("created "+o.length+"catans records for the new answer"),n.DEBUG_MODE&&console.log("result",e),e.data}t.scope=n.SCOPE;var r=O,i=[];return t.user=n.user.id,void 0!=o.owner&&0!=o.owner?t.isprivate=!0:t.isprivate=!1,i.push(t),e.post(r,i,{headers:{"Content-Type":"multipart/form-data"},body:i}).then(s,k)}function f(t,a,o){function r(e){return"owner"==a[0]&&s.post("binded",["answer"],[t]),n.DEBUG_MODE&&console.log("updating answer succesful"),e.data}var i={};i.resource=[];var c={};c.id=t;for(var l=0;l<a.length;l++)c[a[l]]=o[l];i.resource.push(c);for(var d=O,u=D.map(function(e){return e.id}).indexOf(t),l=0;l<a.length;l++)D[u][a[l]]=o[l];for(var l=0;l<a.length;l++)if("name"==a[l]||"slug"==a[l]&&a.length>1||"imageurl"==a[l]||"addinfo"==a[l]){!0;break}return e.patch(d,i,{headers:{"Content-Type":"multipart/form-data"},body:i}).then(r,k)}function h(t,a){function o(e){return n.DEBUG_MODE&&console.log(" answer flagged succesful"),e.data}var s={};s.resource=[];var r={};r.id=t,r.flag=a,s.resource.push(r);var i=O;return e.patch(i,s,{headers:{"Content-Type":"multipart/form-data"},body:s}).then(o,k)}function v(t){function a(e){var a="answer"+t+".html",o={};return o.filename=a,r.removeFile(o),n.DEBUG_MODE&&console.log("Deleting answer was succesful"),e.data}var o={};o.resource=[];var s={};s.id=t,o.resource.push(s);var i=O+"/"+t,c=D.map(function(e){return e.id}).indexOf(t);return c>-1&&D.splice(c,1),e.delete(i,s,{headers:{"Content-Type":"multipart/form-data"},body:o}).then(a,k)}function b(e){D.length=0,E.length=0,e.forEach(function(e){D.push(e)})}function w(e,t){var n=[],a=-1;n=e.map(function(e){return e.id}),t.forEach(function(t){a=n.indexOf(t.id),a<0?e.push(t):e[a]=angular.extend(e[a],t)})}function y(e){var t=D.map(function(e){return e.id}),n=-1;e.forEach(function(e){n=t.indexOf(e.id),D[n].imageurl=e.imageurl,D[n].type=e.type,D[n].isfood=e.isfood,D[n].lat=e.lat,D[n].lng=e.lng,D[n].eventlocid=e.eventlocid})}function x(){n.estAnswers=[],n.estNames=[],n.pplAnswers=[],n.pplNames=[],n.plaAnswers=[],n.plaNames=[],n.freAnswers=[],n.freNames=[],n.orgNames=[],n.orgAnswers=[],n.orgNames=[],n.foodans=[];for(var e=0;e<D.length;e++)"Establishment"==D[e].type&&(n.estNames.push(D[e].name),n.estAnswers.push(D[e])),"Person"==D[e].type&&(n.pplNames.push(D[e].name),n.pplAnswers.push(D[e])),"Place"==D[e].type&&(n.plaNames.push(D[e].name),n.plaAnswers.push(D[e])),"Organization"==D[e].type&&(n.orgNames.push(D[e].name),n.orgAnswers.push(D[e])),"PersonCust"==D[e].type&&(n.freNames.push(D[e].name),n.freAnswers.push(D[e])),1==D[e].isfood&&n.foodans.push(D[e].id)}function k(e){throw e}var D=[],E=[];n.answers=D;var O="/api/v2/mysql/_table/answers";return{getAnswers:d,getAllAnswers:i,getAnswersX:c,getAnswersFromCatans:l,getAnswer:u,addAnswer:m,addAnswer2:p,updateAnswer:f,deleteAnswer:v,flagAnswer:h,getAnswerbyCustomer:g}}angular.module("app").factory("answer",e),e.$inject=["$http","$q","$rootScope","catans","vrows","uaf","staticpages"]}(),angular.module("app").directive("catBar",["color","$window","$rootScope","$state",function(e,t,n,a){"use strict";return{templateUrl:"app/answer/Partials/catbar.html",transclude:!0,scope:{text:"@",leftFn:"&leftFn",rightFn:"&rightFn",closeRank:"&closeRank"},link:function(n){n.bc="#006dcc",n.bc2=e.shadeColor(n.bc,-.3),n.fc="white",t.innerWidth<769?(n.ht=50,n.text.length>50&&(n.ht=90)):t.innerWidth<870?(n.ht=50,n.text.length>50&&(n.ht=75)):n.ht=50,n.goPrev=function(){n.leftFn()},n.goNext=function(){n.rightFn()},n.selRank=function(){n.closeRank()}}}}]),angular.module("app").directive("blobUpload",["$rootScope","$state",function(e,t){"use strict";return{templateUrl:"app/answer/Partials/blobupload.html",transclude:!0,scope:{},controller:["$scope","Upload","$timeout","$http","$rootScope","useruploadedimages","mailing",function(e,t,n,a,o,s,r){function i(t){e.errorMsg=t}function c(e){var t={};console.log("$rootScope.user - ",o.user),t.user=o.user.id,t.username=o.user.name,t.imageurl=e,t.answer=o.canswer.id,t.answername=o.canswer.name,s.postRecord(t),r.newImageUploaded(t).then(function(e){console.log("Send mail request for image notification")})}i(""),e.uploadFiles=function(n,a){if(e.f=n,e.errFile=a&&a[0],null==n)if(console.log("file is null"),void 0!=e.errFile){var s="Uploading failed for "+e.errFile.name+", "+e.errFile.$error+" exceeds "+e.errFile.$errorParam;i(s)}else i("");else{var r="https://rankx.blob.core.windows.net/sandiego/"+o.canswer.id+"/"+n.name+"?sv=2015-04-05&ss=bfqt&srt=sco&sp=rwdlacup&se=2018-08-30T01:15:12Z&st=2016-08-29T17:15:12Z&spr=https,http&sig=PpyWE0X%2Fpz9SuRje5GtHh44WaWIii0GBU9PbIcDIka8%3D",l=new FileReader;l.readAsArrayBuffer(n),l.onload=function(a){t.http({url:r,method:"PUT",headers:{"x-ms-blob-type":"BlockBlob","x-ms-blob-content-type":n.type},data:a.target.result}).then(function(t){t.status>0&&(e.errorMsg=t.status+": "+t.data);var a="https://rankx.blob.core.windows.net/sandiego/"+o.canswer.id+"/"+n.name;console.log("emitted fileUploaded!!"),c(a),o.$emit("fileUploaded",a)},null,function(e){n.progress=Math.min(100,parseInt(100*e.loaded/e.total))})}}}}]}}]),angular.module("app").directive("answerHeader",["color","$window","$rootScope","$state","dialog","dataloader",function(e,t,n,a,o,s){"use strict";return{templateUrl:"app/answer/Partials/answerheader.html",transclude:!0,scope:{ans:"@",idx:"@"},link:function(r){function i(){r.imgmode="Show Map",r.imgmodeicon="fa fa-globe",r.modeIsImage=!0,n.modeIsImage=!0}function c(){r.imgmode="Show Image",r.imgmodeicon="fa fa-picture-o",r.modeIsImage=!1,n.modeIsImage=!1}r.isMobile=!1,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|ipad|iris|kindle|Android|Silk|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(navigator.userAgent)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(navigator.userAgent.substr(0,4)))&&(r.isMobile=!0),r.answer=JSON.parse(r.ans),"Short-Phrase"==r.answer.type?r.isShortPhrase=!0:r.isShortPhrase=!1,"Event"==r.answer.type?r.isEvent=!0:r.isEvent=!1,n.isLoggedIn&&n.user.id==r.answer.owner?r.userIsOwner=!0:r.userIsOwner=!1,r.modeIsImage=!0,r.imgmode="Show Map",r.imgmodeicon="fa fa-globe",r.hasMap=void 0!=r.answer.location&&""!=r.answer.location;for(var l=[0,401,474,769,971,996,1173,1201,1635,1960,3500],d=[.86,.86,.88,.96,.75,.96,.68,.96,.64,.6,.6],u=t.innerWidth,g=0,m=0;m<l.length-1;m++)if(u>l[m]&&u<l[m+1]){var p=(d[m+1]-d[m])/(l[m+1]-l[m]),f=d[m]-l[m]*p;g=u*p+f}if(t.innerWidth<763){if(r.sp1="width:5%;padding:0px;",r.sp2="width:25%;max-height:50px",r.sp3="width:20%",r.sm=!0,r.nsm=!1,r.width=Math.round(u*g),r.mxheight=Math.round(r.width/1.25),r.mxheight>300&&(r.mxheight=300),n.cCategory){var h=e.defaultRankColor(n.cCategory);r.bc=h[0],r.fc=h[1]}else r.bc="gray",r.fc="black";r.bc2=e.shadeColor(r.bc,.4)}else{if(r.mxheight="300",r.sp1="width:15%",r.sp2="width:22.5%;max-height:50px;",r.sp3="width:20%",r.sm=!1,r.nsm=!0,r.width=Math.round(u*g),r.width2=Math.round(u*g/2),r.width3=Math.round(u*g/3),n.cCategory){var h=e.defaultRankColor(n.cCategory);r.bc=h[0],r.fc=h[1]}else r.bc="gray",r.fc="black";r.bc2="#d8d8d8"}if(void 0!=r.answer.addinfo&&(r.answer.addinfo_teaser=r.answer.addinfo.slice(0,300),r.answer.addinfo_complete=r.answer.addinfo.slice(300)),r.moretext=" more ",r.completeinfo=!1,n.coordsRdy&&r.answer.location&&void 0==r.answer.dist){var v=.017453292519943295,b=Math.cos,w=0,y=n.currentUserLatitude,x=n.currentUserLongitude,k=0,D=0,E=0;k=r.answer.lat,D=r.answer.lng,w=.5-b((k-y)*v)/2+b(y*v)*b(k*v)*(1-b((D-x)*v))/2,E=12742*Math.asin(Math.sqrt(w))/1.609,r.answer.dist=E<1?E.toPrecision(2):E.toPrecision(3)}!function(){if(r.hrset=!1,void 0!=r.answer.strhours&&null!=r.answer.strhours){r.hrset=!0;var e=new Date,t=e.getDay(),n=t-1;n<0&&(n=6);var a=JSON.parse(r.answer.strhours);"CLOSED"==a[n].opn?r.hourstr="Closed today":r.hourstr="Open today from: "+a[n].st+" to "+a[n].ct}}(),function(){r.workhere=[],n.answers.forEach(function(e){e.eventlocid==r.answer.id&&r.workhere.push(e)}),r.workhere.length>0&&s.pulldata("answers",r.workhere)}(),r.toggleimgmode=function(){r.modeIsImage?c():i()},r.editAnswer=function(){n.isLoggedIn?"Event"==r.answer.type?(n.eventmode="edit",a.go("addEvent",{index:r.answer.id})):a.go("editAnswer",{index:r.answer.id}):o.loginFacebook()},r.showcomplete=function(){return" more "==r.moretext?(r.moretext=" less ",void(r.completeinfo=!0)):" less "==r.moretext?(r.moretext=" more ",void(r.completeinfo=!1)):void 0},r.gotoLocationAnswer=function(){console.log("eventlocid - ",r.answer.eventlocid),a.go("answerDetail",{index:r.answer.eventlocid})},r.gotoprofile=function(e){a.go("answerDetail",{index:e.slug})}}}}]),function(){"use strict";function e(e,t,n,a,o,s,r,i,c,l,d,u,g,m,p,f,h,v,b,w,y,x,k,D,E,O,C,R,_,S,M,$,P,I,B,L){function U(){s.canswer=null;var e=S.getIndexFromSlug(t.index),n=s.answers.map(function(e){return e.id}).indexOf(Number(e));n>-1&&(s.canswer=s.answers[n]),null!=s.canswer?T():b.getAnswer(t.index)}function T(){if(r.scrollTo(0,0),tt.dataReady=!0,tt.answer=s.canswer,st=s.canswers,tt.fields=s.fields,tt.isAdmin=s.isAdmin||s.dataAdmin,tt.isAdmin&&(tt.bizcat=v.getBizCat(tt.answer.id)),s.isLoggedIn=!!s.isLoggedIn&&s.isLoggedIn,tt.isLoggedIn=s.isLoggedIn,s.cansvrows=void 0,O.$parent.$parent.$parent.seo={pageTitle:tt.answer.name,metaDescription:tt.answer.addinfo},void 0==tt.answer.isprivate&&(tt.answer.isprivate=!1),tt.type=tt.answer.type,tt.i=-1,(s.DISPLAY_XSMALL||s.DISPLAY_SMALL)&&(lt=4),s.DISPLAY_MEDIUM&&(lt=6),s.DISPLAY_LARGE&&(lt=12),xe(),s.inFavMode?tt.ranking=s.myfavs.title:s.cCategory?tt.ranking=s.cCategory.title:tt.ranking="",void 0==st&&(st=[tt.answer]),tt.idx=st.map(function(e){return e.id}).indexOf(tt.answer.id)+1,void 0==s.cCategory&&(tt.idx=0),2225==tt.answer.id?tt.igdemo=!0:tt.igdemo=!1,G(),tt.modeIsImage=void 0==s.modeIsImage||s.modeIsImage,void 0==tt.answer.location&&(tt.modeIsImage=!0),"answerDetail"!=s.previousState&&r.scrollTo(0,0),V(),X(tt.answer.id),tt.access=!1,s.isLoggedIn?(s.user.id==tt.answer.owner?(tt.userIsOwner=!0,tt.answer.isactive&&(tt.access=!0)):tt.userIsOwner=!1,s.isAdmin&&(tt.userIsOwner=!0)):tt.userIsOwner=!1,s.userIsOwner=tt.userIsOwner,de(),"Establishment"!=tt.type&&tt.type,"Establishment"==tt.type&&oe(tt.answer.id),ie(tt.answer.id),ae(),b.pulldata("ranks",tt.answerRanks),null!=tt.answer.eventlocid&&tt.answer.eventlocid>-1&&b.pulldata("answers",[{id:tt.answer.eventlocid,answer:tt.answer.eventlocid}]),"Event"==tt.type){var e=JSON.parse(tt.answer.eventstr);Be(tt.answer,e),tt.ehtml=c.eventHtml(tt.answer),tt.estyle="background-color:"+tt.answer.bc+";color:"+tt.answer.fc+";white-space:pre;"}if(tt.answer.hasranks){var t=0;if(tt.myranks=JSON.parse(tt.answer.ranks),void 0!=tt.myranks&&tt.myranks.length>0)for(var n=0;n<tt.myranks.length;n++)t=s.customranks.map(function(e){return e.id}).indexOf(tt.myranks[n].id),tt.myranks[n].title=s.customranks[t].title.replace(" @ "+tt.answer.name,""),tt.myranks[n].image=s.customranks[t].image1url,void 0!=tt.myranks[n].image&&""!=tt.myranks[n].image||(tt.myranks[n].image=s.EMPTY_IMAGE)}else if(tt.userIsOwner){tt.myranks=[];var o={};o.id=11091,o.bc="#027fa8",o.fc="white",tt.myranks.push(o),o={},o.id=11092,o.bc="#027fa8",o.fc="white",tt.myranks.push(o),o={},o.id=11093,o.bc="#027fa8",o.fc="white",tt.myranks.push(o);for(var n=0;n<tt.myranks.length;n++)t=s.customranks.map(function(e){return e.id}).indexOf(tt.myranks[n].id),t>-1&&(tt.myranks[n].title=s.customranks[t].title.replace(" @ Demo",""),tt.myranks[n].image=s.customranks[t].image1url),void 0!=tt.myranks[n].image&&""!=tt.myranks[n].image||(tt.myranks[n].image=s.EMPTY_IMAGE);s.rankOwner={},s.rankOwner.name=tt.answer.name,s.rankOwner.slug=tt.answer.slug}void 0==tt.answer.numcom?tt.numcom=0:tt.numcom=tt.vrows.length,tt.answer.numcom!=tt.vrows.length&&a.updateAnswer(tt.answer.id,["numcom"],[tt.numcom]),tt.ranking?tt.showNextnPrev=!0:tt.showNextnPrev=!1,et(),Ve(),s.DEBUG_MODE&&console.log("Answer details loaded"),window.prerenderReady=!0}function G(){if(!s.fields){var e=0;switch(tt.answer.type){case"Place":e=0;break;case"Person":e=1;break;case"Event":e=2;break;case"Organization":e=3;break;case"Short-Phrase":e=4;break;case"Activity":e=5;break;case"Establishment":e=6;break;case"Thing":e=7;break;case"PersonCust":e=8;break;case"Simple":e=9}var t=s.typeSchema[e].fields;s.fields=t}}function V(){void 0==tt.answer.owner||null==tt.answer.owner||0==tt.answer.owner?tt.answer.hasOwner=!1:tt.answer.hasOwner=!0,tt.bindtxt="","Establishment"==tt.type&&(tt.bindtxt="I represent this business"),"PersonCust"==tt.type&&(tt.bindtxt="I am this person"),"Event"==tt.type&&(tt.bindtxt="I organize this event")}function N(e){var t=0,n=0,a="";tt.relativetable=[];for(var o=s.R,r=s.GP,i=s.answersR,c=A.indexOf(+e),l=0,d=s.fields[0].name,u=!1,g=0;g<i.length;g++)if(A[g]!=e){switch(l=o[c][g],d){case"name":a=i[g].name;break;case"nickname":a=i[g].nickname;break;case"country":a=i[g].country,u=!0;break;case"club":a=i[g].club}r[c][g]?(t=Math.round(l/r[c][g]*100),n=100-t):(t=0,n=0),tt.relativetable.push({id:i[g].id,Rank:i[g].Rank,PctF:t,vsName:a,PctC:n,GP:r[c][g],isC:u})}}function F(e){q(),rt=!1,nt=!1,tt.answer=st[A.indexOf(+e)],s.canswer=tt.answer,X(tt.answer.id),at=tt.catans.upV,ot=tt.catans.downV,V(),ae(),Y(),N(e),oe(tt.answer.id),ie(tt.answer.id)}function q(){if(s.isLoggedIn&&ut){s.DEBUG_MODE&&console.log("UpdateRecords @answerDetail");for(var e=0;e<tt.answerRanks.length;e++){var t=tt.answerRanks[e].voteRecordExists,n=!1,a={};try{var o=s.thisuseractivity.map(function(e){return e.category}).indexOf(tt.answerRanks[e].id)}catch(e){console.log("Error: ",e),console.log("$rootScope.thisuseractivity - ",s.thisuseractivity);var o=-1}o>=0?(n=!0,a=s.thisuseractivity[o]):n=!1,t&&tt.answerRanks[e].uservote.vote!=tt.answerRanks[e].dV&&0!=tt.answerRanks[e].dV&&(s.DEBUG_MODE&&console.log("UR-1"),l.patchRec(tt.answerRanks[e].uservote.id,tt.answerRanks[e].dV)),t&&tt.answerRanks[e].uservote.vote!=tt.answerRanks[e].dV&&0==tt.answerRanks[e].dV&&(s.DEBUG_MODE&&console.log("UR-2"),l.deleteRec(tt.answerRanks[e].uservote.id),a.votes<2?(s.DEBUG_MODE&&console.log("UR-3"),i.deleteRec(a.id)):(s.DEBUG_MODE&&console.log("UR-4"),i.patchRec(a.id,a.votes-1))),t||0==tt.answerRanks[e].dV||(s.DEBUG_MODE&&console.log("UR-5"),l.postRec(tt.answerRanks[e].catans,tt.answer.id,tt.answerRanks[e].id,tt.answerRanks[e].dV),n?(s.DEBUG_MODE&&console.log("UR-6"),i.patchRec(a.id,a.votes+1)):(s.DEBUG_MODE&&console.log("UR-7"),i.postRec(tt.answerRanks[e].id))),tt.answerRanks[e].upV==tt.answerRanks[e].upVi&&tt.answerRanks[e].downV==tt.answerRanks[e].downVi||(s.DEBUG_MODE&&console.log("UR-8"),m.updateRec(tt.answerRanks[e].catans,["upV","downV"],[tt.answerRanks[e].upV,tt.answerRanks[e].downV]))}if(tt.vrows)for(var e=0;e<tt.vrows.length;e++){var r=tt.vrows[e].voteExists;r&&tt.vrows[e].dVi!=tt.vrows[e].dV&&(s.DEBUG_MODE&&console.log("UR-9"),s.cvrowvotes[tt.vrows[e].vidx].val=tt.vrows[e].dV,k.patchRec(tt.vrows[e].voteid,tt.vrows[e].dV)),r||0==tt.vrows[e].dV||(s.DEBUG_MODE&&console.log("UR-10"),k.postRec(tt.vrows[e].id,tt.vrows[e].dV)),tt.vrows[e].upV==tt.vrows[e].upVi&&tt.vrows[e].downV==tt.vrows[e].downVi||(s.DEBUG_MODE&&console.log("UR-11"),x.updateRec(tt.vrows[e].id,["upV","downV"],[tt.vrows[e].upV,tt.vrows[e].downV]))}rt=!0}}function Y(){for(var e=0;e<tt.answerRanks.length;e++){tt.answerRanks[e].voteRecordExists=!1;for(var t=0;t<s.cvotes.length;t++)if(s.cvotes[t].catans==tt.answerRanks[e].catans){tt.answerRanks[e].uservote=s.cvotes[t],tt.answerRanks[e].uservote.ansvidx=e,tt.answerRanks[e].voteRecordExists=!0;break}tt.answerRanks[e].voteRecordExists?tt.answerRanks[e].dV=tt.answerRanks[e].uservote.vote:tt.answerRanks[e].dV=0,W(tt.answerRanks[e])}}function z(){if(s.isLoggedIn)for(var e=0;e<s.cansvrows.length;e++)for(var t=0;t<s.cvrowvotes.length;t++)s.cvrowvotes[t].vrow==s.cansvrows[e].id&&(s.cansvrows[e].voteExists=!0,s.cansvrows[e].dVi=s.cvrowvotes[t].val,s.cansvrows[e].dV=s.cvrowvotes[t].val,s.cansvrows[e].voteid=s.cvrowvotes[t].id,s.cansvrows[e].vidx=t,j(s.cansvrows[e],s.cvrowvotes[t].val));ce()}function j(e,t){1==t&&(e.upImage="thumbs_up_blue_table.png",e.downImage="thumbs_down_gray_table.png"),0==t&&(e.dVi=0,e.dV=0,e.upImage="thumbs_up_gray_table.png",e.downImage="thumbs_down_gray_table.png"),-1==t&&(e.dVi=-1,e.dV=-1,e.upImage="thumbs_up_gray_table.png",e.downImage="thumbs_down_blue_table.png")}function X(e){tt.numEdits=0;for(var t=0;t<s.edits.length;t++)s.edits[t].answer==e&&tt.numEdits++}function W(e){1==e.dV&&(e.thumbUp="#0070c0",e.thumbDn="grey"),0==e.dV&&(e.thumbUp="grey",e.thumbDn="grey"),-1==e.dV&&(e.thumbUp="grey",e.thumbDn="#0070c0")}function K(e){if(!s.isLoggedIn)return void o.loginFacebook();switch(e.dV){case-1:e.dV=1,e.upV++,e.downV--;break;case 0:e.dV=1,e.upV++;break;case 1:e.dV=0,e.upV--}W(e),s.DEBUG_MODE&&console.log("UpVote")}function H(e){if(!s.isLoggedIn)return void o.loginFacebook();switch(e.dV){case-1:e.dV=0,e.downV--;break;case 0:e.dV=-1,e.downV++;break;case 1:e.dV=-1,e.upV--,e.downV++}W(e),s.DEBUG_MODE&&console.log("DownVote")}function J(){s.DEBUG_MODE&&console.log("goBack"),"match"==s.previousState?n.go("match"):s.inFavMode?n.go("favs"):s.cCategory?(s.cCategory.isfoodnearme&&(s.isFoodNearMe=!0,n.go("rankSummary",{index:s.cCategory.slug})),s.cCategory.title.indexOf("@")>-1&&(s.isCustomRank=!0),n.go("rankSummary",{index:s.cCategory.id})):Je()}function Q(e){s.title=e.title,n.go("rankSummary",{
index:e.id})}function Z(){console.log("Delete Answer"),o.deleteType(function(){d.deleteRecordsbyCatans(s.cCategory.id,tt.answer.id),m.deleteRec(tt.answer.id,s.cCategory.id).then(function(){tt.addctsactive=!1,ae(),tt.dispRanks--})},function(){a.deleteAnswer(tt.answer.id),d.deleteRecordsbyAnswer(tt.answer.id),u.deleteEditbyAnswer(tt.answer.id),g.deleteEditVotesbyAnswer(tt.answer.id),m.deleteAnswer(tt.answer.id),x.deleteVrowByAnswer(tt.answer.id),n.go("rankSummary",{index:s.cCategory.id})})}function ee(e){var t=tt.answer.name,n=s.content.map(function(e){return e.id}).indexOf(e.id),a=s.content[n].title;o.deleteThisCatans(t,a,function(){d.deleteRecordsbyCatans(e.id,tt.answer.id),m.deleteRec(tt.answer.id,e.id).then(function(){tt.addctsactive=!1,ae(),tt.dispRanks--})})}function te(t){if(s.isLoggedIn)return s.DEBUG_MODE&&console.log("Answer Flagged"),e.flagAnswer("answer",tt.answer.id,t),void o.getDialog("answerFlagged");o.loginFacebook()}function ne(t){if(s.isLoggedIn)return s.DEBUG_MODE&&console.log("Answer Comment Flagged"),e.flagAnswer("comment-answer",tt.answer.id,t),void o.getDialog("commentFlagged");o.loginFacebook()}function ae(){tt.answerRanks=[];for(var e={},t=0;t<s.catansrecs.length;t++)if(s.catansrecs[t].answer==tt.answer.id)for(var n=0;n<s.content.length;n++)s.content[n].id==s.catansrecs[t].category&&(e={},e=s.content[n],e.upV=s.catansrecs[t].upV,e.downV=s.catansrecs[t].downV,e.catans=s.catansrecs[t].id,e.rank=s.catansrecs[t].rank,e.rank>e.answers&&(e.rank=e.answers),e.uservote={},e.upVi=s.catansrecs[t].upV,e.downVi=s.catansrecs[t].downV,1==e.rank?e.icon="/assets/images/gold.png":2==e.rank?e.icon="/assets/images/silver.png":3==e.rank?e.icon="/assets/images/bronze.png":e.rank>3&&e.rank<11?e.icon="/assets/images/top10.png":e.rank>=11&&e.rank<21?e.icon="/assets/images/top20.png":e.rank>=21&&e.rank<51?e.icon="/assets/images/top50.png":e.rank>=51&&e.rank<101?e.icon="/assets/images/top100.png":e.icon="/assets/images/blank.png",tt.answerRanks.push(e));tt.otherRanksExist=!0,Y()}function oe(e){var t=0;t=!tt.answer.ispremium&&tt.userIsOwner?1:e,tt.specialsList=[];for(var n=0;n<s.specials.length;n++)s.specials[n].answer==t&&tt.specialsList.push(s.specials[n])}function se(e){o.showSpecial(e)}function re(e){e.showimage?e.showimage=!1:e.showimage=!0}function ie(e){var t=!1,n={},a=!1;if(void 0==s.cansvrows&&(s.cansvrows=[],a=!0),s.cvrows){for(var o=0;o<s.cvrows.length;o++)if(s.cvrows[o].answer==e){t=!1;for(var r=0;r<s.cansvrows.length;r++)s.cansvrows[r].id==s.cvrows[o].id&&(t=!0);t||(n={},n=s.cvrows[o],n.idx=o,n.voteExists=!1,n.dV=0,n.upVi=s.cvrows[o].upV,n.downVi=s.cvrows[o].downV,n.upImage="thumbs_up_gray_table.png",n.downImage="thumbs_down_gray_table.png",n.delta=n.upV-n.downV,s.isLoggedIn&&n.user==s.user.id&&it++,s.cansvrows.push(n))}a?z():tt.newop="",(it>=3||!s.isLoggedIn)&&(tt.addvrowbutton="disabled")}}function ce(){tt.vrows=s.cansvrows}function le(){tt.maybeRepeatedVrows=[];var e=[],t="",n=tt.newop,a=!1;n=n.toLowerCase(),n=n.replace(","," "),n=n.replace("!"," ");for(var o=n.split(" "),s=0;s<tt.vrows.length;s++){a=!1,t=tt.vrows[s].title,t=t.toLowerCase(),t=t.replace(","," "),t=t.replace("!"," "),e=t.split(" ");for(var r=0;r<e.length;r++){for(var i=0;i<o.length;i++)if(e[r].length>3&&o[i].length>3)if(e[r].length>=o[i].length){if(e[r].indexOf(o[i])>-1){tt.maybeRepeatedVrows.push(tt.vrows[s]),a=!0;break}}else if(o[i].indexOf(e[r])>-1){tt.maybeRepeatedVrows.push(tt.vrows[s]),a=!0;break}if(a)break}}}function de(){s.dataAdmin||s.isAdmin||tt.userIsOwner&&tt.answer.isprivate?tt.deleteButton=!0:tt.deleteButton=!1}function ue(){o.url(tt.answer.imageurl)}function ge(){n.go("cwrapper")}function me(){J()}function pe(){o.bizRegistration(fe)}function fe(){s.isLoggedIn?o.bindAccount(s.user.name,tt.answer.name,he):o.getDialog("notLoggedInBiz")}function he(){s.DEBUG_MODE&&console.log("Bind business to user account"),a.updateAnswer(tt.answer.id,["owner"],[s.user.id]).then(ve);var e={};e=tt.answer,e.username=s.user.first_name+" "+s.user.last_name,e.email=s.user.email,v.adduseraccnt(e).then(function(t){B.newBizCreated({account:t,answer:e}).then(function(e){});for(var n=!1,a=0;a<s.useraccnts.length;a++)""!=s.useraccnts[a].email&&(n=!0);n||s.$emit("showWarning"),s.$emit("userAccountsLoaded")})}function ve(){tt.userIsOwner=!0,V()}function be(){n.go("specials")}function we(){}function ye(){n.go("answerRanksManager")}function xe(){if(tt.showImageGallery=!0,tt.igdemo)E.getImages().then(ke);else{s.blobs=[];for(var e=tt.answer.ig_image_urls.split(";"),t=0;t<e.length;t++)if(""!=e[t]){var n={};n.url=e[t],n.type="Instagram",s.blobs.push(n)}D.getImageList().then(ke)}}function ke(){var e=[];tt.specialsList&&(e=tt.specialsList.map(function(e){return e.image})),s.blobs=s.blobs.filter(function(t){return-1==e.indexOf(t.url)}),tt.igdemo?tt.images=s.igimages:tt.images=s.blobs,ct=tt.images.length,tt.i=0,De()}function De(){tt.i+(lt-1)<=ct?tt.e=tt.i+lt:tt.e=ct,ct<=4?(tt.showFwd=!1,tt.showRev=!1):(0==tt.i?tt.showRev=!1:tt.showRev=!0,tt.e==tt.images.length-1?tt.showFwd=!1:tt.showFwd=!0),tt.e>=ct-1&&(tt.showFwd=!1)}function Ee(){tt.showFwd&&(tt.i=tt.i+lt,De())}function Oe(){tt.showRev&&(tt.i=tt.i-lt,De())}function Ce(e){n.go("rankSummary",{index:e.slug})}function Re(e){s.oCategory=s.cCategory,s.oAnswer=tt.answer,s.isCustomRank=!0,n.go("rankSummary",{index:e.id})}function _e(){var e=st.length,t=st.map(function(e){return e.id}).indexOf(tt.answer.id),a=t-1;a<0&&(a=e-1),s.isLoggedIn&&q(),n.go("answerDetail",{index:st[a].id})}function Ae(){var e=st.length,t=st.map(function(e){return e.id}).indexOf(tt.answer.id),a=t+1;a>e-1&&(a=0),s.isLoggedIn&&q(),n.go("answerDetail",{index:st[a].id})}function Se(e){if(!s.isLoggedIn)return void o.loginFacebook();switch(e.dV){case-1:e.dV=1,e.upV++,e.downV--;break;case 0:e.dV=1,e.upV++;break;case 1:e.dV=0,e.upV--}e.delta=e.upV-e.downV,$e(e),s.DEBUG_MODE&&console.log("VRow UpVote")}function Me(e){if(!s.isLoggedIn)return void o.loginFacebook();switch(e.dV){case-1:e.dV=0,e.downV--;break;case 0:e.dV=-1,e.downV++;break;case 1:e.dV=-1,e.upV--,e.downV++}e.delta=e.upV-e.downV,$e(e),s.DEBUG_MODE&&console.log("DownVote")}function $e(e){1==e.dV&&(e.upImage="thumbs_up_blue_table.png",e.downImage="thumbs_down_gray_table.png"),0==e.dV&&(e.upImage="thumbs_up_gray_table.png",e.downImage="thumbs_down_gray_table.png"),-1==e.dV&&(e.upImage="thumbs_up_gray_table.png",e.downImage="thumbs_down_blue_table.png")}function Pe(){f.loadComments("answer",dt).then(function(){$.all(dt.comments.map(function(e){return P.getFBUserById(e.user)})).then(function(e){for(var t=0;t<dt.comments.length;t++)dt.comments[t].picture=e[t]?e[t].picture.data.url:null})})}function Ie(){f.postComment("answer",dt)}function Be(e,t){e.bc=t.bc,e.fc=t.fc,e.freq=t.freq,e.edate=t.edate,e.sdate=t.sdate,e.etime=t.etime,e.etime2=t.etime2,e.stime=t.stime,e.stime2=t.stime2,e.mon=t.mon,e.tue=t.tue,e.wed=t.wed,e.thu=t.thu,e.fri=t.fri,e.sat=t.sat,e.sun=t.sun}function Le(e){o.seePhotos(tt.images,e,tt.answer,tt.userIsOwner)}function Ue(e){var t="",n=-1,a=!1,o=-1,r=-1;t=tt.addctsval;for(var i=0;i<s.content.length;i++)if(s.content[i].title==t){a=!0,n=s.content[i].id;break}if(console.log("could not find - ",t),a)console.log("rank found, posting record"),m.postRec2(tt.answer.id,n).then(function(){tt.addctsactive=!1,ae(),tt.dispRanks++});else{console.log("rank not found, will create ghost"),t.indexOf(tt.answer.cityarea)>-1&&(t=t.replace(tt.answer.cityarea,"@Nh"),console.log("category title - ",t));for(var i=0;i<s.categories.length;i++)if(s.categories[i].category==t){o=s.categories[i].id;break}for(var i=0;i<s.locations.length;i++)if(s.locations[i].nh_name==tt.answer.cityarea){r=s.locations[i].id;break}if(o>-1&&r>-1){var c={};c.cat=o,c.nh=r,c.isatomic=!0,C.addTable(c).then(function(e){m.postRec2(tt.answer.id,e).then(function(){tt.addctsactive=!1,ae(),tt.dispRanks++})})}else console.log("Error creating ghost rank, cat, nh ",o,r)}}function Te(e){tt.addctsopts=[];for(var t="",n=0;n<s.ctsOptions.length;n++)s.ctsOptions[n].indexOf("@Nh")>-1?(t=s.ctsOptions[n].replace("@Nh",tt.answer.cityarea),tt.addctsopts.push(t)):tt.addctsopts.push(s.ctsOptions[n]);tt.addctsactive=!0}function Ge(){tt.votemode=!0,tt.voteonstyle="background-color:#3277b3;color:#e6e6e6",tt.voteoffstyle="background-color:#e6e6e6;color:black"}function Ve(){tt.votemode=!1,tt.voteoffstyle="background-color:#3277b3;color:#e6e6e6",tt.voteonstyle="background-color:#e6e6e6;color:black"}function Ne(){o.endorse(tt.type),s.endorseDialogShown=!0}function Fe(){it<3&&s.isLoggedIn?(le(),tt.maybeRepeatedVrows.length>0?o.maybeRepeatVrows(tt.newop,tt.maybeRepeatedVrows,qe):qe()):s.isLoggedIn?o.getDialog("opinionsLimit"):o.loginFacebook()}function qe(){x.postRec(tt.newop).then(function(){ie(s.canswer.id)})}function Ye(){null==I.access_token()?I.login():I.getMyRecentImages().then(function(e){o.chooseImgFromIgDlg(e,tt.answer,tt.userIsOwner,tt.navigateTowards)}).catch(function(e){console.log(e)}),s.$on("instagramLoggedIn",function(e,t){I.getMyRecentImages().then(function(e){o.chooseImgFromIgDlg(e,tt.answer,tt.userIsOwner,tt.navigateTowards)}).catch(function(e){console.log(e)})})}function ze(e){"next"==e?I.getNextPage().then(function(e){o.chooseImgFromIgDlg(e,tt.answer,tt.userIsOwner,tt.navigateTowards)}).catch(function(e){console.log(e)}):"previous"==e&&I.getPreviousPage().then(function(e){o.chooseImgFromIgDlg(e,tt.answer,tt.userIsOwner,tt.navigateTowards)}).catch(function(e){console.log(e)})}function je(){tt.dispRanks<=3?tt.dispRanks=tt.answerRanks.length:tt.dispRanks=3}function Xe(){tt.hideCustomRanksMsg=!0,s.hideCustomRankMsg=!0}function We(){tt.hideGetPremiumMsg=!0,s.hideGetPremiumMsg=!0}function Ke(){n.go("mybusiness")}function He(){for(var e=tt.answer.family.split(":").map(Number),t=[],n=0,a=0;a<e.length;a++)(n=s.answers.map(function(e){return e.id}).indexOf(e[a]))>-1&&t.push(s.answers[n]);o.showLocations(t)}function Je(){q(),"trends"==s.previousState?n.go("trends"):s.$emit("backToResults")}function Qe(){tt.linkurl=R+"answer"+tt.answer.id+".html",tt.tweet=tt.answer.name+", endorse your favorite ones at: ";var e=tt.answer.imageurl;o.shareOptions(Ze,tt.isMobile,tt.linkurl,"Rank-X, "+tt.answer.name+"\n"+e,O)}function Ze(e){var t=tt.answer.imageurl;switch(e){case"twitter":s.DEBUG_MODE&&console.log(e),L.share({provider:"twitter",attrs:{socialshareUrl:tt.linkurl,socialshareText:tt.tweet,socialshareHashtags:"rankxsandiego"}});break;case"facebook":s.DEBUG_MODE&&console.log(e),FB.ui({method:"feed",link:tt.linkurl,caption:"Rank-X San Diego"});break;case"email":s.DEBUG_MODE&&console.log(e),L.share({provider:"email",attrs:{socialshareSubject:"Rank-X, "+tt.answer.name,socialshareBody:tt.linkurl}});break;case"gplus":s.DEBUG_MODE&&console.log(e),L.share({provider:"google",attrs:{socialshareUrl:tt.linkurl,socialshareText:tt.answer.name,socialshareMedia:t}});break;case"pinterest":s.DEBUG_MODE&&console.log(e),L.share({provider:"pinterest",attrs:{socialshareUrl:tt.linkurl,socialshareText:"Rank-X, "+tt.answer.name,socialshareMedia:t}});break;case"tumblr":s.DEBUG_MODE&&console.log(e),L.share({provider:"tumblr",attrs:{socialshareUrl:tt.linkurl,socialshareText:"Rank-X, "+tt.answer.name,socialshareMedia:t}});break;case"reddit":s.DEBUG_MODE&&console.log(e),L.share({provider:"reddit",attrs:{socialshareUrl:tt.linkurl,socialshareText:"Rank-X, "+tt.answer.name,socialshareSubreddit:""}})}}function et(){var e=(tt.answer.views++,R+"databaseOps/incViews/answer/"+tt.answer.id);_({method:"POST",url:e,headers:{"X-Dreamfactory-API-Key":void 0,"X-DreamFactory-Session-Token":void 0}})}var tt=this;tt.title="answerDetail";var nt=!1,at=0,ot=0,st=[],rt=!1,it=0;tt.numEdits=0;var ct=0,lt=0;tt.relativetable=[],tt.catans=[],tt.sm=s.sm,tt.votemode=!1,tt.dispRanks=3,tt.UpVote=K,tt.DownVote=H,tt.refresh=F,tt.goBack=J,tt.goPrev=_e,tt.goNext=Ae,tt.deleteAnswer=Z,tt.flagAnswer=te,tt.deleteButton=!1,tt.showUrl=ue,tt.closeRank=ge,tt.closeAnswerDetail=me,tt.rankSel=Q,tt.bizRegDialog=pe,tt.openSpecials=be,tt.editVRows=we,tt.getImages=xe,tt.showsimage=re,tt.gotoRank=Ce,tt.vrowVoteUp=Se,tt.vrowVoteDown=Me,tt.loadComments=Pe,tt.postComment=Ie,tt.selectPhoto=Le,tt.cmFlag=ne,tt.deleteThisCatans=ee,tt.addRankforAnswer=ye,tt.votemodeON=Ge,tt.votemodeOFF=Ve,tt.user=s.user,tt.endorseDialog=Ne,tt.selectInstagramImages=Ye,tt.showRanks=je,tt.hideCustomRanks=Xe,tt.hideGetPremium=We,tt.gotoMyBusiness=Ke,tt.share=Qe,tt.addvrow=Fe,tt.moreImagesRev=Oe,tt.moreImagesFwd=Ee,tt.showSpecial=se,tt.showLocations=He,tt.navigateTowards=ze,tt.gotoCustomRank=Re,tt.backToResults=Je,tt.addCatans=Te,tt.addctsactive=!1,tt.addcts=Ue;var dt={};dt.commLoaded=!1,dt.initials="",dt.bc="",dt.fc="",dt.comments=[],dt.newComment="",tt.cm=dt,tt.commentAllowed=!0,tt.searchActive=s.searchActive;var ut=!1;tt.dataReady=!1,tt.isMobile=!1,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|ipad|iris|kindle|Android|Silk|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(navigator.userAgent)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(navigator.userAgent.substr(0,4)))&&(tt.isMobile=!0);var gt=s.$on("$stateChangeStart",function(e,t,n,a,o){"answerDetail"==a.name&&"answerDetail"!=t.name&&!rt&&s.isLoggedIn&&ut&&q()}),mt=s.$on("refreshImages",function(){"answerDetail"==n.current.name&&xe()}),pt=s.$on("fileUploaded",function(){"answerDetail"==n.current.name&&xe()}),ft=s.$on("answerDataLoaded",function(){0==tt.dataReady&&U()});O.$on("$destroy",mt),O.$on("$destroy",pt),O.$on("$destroy",ft),O.$on("$destroy",gt),tt.hideCustomRanksMsg=void 0!=s.hideCustomRankMsg&&s.hideCustomRankMsg,tt.hideGetPremiumMsg=void 0!=s.hideGetPremiumMsg&&s.hideGetPremiumMsg,window.prerenderReady=!1,U()}angular.module("app").controller("answerDetail",e),e.$inject=["flag","$stateParams","$state","answer","dialog","$rootScope","$window","useractivity","htmlops","votes","matchrec","edit","editvote","catans","datetime","commentops","userdata","useraccnt","dataloader","$timeout","$location","vrows","vrowvotes","imagelist","instagram","$scope","table","SERVER_URL","$http","common","$cookies","$q","fbusers","InstagramService","mailing","Socialshare"]}(),function(){"use strict";function e(e,t,n){function a(){var a=l,o=e.get(a);return t.all([o]).then(function(e){return r(e[0].data.resource),n.DEBUG_MODE&&console.log("User uploaded images: ",c.length),c},i)}function o(t){function a(e){var a=t;return a.id=e.data.resource[0].id,c.push(a),n.DEBUG_MODE&&console.log("created uui record"),n.DEBUG_MODE&&console.log("result",e),e.data}var o=l,s=[];return s.push(t),e.post(o,s,{headers:{"Content-Type":"multipart/form-data"},body:s}).then(a,i)}function s(t){function a(e){return n.DEBUG_MODE&&console.log("Deleting uui record was succesful"),e.data}var o={};o.resource=[];var s={};s.id=t,o.resource.push(s);var r=l+"/"+t,d=c.map(function(e){return e.id}).indexOf(t);return d>-1&&c.splice(d,1),e.delete(r,s,{headers:{"Content-Type":"multipart/form-data"},body:o}).then(a,i)}function r(e){c.length=0,e.forEach(function(e){c.push(e)})}function i(e){throw e}var c=[];n.uuis=c;var l="/api/v2/mysql/_table/useruploadedimages";return{getRecords:a,postRecord:o,deleteRecord:s}}angular.module("app").factory("useruploadedimages",e),e.$inject=["$http","$q","$rootScope"]}(),function(){"use strict";function e(e,t,n){function a(n){function a(e){return l=e.data.resource}if(i()&&!n)return t.when(l);var o=d;return e.get(o).then(a,c)}function o(t,n){function a(e){console.log("Creating new query record was succesful")}var o={};o.resource=[];var s={};s.query=t,s.results=n,s.timestmp=Date.now(),o.resource.push(s);var r=d;return e.post(r,o,{headers:{"Content-Type":"multipart/form-data"},body:o}).then(a,c)}function s(t){function n(e){console.log("Flushing queries db was succesful")}({}).resource=t,console.log("obj ---",t);var a=d;return e.delete(a,t,{headers:{"Content-Type":"multipart/form-data"},body:t}).then(n,c)}function r(t){function n(e){return console.log("Deleting record was succesful"),e.data}var a={};a.resource=[];var o={};o.id=t,a.resource.push(o);var s=d+"/"+t;return e.delete(s,o,{headers:{"Content-Type":"multipart/form-data"},body:a}).then(n,c)}function i(){return l.length>0}function c(e){throw e}var l=[],d="/api/v2/mysql/_table/queries";return{getQueries:a,postQuery:o,flushAll:s,deleteRec:r}}angular.module("app").factory("query",e),e.$inject=["$http","$q","$rootScope"]}(),function(){"use strict";function e(e,t,n){function a(n){function a(e){return r=e.data.resource}if(o()&&!n)return t.when(r);var c=i;return e.get(c).then(a,s)}function o(){return r.length>0}function s(e){throw e}var r=[],i="/api/v2/mysql/_table/codeprice";return{get:a}}angular.module("app").factory("codeprice",e),e.$inject=["$http","$q","$rootScope"]}(),function(){"use strict";function e(e,t,n){function a(t){function a(e){return n.DEBUG_MODE&&console.log("created new category-code paire"),e.data}var o=l,s=[];return s.push(t),c.push(t),e.post(o,s,{headers:{"Content-Type":"multipart/form-data"},body:s}).then(a,i)}function o(n){function a(e){return c=e.data.resource}if(r()&&!n)return t.when(c);var o=l;return e.get(o).then(a,i)}function s(t,a,o){function s(e){return n.DEBUG_MODE&&console.log("updating category code succesful"),e.data}var r={};r.resource=[];var d={};d.id=t;for(var u=0;u<a.length;u++)switch(a[u]){case"category":d.category=o[u]}r.resource.push(d);for(var g=l,m=c.map(function(e){return e.id}).indexOf(t),u=0;u<a.length;u++)switch(a[u]){case"category":c[m].category=o[u]}return e.patch(g,r,{headers:{"Content-Type":"multipart/form-data"},body:r}).then(s,i)}function r(){return c.length>0}function i(e){throw e}var c=[],l="/api/v2/mysql/_table/categorycode";return{get:o,post:a,update:s}}angular.module("app").factory("categorycode",e),e.$inject=["$http","$q","$rootScope"]}();