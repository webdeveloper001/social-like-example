function calculateAge(birthday){var ageDifMs=Date.now()-birthday.getTime(),ageDate=new Date(ageDifMs);return Math.abs(ageDate.getUTCFullYear()-1970)}!function(){"use strict";angular.module("app",["angulike","color.picker","ngFileUpload","ngAnimate","ngCookies","ngRoute","ngSanitize","ngTouch","ngMessages","oc.lazyLoad","login","ui.router","ui.bootstrap.modal","mgcrea.ngStrap","720kb.datepicker","720kb.socialshare","ngFacebook","ui.select","infinite-scroll","datatables","wu.masonry"])}(),angular.module("app").run(["$templateCache",function($templateCache){$templateCache.put("app/answer/Partials/answerDetail.html",'<div id="veil" ng-hide="vm.dataReady"></div><div id="feedLoading" ng-hide="vm.dataReady"><div style="text-align: center" ng-if="!vm.dataReady"><div><img src="/assets/images/loading.gif" class="img" style="width:50px;height:50px"></div><p style="font-size:large">loading details...</p></div></div><div ng-if="vm.dataReady" style="margin-left: -15px; margin-right: -15px"><div class="container"><div class="text-center"><button class="btn btn-default" ng-if="vm.searchActive" ng-click="vm.backToResults()" style="margin:5px; width:100%; background-color:lightgray">Back to Results</button></div></div><cat-bar ng-if="vm.ranking" text="{{vm.ranking}}" left-fn="vm.goPrev()" right-fn="vm.goNext()" close-rank="vm.closeAnswerDetail()"></cat-bar><div class="row" style="margin:5px;"><div class="col-xs-6 col-sm-3 col-md-2"><div class="text-left"><small class="text-muted">&nbsp;&nbsp;&nbsp{{vm.answer.views}}&nbspviews</small></div></div><div class="col-xs-6 col-sm-9 col-md-10"><div ng-show="{{vm.type == \'Establishment\' || vm.type == \'PersonCust\' || vm.type == \'Event\' }}" class="text-right"><p ng-attr-style="display:{{vm.answer.hasOwner ? \'none\':\'inline\'}};" class="hiw" ng-click="vm.bizRegDialog()"><u>{{vm.bindtxt}}</u>{{vm.isAdmin?(\' \'+ vm.bizcat):\'\'}}</p><span class="glyphicon glyphicon-lock" ng-attr-style="display:{{vm.answer.hasOwner ? \'inline\':\'none\'}}"></span></div></div></div><answer-header ans="{{vm.answer}}" idx="{{vm.idx}}"></answer-header><div ng-if="vm.type == \'Event\'"><br><div ng-bind-html="vm.ehtml" ng-attr-style="{{vm.estyle}}"><br></div></div><div class="text-center" style="margin-right:20px"><a type="button" class="btn btn-default" style="vertical-align:middle;color:#0059b3;border-color:#0059b3;" ng-if="vm.answer.family" ng-click="vm.showLocations()" target="_blank">Other Locations&nbsp&nbsp<span class="fa fa-map-marker"></span></a> <a type="button" class="btn btn-default" style="vertical-align:middle;color:#0059b3;border-color:#0059b3;" ng-if="true" ng-click="vm.share()" target="_blank">Share&nbsp&nbsp<span class="fa fa-share"></span></a></div><div class="col-xs-12" ng-if="!vm.answer.isprivate"><div class="well-sm" style="background-color:#666666;color:#f8f8ff"><h3 class="sub-header text-center">Endorsements</h3></div><p class="text-left" ng-if="vm.type != \'Short-Phrase\'"><strong>{{vm.answer.name}}</strong> is featured in the following ranks:</p><div class="well well-light-ranks col-xs-12 col-sm-6 col-md-4 col-lg-4" style="padding-top:5px;" ng-repeat="r in vm.answerRanks | orderBy:\'rank\' | limitTo:vm.dispRanks"><div class="container-bgbox"><bg-box bc="#666666" shade="0" fc="#f8f8ff" text="{{(vm.type == \'Short-Phrase\') ? vm.answer.name : r.title}}" dir="horizontal" w="100%" h="40px"></bg-box></div><p class="text-center" ng-if="vm.type == \'Short-Phrase\'">on {{r.title}}</p><div class="row" ng-if="true" style="padding-bottom:5px;padding-top:5px; margin-top:0px"><img ng-attr-style="height:55px;width:auto;" class="col-xs-3 col-md-1 col-lg-1" ng-src="{{r.icon}}"><div class="col-xs-6" style="min-width:175px"><p style="padding-top:3px;margin-bottom:px;">Ranked <strong>#{{r.rank}}</strong> out of <strong>{{r.answers}}</strong></p><div class="text-center" style="margin-top:2px"><span ng-click="vm.UpVote(r)" ng-attr-style="color:{{r.thumbUp}};margin-right: {{vm.sm?\'0px\':\'20px\'}};font-size: 18px;" class="pull-left">&nbsp&nbsp <i class="fa fa-thumbs-up" aria-hidden="true"></i> <span style="color:black;font-size: 14px;">&nbsp;{{r.upV}}&nbsp;&nbsp;</span></span> <span ng-click="vm.DownVote(r)" ng-attr-style="color:{{r.thumbDn}};margin-right: {{vm.sm?\'0px\':\'20px\'}};font-size: 18px;" class="pull-right"><i class="fa fa-thumbs-down" aria-hidden="true"></i> <span style="color:black;font-size: 14px;">&nbsp;{{r.downV}}</span> &nbsp&nbsp</span></div></div><a href="" class="text-center col-xs-3" ng-click="vm.gotoRank(r)">Full ranking</a></div><p ng-attr-style="display:{{vm.deleteButton ? \'inline\':\'none\'}};color:red" ng-click="vm.deleteThisCatans(r)">&lt;&lt;Delete&gt;&gt;</p></div><p ng-show="{{vm.answerRanks.length > 3}}" style="background-color:lightgray;cursor:pointer" ng-click="vm.showRanks()">{{vm.dispRanks > 3 ? \'Show less\':(\'Show more (\' + (vm.answerRanks.length - 3) + \')\') }}</p><div ng-if="vm.isAdmin"><div class="text-left"><button class="btn btn-primary" ng-click="vm.addCatans()">Add Catans</button></div><div class="input-group" ng-if="vm.addctsactive"><input type="text" class="form-control" ng-model="vm.addctsval" bs-options="c for c in vm.addctsopts" bs-typeahead=""> <span class="input-group-btn text-right"><button class="btn btn-success" type="button" ng-click="vm.addcts()">Add</button></span></div></div></div><div class="container col-xs-12" ng-if="vm.answer.hasranks"><div class="row" ng-if="vm.type != \'Short-Phrase\'"><div class="col-xs-12"><div class="well-sm" style="background-color:#666666;color:#f8f8ff;"><h3 class="sub-header text-center">The Favorites</h3></div></div></div><div class="row" style="padding:0px;margin:0px;border:0px"><div ng-repeat="n in vm.myranks"><div class="container col-xs-3 col-sm-2 col-md-2 col-lg-2" ng-click="vm.gotoCustomRank(n)" ng-attr-style="border-top:3px solid white;border-bottom:3px solid white;background-color:{{n.bc}};color:{{n.fc}};height:{{vm.sm ? \'90px\':\'150px\'}};margin:0px;padding:0px;position:relative;"><h3 class="hidden-xs text-center" ng-attr-style="padding:3px; margin:0px; position:absolute; top:50%; left:50%; margin-right:-50%;transform: translate(-50%,-50%);cursor:pointer;">{{n.title}}<h4 class="hidden-sm hidden-md hidden-lg hidden-xl text-center" ng-attr-style="padding:3px; margin:0px; position:absolute; top:50%; left:50%; margin-right:-50%;transform: translate(-50%,-50%);cursor:pointer;">{{n.title}}</h4></h3></div><div class="col-xs-3 col-sm-2 col-md-2 col-lg-2" ng-click="vm.gotoCustomRank(n)" style="margin:0px;padding:0px;"><img ng-src="{{n.image}}" ng-attr-style="border-top:3px solid white;border-bottom:3px solid white;width:95%;height:{{vm.sm ? \'90px\':\'150px\'}};cursor:pointer;"></div></div></div><div class="text-right"><a href="" ng-if="vm.userIsOwner" ng-click="vm.addRankforAnswer()">Edit Ranking/List</a></div></div><div class="container col-xs-12" ng-if="vm.userIsOwner&&!vm.answer.hasranks&&!vm.hideCustomRanksMsg&&!vm.answer.isprivate &&vm.answer.type==\'Establishment\'||vm.answer.type==\'PersonCust\'"><br><div class="alert alert-info">This Favorites section contains <strong>Custom Ranks</strong> and it is <strong>only visible to you</strong> Custom Ranks are:<br><br><i class="fa fa-check"></i>&nbsp<strong>Interactive lists</strong> about anything in your business.<br><i class="fa fa-check"></i>&nbsp<strong>Showcase in detail</strong> your products and/or services.<br><i class="fa fa-check"></i>&nbspA great way to <strong>engage your audience</strong>.<br><i class="fa fa-check"></i>&nbspCan be anything from <i>Food or Drink Items</i>, <i>Newest or Best-selling Products</i>, <i>Popular Services</i>, <i>Recent Projects</i>, <i>Success Stories</i>, <i>Staff Members</i> or anything you choose.<br><br>Below are some examples on how you can use Custom Ranks to enhance your business profile.<div class="well-sm" style="background-color:#666666;color:#f8f8ff;"><h3 class="sub-header text-center">The Favorites</h3></div><div class="row" style="padding:0px;margin:0px;border:0px"><div ng-repeat="n in vm.myranks"><div class="container col-xs-3 col-sm-2 col-md-2 col-lg-2" ng-click="vm.gotoCustomRank(n)" ng-attr-style="border-top:3px solid #D9EDF7;border-bottom:3px solid #D9EDF7;background-color:{{n.bc}};color:{{n.fc}};height:{{vm.sm ? \'90px\':\'150px\'}};margin:0px;padding:0px;position:relative;"><h3 class="hidden-xs text-center" ng-attr-style="padding:3px; margin:0px; position:absolute; top:50%; left:50%; margin-right:-50%;transform: translate(-50%,-50%);cursor:pointer;">{{n.title}}<h4 class="hidden-sm hidden-md hidden-lg hidden-xl text-center" ng-attr-style="padding:3px; margin:0px; position:absolute; top:50%; left:50%; margin-right:-50%;transform: translate(-50%,-50%);cursor:pointer;">{{n.title}}</h4></h3></div><div class="col-xs-3 col-sm-2 col-md-2 col-lg-2" ng-click="vm.gotoCustomRank(n)" style="margin:0px;padding:0px;"><img ng-src="{{n.image}}" ng-attr-style="border-top:3px solid #D9EDF7;border-bottom:3px solid #D9EDF7;width:95%;height:{{vm.sm ? \'90px\':\'150px\'}};cursor:pointer;"></div></div></div><div class="text-right"><button class="btn btn-default" ng-click="vm.gotoMyBusiness()" style="margin:5px">Purchase Custom Ranks</button> <button class="btn btn-default" ng-click="vm.hideCustomRanks()" style="margin:5px">Hide Message</button></div></div></div><div class="col-xs-12" ng-if="true"><div class="well-sm" style="background-color:#666666;color:#f8f8ff;"><h3 class="sub-header" style="justify-content:space-between;display:flex"><span class="alignleft" style="cursor:pointer" ng-click="vm.moreImagesRev()">&nbsp{{vm.showRev?\'&lt\':\' \'}}&nbsp</span> <span class="aligncenter">Photo Gallery</span> <span class="alignright" style="cursor:pointer" ng-click="vm.moreImagesFwd()">&nbsp{{vm.showFwd?\'&gt\':\' \'}}&nbsp</span></h3></div><div class="text-right" ng-if="vm.type != \'Short-Phrase\'"><button ng-if="!vm.igdemo" class="btn btn-success" ng-click="vm.getImages()" ng-attr-style="display:{{vm.showImageGallery == false ? \'inline\':\'none\'}};margin:5px;">Show Images</button></div><div ng-attr-style="display:{{vm.showImageGallery == true ? \'inline\':\'none\'}}"><div class="col-xs-6 col-sm-4 col-md-3 col-lg-2" ng-repeat="x in vm.images.slice(vm.i,vm.e)"><a ng-click="vm.selectPhoto($index)" class="thumbnail"><img ng-src="{{x.url}}" style="width:100%;height:120px"></a></div><div ng-if="vm.images.length == 0">No images in Photo Gallery.</div></div></div><div ng-if="vm.type != \'Short-Phrase\'" class="col-xs-12"><div class="row"><div class="col-xs-6" style="padding-top:20px;"><div class="text-center" ng-if="vm.showImageGallery && vm.isLoggedIn" ng-attr-style="display:{{vm.isLoggedIn ? \'inline\':\'none\'}};"><blob-upload></blob-upload></div></div><div class="col-xs-6"><div class="text-center" ng-if="vm.showImageGallery && vm.isLoggedIn">Get from Instagram&nbsp&nbsp&nbsp <img ng-src="/assets/images/glyph-logo_May2016.png" ng-click="vm.selectInstagramImages()" ng-attr-style="width:80px;display:{{vm.isLoggedIn ? \'inline\':\'none\'}};cursor:pointer"></div></div></div></div><div class="col-xs-12" ng-if="vm.answer.ispremium"><div ng-show="{{vm.type == \'Establishment\' || vm.type == \'PersonCust\' }}"><div class="well-sm" style="background-color:#666666;color:#f8f8ff"><h3 class="sub-header text-center">Specials</h3></div><div class="row" style="border-left:5px solid white;border-right:5px solid white;"><div ng-repeat="x in vm.specialsList"><div class="col-xs-12 col-sm-6 col-md-4 col-lg-4" ng-click="vm.showSpecial(x)" ng-attr-style="background-color:{{x.bc}};color:{{x.fc}};cursor:pointer;border:5px solid white;"><h4 class="text-center">{{x.stitle}}</h4></div></div></div><div class="text-right"><a href="" ng-if="vm.userIsOwner" ng-click="vm.openSpecials()">Edit Specials</a></div></div></div><div class="container col-xs-12" ng-if="vm.userIsOwner&&!vm.answer.ispremium&&!vm.hideGetPremiumMsg &&!vm.answer.isprivate&&vm.answer.type==\'Establishment\'||vm.answer.type==\'PersonCust\'"><div class="alert alert-info">This Specials section below is only visible when you have <strong>Premium Membership</strong>. Premium Membership allows you to:<br><br><i class="fa fa-check"></i>&nbspCommunicate to users <strong>daily specials, events and deals</strong> real time.<br><i class="fa fa-check"></i>&nbspOffer special deals and control exactly when to start and stop an offering.<br><i class="fa fa-check"></i>&nbspSpecials are shown in the <strong>rankings summary</strong> driving <strong>more customers</strong> to your profile.<br><br>Below are examples on the type of Specials and Promotions you can show with a Premium Membership.<div class="well-sm" style="background-color:#666666;color:#f8f8ff;"><h3 class="sub-header text-center">Specials</h3></div><div class="row" style="border-left:5px solid #D9EDF7;border-right:5px solid #D9EDF7;"><div ng-repeat="x in vm.specialsList"><div class="col-xs-12 col-sm-6 col-md-4 col-lg-4" ng-click="vm.showSpecial(x)" ng-attr-style="background-color:{{x.bc}};color:{{x.fc}};cursor:pointer;border:5px solid #D9EDF7;"><h4 class="text-center" style="padding-top:10px">{{x.stitle}}</h4></div></div></div><div class="text-right"><button class="btn btn-default" ng-click="vm.gotoMyBusiness()" style="margin:5px">Purchase Premium Membership</button> <button class="btn btn-default" ng-click="vm.hideGetPremium()" style="margin:5px">Hide Message</button></div></div></div><div class="col-xs-12"><div><div class="well-sm" style="background-color:#666666;color:#f8f8ff"><h3 class="sub-header text-center">Opinions</h3></div><table class="table table-hover cursor"><tbody><tr ng-repeat="item in vm.vrows | orderBy:\'-delta\'"><td align="middle" ng-attr-style="width:10%"><img ng-src="../../../assets/images/{{item.upImage}}" style="max-height:30px;margin:0px;" ng-click="vm.vrowVoteUp(item)"></td><td align="left" style="width:10%">{{item.upV}}</td><td align="middle" style="width:60%">{{item.title}}</td><td align="right" style="width:10%">{{item.downV}}</td><td align="middle" ng-attr-style="width:10%"><img ng-src="../../../assets/images/{{item.downImage}}" style="max-height:30px;margin:0px;" ng-click="vm.vrowVoteDown(item)"></td></tr></tbody></table><div class="input-group" style="padding:0px;margin:0px;"><input type="text" class="form-control" ng-model="vm.newop" maxlength="40" placeholder="{{\'Write an opinion of \'+ vm.answer.name}}"> <span class="input-group-btn text-right"><button class="btn btn-primary {{vm.addvrowbutton}}" type="button" ng-click="vm.addvrow()">Add Opinion</button></span></div><div class="text-center" style="padding-top:5px">{{40 - vm.newop.length + \' characters left\'}}</div><br></div></div><div class="col-xs-12" ng-if="false"><div ng-show="{{vm.type != \'Establishment\' && vm.type != \'PersonCust\' && vm.type != \'Event\' }}"><div class="well-sm" style="background-color:#666666;color:#f8f8ff"><h3 class="sub-header">Versus Table</h3></div><table class="table table-hover cursor"><tbody><thead><tr><th align="middle" style="width:15%">Pct (%)</th><th align="middle" style="width:60%">vs. Opponent</th><th align="middle" style="width:15%">Pct (%)</th><th align="middle" style="width:10%">GP</th></tr></thead><tbody><tr ng-repeat="x in vm.relativetable | orderBy: \'-Rank\'"><td align="middle" style="width:15%">{{x.PctF}}</td><td align="middle" style="width:60%">{{x.vsName}}</td><td align="middle" style="width:15%">{{x.PctC}}</td><td align="middle" style="width:10%">{{x.GP}}</td></tr></tbody></tbody></table></div></div><br><br><div class="btn-group" role="group"><button type="button" ng-click="vm.goBack()" class="btn btn-default">Back</button></div><button type="button" ng-click="vm.deleteAnswer()" class="btn btn-danger" ng-if="vm.deleteButton">Delete</button><br><br></div>'),$templateCache.put("app/answer/Partials/answerheader.html",'<div class="container hidden-xs" ng-if="!isShortPhrase"><div class="row"><div class="container col-sm-6 col-md-4 col-lg-4" ng-attr-style="height:{{mxheight}}px;margin:0px;padding:0px;border:0px;"><div class="container-bgbox"><bg-box bc="{{bc}}" bc2="{{bc2}}" fc="{{fc}}" text="{{idx > 0 ? idx + \'. \' + answer.name:answer.name}}" dir="vertical" w="100%" h="120px"></bg-box></div><div class="container" ng-attr-style="width:100%; height:{{mxheight-120}}px;background-color:#d8d8d8;padding-top:5px"><strong ng-if="answer.eventloc">Location:</strong> <a ng-if="answer.eventloc" ng-click="gotoLocationAnswer()" target="_blank">{{answer.eventloc}}</a><br ng-if="answer.eventloc"><strong ng-if="answer.location">Address:</strong> <a ng-if="answer.location" href="http://maps.apple.com/maps?q={{answer.location}}" target="_blank">{{answer.location}}</a><font ng-if="answer.dist&&answer.location" style="color:gray">&nbsp&nbsp({{answer.dist}} mi away)</font><br ng-if="answer.location"><strong ng-if="answer.cityarea">{{(answer.cityarea) ? \'Neighborhood:\' : ""}}</strong> {{(answer.cityarea) ? answer.cityarea : ""}}<br ng-attr-style="display:{{(answer.cityarea) ? \'inline\' : \'none\'}}"><strong ng-if="answer.phone">Phone:</strong> <a ng-if="answer.phone" href="tel:{{answer.phone}}">{{answer.phone}}</a><br ng-attr-style="display:{{(answer.phone) ? \'inline\' : \'none\'}}"><strong ng-if="answer.website">Website:</strong> <a ng-if="answer.website.indexOf(\'http\') >=0" href="{{answer.website}}" target="_blank">{{answer.website}}</a> <a ng-if="answer.website.indexOf(\'http\') == -1" href="http://{{answer.website}}" target="_blank">{{answer.website}}</a><br ng-if="answer.website"><strong ng-if="answer.email">{{(answer.email) ? \'Email:\' : ""}}</strong> {{(answer.email) ? answer.email : ""}}<br ng-attr-style="display:{{(answer.email) ? \'inline\' : \'none\'}}"><i ng-attr-style="display:{{hrset ? \'inline\':\'none\'}}">{{hourstr}}</i><div class="text-center answer_info_buttons"><br><a type="button" class="btn btn-default" style="vertical-align:middle;color:#0059b3;border-color:#0059b3;" ng-if="!answer.hasOwner || userIsOwner" ng-click="editAnswer()" target="_blank">Edit&nbsp&nbsp<span class="fa fa-pencil"></span></a><a type="button" class="btn btn-default" style="vertical-align:middle;color:#0059b3;border-color:#0059b3;" ng-if="isMobile && answer.phone" href="tel:{{answer.phone}}" target="_blank">Call&nbsp&nbsp<span class="fa fa-phone"></span></a> <a type="button" class="btn btn-default" style="vertical-align:middle;color:#0059b3;border-color:#0059b3;" ng-if="answer.lat && answer.lng" href="http://maps.apple.com/maps?q={{answer.lat}}, {{answer.lng}}" target="_blank">Directions&nbsp&nbsp<span class="fa fa-arrow-right"></span></a> <a type="button" class="btn btn-default hidden-md hidden-lg hidden-xl" style="vertical-align:middle;color:#0059b3;border-color:#0059b3;" ng-if="answer.lat && answer.lng" ng-click="toggleimgmode()">{{imgmode}}&nbsp&nbsp<span class="{{imgmodeicon}}"></span></a></div></div></div><div class="col-sm-6 col-md-4 col-lg-4" style="margin:0px;padding:0px;border:0px;"><img class="displayed" ng-src="{{answer.imageurl}}" alt="Moustiers Sainte Marie" ng-attr-style="height:{{mxheight}}px;width:100%;margin-left:auto;margin-right:auto;" ng-click="showUrl()" ng-if="modeIsImage"> <img class="displayed" ng-src="https://maps.googleapis.com/maps/api/staticmap?center={{answer.location}}&zoom=13&size={{width2}}x{{mxheight}}&maptype=roadmap &markers=color:red%7Clabel:%7C{{answer.lat}},{{answer.lng}}&key=AIzaSyDKXsql-P8czb4nAQMXjkFpm_I5HqKsQpo" ng-if="!modeIsImage"></div><div class="hidden-sm col-md-4 col-lg-4" style="margin:0px;padding:0px;border:0px;"><img class="displayed" ng-src="https://maps.googleapis.com/maps/api/staticmap?center={{answer.location}}&zoom=13&size={{width3}}x{{mxheight}}&maptype=roadmap &markers=color:red%7Clabel:%7C{{answer.lat}},{{answer.lng}}&key=AIzaSyDKXsql-P8czb4nAQMXjkFpm_I5HqKsQpo" ng-if="hasMap"><div class="container" ng-attr-style="background-color:#d8d8d8;width:{{width3}}px;height:{{mxheight}}px;margin-left:auto;margin-right:auto;" ng-if="!hasMap"></div></div></div></div><div class="container hidden-sm hidden-md hidden-lg hidden-xl" ng-if="!isShortPhrase"><div class="container-bgbox"><bg-box bc="{{bc}}" bc2="{{bc2}}" fc="{{fc}}" text="{{idx > 0 ? idx + \'. \' + answer.name:answer.name}}" dir="vertical" w="100%" h="75px"></bg-box></div><div class="container" style="margin:0px;padding:0px;border:0px;"><img class="displayed" ng-src="{{answer.imageurl}}" alt="Moustiers Sainte Marie" style="height:auto;width:100%;" ng-click="showUrl()" ng-if="modeIsImage"> <img class="displayed" ng-src="https://maps.googleapis.com/maps/api/staticmap?center={{answer.location}}&zoom=13&size={{width}}x{{mxheight}}&maptype=roadmap &markers=color:red%7Clabel:%7C{{answer.lat}},{{answer.lng}}&key=AIzaSyDKXsql-P8czb4nAQMXjkFpm_I5HqKsQpo" ng-if="!modeIsImage"></div></div><div class="container-answer" style="width:100%;height:auto" ng-if="isShortPhrase"><br><h2 style="text-align:center"><strong>{{answer.name}}</strong></h2><br><h4 style="text-align:center">{{answer.addinfo}}</h4></div><div class="answer_info row" ng-if="!isShortPhrase" style="padding:0px;margin:0px;border:0px;"><div class="container hidden-sm hidden-md hidden-lg hidden-xl"><br ng-if="answer.eventloc"><strong ng-if="answer.eventloc">Location:</strong> <a ng-if="answer.eventloc" ng-click="gotoLocationAnswer()" target="_blank">{{answer.eventloc}}</a><br ng-if="answer.location"><strong ng-if="answer.location">Address:</strong> <a ng-if="answer.location" href="http://maps.apple.com/maps?q={{answer.location}}" target="_blank">{{answer.location}}</a><font ng-if="answer.dist&&answer.location" style="color:gray">&nbsp&nbsp({{answer.dist}} mi away)</font><br ng-if="answer.location"><div class="row"><div class="col-xs-9"><strong ng-if="answer.cityarea">{{(answer.cityarea) ? \'Neighborhood:\' : ""}}</strong> {{(answer.cityarea) ? answer.cityarea : ""}}<br ng-attr-style="display:{{(answer.cityarea) ? \'inline\' : \'none\'}}"><strong ng-if="answer.phone">Phone:</strong> <a ng-if="answer.phone" href="tel:{{answer.phone}}">{{answer.phone}}</a><br ng-attr-style="display:{{(answer.phone) ? \'inline\' : \'none\'}}"><strong ng-if="answer.website">Website:</strong> <a ng-if="answer.website.indexOf(\'http\') >=0" href="{{answer.website}}" target="_blank">{{answer.website}}</a> <a ng-if="answer.website.indexOf(\'http\') == -1" href="http://{{answer.website}}" target="_blank">{{answer.website}}</a><br ng-if="answer.website"><strong ng-if="answer.email">{{(answer.email) ? \'Email:\' : ""}}</strong> {{(answer.email) ? answer.email : ""}}<br ng-attr-style="display:{{(answer.email) ? \'inline\' : \'none\'}}"></div><div class="col-xs-3 text-left"><a type="button" class="btn btn-default" style="vertical-align:middle;color:#0059b3;border-color:#0059b3;margin-top:15px;" ng-if="!answer.hasOwner || userIsOwner" ng-click="editAnswer()" target="_blank">&nbsp&nbsp<span class="fa fa-pencil"></span></a></div></div><i ng-attr-style="display:{{hrset ? \'inline\':\'none\'}}">{{hourstr}}</i></div><div class="hidden-sm hidden-md hidden-lg hidden-xl text-center answer_info_buttons" style="padding-top:10px;"><a type="button" class="btn btn-default" style="vertical-align:middle;color:#0059b3;border-color:#0059b3;" ng-if="isMobile && answer.phone" href="tel:{{answer.phone}}" target="_blank">Call&nbsp&nbsp<span class="fa fa-phone"></span></a> <a type="button" class="btn btn-default" style="vertical-align:middle;color:#0059b3;border-color:#0059b3;" ng-if="answer.lat && answer.lng" href="http://maps.apple.com/maps?q={{answer.lat}}, {{answer.lng}}" target="_blank">Directions&nbsp&nbsp<span class="fa fa-arrow-right"></span></a> <a type="button" class="btn btn-default" style="vertical-align:middle;color:#0059b3;border-color:#0059b3;" ng-if="answer.lat && answer.lng" ng-click="toggleimgmode()">{{imgmode}}&nbsp&nbsp<span class="{{imgmodeicon}}"></span></a></div></div><div style="padding:5px"></div><div ng-if="!isShortPhrase && !isEvent" ng-attr-style="display:{{answer.addinfo ? \'inline\':\'none\'}};"><span>{{answer.addinfo_teaser}}</span> <span ng-show="completeinfo">{{answer.addinfo_complete}}</span> <span ng-if="answer.addinfo.length > 0" ng-click="showcomplete()" style="background-color:lightgray;cursor:pointer">{{moretext}}</span><br ng-attr-style="display:{{answer.addinfo ? \'inline\':\'none\'}}"></div>'),$templateCache.put("app/answer/Partials/blobupload.html",'<button type="file" ngf-select="uploadFiles($file, $invalidFiles)" accept="image/*" ngf-max-size="3MB" class="btn btn-primary text-center" ngf-resize="{width: 100, height: 100, quality: .1, type: \'image/jpeg\', ratio: \'19:11\', centerCrop: true, pattern=\'.jpg\', restoreExif: false}" role="button" ngf-validate-after-resize="boolean" ngf-model-invalid="invalidFiles">Upload New Image</button><br><br><div style="font:smaller">{{errFile.name}} {{errorMsg}}</div><div style="font:smaller"><span class="progress" ng-show="f.progress >= 0"><div ng-attr-style="width:{{f.progress}}%" ng-bind="f.progress + \'%\'"></div></span></div><br>'),$templateCache.put("app/answer/Partials/catbar.html",'<div class="container"><div class="row"><div class="container-bgbox col-xs-1"><bg-box bc="{{bc}}" bc2="{{bc}}" fc="{{fc}}" text="<" dir="horizontal" w="100%" h="{{ht}}px" ng-click="goPrev()" style="cursor:pointer"></bg-box></div><div class="container-bgbox col-xs-10"><bg-box bc="{{bc}}" bc2="{{bc2}}" fc="{{fc}}" text="{{text}}" dir="horizontal" w="100%" h="{{ht}}px" ng-click="selRank()" style="cursor:pointer"></bg-box></div><div class="container-bgbox col-xs-1"><bg-box bc="{{bc2}}" bc2="{{bc2}}" fc="{{fc}}" text=">" dir="horizontal" w="100%" h="{{ht}}px" ng-click="goNext()" style="cursor:pointer"></bg-box></div></div></div>'),$templateCache.put("app/common/partials/bgbox.html",'<div ng-if="dirHor"><div class="container" ng-attr-style="color:{{fc}};margin:0px;padding:0px;border:0px;position:relative;width:{{w}};height:{{h}}; background: {{bc}}; background: -webkit-linear-gradient(left, {{bc}}, {{bc2}}); background: -o-linear-gradient(right, {{bc}}, {{bc2}}); background: -moz-linear-gradient(right, {{bc}}, {{bc2}}); background: linear-gradient(to right, {{bc}}, {{bc2}});"><h4 class="text-center" style="padding:3px; margin:0px; position:absolute; top:50%; left:50%; margin-right:-50%;transform: translate(-50%,-50%)">{{text}}</h4></div></div><div ng-if="dirVer"><div class="container" ng-attr-style="color:{{fc}};margin:0px;padding:0px;border:0px;position:relative;width:{{w}};height:{{h}}; background: {{bc}}; background: -webkit-linear-gradient({{bc}}, {{bc2}}); background: -o-linear-gradient({{bc}}, {{bc2}}); background: -moz-linear-gradient({{bc}}, {{bc2}}); background: linear-gradient({{bc}}, {{bc2}});"><h3 class="hidden-xs text-center" style="padding:3px; margin:0px; position:absolute; top:50%; left:50%; margin-right:-50%;transform: translate(-50%,-50%)">{{text}}</h3><h4 class="hidden-sm hidden-md hidden-lg hidden-xl text-center" style="padding:3px; margin:0px; position:absolute; top:50%; left:50%; margin-right:-50%;transform: translate(-50%,-50%)">{{text}}</h4></div></div>'),$templateCache.put("app/common/partials/bgbox2.html",'<div ng-if="dirHor"><div class="container" ng-attr-style="color:{{fc}};margin:0px;padding:0px;border:0px;position:relative;width:{{w}};height:{{h-30}}px;cursor:pointer; background: {{bc}}; background: -webkit-linear-gradient(left, {{bc}}, {{bc2}}); background: -o-linear-gradient(right, {{bc}}, {{bc2}}); background: -moz-linear-gradient(right, {{bc}}, {{bc2}}); background: linear-gradient(to right, {{bc}}, {{bc2}});"><h4 ng-if="!isRankOfDay" class="text-center" ng-attr-style="padding:3px; margin:0px; position:absolute; top:60%; left:50%; margin-right:-50%;transform: translate(-50%,-50%)">{{text}}</h4><p ng-if="!isRankOfDay" ng-attr-style="padding:3px; margin:0px; position:absolute; bottom:0px; left:50%; margin-right:-50%;transform: translate(-50%,-50%)">{{question}}</p><div ng-if="isRankOfDay" ng-attr-style="padding:3px; margin:0px; position:absolute; top:50%; left:50%; margin-right:-50%;transform: translate(-50%,-50%)"><h3 class="text-center" style="padding-top:8px">{{title}}</h3><p>{{question}}</p></div></div><div class="container" ng-attr-style="color:{{fc}};margin:0px;padding:0px;border:0px;position:relative;width:{{w}};height:{{30}}px;cursor:pointer; background: {{bc}}; background: -webkit-linear-gradient(left, {{bc}}, {{bc2}}); background: -o-linear-gradient(right, {{bc}}, {{bc2}}); background: -moz-linear-gradient(right, {{bc}}, {{bc2}}); background: linear-gradient(to right, {{bc}}, {{bc2}});"><div class="text-center" ng-attr-style="color:white;font-size:small"><i class="fa fa-eye"></i> {{views}} | <i class="fa fa-list-ol"></i> {{answers}} | <i class="fa fa-comment"></i> {{comments}}</div></div></div><div ng-if="dirVer"><div class="container" style="color:{{fc}};margin:0px;padding:0px;border:0px;position:relative;width:{{w}};height:{{h}};cursor:pointer; background: {{bc}}; background: -webkit-linear-gradient({{bc}}, {{bc2}}); background: -o-linear-gradient({{bc}}, {{bc2}}); background: -moz-linear-gradient({{bc}}, {{bc2}}); background: linear-gradient({{bc}}, {{bc2}});"><h3 class="hidden-sm hidden-md hidden-lg hidden-xl text-center" ng-attr-style="padding:3px; margin:0px; position:absolute; top:50%; left:50%; margin-right:-50%;transform: translate(-50%,-50%)">{{text}}</h3></div><div class="container" ng-attr-style="color:{{fc}};margin:0px;padding:0px;border:0px;position:relative;width:{{w}};height:{{30}}px;cursor:pointer; background: {{bc}}; background: -webkit-linear-gradient(left, {{bc}}, {{bc2}}); background: -o-linear-gradient(right, {{bc}}, {{bc2}}); background: -moz-linear-gradient(right, {{bc}}, {{bc2}}); background: linear-gradient(to right, {{bc}}, {{bc2}});"><div class="text-center" style="color:white;font-size:small"><i class="fa fa-eye"></i> {{views}} | <i class="fa fa-list-ol"></i> {{answers}} | <i class="fa fa-comment"></i> {{comments}}</div></div></div>'),
$templateCache.put("app/common/partials/bgbox3.html",'<div ng-if="dirHor" ng-click="addView()"><div class="container" ng-attr-style="color:{{fc}};margin:0px;padding:0px;border:0px;position:relative;width:{{w}};height:auto;cursor:pointer; background: {{bc}}; background: -webkit-linear-gradient(left, {{bc}}, {{bc2}}); background: -o-linear-gradient(right, {{bc}}, {{bc2}}); background: -moz-linear-gradient(right, {{bc}}, {{bc2}}); background: linear-gradient(to right, {{bc}}, {{bc2}});"><p></p><p style="text-align:center"><img ng-src="{{imageurl}}" style="width:90%;min-height:100px"></p><p style="text-align:left; padding:0px;margin:0px;">&nbsp&nbsp&nbsp<u>{{type}}</u></p><h4 ng-if="sm" class="text-center" ng-attr-style="padding:3px; margin:0px;">{{text}}</h4><h3 ng-if="!sm" class="text-center" ng-attr-style="padding:3px; margin:0px;">{{text}}</h3><p></p><div class="text-center" ng-attr-style="color:white;font-size:small;min-height:30px" ng-if="showStats"><i class="fa fa-eye"></i> {{views}} | <i class="fa fa-list-ol"></i> {{answers}} | <i class="fa fa-comment"></i> {{comments}}</div></div></div><div ng-if="dirVer"><div class="container" style="color:{{fc}};margin:0px;padding:0px;border:0px;position:relative;width:{{w}};height:{{h}};cursor:pointer; background: {{bc}}; background: -webkit-linear-gradient({{bc}}, {{bc2}}); background: -o-linear-gradient({{bc}}, {{bc2}}); background: -moz-linear-gradient({{bc}}, {{bc2}}); background: linear-gradient({{bc}}, {{bc2}});"><p class="text-left">{{type}}</p><h4 ng-if="!isRankOfDay" class="text-center" ng-attr-style="padding:3px; margin:0px;">{{text}}</h4><img ng-src="{{imageurl}}"></div><div class="container" ng-attr-style="color:{{fc}};margin:0px;padding:0px;border:0px;position:relative;width:{{w}};height:{{30}}px;cursor:pointer; background: {{bc}}; background: -webkit-linear-gradient(left, {{bc}}, {{bc2}}); background: -o-linear-gradient(right, {{bc}}, {{bc2}}); background: -moz-linear-gradient(right, {{bc}}, {{bc2}}); background: linear-gradient(to right, {{bc}}, {{bc2}});"><div class="text-center" style="color:white;font-size:small"><i class="fa fa-eye"></i> {{views}} | <i class="fa fa-list-ol"></i> {{answers}} | <i class="fa fa-comment"></i> {{comments}}</div></div></div>'),$templateCache.put("app/content/partials/answer-block.html",'<div ng-class="sm?\'\':\'rank-item\'" style="padding-bottom:10px"><div class="row" ng-click="ansSel(answer)"><div class="container-bgbox col-xs-6"><div style="position:absolute; z-index: 50; padding: 2px; font-size: 17px; color: #fff"><small><i class="{{answer.icon}}" aria-hidden="true"></i> <span class="tooltiptext">{{answer.itext}}</span></small></div><bg-box2 bc="{{bc}}" shade="{{shade}}" fc="{{fc}}" text="{{answer.name}}" dir="horizontal" w="100%" h="{{sm ? \'150\':\'200\'}}" stats="{{stats}}"></bg-box2></div><div class="col-xs-6" style="margin:0px;padding:0px;border:0px;" ng-if="!isShortPhrase"><img ng-src="{{image1}}" ng-attr-style="display:{{image1 != undefined ? \'inline\':\'none\'}};width:100%;height:{{sm ? \'150px\':\'200px\'}};cursor:pointer;"></div></div></div>'),$templateCache.put("app/content/partials/content-block.html",'<div class="row"><div class="col-xs-12 col-sm-6 col-md-4" ng-repeat="ranking in initalHomeData" ng-if="initalHomeData"><rank-item rank-object="ranking"></rank-item></div></div><div class="row"><div infinite-scroll="loadMore()" infinite-scroll-distance="0" infinite-scroll-disabled="(!pageDataLoaded || scrollDataLoading) || endReached" class="col-xs-12" id="inifinite-container" style="padding:0px;margin:0px"><div class="col-xs-12 col-sm-6 col-md-4 col-lg-4" ng-repeat="rankingID in scrollingData.slice(startIndex, currentIndex)"><rank-item rank-object="uniqueResult[rankingID]"></rank-item></div><div ng-if="(pageDataLoaded || scrollDataLoading) && !endReached" class="col-xs-12 text-center"><a><img src="/assets/images/loading.gif" class="img" style="width:50px;height:50px"> Loading More...</a></div><div ng-if="endReached" class="col-xs-12 text-center" style="border: 1px solid #00b3e4;font-size: 14px">End Reached.</div></div></div>'),$templateCache.put("app/content/partials/facebook-follow.html",""),$templateCache.put("app/content/partials/rank-block.html",'<div ng-class="sm?\'\':\'rank-item\'" style="padding-bottom:10px"><div class="row" ng-click="rankSel(rank,false)"><div class="container-bgbox col-xs-6"><div style="position:absolute;background-color:red; z-index: 50; padding: 2px; font-size: 14px; color: #fff" ng-if="rod">&nbspRanking of the Day&nbsp</div><div style="position:absolute; z-index: 50; padding: 2px; font-size: 17px; color: #fff" ng-if="!rod"><small><i class="fa fa-list-ol" aria-hidden="true"></i></small></div><bg-box2 bc="{{bc}}" shade="{{shade}}" fc="{{fc}}" text="{{title}}" dir="horizontal" w="100%" h="{{sm ? \'150\':\'200\'}}" stats="{{stats}}"></bg-box2></div><div class="col-xs-6" style="margin:0px;padding:0px;border:0px;" ng-if="!isShortPhrase"><img ng-src="{{image1}}" ng-attr-style="display:{{image1 != undefined ? \'inline\':\'none\'}};width:100%;height:{{sm ? \'150px\':\'200px\'}};cursor:pointer;"></div></div></div>'),$templateCache.put("app/content/partials/rank-of-day.html",'<div ng-class="sm?\'\':\'rank-item\'" style="padding-bottom:10px"><div class="row" ng-click="rankSel(rank,false)" ng-if="isBasic"><div class="container-bgbox col-xs-12 col-sm-12" ng-if="part==\'title\'"><div style="position:absolute;background-color:red; z-index: 50; padding: 2px; font-size: 17px; color: #fff">&nbspRanking of the Day&nbsp</div><bg-box2 bc="{{bc}}" shade="{{shade}}" fc="{{fc}}" text="{{title}}" dir="horizontal" w="100%" h="{{sm ? \'150\':\'200\'}}" stats="{{stats}}" question="{{rankObject.question}}" is-rank-of-day="{{true}}"></bg-box2></div><div class="col-xs-12 col-sm-12 row" style="margin:0px; padding: 0px; border:0px;cursor:pointer;" ng-if="part==\'image\'"><div class="col-xs-6" style="padding: 0px"><img ng-src="{{image1}}" ng-attr-style="display:{{image1 != undefined ? \'inline\':\'none\'}};width:100%;height:{{sm ? \'150px\':\'200px\'}};"></div><div class="col-xs-6" style="padding: 0px" ng-if="!isShortPhrase"><img ng-src="{{image2}}" ng-attr-style="display:{{image2 != undefined ? \'inline\':\'none\'}};width:100%;height:{{sm ? \'150px\':\'200px\'}};"></div><div class="container-bgbox col-xs-6" ng-if="isShortPhrase"><bg-box bc="{{bcp}}" bc2="{{bc2p}}" fc="{{fcp}}" text="{{title1}}" dir="horizontal" w="100%" h="{{sm ? \'150px\':\'200px\'}}"></bg-box></div></div></div></div>'),$templateCache.put("app/content/partials/result-block.html",'<div ng-class="sm?\'\':\'result-item\'"><div class="row" ng-click="resSel(result)"><div class="container-bgbox col-xs-12"><bg-box3 bc="{{bc}}" shade="{{shade}}" fc="{{fc}}" text="{{title}}" dir="horizontal" introtext="{{introtext}}" w="100%" h="{{sm ? \'150\':\'200\'}}" stats="{{stats}}" type="{{type}}" imageurl="{{imageurl}}" isanswer="{{isAnswer}}"></bg-box3></div></div></div>'),$templateCache.put("app/content/partials/search-block.html",'<div class="" ng-show="contentLoaded"><div infinite-scroll="loadMore(false)" infinite-scroll-distance="3" infinite-scroll-disabled="scrollDataLoading || endReached || disableScrolling" id="inifinite-container"><div masonry=""><div class="col-xs-6 col-sm-6 col-md-4 col-lg-3 masonry-brick minxs280" ng-repeat="x in displayResults"><div style="width:95%"><result-item result-object="x"></result-item></div></div></div></div><div ng-if="scrollDataLoading && !endReached" class="col-xs-12 text-center"><a><img src="/assets/images/loading.gif" class="img" style="width:50px;height:50px"> Loading More...</a></div><div ng-if="endReached" class="col-xs-12 text-center" style="border: 1px solid #00b3e4;font-size: 20px">No more results.</div></div><div ng-attr-style="position:relative;width:100%;height:150px;" ng-if="!contentLoaded"><img src="/assets/images/loading.gif" class="img" style="width:50px;height:50px;position:absolute; top:50%; left:50%; margin-right:-50%;transform: translate(-50%,-50%)"></div>'),$templateCache.put("app/content/partials/trend-block.html",'<div class=""><div class=""><div class="col-xs-12 trend-tab" style="padding: 0px; background-color:#e6e6e6"><ul class="nav nav-tabs trend-tab" style="background-color: white"><li class="active" style="cursor: pointer"><a data-toggle="tab" href="#userfeed">Feed</a></li><li style="cursor: pointer"><a data-toggle="tab" href="#popular">Popular</a></li><li style="cursor: pointer"><a data-toggle="tab" href="#newest">Newest</a></li></ul><div class="tab-content" style=""><div class="tab-pane in active fade" style="padding-top:10px;padding-bottom:10px;" ng-class="showAll ==\'true\' ?\'\':\'trend-tab-single-page\'" id="userfeed"><userfeed-block show-all="true" show-qty="{{userfeedLimit}}"></userfeed-block><p class="text-center" style="color:blue; margin-top:10px" ng-if="showAll == \'true\'"><a class="btn btn-default" style="margin-right:20px;" ng-click="seeMore(\'userfeed\')">See More</a><a class="btn btn-default" ng-click="goBack()">Back</a></p></div><div class="tab-pane fade" style="padding-top:10px;padding-bottom:10px;" ng-class="showAll ==\'true\' ?\'\':\'trend-tab-single-page\'" id="popular"><div class="col-xs-12 media ranking-blog-item" ng-repeat="ranking in popularOrder | limitTo:popularLimit" style="cursor: pointer;" ng-click="rankSel(ranking)"><div class="profile-avatar-wrapper media-left"><img ng-src="{{ranking.realimage}}"></div><div class="media-body" style="vertical-align: middle;">{{ranking.title}} <span class="pull-right">{{ranking.views}} Views</span></div></div><p class="text-center" style="color:blue; margin-top:10px" ng-if="showAll == \'true\'"><a class="btn btn-default" style="margin-right:20px;" ng-click="seeMore(\'popular\')">See More</a><a class="btn btn-default" ng-click="goBack()">Back</a></p></div><div class="tab-pane fade" style="padding-top:10px;padding-bottom:10px;" id="newest" ng-class="showAll ==\'true\' ?\'\':\'trend-tab-single-page\'"><div class="col-xs-12 media ranking-blog-item" ng-repeat="ranking in newestOrder| limitTo:newestLimit" ng-click="rankSel(ranking)" style="cursor: pointer;"><div class="profile-avatar-wrapper media-left"><img ng-src="{{ranking.realimage}}"></div><div class="media-body" style="vertical-align: middle;">{{ranking.title}}<span class="pull-right">{{ranking.humanized}}</span></div></div><p class="text-center" style="color:blue; margin-top:10px" ng-if="showAll == \'true\'"><a class="btn btn-default" style="margin-right:20px;" ng-click="seeMore(\'newest\')">See More</a><a class="btn btn-default" ng-click="goBack()">Back</a></p></div></div><p class="text-center" style="color:blue;margin-top:10px" ng-if="showAll == \'false\'"><a class="btn btn-default" href="/trends">See More</a></p></div></div></div>'),$templateCache.put("app/content/partials/userfeed-block.html",'<button type="button" class="btn btn-default pull-right" style="vertical-align:middle;" ng-click="refreshFeed()"><span class="glyphicon glyphicon-refresh" style="padding-top:0px;padding-bottom:0px;" aria-hidden="true"></span></button><div ng-repeat="x in feeds | orderBy:\'-id\' | limitTo:fres" style="padding:0px;border:0px;margin-top:10px;"><div class="row" style="margin:4px"><div class="col-xs-12 media" style="padding-left: 5px;padding-right: 5px;"><div ng-if="!x.picture" class="profile-avatar-wrapper media-left"><div class="empty-profile-avatar-wrapper" ng-attr-style="background-color:{{x.bc}};color:{{x.fc}};">{{x.initials}}</div></div><div ng-if="x.picture" class="profile-avatar-wrapper media-left" align="middle"><img ng-src="{{x.picture}}" class="img-responsive img-circle profile-avatar"></div><div ng-if="x.action == \'addedAnswer\'" class="media-body" style="vertical-align: middle;">{{x.actorusername}} added <a ng-click="gotoAnswer(x)" style="cursor:pointer">{{x.text1}}</a> to <a ng-click="gotoRank(x)" style="cursor:pointer">{{x.text2}}</a>.</div><div ng-if="x.action == \'upVoted\'" class="media-body" style="vertical-align: middle;">{{x.actorusername}} endorsed <a ng-click="gotoAnswer(x)" style="cursor:pointer">{{x.text1}}</a> in <a ng-click="gotoRank(x)" style="cursor:pointer">{{x.text2}}</a>.</div><div ng-if="x.action == \'downVoted\'" class="media-body" style="vertical-align: middle;">{{x.actorusername}} voted down <a ng-click="gotoAnswer(x)" style="cursor:pointer">{{x.text1}}</a> in <a ng-click="gotoRank(x)" style="cursor:pointer">{{x.text2}}</a>.</div><div ng-if="x.action == \'commentR\'" class="media-body" style="vertical-align: middle;">{{x.actorusername}} posted a comment in <a ng-click="gotoRank(x)" style="cursor:pointer">{{x.text2}}</a>.</div><div ng-if="x.action == \'commentA\'" class="media-body" style="vertical-align: middle;">{{x.actorusername}} posted a comment for <a ng-click="gotoAnswer(x)" style="cursor:pointer">{{x.text1}}</a>.</div><div ng-if="x.action == \'editA\'" class="media-body" style="vertical-align: middle;">{{x.actorusername}} edited the information of <a ng-click="gotoAnswer(x)" style="cursor:pointer">{{x.text1}}</a>.</div><div ng-if="x.action == \'upVotedVrow\'" class="media-body" style="vertical-align: middle;">{{x.actorusername}} endorses the opinion: <em>{{x.text2}}</em> for <a ng-click="gotoAnswer(x)" style="cursor:pointer">{{x.text1}}</a>.</div><div ng-if="x.action == \'downVotedVrow\'" class="media-body" style="vertical-align: middle;">{{x.actorusername}} disagrees with the opinion: <em>{{x.text2}}</em> for <a ng-click="gotoAnswer(x)" style="cursor:pointer">{{x.text1}}</a>.</div><div ng-if="x.action == \'binded\'" class="media-body" style="vertical-align: middle;">{{x.actorusername}} bound account to <a ng-click="gotoAnswer(x)" style="cursor:pointer">{{x.text1}}</a>.</div><div ng-if="x.action == \'addedRank\'" class="media-body" style="vertical-align: middle;">{{x.actorusername}} added a new ranking <a ng-click="gotoRank(x)" style="cursor:pointer">{{x.text2}}</a>.</div><div ng-if="x.action == \'addedCustomRank\'" class="media-body" style="vertical-align: middle;">{{x.actorusername}} created the ranking <a ng-click="gotoRank(x)" style="cursor:pointer">{{x.text2}}</a> for <a ng-click="gotoAnswer(x)" style="cursor:pointer">{{x.text1}}</a>.</div></div></div></div>'),$templateCache.put("app/layout/Partials/cwrapper.html",""),$templateCache.put("app/layout/Partials/layout.html",'<div ui-view="navbar" style="position: fixed; z-index: 1000; width: 100%"></div><div class="container" style="padding-left:5px;padding-right:5px; margin-bottom: 20px;"><div id="veil" ng-show="vm.isLoading"></div><div id="feedLoading" ng-show="vm.isLoading"><div style="text-align: center" ng-if="vm.isLoading"><div><img src="/assets/images/loading.gif" class="img" style="width:50px;height:50px"></div><p style="font-size:large">{{vm.veilMsg}}</p></div></div><div ng-hide="vm.isLoading"><div class="container" style="margin-top: 60px" ng-show="vm.barIsActive"><div class="row" style="padding-bottom:10px"><div class="hidden-sm hidden-md hidden-lg hidden-xl"><div class="col-xs-12" style="padding-left:0px;padding-right:0px;"><button class="col-xs-3 btn btn-default" ng-click="vm.quickFilter(\'food\')">Food</button> <button class="col-xs-3 btn btn-default" ng-click="vm.quickFilter(\'activities\')">Activities</button> <button class="col-xs-3 btn btn-default" ng-click="vm.quickFilter(\'nightlife\')">Nightlife</button> <button class="col-xs-3 btn btn-default" ng-click="vm.quickFilter(\'beauty\')">Beauty</button></div><div class="col-xs-12" style="padding-left:0px;padding-right:0px"><button class="col-xs-3 btn btn-default" ng-click="vm.quickFilter(\'shopping\')">Shopping</button> <button class="col-xs-3 btn btn-default" ng-click="vm.quickFilter(\'events\')">Events</button> <button class="col-xs-3 btn btn-default" ng-click="vm.quickFilter(\'family\')">Family</button> <button class="col-xs-3 btn btn-default" ng-click="vm.quickFilter(\'health\')">Health</button></div><div class="col-xs-12" style="padding-left:0px;padding-right:0px;padding-bottom:7px"><button class="col-xs-3 btn btn-default" ng-click="vm.quickFilter(\'services\')">Services</button> <button class="col-xs-3 btn btn-default" ng-click="vm.quickFilter(\'fitness\')">Fitness</button> <button class="col-xs-3 btn btn-default" ng-click="vm.quickFilter(\'sports\')">Sports</button> <button class="col-xs-3 btn btn-default" style="padding-left:5px" ng-click="vm.quickFilter(\'neighborhood\')"><small>{{vm.nh != \'\'? vm.nh:\'Neighborhood\'}}</small></button></div></div><div class="hidden-xs"><div class="col-xs-12" style="padding-left:0px;padding-right:0px;"><button class="col-xs-2 btn btn-default" ng-click="vm.quickFilter(\'food\')">Food</button> <button class="col-xs-2 btn btn-default" ng-click="vm.quickFilter(\'activities\')">Activities</button> <button class="col-xs-2 btn btn-default" ng-click="vm.quickFilter(\'nightlife\')">Nightlife</button> <button class="col-xs-2 btn btn-default" ng-click="vm.quickFilter(\'beauty\')">Beauty</button> <button class="col-xs-2 btn btn-default" ng-click="vm.quickFilter(\'shopping\')">Shopping</button> <button class="col-xs-2 btn btn-default" ng-click="vm.quickFilter(\'events\')">Events</button></div><div class="col-xs-12" style="padding-left:0px;padding-right:0px;padding-bottom:7px"><button class="col-xs-2 btn btn-default" ng-click="vm.quickFilter(\'family\')">Family</button> <button class="col-xs-2 btn btn-default" ng-click="vm.quickFilter(\'health\')">Health</button> <button class="col-xs-2 btn btn-default" ng-click="vm.quickFilter(\'services\')">Services</button> <button class="col-xs-2 btn btn-default" ng-click="vm.quickFilter(\'fitness\')">Fitness</button> <button class="col-xs-2 btn btn-default" ng-click="vm.quickFilter(\'sports\')">Sports</button> <button class="col-xs-2 btn btn-default" style="padding-left:5px" ng-click="vm.quickFilter(\'neighborhood\')">{{vm.nh != \'\'? vm.nh:\'Neighborhood\'}}</button></div></div><div class="col-xs-12" style="padding-left:0px;padding-right:0px;padding-bottom:7px;" ng-show="vm.nhctrl"><div class="col-xs-3" style="padding-left:0px;padding-right:0px;"><p style="padding-top:5px">Neighborhood</p></div><div class="col-xs-5" style="padding-left:0px;padding-right:0px;"><input type="text" class="form-control" placeholder="Enter Neighborhood" ng-model="vm.nhinp" bs-options="c for c in vm.nhops" bs-typeahead=""></div><button class="col-xs-2 btn btn-success" type="submit" ng-click="vm.selectNh()">Select</button> <button class="col-xs-2 btn btn-default" type="submit" ng-click="vm.clearNh()">Clear</button></div><div class="col-xs-12" style="padding-left:0px;padding-right:0px;"><div class="col-xs-7" style="padding-left:0px;padding-right:0px;"><div class="input-group"><input type="text" class="form-control" placeholder="Search San Diego" ng-model="vm.val" ng-change="vm.getResults()" id="SearchInput"><div class="input-group-btn"><button class="btn btn-default" type="submit"><i class="glyphicon glyphicon-search"></i></button></div></div></div><div class="col-xs-3" style="padding-left:0px;padding-right:0px"><button class="btn btn-default" style="width:100%" ng-click="vm.goAddRank()">Add Rank&nbsp&nbsp</button></div><button class="col-xs-2 btn btn-default pull-right" ng-click="vm.showTrends()"><i class="fa fa-rss" aria-hidden="true"></i></button></div></div></div><div class="input-group" style="width:100%" ng-if="vm.isAdmin&&!vm.childActive"><div class="text-center" ng-attr-style="display:{{vm.isAdmin ? \'inline\':\'none\'}}"><div class="btn-group col-sm-6 col-md-6"><button class="btn btn-primary {{vm.selEditRank}}" ng-click="vm.editRank()">Edit Mode</button> <button class="btn btn-primary {{vm.selViewRank}}" ng-click="vm.viewRank()">View Mode</button></div></div></div><div ng-show="!vm.childActive"><search-block ng-click="vm.hideSearch()" query="{{vm.val}}" ans="vm.showans" ranks="true" length="vm.slen" init="vm.initready" data="vm.dataready" rod="vm.rodready" scrollactive="!vm.childActive"></search-block></div><br ng-if="vm.childActive"><br ng-if="vm.childActive"><br ng-if="vm.childActive"><div ui-view="" ng-if="!vm.isLoading && vm.childActive" class="container" id="page-containter" style=""></div></div><a href="#" class="back-to-top" style="display: inline;"><i class="fa fa-arrow-up" aria-hidden="true"></i></a></div><br><br><footer class="footer" style="position: fixed; bottom: 0px; background: white; width: 100%; padding-top: 20px;"><div class="container"><p class="text-muted">Rank-X is a registered trademark property of Rank-X LLC. San Diego, CA - 2017 <span><a ng-click="vm.goPrivacyPolicy()">Privacy Policy</a></span> <span><a ng-click="vm.goRankofDayConsole()">RoD</a></span></p></div></footer>'),$templateCache.put("app/layout/Partials/navbar.html",'<nav class="navbar navbar-inverse"><div class="container"><div class="navbar-header"><button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar"><span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span></button> <a class="navbar-brand" href="/cwrapper" ng-click="vm.gotoHome()" style="cursor:pointer;padding:0px;border:0px;margin:0px;"><img src="/assets/images/logosqwborder.jpg" style="width:60px;"></a> <a class="navbar-brand home-link" ng-click="vm.selCity()" style="font-size:medium">San Diego</a><a class="navbar-brand navbar-profile-picture-wrapper" ng-show="vm.user" href="/favs" ng-click="vm.gotofavs()"><img class="img-responsive img-circle navbar-profile-picture" ng-src="{{vm.user.picture.data.url}}"> <span style="font-size:medium">{{vm.user.first_name}}</span></a> <button id="navbar-user-points" class="waggle">{{vm.user.points > 0 ? "+" : ""}}{{vm.user.points}}</button> <a class="navbar-brand" ng-if="vm.warning" style="background-color:#33cccc;color:black;margin:2px" ng-click="vm.goWarning()"><i class="fa fa-warning"></i></a> <a class="navbar-brand" ng-if="vm.coordsRdy" ng-click="vm.goCoords()" style="margin:0px;"><i class="fa fa-location-arrow"></i></a></div><div id="navbar" class="navbar-collapse collapse"><ul class="nav navbar-nav navbar-right"><li ng-if="vm.hasBusiness"><a href="/mybusiness" ng-click="vm.gotomybusiness()">My Business</a></li><li ng-if="vm.isPromoter"><a href="/promoterconsole" ng-click="vm.goPromoterConsole()">Promote</a></li><li><a href="/about" ng-click="vm.gotoAbout()">About</a></li><li><a href="/tour" ng-click="vm.gotoTour()">Tour</a></li><li ng-if="vm.isAdmin"><a href="" ng-click="vm.gotoAdmin()">Admin</a></li><li ng-if="!vm.isLoggedIn"><a ng-click="vm.goToLogin()">Login</a></li><li ng-if="vm.isLoggedIn"><a href="/logout" ng-click="vm.logout()" class="">Logout</a></li></ul></div></div></nav>'),
$templateCache.put("app/rank/Partials/RankSummary.html",'<div ng-if="!vm.foodNearMe"><div id="veil" ng-hide="vm.dataReady"></div><div id="feedLoading" ng-hide="vm.dataReady"><div style="text-align: center" ng-if="!vm.dataReady"><div><img src="/assets/images/loading.gif" class="img" style="width:50px;height:50px"></div><p style="font-size:large">loading rank...</p></div></div></div><div ng-if="vm.foodNearMe"><div id="veil" ng-show="vm.loadingAnswers"></div><div id="feedLoading" ng-show="vm.loadingAnswers"><div style="text-align: center"><div><img src="/assets/images/loading.gif" class="img" style="width:50px;height:50px"></div><p style="font-size:large">Wait a moment, finding some delicious food near by...</p></div></div></div><div ng-if="vm.dataReady && !vm.loadingAnswers"><div class="text-left"><button class="btn btn-default" ng-click="vm.backToResults()" style="margin:5px; width:100%; background-color:lightgray">Back to Results</button> <button class="btn btn-default" ng-if="vm.hasParent" ng-click="vm.gotoParentRank()" style="margin:5px; width:100%; background-color:lightgray">{{vm.parentRank.title}}</button></div><div class="text-left" ng-if="vm.isCustomRank"><button class="btn btn-default" ng-click="vm.answerDetail(vm.rankOwner)" style="margin:5px; width:100%; background-color:lightgray">Return to {{vm.rankOwner.name}}</button></div><div class="container"><div class="row"><div class="container-bgbox col-xs-6 col-sm-4 col-md-4 col-lg-3"><bg-box bc="{{vm.bc}}" shade="{{vm.shade}}" fc="{{vm.fc}}" text="{{vm.ranking}}" dir="horizontal" w="100%" h="{{vm.sm ? \'150px\':\'200px\'}}"></bg-box></div><div ng-if="!vm.isShortPhrase"><div class="col-xs-6 col-sm-4 col-md-4 col-lg-3" style="margin:0px;padding:0px;border:0px;" ng-if="!vm.isShortPhrase"><img ng-src="{{vm.image1}}" ng-attr-style="display:{{vm.image1 != undefined ? \'inline\':\'none\'}};width:100%;height:{{vm.sm ? \'150px\':\'200px\'}};"></div><div class="hidden-xs col-sm-4 col-md-4 col-lg-3" style="margin:0px;padding:0px;border:0px;" ng-if="!vm.isShortPhrase"><img ng-src="{{vm.image2}}" ng-attr-style="display:{{vm.image2 != undefined ? \'inline\':\'none\'}};width:100%;height:{{vm.sm ? \'150px\':\'200px\'}};"></div><div class="hidden-xs hidden-sm hidden-md col-lg-3" style="margin:0px;padding:0px;border:0px;" ng-if="!vm.isShortPhrase"><img ng-src="{{vm.image3}}" ng-attr-style="display:{{vm.image3 != undefined ? \'inline\':\'none\'}};width:100%;height:{{vm.sm ? \'150px\':\'200px\'}};"></div></div><div ng-if="vm.isShortPhrase&&vm.hasfimage"><div class="col-xs-6 col-sm-4 col-md-4 col-lg-3" style="margin:0px;padding:0px;border:0px;"><img ng-src="{{vm.fimage}}" ng-attr-style="display:{{vm.image1 != undefined ? \'inline\':\'none\'}};width:100%;height:{{vm.sm ? \'150px\':\'200px\'}};"></div><div class="container hidden-xs col-sm-4 col-md-4 col-lg-3" ng-attr-style="background-color:lightgray;color:black;height:{{sm ? \'150px\':\'200px\'}};margin:0px;padding:0px;border:0px;position:relative;"><div style="padding:3px; margin:0px; position:absolute; top:50%; left:50%; margin-right:-50%;transform: translate(-50%,-50%)"><h2 class="hidden-xs text-center">{{vm.title1}}</h2><h3 class="hidden-sm hidden-md hidden-lg hidden-xl text-center">{{vm.title1}}</h3></div></div><div class="container hidden-xs hidden-sm hidden-md col-lg-3" ng-attr-style="background-color:lightgray;color:black;height:{{sm ? \'150px\':\'200px\'}};margin:0px;padding:0px;border:0px;position:relative;"><div style="padding:3px; margin:0px; position:absolute; top:50%; left:50%; margin-right:-50%;transform: translate(-50%,-50%)"><h2 class="hidden-xs text-center">{{vm.title2}}</h2><h3 class="hidden-sm hidden-md hidden-lg hidden-xl text-center">{{vm.title2}}</h3></div></div></div><div ng-if="vm.isShortPhrase&&!vm.hasfimage"><div class="container col-xs-6 col-sm-4 col-md-4 col-lg-3" ng-attr-style="background-color:lightgray;color:black;height:{{sm ? \'150px\':\'200px\'}};margin:0px;padding:0px;border:0px;position:relative;"><div style="padding:3px; margin:0px; position:absolute; top:50%; left:50%; margin-right:-50%;transform: translate(-50%,-50%)"><h2 class="hidden-xs text-center">{{vm.title1}}</h2><h3 class="hidden-sm hidden-md hidden-lg hidden-xl text-center">{{vm.title1}}</h3></div></div><div class="container hidden-xs col-sm-4 col-md-4 col-lg-3" ng-attr-style="background-color:lightgray;color:black;height:{{sm ? \'150px\':\'200px\'}};margin:0px;padding:0px;border:0px;position:relative;"><div style="padding:3px; margin:0px; position:absolute; top:50%; left:50%; margin-right:-50%;transform: translate(-50%,-50%)"><h2 class="hidden-xs text-center">{{vm.title2}}</h2><h3 class="hidden-sm hidden-md hidden-lg hidden-xl text-center">{{vm.title2}}</h3></div></div><div class="container hidden-xs hidden-sm hidden-md col-lg-3" ng-attr-style="background-color:lightgray;color:black;height:{{sm ? \'150px\':\'200px\'}};margin:0px;padding:0px;border:0px;position:relative;"><div style="padding:3px; margin:0px; position:absolute; top:50%; left:50%; margin-right:-50%;transform: translate(-50%,-50%)"><h2 class="hidden-xs text-center">{{vm.title3}}</h2><h3 class="hidden-sm hidden-md hidden-lg hidden-xl text-center">{{vm.title3}}</h3></div></div></div></div></div><br ng-if="vm.introtext"><p class="text-left">{{vm.introtext}}</p><br><div class="row" style="margin:0px;padding:0px;"><div class="col-sm-9 col-md-9 col-lg-10 hidden-xs" style="margin-bottom: 10px; padding:0px"><div class="btn-group text-left"><button class="btn btn-default" ng-click="vm.sortbyHelpDialog()"><i class="fa fa-question-circle"></i></button> <span style="float: left;margin-left: 10px; margin-right: 10px;line-height: 32px">{{vm.sm ? \'\':\'Sort by:\'}}</span> <button class="btn btn-default {{vm.selRank}}" ng-click="vm.sortByRank()" ng-if="vm.type != \'Event\' && !vm.fnm">Rank</button> <button class="btn btn-default {{vm.selUpV}}" ng-click="vm.sortByUpV()">Popular</button> <button class="btn btn-default {{vm.selDistance}}" ng-click="vm.sortByDistance()" ng-show="{{vm.type == \'Establishment\' || vm.type == \'Event\' || vm.type == \'Place\'}}">Distance</button> <button class="btn btn-default {{vm.selDate}}" ng-click="vm.sortByDate()" ng-show="{{vm.type == \'Event\'}}">Date</button> <button class="btn btn-default {{vm.selTrending}}" ng-click="vm.sortByTrending()">Trending</button></div></div><div class="col-xs-8 visible-xs" style="margin-bottom: 10px; padding:0px"><div class="dropdown" style="margin:0px; padding:0px;"><button class="btn btn-default" ng-click="vm.sortbyHelpDialog()"><i class="fa fa-question-circle"></i></button> <span style="line-height:32px; margin: 0px 10px;">Sort By:</span> <button class="btn btn-default dropdown-toggle" type="button" data-toggle="dropdown">{{vm.sortByName}} <span class="caret"></span></button><ul class="dropdown-menu"><li><a class="btn btn-default {{vm.selRank}}" ng-click="vm.sortByRank()" ng-if="vm.type != \'Event\' && !vm.fnm">Rank</a></li><li><a class="btn btn-default {{vm.selUpV}}" ng-click="vm.sortByUpV()">Popular</a></li><li><a class="btn btn-default {{vm.selDistance}}" ng-click="vm.sortByDistance()" ng-show="{{vm.type == \'Establishment\' || vm.type == \'Event\' || vm.type == \'Place\'}}">Distance</a></li><li><a class="btn btn-default {{vm.selDate}}" ng-click="vm.sortByDate()" ng-show="{{vm.type == \'Event\'}}">Date</a></li><li><a class="btn btn-default {{vm.selTrending}}" ng-click="vm.sortByTrending()">Trending</a></li></ul></div></div><div class="col-xs-4 col-sm-3 col-md-3 col-lg-2 btn-group text-center"><a type="button" class="btn btn-default" style="vertical-align:middle;color:#0059b3;border-color:#0059b3;" ng-if="true" ng-click="vm.share()" target="_blank">Share&nbsp&nbsp<span class="fa fa-share"></span></a></div></div><div class="row"><div class="col-xs-12 col-sm-6 text-center" style="margin-bottom: 10px; padding:0px" ng-if="!vm.fnm"><div class="btn-group" style="padding-right:20px"><button ng-click="vm.changeMode(\'endorse\')" class="btn {{vm.mode==\'endorse\' ? \'btn-primary\':\'btn-default\'}}">Endorsements</button> <button ng-click="vm.changeMode(\'specials\')" class="btn {{vm.mode==\'specials\' ? \'btn-primary\':\'btn-default\'}}">Specials</button></div><button ng-click="vm.goRank()" class="btn btn-success {{vm.rankDisabled}}">&nbsp&nbsp&nbsp&nbspRank&nbsp&nbsp&nbsp&nbsp</button></div><div class="col-xs-12 col-sm-6 input-group"><input type="text" class="form-control" bs-options="c for c in vm.opts" bs-typeahead="" placeholder="Filter by Name or Neighborhood" ng-model="vm.val" ng-change="vm.getResults()" id="SearchInput"><div class="input-group-btn"><button class="btn btn-default" type="submit" ng-click="vm.clearSearch()"><i class="glyphicon glyphicon-search"></i></button></div></div></div><br><table class="table table-hover cursor"><tbody><thead><tr><th ng-if="!vm.sm || vm.sortByName==\'Rank\'" align="middle">Rank</th><th class="capitalize" ng-repeat="h in vm.fields | filter:{isrequired:true}" align="middle">{{h.label}}</th><th ng-if="!vm.sm || vm.sortByName==\'Popular\'" align="middle" style="width:{{vm.sm?\'10px\':\'auto\'}}">Diff.</th><th ng-if="(!vm.sm || vm.sortByName==\'Distance\') && vm.haveLocation" align="middle" style="width:{{vm.sm?\'10px\':\'auto\'}}">Dist (mi)</th><th ng-if="(!vm.sm || vm.sortByName==\'Trending\')" align="middle" style="width:{{vm.sm?\'10px\':\'auto\'}}">Last month</th><th ng-if="(!vm.sm || vm.sortByName==\'Date\') && vm.type == \'Event\' && vm.mode==\'specials\'" align="middle">Date</th><th ng-if="vm.type == \'Establishment\' && vm.mode==\'specials\'" style="width:{{vm.sm?\'150px\':\'200px\'}}" class="text-center">Specials</th><th ng-if="vm.mode == \'endorse\'" style="width:{{vm.sm?\'150px\':\'200px\'}}" class="text-center">Endorsements</th><th ng-if="vm.mode==\'endorse\'">&nbsp</th></tr></thead><tbody><tr ng-repeat="x in vm.answers | limitTo: vm.limit" style="height:43px" ng-click="vm.answerDetail(x)"><td ng-if="!vm.sm || vm.sortByName == \'Rank\'" align="middle">{{x.Rank}}</td><td ng-repeat="h in vm.fields | filter:{isrequired:true}"><a ng-attr-style="text-decoration: none;" href="{{\'/answerDetail/\' + x.slug }}" ng-click="vm.answerDetail(x)">{{ x[h.name]}}</a></td><td ng-if="(!vm.sm || vm.sortByName == \'Distance\') && vm.haveLocation" align="middle" style="width:{{vm.sm?\'10px\':\'auto\'}}">{{x.dist}}</td><td ng-if="!vm.sm || vm.sortByName == \'Popular\'" align="middle" style="width:{{vm.sm?\'10px\':\'auto\'}}">{{x.upV - x.downV > 0 ? (\'+\'+(x.upV-x.downV)):(x.upV-x.downV)}}</td><td ng-if="!vm.sm || vm.sortByName == \'Trending\'" align="middle" style="width:{{vm.sm?\'10px\':\'auto\'}}">{{x.trendUpV!=undefined&&x.trendUpV!=NaN?x.trendUpV:0}}</td><td ng-if="(!vm.sm || vm.sortByName == \'Date\') && vm.type == \'Event\' && vm.mode==\'specials\'" align="middle">{{x.date}}</td><td ng-show="vm.type == \'Establishment\' && vm.mode==\'specials\'" ng-attr-style="background-color:{{x.sp_bc}};color:{{x.sp_fc}};" ng-click="vm.answerDetail(x)">{{x.sp_title}}</td><td ng-if="vm.mode==\'endorse\'" style="width:{{vm.sm?\'150px\':\'200px\'}}"><div><span ng-click="vm.UpVote(x,$event)" ng-attr-style="color:{{x.thumbUp}};margin-right: {{vm.sm?\'0px\':\'20px\'}};font-size: 18px;" class="pull-left">&nbsp&nbsp <i class="fa fa-thumbs-up" aria-hidden="true"></i> <span style="color:black;font-size: 14px;">&nbsp;{{x.upV}}&nbsp;&nbsp;</span></span> <span ng-click="vm.DownVote(x,$event)" ng-attr-style="color:{{x.thumbDn}};margin-right: {{vm.sm?\'0px\':\'20px\'}};font-size: 18px;" class="pull-right"><i class="fa fa-thumbs-down" aria-hidden="true"></i> <span style="color:black;font-size: 14px;">&nbsp;{{x.downV}}</span> &nbsp&nbsp</span></div><div class="hidden-sm hidden-md hidden-lg hidden-xl"><div ng-if="x.userObjs.length == 1"><span class="badge btn-primary" ng-click="vm.showAllFriendsList(x.userObjs, x.name)">1 friend endorses this</span></div><div ng-if="x.userObjs.length > 1"><span class="badge btn-primary" ng-click="vm.showAllFriendsList(x.userObjs, x.name)">{{x.userObjs.length}} friends endorse this</span></div></div></td><td class="hidden-xs" ng-if="vm.mode==\'endorse\'" style="width:{{vm.sm?\'150px\':\'150px\'}}"><div ng-if="x.userObjs.length == 1"><span class="badge btn-primary" ng-click="vm.showAllFriendsList(x.userObjs, x.name)">1 friend endorses this</span></div><div ng-if="x.userObjs.length > 1"><span class="badge btn-primary" ng-click="vm.showAllFriendsList(x.userObjs, x.name)">{{x.userObjs.length}} friends endorse this</span></div></td></tr></tbody></tbody></table><div class="text-center" ng-if="vm.thereIsMore"><button class="btn btn-default" ng-click="vm.seeMore()">See More</button></div><div class="row" style="margin:0px;" ng-if="!vm.hasAnswerParent || vm.userIsOwner"><div class="col-xs-2" style="padding:0px"><a class="btn btn-primary" ng-click="vm.addAnswer()">+</a></div><div class="col-xs-10" ng-attr-style="display:{{vm.hideInfoBox ? \'none\':\'inline\'}};padding:0px;" ng-if="!vm.addInfoMsgAck || vm.noAnswers"><div class="alert alert-warning" style="padding-top: 5px;padding-bottom: 5px;"><a class="close" data-dismiss="alert" aria-label="close" ng-click="vm.closeAddInfoMsg()">&times;</a> <span class="glyphicon glyphicon-arrow-left"></span><strong>&nbsp;&nbsp; {{vm.noAnswers ? \'Oops, we have nothing on this list.\':\'Are we missing one?\'}}</strong>&nbsp;&nbsp;Use the \'+\' button to add a new <span ng-if="vm.type == \'Establishment\'">Establishment.</span> <span ng-if="vm.type == \'Organization\'">Organization or Company.</span> <span ng-if="vm.type == \'Person\'">Person.</span> <span ng-if="vm.type == \'PersonCust\'">Professional.</span> <span ng-if="vm.type == \'Place\'">Place.</span> <span ng-if="vm.type == \'Short-Phrase\'">Answer.</span> <span ng-if="vm.type == \'Thing\'">Item.</span> <span ng-if="vm.type == \'Event\'">Event.</span> <span ng-if="vm.type == \'Simple\'">Item.</span></div></div></div><br><br ng-if="!vm.sm"><div class="text-center"><button ng-click="vm.loadComments()" class="btn btn-default" ng-class="vm.cm.commLoaded ? \'disabled\' : \'\'" style="background-color:#e6e6e6;width:100%">COMMENTS ({{vm.numcom}})</button></div><br ng-if="!vm.sm"><div ng-attr-style="display:{{vm.cm.commLoaded ? \'inline\':\'none\'}}"><div ng-repeat="x in vm.cm.comments"><div class="col-xs-12 media"><div ng-if="!x.picture" class="profile-avatar-wrapper media-left"><div class="empty-profile-avatar-wrapper" ng-attr-style="background-color:{{x.bc}};color:{{x.fc}};">{{x.initials}}</div></div><div ng-if="x.picture" class="profile-avatar-wrapper media-left" align="middle"><img ng-src="{{x.picture}}" class="img-responsive img-circle profile-avatar"></div><div class="media-body">{{x.body}}<br><small style="color:#bfbfbf">{{x.username}} - {{x.date}}&nbsp&nbsp <span class="dropdown"><i type="button" class="fa fa-flag dropdown-toggle" data-toggle="dropdown"></i><ul class="dropdown-menu dropdown-menu-right"><li><a ng-click="vm.cmFlag(1)">Off-Topic</a></li><li><a ng-click="vm.cmFlag(2)">Offensive</a></li><li><a ng-click="vm.cmFlag(3)">Spam</a></li></ul></span></small></div></div><br></div><div ng-attr-style="display:{{(vm.cm.commLoaded && vm.cm.comments.length == 0 && !vm.isLoggedIn) ? \'inline\':\'none\'}}"><br><p><small>Nobody has commented yet. Be the first. Log in, endorse answers and leave a comment.</small></p></div><div ng-attr-style="display:{{(vm.cm.commLoaded && vm.cm.comments.length > 0 && !vm.isLoggedIn) ? \'inline\':\'none\'}}"><br><p><small>You must log in and endorse one or more answers to leave a comment.</small></p></div><div ng-attr-style="display:{{(vm.cm.commLoaded && vm.isLoggedIn && !vm.commentAllowed) ? \'inline\':\'none\'}}"><br><p><small>Endorse one or more answers to leave a comment.</small></p></div><div ng-attr-style="display:{{(vm.isLoggedIn && vm.commentAllowed) ? \'inline\':\'none\'}}"><div class="media"><div ng-if="!user.picture.data.url" class="profile-avatar-wrapper media-left"><div class="empty-profile-avatar-wrapper" ng-attr-style="background-color:{{x.bc}};color:{{x.fc}};">{{x.initials}}</div></div><div ng-if="user.picture.data.url" class="profile-avatar-wrapper media-left" align="middle"><img ng-src="{{user.picture.data.url}}" class="img-responsive img-circle profile-avatar"></div><div class="media-body"><textarea class="form-control" ng-model="vm.cm.newComment" placeholder="Leave a comment" style="margin-left:0px;margin-right:0px;"></textarea></div></div><div class="text-right"><button ng-click="vm.postComment()" class="btn btn-primary">Post</button></div></div></div><br></div>'),$templateCache.put("app/admin/Partials/admin.html",'<div ui-view="navbar"></div><br><div ng-if="!vm.dataready"><h2>Please wait, loading all admin data...</h2></div><div ng-if="vm.dataready"><div class="text-center" ng-if="vm.isAdmin"><div class="btn-group"><button class="btn btn-default {{vm.selKeywords}}" ng-click="vm.keywords()">Searched-Keyword</button> <button class="btn btn-default {{vm.selViews}}" ng-click="vm.views()">Ranking-Answers Views</button> <button class="btn btn-default {{vm.selFlags}}" ng-click="vm.flags()">Answer Flags</button> <button class="btn btn-default {{vm.selAddRanking}}" ng-click="vm.addRank()">Add Ranking</button> <button class="btn btn-default {{vm.selDbMaint}}" ng-click="vm.dbMaint()">dB Maint</button> <button class="btn btn-default {{vm.selQuery}}" ng-click="vm.dbQuery()">Query</button> <button class="btn btn-default {{vm.selSibLocs}}" ng-click="vm.sibLocs()">Sibbling Locations</button> <button class="btn btn-default {{vm.selFoodRanks}}" ng-click="vm.foodranks()">Food Ranks</button> <button class="btn btn-default {{vm.selPayment}}" ng-click="vm.payment()">Payment</button> <button class="btn btn-default {{vm.selPlan}}" ng-click="vm.plan()">Plan</button> <button class="btn btn-default" ng-click="vm.bizAdmin()">Business</button> <button class="btn btn-default" ng-click="vm.cleanDB()">Clean DB</button> <button class="btn btn-default" ng-click="vm.modImages()">Moderate Images</button> <button class="btn btn-default" ng-click="vm.staticPages()">Static Pages</button> <button class="btn btn-default {{vm.selLocations}}" ng-click="vm.golocations()">Locations</button> <button class="btn btn-default {{vm.selsitemap}}" ng-click="vm.gositemap()">Sitemap</button> <button class="btn btn-danger" ng-click="vm.applyRule()">Apply Rule</button></div></div><div ng-if="vm.dataAdmin"><button class="btn btn-default {{vm.selQuery}}" ng-click="vm.dbQuery()">Query</button> <button class="btn btn-default {{vm.selSibLocs}}" ng-click="vm.sibLocs()">Sibbling Locations</button></div><div ng-if="vm.modAdmin"><button class="btn btn-default" ng-click="vm.modImages()">Moderate Images</button> <button class="btn btn-default" ng-click="vm.staticPages()">Static Pages</button></div></div><br><br><div ui-view=""></div><br><br>')}]),function(){"use strict";function users($http,$rootScope,$q){function addUser(){function querySucceeded(result){return result.data}var currentuser=$rootScope.user,userinfo={first_name:currentuser.first_name,last_name:currentuser.last_name,email:currentuser.email,gender:currentuser.gender?currentuser.gender:"unknown",role:currentuser.role?currentuser.role:"unknown",userid:currentuser.id,age:currentuser.age?currentuser.age:"-1",level:"Newcomer",points:0};$rootScope.user.level="Newcomer",$rootScope.user.points=0;var resource=[];resource.push(userinfo);var url=BaseURI;$http.post(url,resource,{headers:{"Content-Type":"multipart/form-data"},body:resource}).then(querySucceeded,_queryFailed)}function getUser(userid){function querySucceeded(result){return result.data.resource}var url=BaseURI+"/?filter=userid="+userid;return $http.get(url).then(querySucceeded,_queryFailed)}function updateUser(userid,pts){$rootScope.user.id==userid&&$rootScope.$broadcast("getAttentionForUserPoints",{points:$rootScope.user.points+pts}),$q.all([getUser(userid)]).then(function(data){function querySucceeded(result){return $rootScope.DEBUG_MODE&&console.log("updating user succesful"),result.data}if(data){var userinfo=data[0][0];userinfo.points+=pts;var url=BaseURI,obj={resource:[]};$q.all([getUserLevels()]).then(function(data){if(data[0]){var userlevels=data[0],i=0;for(i=0;i<userlevels.length;i++){if(userinfo.points==userlevels[i].pts){userinfo.level=userlevels[i].level;break}if(userinfo.points<userlevels[i].pts){userinfo.level=userlevels[i-1].level;break}}return obj.resource.push(userinfo),$rootScope.user.id==userid&&($rootScope.user.level=userinfo.level),$http.patch(url,obj,{headers:{"Content-Type":"multipart/form-data"},body:obj}).then(querySucceeded,_queryFailed)}})}})}function getUserLevels(){function querySucceeded(result){return result.data.resource}return $http.get("/api/v2/mysql/_table/userlevels").then(querySucceeded,_queryFailed)}function _queryFailed(error){throw error}var BaseURI="/api/v2/mysql/_table/users";return{addUser:addUser,getUser:getUser,updateUser:updateUser}}angular.module("app").service("users",users),users.$inject=["$http","$rootScope","$q"]}(),function(){"use strict";function userpts($http,$rootScope,$q,users){function getActionPoint(action){function querySucceeded(result){return result.data.resource}var url="/api/v2/mysql/_table/actionpoints/?filter=action="+action;return $http.get(url).then(querySucceeded,_queryFailed)}function addrec(uaf){function querySucceeded(result){return result.data}var userpoint1,userpoint2,resource=[],action="";switch(uaf.action){case"addedAnswer":action="addAnswer";break;case"binded":case"commentR":case"commentA":break;case"editA":action="editAnswer";break;case"upVotedEdit":case"downVotedEdit":break;case"upVoted":action="voteUpAnswer";break;case"downVoted":action="voteDownAnswer";break;case"upVotedVrow":action="voteUpOpinion";break;case"downVotedVrow":action="voteDownOpinion";break;case"postPhoto":action="postPhoto";break;case"shareFacebook":action="shareFacebook";break;case"addedRank":break;case"addedOpinion":action="writeOpinion"}userpoint1={userid:uaf.userid,uaf:uaf.id,action:action},resource.push(userpoint1);var action1=resource[0].action;$q.all([getActionPoint(action1)]).then(function(result){resource[0].pts=result[0][0].pts,users.updateUser(resource[0].userid,resource[0].pts)}),$q.all([getCatanFromUaf(uaf),getVrowFromUaf(uaf)]).then(function(data){var catan=data[0],vrow=data[1];switch(uaf.action){case"upVoted":action="userVoteUpAnswerYouAdded",userpoint2={userid:catan.user,uaf:uaf.id,action:action},resource.push(userpoint2);break;case"downVoted":action="userVoteDownAnswerYouAdded",userpoint2={userid:catan.user,uaf:uaf.id,action:action},resource.push(userpoint2);break;case"upVotedVrow":action="userVoteUpYourOpinion",userpoint2={userid:vrow.user,uaf:uaf.id,action:action},resource.push(userpoint2);break;case"downVotedVrow":action="userVoteDownYourOpinion",userpoint2={userid:vrow.user,uaf:uaf.id,action:action},resource.push(userpoint2)}var action2=resource[1]?resource[1].action:"undefined";$q.all([getActionPoint(action2)]).then(function(result){result[0]&&(resource[1].pts=result[0][0].pts),users.updateUser(resource[1].userid,resource[1].pts);return $http.post("/api/v2/mysql/_table/userpoints",resource,{headers:{"Content-Type":"multipart/form-data"},body:resource}).then(querySucceeded,_queryFailed)})})}function getRecsByUser(userId){function querySucceeded(result){return result.data.resource}var url="/api/v2/mysql/_table/userpoints/?filter=userid="+userId;return $http.get(url).then(querySucceeded,_queryFailed)}function deleterec(userId){function querySucceeded(result){$rootScope.DEBUG_MODE&&console.log("deleting matching records succeeded")}var url="/api/v2/mysql/_table/userpoints/?filter=userid="+userId;return $http.delete(url).then(querySucceeded,_queryFailed)}function getActionPoints(){function querySucceeded(result){return result.data.resource}return $http.get("/api/v2/mysql/_table/actionpoints").then(querySucceeded,_queryFailed)}function getUserLevels(){function querySucceeded(result){return result.data.resource}return $http.get("/api/v2/mysql/_table/userlevels").then(querySucceeded,_queryFailed)}function getCatanFromUaf(uaf){function querySucceeded(result){return result.data.resource[0]}if(!uaf.answer||!uaf.category)return null;var url="/api/v2/mysql/_table/catans/?filter=((answer="+uaf.answer+") and (category="+uaf.category+"))";return $http.get(url).then(querySucceeded,_queryFailed)}function getVrowFromUaf(uaf){function querySucceeded(result){return result.data.resource[0]}if(!uaf.vrow)return null;var url="/api/v2/mysql/_table/vrows/?filter=id="+uaf.vrow;return $http.get(url).then(querySucceeded,_queryFailed)}function _queryFailed(error){throw error}return{addrec:addrec,getRecsByUser:getRecsByUser,deleterec:deleterec,getActionPoints:getActionPoints,getUserLevels:getUserLevels}}angular.module("app").service("userpts",userpts),userpts.$inject=["$http","$rootScope","$q","users"]}(),function(){"use strict";function staticpages($http,$q,$rootScope,SERVER_URL){function createPageRank(rank){return $http({method:"POST",data:rank,url:SERVER_URL+"staticpages/createPageRank",headers:{"X-Dreamfactory-API-Key":void 0,"X-DreamFactory-Session-Token":void 0}})}function createPageAnswer(answer){return $http({method:"POST",data:answer,url:SERVER_URL+"staticpages/createPageAnswer",headers:{"X-Dreamfactory-API-Key":void 0,"X-DreamFactory-Session-Token":void 0}})}function getFileList(){return $http({method:"POST",data:{},url:SERVER_URL+"staticpages/getFileList",headers:{"X-Dreamfactory-API-Key":void 0,"X-DreamFactory-Session-Token":void 0}})}function getPageContent(page){return $http({method:"POST",data:page,url:SERVER_URL+"staticpages/getPageContent",headers:{"X-Dreamfactory-API-Key":void 0,"X-DreamFactory-Session-Token":void 0}})}function removeFile(page){return $http({method:"POST",data:page,url:SERVER_URL+"staticpages/removeFile",headers:{"X-Dreamfactory-API-Key":void 0,"X-DreamFactory-Session-Token":void 0}})}return{createPageRank:createPageRank,createPageAnswer:createPageAnswer,removeFile:removeFile,getFileList:getFileList,getPageContent:getPageContent}}angular.module("app").factory("staticpages",staticpages),staticpages.$inject=["$http","$q","$rootScope","SERVER_URL"]}(),function(){"use strict";function setting($http,$q,$rootScope,SERVER_URL){function getSetting(){return $http({method:"GET",url:SERVER_URL+"settings/",headers:{"X-Dreamfactory-API-Key":void 0,"X-DreamFactory-Session-Token":void 0}}).then(function(result){return $rootScope.setting=result.data.settings,result.data.settings})}function setSetting(setting){return $http({method:"POST",url:SERVER_URL+"settings/",data:setting,headers:{"X-Dreamfactory-API-Key":void 0,"X-DreamFactory-Session-Token":void 0}}).then(function(result){return $rootScope.setting=result.data.settings,result.data.settings})}function setCodePrice(codepriceObj,newPrice){return $http({method:"POST",url:SERVER_URL+"codeprice/",data:{codeprice:codepriceObj,newPrice:newPrice},headers:{"X-Dreamfactory-API-Key":void 0,"X-DreamFactory-Session-Token":void 0}})}return{getSetting:getSetting,setSetting:setSetting,setCodePrice:setCodePrice}}angular.module("app").factory("setting",setting),setting.$inject=["$http","$q","$rootScope","SERVER_URL"]}(),function(){"use strict";function mailing($http,$q,$rootScope,SERVER_URL){function newBizCreated(useraccnt){return $http({method:"POST",data:useraccnt,url:SERVER_URL+"mailing/newBizCreated",headers:{"X-Dreamfactory-API-Key":void 0,"X-DreamFactory-Session-Token":void 0}})}function newImageUploaded(data){return $http({method:"POST",data:data,url:SERVER_URL+"mailing/newImageUploaded",headers:{"X-Dreamfactory-API-Key":void 0,"X-DreamFactory-Session-Token":void 0}})}function promoterCreated(promoter){return $http({method:"POST",data:promoter,url:SERVER_URL+"mailing/promoterCreated",headers:{"X-Dreamfactory-API-Key":void 0,"X-DreamFactory-Session-Token":void 0}})}function planPurchased(data){return $http({method:"POST",data:data,url:SERVER_URL+"mailing/planPurchased",headers:{"X-Dreamfactory-API-Key":void 0,"X-DreamFactory-Session-Token":void 0}})}function subscribed(email,username){return $http({method:"POST",data:{email:email,username:username},url:SERVER_URL+"mailing/userSubscribed",headers:{"X-Dreamfactory-API-Key":void 0,"X-DreamFactory-Session-Token":void 0}})}return{promoterCreated:promoterCreated,newBizCreated:newBizCreated,planPurchased:planPurchased,subscribed:subscribed,newImageUploaded:newImageUploaded}}angular.module("app").factory("mailing",mailing),mailing.$inject=["$http","$q","$rootScope","SERVER_URL"]}(),angular.module("app").factory("InstagramService",["$rootScope","$location","$http","INSTAGRAM_CLIENT_ID",function($rootScope,$location,$http,INSTAGRAM_CLIENT_ID){var currentPageID,client_id=INSTAGRAM_CLIENT_ID,maxIds=[],nextEnabled=!1,service={_access_token:null,access_token:function(newToken){return angular.isDefined(newToken)&&(this._access_token=newToken),this._access_token},login:function(){var redirect_uri=$location.absUrl().split($location.path())[0]+"/";window.open("https://api.instagram.com/oauth/authorize/?client_id="+client_id+"&redirect_uri="+redirect_uri+"&response_type=token&scope=likes+relationships+public_content+follower_list","Instagram Auth","width=400, height=600, centerscreen=true, chrome=yes")},getMyRecentImages:function(){return $http.jsonp("https://api.instagram.com/v1/users/self/media/recent?access_token="+service.access_token()).then(function(response){return response.data.pagination.next_max_id?(nextEnabled=!0,maxIds=[response.data.pagination.next_max_id],currentPageID=0):nextEnabled=!1,response.data.data})},getNextPage:function(){return $http.jsonp("https://api.instagram.com/v1/users/self/media/recent?access_token="+service.access_token()+"&max_id="+maxIds[currentPageID]).then(function(response){return response.data.pagination.next_max_id?(-1==maxIds.indexOf(response.data.pagination.next_max_id)&&maxIds.push(response.data.pagination.next_max_id),nextEnabled=!0):nextEnabled=!1,currentPageID++,response.data.data}).catch(function(err){console.log(err)})},getPreviousPage:function(){return $http.jsonp("https://api.instagram.com/v1/users/self/media/recent?access_token="+service.access_token()+"&max_id="+maxIds[currentPageID-1]).then(function(response){return currentPageID--,nextEnabled=!0,response.data.data}).catch(function(err){console.log(err)})},getUserprofile:function(){return $http.jsonp("https://api.instagram.com/v1/users/self/?access_token="+service.access_token()).then(function(data){return console.log(data),data}).catch(function(err){console.log(err)})},isPreviousAvailable:function(){return(1!=maxIds.length||0!=currentPageID)&&currentPageID>=0},isNextAvailable:function(){return nextEnabled}};return $rootScope.$on("igAccessTokenObtained",function(evt,args){service.access_token(args.access_token.replace("#","").replace("!","")),$rootScope.$broadcast("instagramLoggedIn",{access_token:service._access_token})}),service}]),function(){"use strict";function filter($http,$q,$rootScope,$window){function loadFilterOptions(){return $rootScope.filterOptions?$rootScope.filterOptions=JSON.parse($rootScope.filterOptions):$rootScope.filterOptions=defaultOptions,$rootScope.filterOptions}function saveFilterOptions(filterOptions){$rootScope.filterOptions=filterOptions,$window.localStorage.setItem("Rank-X-Filters",JSON.stringify(filterOptions))}function loadInitalHomeData(){return!!$rootScope.initalHomeData&&($rootScope.$emit("initalHomeDataLoaded"),!0)}function saveInitalHomeData(initalHomeData){}var defaultOptions={isNh:!1,isCity:!0,isNhRdy:"",cnh:"",isAllTopics:!0,ctopics:["LifeStyle","Social","Sports","Food","Beauty & Fashion","Family","Technology","Dating","City","Services","Health","Celebrities"]};return{loadFilterOptions:loadFilterOptions,saveFilterOptions:saveFilterOptions,saveInitalHomeData:saveInitalHomeData,loadInitalHomeData:loadInitalHomeData}}angular.module("app").factory("filter",filter),filter.$inject=["$http","$q","$rootScope","$window"]}(),function(){"use strict";function fbusers($http,$q,$rootScope,$facebook){
function addFBUser(user){fbUsers.push(user)}function getFBUserById(fbId){var user=findFBUserById(fbId);return user?$q.when(user):$facebook.api("/"+fbId+"?fields=first_name,gender,locale,picture,last_name,email","GET").then(function(user){return service.addFBUser(user),user},function(err){return null})}function findFBUserById(fbId){return fbUsers.find(function(user){return user.id==fbId})}function loadProfilePicture(users,fieldName){for(var i=0;i<users.length;i++){var userWithPic=angular.copy(user[i]);service.getFBUserById(userWithPic[fieldName]).then(function(fbUser){})}return users}var fbUsers=[],service={findFBUserById:findFBUserById,getFBUserById:getFBUserById,addFBUser:addFBUser,loadProfilePicture:loadProfilePicture};return service}angular.module("app").factory("fbusers",fbusers),fbusers.$inject=["$http","$q","$rootScope","$facebook"]}(),function(){"use strict";function common($rootScope){function getInclusiveAreas(nh,arr){var idx=$rootScope.locations.map(function(x){return x.id}).indexOf(nh);if(idx>-1){var nhSub=$rootScope.locations[idx].sub_areas.split(",").map(Number);if($rootScope.locations[idx].sub_areas){arr.push(nh);for(var i=0;i<nhSub.length;i++)getInclusiveAreas(nhSub[i],arr)}else arr.push(nh)}else console.log("Could not find -- ",nh)}function getIndexFromSlug(slug){if(isNumber(slug))return slug;var slugA=slug.split("-").map(Number);return slugA[slugA.length-1]}function isNumber(o){return!isNaN(o-0)&&null!==o&&""!==o&&!1!==o}return{getInclusiveAreas:getInclusiveAreas,getIndexFromSlug:getIndexFromSlug}}angular.module("app").service("common",common),common.$inject=["$rootScope"]}();var openModal=function(modalSelector,options){$(modalSelector).modal({backdrop:!options||1!=options.backdrop&&0!=options.backdrop?"static":options.backdrop,keyboard:options&&options.keyboard?options.keyboard:"false",show:"true"})},closeModal=function(modalSelector,callback){$(modalSelector).modal("hide"),callback&&callback()};!function(){"user strict";angular.module("app").constant("INSTANCE_URL","https://api.rank-x.com").constant("APP_API_KEY","d85f0ae42651932fd92bb9dddfe1189c930adc3230ac4f578c4cb54073331555").constant("GOOGLE_API_KEY","AIzaSyC2gAzj80m1XpaagvunSDPgEvOCleNNe5A").constant("DEBUG_MODE",!1).constant("EMPTY_IMAGE","https://rank-x.com/assets/images/noimage.jpg").constant("INSTAGRAM_CLIENT_ID","c46745e083b7451a99461240e01da20b").constant("SERVER_URL","https://server.rank-x.com/").constant("STRIPE_CLIENT_ID","ca_AdOtLByD0cfx8W3d76nnKqLjruvHmGlh")}(),function(){"use strict";function stateConfigurator($stateProvider,$urlRouterProvider,$locationProvider,$ocLazyLoadProvider){$ocLazyLoadProvider.config({loadedModules:["app"]}),$urlRouterProvider.otherwise("/home");var states=[{name:"layout",abstract:!0,url:"",views:{"@":{templateUrl:"app/layout/Partials/layout.html",controller:"layout as vm"},"navbar@layout":{templateUrl:"app/layout/Partials/navbar.html",controller:"navbar as vm"}}},{name:"cwrapper",parent:"layout",url:"/home",templateUrl:"app/layout/Partials/cwrapper.html",controller:"cwrapper as vm",resolve:{load:["$ocLazyLoad",function($ocLazyLoad){return $ocLazyLoad.load({rerun:!0,files:["scripts/app2.js"]})}]}},{name:"rankSummary",parent:"layout",url:"/rankSummary/:index",templateUrl:"app/rank/Partials/RankSummary.html",controller:"rankSummary as vm"},{name:"editRanking",parent:"layout",url:"/editRanking/:index",templateUrl:"app/rank/Partials2/editRanking.html",controller:"editRanking as vm"},{name:"addAnswer",parent:"layout",url:"/addAnswer",templateUrl:"app/answer/Partials2/addAnswer.html",controller:"addAnswer as vm"},{name:"addEvent",parent:"layout",url:"/addEvent",templateUrl:"app/answer/Partials2/addEvent.html",controller:"addEvent as vm"},{name:"editAnswer",parent:"layout",url:"/editAnswer/:index",templateUrl:"app/answer/Partials2/editAnswer.html",controller:"editAnswer as vm"},{name:"specials",parent:"layout",url:"/specials",templateUrl:"app/customer/Partials/specials.html",controller:"specials as vm"},{name:"editspecial",parent:"layout",url:"/editspecial",templateUrl:"app/customer/Partials/editspecial.html",controller:"editspecial as vm"},{name:"addRankforAnswer",parent:"layout",url:"/addRankforAnswer",templateUrl:"app/rank/Partials2/addRankforAnswer.html",controller:"addRankforAnswer as vm"},{name:"answerDetail",parent:"layout",url:"/answerDetail/:index",templateUrl:"app/answer/Partials/answerDetail.html",controller:"answerDetail as vm"},{name:"answerRanksManager",parent:"layout",url:"/answerRanksManager",templateUrl:"app/answer/Partials2/answerRanksManager.html",controller:"answerRanksManager as vm"},{name:"editvrows",parent:"layout",url:"/editvrows",templateUrl:"app/customer/Partials/editvrows.html",controller:"editvrows as vm"},{name:"addCustomRank",parent:"layout",url:"/addCustomRank",templateUrl:"app/rank/Partials2/addCustomRank.html",controller:"addCustomRank as vm"},{name:"match",parent:"layout",url:"/match",templateUrl:"app/rank/Partials2/match.html",controller:"match as vm"},{name:"about",url:"/about",parent:"layout",templateUrl:"app/layout/Partials2/about.html",controller:"about as vm"},{name:"privacypolicy",url:"/privacypolicy",parent:"layout",templateUrl:"app/layout/Partials2/privacypolicy.html",controller:"privacypolicy as vm"},{name:"cutomertos",url:"/terms-of-service/customers",parent:"layout",templateUrl:"app/layout/Partials2/customertos.html",controller:"customertos as vm"},{name:"promotertos",url:"/terms-of-service/promoters",parent:"layout",templateUrl:"app/layout/Partials2/promotertos.html",controller:"promotertos as vm"},{name:"mybusiness",url:"/mybusiness",parent:"layout",templateUrl:"app/layout/Partials2/mybusiness.html",controller:"mybusiness as vm"},{name:"promoterconsole",url:"/promoterconsole",parent:"layout",templateUrl:"app/promoters/Partials/promoterconsole.html",controller:"promoterconsole as vm"},{name:"promotersignup",url:"/promotersignup",parent:"layout",templateUrl:"app/promoters/Partials/promotersignup.html",controller:"promotersignup as vm"},{name:"favs",parent:"layout",url:"/favs",templateUrl:"app/user/Partials/favs.html",controller:"favs as vm"},{name:"feeds",parent:"layout",url:"/feeds",templateUrl:"app/layout/Partials2/feeds.html",controller:"feeds as vm"},{name:"trends",parent:"layout",url:"/trends",templateUrl:"app/layout/Partials2/trends.html",controller:"trends as vm"},{name:"admin",url:"/admin",parent:"layout",templateUrl:"app/admin/Partials/admin.html",controller:"admin as vm",resolve:{load:["$ocLazyLoad",function($ocLazyLoad){return $ocLazyLoad.load({rerun:!0,files:["scripts/admin-app.js"]})}]}}];$(states).each(function(){$stateProvider.state(this)}),$locationProvider.html5Mode(!0),$locationProvider.hashPrefix("!")}angular.module("app").config(["$stateProvider","$urlRouterProvider","$locationProvider","$ocLazyLoadProvider",stateConfigurator])}(),function(){"use strict";function configure($httpProvider,$locationProvide,$facebookProvider,$sceDelegateProvider){$httpProvider.interceptors.push("httpInterceptor"),$facebookProvider.setAppId("1102409523140826"),$sceDelegateProvider.resourceUrlWhitelist(["self","https://api.instagram.com/**"])}angular.module("app").config(configure),configure.$inject=["$httpProvider","$locationProvider","$facebookProvider","$sceDelegateProvider"]}(),function(){"use strict";function configureHeaders($cookies,$http,$rootScope,APP_API_KEY,$window){$http.defaults.headers.common["X-Dreamfactory-API-Key"]=APP_API_KEY,$http.defaults.headers.common["X-DreamFactory-Session-Token"]=$cookies.session_token;var access=$window.location.hash.replace("#access_token=","").split("&")[0];if(-1!=$window.location.hash.indexOf("access_token")){console.log("opener",$window.opener);$window.opener.angular.element($window.opener.document).scope().$broadcast("igAccessTokenObtained",{access_token:access}),$window.close()}}function setAnalytics($rootScope,$location,$window){$window.ga("create","UA-88236718-1","auto"),$window.ga("send","pageview"),$rootScope.$on("$stateChangeSuccess",function(event){$window.ga("send","pageview",$location.path())})}angular.module("app").run(configureHeaders).run(setAnalytics),configureHeaders.$inject=["$cookies","$http","$rootScope","APP_API_KEY","$window"],setAnalytics.$inject=["$rootScope","$location","$window"]}(),function(){"use strict";function rank($rootScope){function computeRanking(answers,mrecs){for(var N=answers.length,M=N*(N-1)/2,L=mrecs.length,ansHS=0,ansLS=0,GPtemp=0,mGP=0,i=0;i<N;i++){R[i]=new Array(N),GP[i]=new Array(N);for(var j=0;j<N;j++)R[i][j]=0,GP[i][j]=0;A[i]=answers[i].id}for(i=0;i<L;i++)ansHS=A.indexOf(mrecs[i].hs),ansLS=A.indexOf(mrecs[i].ls),ansHS>=0&&ansLS>=0&&(mrecs[i].sel==mrecs[i].hs?R[ansHS][ansLS]++:mrecs[i].sel==mrecs[i].ls&&R[ansLS][ansHS]++,GP[ansHS][ansLS]++,GP[ansLS][ansHS]++);for(GPtemp=0,i=0;i<N;i++)for(j=0;j<N;j++)GPtemp+=GP[i][j];for(mGP=GPtemp/(4*M),i=0;i<N;i++){for(answers[i].Rank=0,GPtemp=0,j=0;j<N;j++)answers[i].Rank=answers[i].Rank+R[i][j],GPtemp+=GP[i][j];answers[i].Rank=answers[i].Rank/GPtemp,GPtemp<mGP&&(answers[i].Rank=answers[i].Rank*(GPtemp/mGP)),isNaN(answers[i].Rank)&&(answers[i].Rank=0)}for(var k=0;k<N;k++)for(j=0;j<N;j++)k!=j&&answers[j].Rank>=answers[k].Rank&&R[k][j]>R[j][k]&&GP[k][j]>=mGP&&(answers[k].Rank=answers[j].Rank+.01);answersR=answers,$rootScope.answersR=answersR,$rootScope.R=R,$rootScope.GP=GP,$rootScope.A=A}$rootScope.A=[];var R=[],GP=[],A=[],answersR=[];return{computeRanking:computeRanking}}angular.module("app").service("rank",rank),rank.$inject=["$rootScope"]}(),function(){"use strict";function matchrec($http,$q,$rootScope){function postRec(data){function querySucceeded(result){return $rootScope.DEBUG_MODE&&console.log("creating match record was succesful"),result.data}var obj={};obj.resource=[],obj.resource.push(data),_mrecs.push.apply(_mrecs,data);var url=baseURI;return $http.post(url,data,{headers:{"Content-Type":"multipart/form-data"},body:obj}).then(querySucceeded,_queryFailed)}function GetMatchTable(forceRefresh){function querySucceeded(result){return _load(result.data.resource),_mrecs}if(_areMatchRecsLoaded()&&!forceRefresh)return $q.when(_mrecs);var url=baseURI;return $http.get(url).then(querySucceeded,_queryFailed)}function GetMatchTableX(data){function querySucceeded(result){var _mrecsx=result.data.resource,map=_mrecs.map(function(x){return x.id});return _mrecsx.forEach(function(obj){map.indexOf(obj.id)<0&&_mrecs.push(obj)}),$rootScope.DEBUG_MODE&&console.log("mrecsX data loaded"),_mrecsx}for(var filterstr="?filter=(",i=0;i<data.length;i++)filterstr=filterstr+"category="+data[i].category+")OR(";filterstr=filterstr.substring(0,filterstr.length-3);var url=baseURI;return $http.get(url).then(querySucceeded,_queryFailed)}function deleteRecordsbyAnswer(answer_id){function querySuccess(result){$rootScope.DEBUG_MODE&&console.log("deleting match records succesful")}for(var i=0;i<_mrecs.length;i++)_mrecs[i].ls!=answer_id&&_mrecs[i].hs!=answer_id||_mrecs.splice(i,1);var url=baseURI+"?filter=(ls="+answer_id+") OR (hs="+answer_id+")";return $http.delete(url).then(querySuccess,_queryFailed)}function deleteRecordsbyCatans(category_id,answer_id){function querySuccess1(result){console.log("deleting match records category-hs pair succesful")}function querySuccess2(result){$rootScope.DEBUG_MODE&&console.log("deleting match records category-ls pair succesful")}for(var i=0;i<_mrecs.length;i++)_mrecs[i].ls!=answer_id&&_mrecs[i].hs!=answer_id||_mrecs.splice(i,1);var url=baseURI+"?filter=(category="+category_id+") AND (hs="+answer_id+")";$http.delete(url).then(querySuccess1,_queryFailed);var url2=baseURI+"?filter=(category="+category_id+") AND (ls="+answer_id+")";$http.delete(url2).then(querySuccess2,_queryFailed)}function _load(data){_mrecs.length=0,data.forEach(function(x){_mrecs.push(x)})}function _queryFailed(error){throw error}function _areMatchRecsLoaded(){return _mrecs.length>0}var _mrecs=[];$rootScope.mrecs=_mrecs;var baseURI="/api/v2/mysql/_table/matchtable";return{GetMatchTable:GetMatchTable,GetMatchTableX:GetMatchTableX,postRec:postRec,deleteRecordsbyAnswer:deleteRecordsbyAnswer,deleteRecordsbyCatans:deleteRecordsbyCatans}}angular.module("app").factory("matchrec",matchrec),matchrec.$inject=["$http","$q","$rootScope"]}(),function(){"use strict";function rankSummary(dialog,$stateParams,$state,catans,datetime,color,locations,answer,rank,$filter,table,vrowvotes,$window,vrows,$scope,$http,$rootScope,$modal,editvote,votes,commentops,flag,Socialshare,SERVER_URL,$location,$q,fbusers,$timeout,table2,categories,dataloader,common){function checkRankIsLoaded(){$rootScope.cCategory=null;var rankid=common.getIndexFromSlug($stateParams.index),idx=0;$rootScope.isCustomRank?(idx=$rootScope.customranks.map(function(x){return x.id}).indexOf(Number(rankid)))>-1&&($rootScope.cCategory=$rootScope.customranks[idx]):(idx=$rootScope.content.map(function(x){return x.id}).indexOf(Number(rankid)))>-1&&($rootScope.cCategory=$rootScope.content[idx]),null!=$rootScope.cCategory?prepareRankSummary():dataloader.getRank($stateParams.index)}function prepareRankSummary(){vm.dataReady=!0,vm.ranking=$rootScope.cCategory.title,11942==$rootScope.cCategory.id&&(vm.foodNearMe=!0,foodNearMe=!0,vm.fnm=!0,vm.showR=!1,void 0!=$rootScope.coordsRdy&&0!=$rootScope.coordsRdy||sortByDistance()),vm.loadingAnswers=!0,$timeout(function(){foodNearMe?$rootScope.coordsRdy&&activate():activate(),vm.loadingAnswers=!1})}function activate(){answers=$rootScope.answers,catansrecs=$rootScope.catansrecs,mrecs=$rootScope.mrecs,$rootScope.inFavMode=!1,rankIsNearMe=void 0!=$rootScope.rankIsNearMe&&$rootScope.rankIsNearMe,$window.scrollTo(0,0),$rootScope.$emit("showLogo"),$rootScope.rankIsActive=!0,$rootScope.objNumAct=$rootScope.objNum,loadData(),foodNearMe||(loadTrendVotes(0),$rootScope.isLoggedIn&&$rootScope.friends_votes&&loadFriendsEndorsements(0)),checkUserCredentials(),$scope.$parent.$parent.$parent.seo={pageTitle:$rootScope.cCategory.title,metaDescription:$rootScope.cCategory.question},0==vm.answers.length?vm.noAnswers=!0:vm.noAnswers=!1,getUserData(),$rootScope.cvotes?getAnswerVotes():($rootScope.cvotes=[],$rootScope.ceditvotes=[]),createAnswerStatus(),sortByUpV(),rank.computeRanking($rootScope.canswers,$rootScope.cmrecs),$rootScope.cmrecs.length>0&&sortByRank();for(var i=0;i<vm.answers.length;i++)vm.answers[i].Rank=i+1;if(void 0==$rootScope.cCategory.numcom?vm.numcom=0:vm.numcom=$rootScope.cCategory.numcom,!foodNearMe)for(var i=0;i<vm.answers.length;i++)vm.answers[i].Rank!=vm.answers[i].catansrank&&void 0!=vm.answers[i].catans&&($rootScope.DEBUG_MODE&&console.log("RS-1"),vm.answers[i].catansrank!=vm.answers[i].Rank&&catans.updateRec(vm.answers[i].catans,["rank"],[vm.answers[i].Rank]));if(1==vm.answers.length&&(vm.numAns=1,"Short-Phrase"==$rootScope.cCategory.type?(vm.isShortPhrase=!0,vm.title1=vm.answers[0].name,vm.addinfo1=vm.answers[0].addinfo,vm.image1=vm.title1+"##"+vm.addinfo1,null!=$rootScope.cCategory.fimage&&void 0!=$rootScope.cCategory.fimage&&""!=$rootScope.cCategory.fimage?(vm.hasfimage=!0,vm.fimage=$rootScope.cCategory.fimage):vm.hasfimage=!1):(vm.isShortPhrase=!1,void 0!=vm.answers[0].imageurl&&null!=vm.answers[0].imageurl&&""!=vm.answers[0].imageurl?(vm.image1=vm.answers[0].imageurl,vm.image1ok=!0):vm.image1ok=!1),foodNearMe||$rootScope.cCategory.isGhost||($rootScope.isCustomRank?table2.update($rootScope.cCategory.id,["answers","image1url","image2url","image3url"],[$rootScope.canswers.length,vm.image1,"",""]):table.update($rootScope.cCategory.id,["answers","image1url","image2url","image3url"],[$rootScope.canswers.length,vm.image1,"",""]))),2==vm.answers.length&&(vm.numAns=2,"Short-Phrase"==$rootScope.cCategory.type?(vm.isShortPhrase=!0,vm.title1=vm.answers[0].name,vm.addinfo1=vm.answers[0].addinfo,vm.image1=vm.title1+"##"+vm.addinfo1,vm.title2=vm.answers[1].name,vm.addinfo2=vm.answers[1].addinfo,vm.image2=vm.title2+"##"+vm.addinfo2,null!=$rootScope.cCategory.fimage&&void 0!=$rootScope.cCategory.fimage&&""!=$rootScope.cCategory.fimage?(vm.hasfimage=!0,vm.fimage=$rootScope.cCategory.fimage):vm.hasfimage=!1):(vm.isShortPhrase=!1,void 0!=vm.answers[0].imageurl&&null!=vm.answers[0].imageurl&&""!=vm.answers[0].imageurl?(vm.image1=vm.answers[0].imageurl,vm.image1ok=!0):vm.image1ok=!1,void 0!=vm.answers[1].imageurl&&null!=vm.answers[1].imageurl&&""!=vm.answers[1].imageurl?(vm.image2=vm.answers[1].imageurl,vm.image2ok=!0):vm.image2ok=!1),foodNearMe||$rootScope.cCategory.isGhost||($rootScope.isCustomRank?table2.update($rootScope.cCategory.id,["answers","image1url","image2url","image3url"],[$rootScope.canswers.length,vm.image1,vm.image2,""]):table.update($rootScope.cCategory.id,["answers","image1url","image2url","image3url"],[$rootScope.canswers.length,vm.image1,vm.image2,""]))),vm.answers.length>2){if(vm.numAns=3,"Short-Phrase"==$rootScope.cCategory.type)vm.isShortPhrase=!0,vm.title1=vm.answers[0].name,vm.addinfo1=vm.answers[0].addinfo,vm.image1=vm.title1+"##"+vm.addinfo1,vm.title2=vm.answers[1].name,vm.addinfo2=vm.answers[1].addinfo,vm.image2=vm.title2+"##"+vm.addinfo2,vm.title3=vm.answers[2].name,vm.addinfo3=vm.answers[2].addinfo,vm.image3=vm.title3+"##"+vm.addinfo3,null!=$rootScope.cCategory.fimage&&void 0!=$rootScope.cCategory.fimage&&""!=$rootScope.cCategory.fimage?(vm.hasfimage=!0,vm.fimage=$rootScope.cCategory.fimage):vm.hasfimage=!1;else{vm.isShortPhrase=!1,vm.image1=$rootScope.EMPTY_IMAGE,vm.image2=$rootScope.EMPTY_IMAGE,vm.image3=$rootScope.EMPTY_IMAGE,vm.image1ok=!0,vm.image2ok=!0,vm.image3ok=!0;for(var img=1,n=0;n<vm.answers.length;n++)if(void 0!=vm.answers[n].imageurl&&null!=vm.answers[n].imageurl&&""!=vm.answers[n].imageurl&&vm.answers[n].imageurl!=$rootScope.EMPTY_IMAGE){if(3==img){vm.image3=vm.answers[n].imageurl;break}2==img&&(vm.image2=vm.answers[n].imageurl,img++),1==img&&(vm.image1=vm.answers[n].imageurl,img++)}}foodNearMe||$rootScope.cCategory.isGhost||($rootScope.isCustomRank?table2.update($rootScope.cCategory.id,["answers","image1url","image2url","image3url"],[$rootScope.canswers.length,vm.image1,vm.image2,""]):table.update($rootScope.cCategory.id,["answers","image1url","image2url","image3url"],[$rootScope.canswers.length,vm.image1,vm.image2,vm.image3]))}if(void 0!=$rootScope.cCategory.fimage&&""!=$rootScope.cCategory.fimage&&$rootScope.cCategory.fimage!=vm.image1&&(vm.image3=vm.image2,vm.image2=vm.image1,vm.image1=$rootScope.cCategory.fimage),void 0!=$rootScope.cCategory.bc&&""!=$rootScope.cCategory.bc)vm.bc=$rootScope.cCategory.bc,vm.fc=$rootScope.cCategory.fc,vm.shade=$rootScope.cCategory.shade;else{var colors=color.defaultRankColor($rootScope.cCategory);vm.bc=colors[0],vm.fc=colors[1],vm.shade=-4}$rootScope.DEBUG_MODE&&console.log("foodNearMe, ",foodNearMe),$rootScope.DEBUG_MODE&&console.log("rankIsNearMe, ",rankIsNearMe),(foodNearMe||rankIsNearMe)&&sortByDistance(),vm.isE&&sortByDate(),foodNearMe&&(vm.showR=!1),foodNearMe||vm.isE||(vm.showR=!0),$rootScope.modeIsImage=!0,$rootScope.isCustomRank||$rootScope.cCategory.isGhost||incViews(),$rootScope.DEBUG_MODE&&console.log("Rank Summary Loaded!"),window.prerenderReady=!0,$rootScope.isCustomRank=!1}function getRankAnswers(){$rootScope.canswers4rank=[];for(var i=0;i<$rootScope.cvotes.length;i++)if(1==$rootScope.cvotes[i].vote)for(var k=0;k<$rootScope.canswers.length;k++)if($rootScope.cvotes[i].answer==$rootScope.canswers[k].id){var idx=$rootScope.catansrecs.map(function(x){return x.id}).indexOf($rootScope.cvotes[i].catans);idx>-1&&$rootScope.catansrecs[idx].category==$rootScope.cCategory.id&&$rootScope.canswers4rank.push($rootScope.canswers[k])}$rootScope.canswers4rank.length>0?vm.commentAllowed=!0:vm.commentAllowed=!1,updateStatusRankButton()}function updateStatusRankButton(){$rootScope.canswers4rank.length>1?vm.rankDisabled="":vm.rankDisabled="disabled"}function updateVoteTable(){votes.loadVotesByUser().then(function(votetable){$rootScope.cvotes=votetable,getRankAnswers()})}function getUserData(){if($rootScope.canswers4rank=[],$rootScope.isLoggedIn){updateVoteTable();for(var i=0;i<$rootScope.editvotes.length;i++)if($rootScope.editvotes[i].category==$rootScope.cCategory.id){var editvoteitem=$rootScope.editvotes[i];$rootScope.ceditvotes.push(editvoteitem)}$rootScope.cmrecs_user=[];for(var i=0;i<$rootScope.cmrecs.length;i++)$rootScope.cmrecs[i].user==$rootScope.user.id&&$rootScope.cmrecs_user.push($rootScope.cmrecs[i])}}function answerDetail(x){vm.rankOwner&&x.slug==vm.rankOwner.slug&&($rootScope.cCategory=$rootScope.oCategory),$state.go("answerDetail",{index:x.slug})}function goRank(){if($rootScope.isLoggedIn){if(!($rootScope.canswers4rank.length>1))return void dialog.getDialog("answersFew");$state.go("match")}else dialog.getDialog("notLoggedIn")}function addAnswer(){if(!$rootScope.isLoggedIn||void 0==$rootScope.cCategory)return void dialog.loginFacebook();if(answersFull)return void dialog.getDialog("answersFull");if($rootScope.cCategory.isGhost){var item={title:$rootScope.cCategory.title,type:$rootScope.cCategory.type,tags:$rootScope.cCategory.tags,keywords:$rootScope.cCategory.keywords,question:$rootScope.cCategory.question,fimage:$rootScope.cCategory.fimage,bc:$rootScope.cCategory.bc,fc:$rootScope.cCategory.fc,shade:$rootScope.cCategory.shade,introtext:$rootScope.cCategory.introtext,user:$rootScope.cCategory.user,views:0,answers:0,image1url:$rootScope.EMPTY_IMAGE,image2url:$rootScope.EMPTY_IMAGE,image3url:$rootScope.EMPTY_IMAGE,answertags:"",isatomic:1,timestmp:new Date,cat:$rootScope.cCategory.cat,nh:$rootScope.cCategory.nh};table.addTable(item).then(function(result){$rootScope.DEBUG_MODE&&console.log("table added --- ",result);var rankid=result.resource[0].id,slug=item.title.toLowerCase();slug=slug.replace(/ /g,"-"),slug=slug.replace("/","at"),slug=slug+"-"+rankid,table.update(rankid,["slug"],[slug]),"Event"==vm.type?($rootScope.eventmode="add",$state.go("addEvent")):$state.go("addAnswer")})}else"Event"==vm.type?($rootScope.eventmode="add",$state.go("addEvent")):$state.go("addAnswer")}function loadData(){if($rootScope.cCategory.introtext){var start=$rootScope.cCategory.introtext.indexOf("++"),end=$rootScope.cCategory.introtext.indexOf("--");vm.introtext=start>-1&&end>-1?$rootScope.cCategory.introtext.substring(start+2,end):$rootScope.cCategory.introtext}else vm.introtext="This is the rank for "+$rootScope.cCategory.title+".  Help shape the ranking by endorsing your favorites!.";if(0!=$rootScope.cCategory.owner&&void 0!=$rootScope.cCategory.owner)if(vm.isCustomRank=!0,11091==$rootScope.cCategory.id||11092==$rootScope.cCategory.id||11093==$rootScope.cCategory.id)vm.rankOwner=$rootScope.oAnswer;else{var idx=$rootScope.answers.map(function(x){return x.id}).indexOf(Number($rootScope.cCategory.owner));vm.rankOwner=$rootScope.answers[idx]}var fidx=0;switch($rootScope.cCategory.type){case"Place":fidx=0;break;case"Person":fidx=1;break;case"Event":fidx=2;break;case"Organization":fidx=3;break;case"Short-Phrase":fidx=4;break;case"Activity":fidx=5;break;case"Establishment":fidx=6;break;case"Thing":fidx=7;break;case"PersonCust":fidx=8;break;case"Simple":fidx=9}var fields=$rootScope.typeSchema[fidx].fields;if($rootScope.fields=fields,vm.fields=$rootScope.fields,vm.type=$rootScope.cCategory.type,"Event"==vm.type?vm.isE=!0:vm.isE=!1,$rootScope.NhImplied=!1,$rootScope.NhValue="",("Establishment"==$rootScope.cCategory.type||"Place"==$rootScope.cCategory.type||"Event"==$rootScope.cCategory.type)&&void 0!=$rootScope.nhs)for(var nhs=$rootScope.nhs,i=0;i<nhs.length;i++)if($rootScope.cCategory.title.indexOf(nhs[i])>-1){$rootScope.NhImplied=!0,$rootScope.NhValue=nhs[i];break}if(vm.sm)for(var i=0;i<vm.fields.length;i++)"cityarea"==vm.fields[i].name&&(vm.fields[i].isrequired=!1),"upV"==vm.fields[i].name&&(vm.fields[i].isrequired=!1),"email"==vm.fields[i].name&&(vm.fields[i].isrequired=!1);if($rootScope.cCategory.isatomic&&$rootScope.NhImplied&&"San Diego"!=$rootScope.NhValue)for(var ss=$rootScope.cCategory.title.replace($rootScope.NhValue,"San Diego"),n=0;n<$rootScope.content.length;n++)$rootScope.content[n].title==ss&&(vm.hasParent=!0,vm.parentRank=$rootScope.content[n],dataloader.pulldata("ranks",[vm.parentRank]));$rootScope.canswers=[];var fanswers=[];$rootScope.ccatans=[],$rootScope.B=[];var eventObj={},obj={};if(foodNearMe&&void 0==$rootScope.fanswers){for(var idx=0,isDup=!1,ansObj={},ansArr=$rootScope.foodans.cats.split(":").map(Number),j=0;j<ansArr.length;j++)if(idx=$rootScope.answers.map(function(x){return x.id}).indexOf(ansArr[j]),$rootScope.answers[idx]){if(isDup=!1,fanswers.length>0&&idx>0)for(var n=0;n<fanswers.length;n++)if(fanswers[n].id==$rootScope.answers[idx].id){isDup=!0;break}isDup||(ansObj=$rootScope.answers[idx],Math.abs($rootScope.currentUserLatitude-$rootScope.answers[idx].lat)<.0145&&Math.abs($rootScope.currentUserLongitude-$rootScope.answers[idx].lng)<.0145&&fanswers.push(ansObj))}$rootScope.canswers=fanswers,$rootScope.fanswers=fanswers}if(!foodNearMe)for(var i=0;i<catansrecs.length;i++){catArr=$rootScope.cCategory.catstr?$rootScope.cCategory.catstr.split(":").map(Number):[$rootScope.cCategory.id];for(var n=0;n<catArr.length;n++)if(catansrecs[i].category==catArr[n])for(var k=0;k<answers.length;k++)if(catansrecs[i].answer==answers[k].id&&1!=catansrecs[i].isdup)if(obj={},obj=answers[k],obj.catans=catansrecs[i].id,obj.catansrank=catansrecs[i].rank,obj.upV=catansrecs[i].upV,obj.upV=catansrecs[i].upV,obj.downV=catansrecs[i].downV,obj.catans=catansrecs[i].id,obj.rank=catansrecs[i].rank,obj.uservote={},obj.upVi=catansrecs[i].upV,obj.downVi=catansrecs[i].downV,displayVote(obj),"Event"==vm.type){if(eventObj=JSON.parse(answers[k].eventstr)){if(mergeObject(answers[k],eventObj),datetime.eventIsCurrent(obj,answers[k])){$rootScope.canswers.push(obj),$rootScope.ccatans.push(catansrecs[i]);break}break}}else if($rootScope.isCustomRank&&obj.isprivate||!$rootScope.isCustomRank&&!obj.isprivate){$rootScope.canswers.push(obj),$rootScope.ccatans.push(catansrecs[i]);break}}foodNearMe&&$rootScope.fanswers&&($rootScope.canswers=$rootScope.fanswers),vm.answers=$rootScope.canswers,getFilterOptions(),vm.answers.length>vm.limit?vm.thereIsMore=!0:vm.thereIsMore=!1,dataloader.pulldata("answers",$rootScope.canswers),$rootScope.currentUserLatitude&&$rootScope.currentUserLongitude?(vm.haveLocation=!0,getDistances()):vm.haveLocation=!1;for(var cdate=new Date,dayOfWeek=cdate.getDay(),isToday=!1,j=0;j<vm.answers.length;j++){isToday=!1;for(var i=0;i<$rootScope.specials.length;i++)if(vm.answers[j].id==$rootScope.specials[i].answer){if("weekly"==$rootScope.specials[i].freq&&(0==dayOfWeek&&$rootScope.specials[i].sun&&(isToday=!0),1==dayOfWeek&&$rootScope.specials[i].mon&&(isToday=!0),2==dayOfWeek&&$rootScope.specials[i].tue&&(isToday=!0),3==dayOfWeek&&$rootScope.specials[i].wed&&(isToday=!0),4==dayOfWeek&&$rootScope.specials[i].thu&&(isToday=!0),5==dayOfWeek&&$rootScope.specials[i].fri&&(isToday=!0),6==dayOfWeek&&$rootScope.specials[i].sat&&(isToday=!0),isToday)){vm.answers[j].sp_bc=$rootScope.specials[i].bc,vm.answers[j].sp_fc=$rootScope.specials[i].fc,vm.answers[j].sp_title=$rootScope.specials[i].stitle;break}if("onetime"==$rootScope.specials[i].freq&&moment().isBetween(moment($rootScope.specials[i].sdate),moment($rootScope.specials[i].edate),"day","[]")){vm.answers[j].sp_bc=$rootScope.specials[i].bc,vm.answers[j].sp_fc=$rootScope.specials[i].fc,vm.answers[j].sp_title=$rootScope.specials[i].stitle;break}}}$rootScope.cmrecs=[];for(var i=0;i<mrecs.length;i++)mrecs[i].category==$rootScope.cCategory.id&&$rootScope.cmrecs.push(mrecs[i]);vm.isLoading=!1}function getDistances(){for(var p=.017453292519943295,c=Math.cos,a=0,lat_o=$rootScope.currentUserLatitude,lng_o=$rootScope.currentUserLongitude,lat=0,lng=0,dist_mi=0,i=0;i<vm.answers.length;i++)lat=vm.answers[i].lat,lng=vm.answers[i].lng,a=.5-c((lat-lat_o)*p)/2+c(lat_o*p)*c(lat*p)*(1-c((lng-lng_o)*p))/2,dist_mi=12742*Math.asin(Math.sqrt(a))/1.609,vm.answers[i].dist=dist_mi<1?dist_mi.toPrecision(2):dist_mi.toPrecision(3),vm.answers[i].dist>2e3&&(vm.answers[i].dist=void 0)}function createAnswerStatus(){answersFull=!1}function rankPersonal(){$rootScope.isLoggedIn?$rootScope.cmrecs_user.length>0?(vm.selOverall="",vm.selPersonal="active",vm.numContributors=1,rank.computeRanking($rootScope.canswers,$rootScope.cmrecs_user)):dialog.getDialog("noPersonalRank"):dialog.getDialog("notLoggedIn")}function rankOverall(){vm.selOverall="active",vm.selPersonal="",vm.numContributors=$rootScope.cuseractivity.length,rank.computeRanking($rootScope.canswers,$rootScope.cmrecs)}function sortByRank(){function compare(a,b){return a.Rank<1||b.Rank<1?b.Rank-a.Rank:a.Rank-b.Rank}vm.answers=vm.answers.sort(compare),getDisplayImages(),$rootScope.canswers=vm.answers,vm.selRank="active",vm.selDistance="",vm.selUpV="",vm.selDate="",vm.selTrending="",vm.sortByName="Rank",vm.showR=!0}function sortByDistance(){function compare(a,b){return a.dist-b.dist}vm.haveLocation?(vm.answers=vm.answers.sort(compare),getDisplayImages(),$rootScope.canswers=vm.answers,vm.selRank="",vm.selDistance="active",vm.selUpV="",vm.selDate="",vm.selTrending="",foodNearMe&&(vm.answers=vm.answers.slice(0,99)),vm.sortByName="Distance"):($rootScope.loadRankWhenCoordsRdy=!0,$rootScope.rankIsNearMe=!0,dialog.askPermissionToLocate(),vm.sortByName="Distance")}function sortByUpV(){function compare(a,b){return b.upV-b.downV-(a.upV-a.downV)}vm.answers=vm.answers.sort(compare),getDisplayImages(),$rootScope.canswers=vm.answers,vm.selRank="",vm.selDistance="",vm.selUpV="active",vm.selDate="",vm.selTrending="",vm.sortByName="Popular",foodNearMe||vm.isE||(vm.showR=!vm.sm)}function sortByTrending(){function compare(a,b){return 0==a.trendUpV&&0==b.trendUpV?b.upV-a.upV:b.trendUpV-a.trendUpV}vm.answers=vm.answers.sort(compare),getDisplayImages(),$rootScope.canswers=vm.answers,vm.selRank="",vm.selDistance="",vm.selUpV="",vm.selDate="",vm.selTrending="active",vm.sortByName="Trending",foodNearMe||vm.isE||(vm.showR=!vm.sm)}function sortByDate(){function compare(a,b){return datetime.date2number(a.date)-datetime.date2number(b.date)}vm.answers=vm.answers.sort(compare),getDisplayImages(),$rootScope.canswers=vm.answers,vm.selRank="",vm.selDistance="",vm.selUpV="",vm.selDate="active",vm.selTrending="",vm.sortByName="Date"}function loadComments(){commentops.loadComments("category",cObj).then(function(){$q.all(cObj.comments.map(function(comment){return fbusers.getFBUserById(comment.user)})).then(function(fbUsers){for(var i=0;i<cObj.comments.length;i++)cObj.comments[i].picture=fbUsers[i]?fbUsers[i].picture.data.url:null})})}function postComment(){commentops.postComment("category",cObj)}function getDisplayImages(){vm.image1=$rootScope.EMPTY_IMAGE,vm.image2=$rootScope.EMPTY_IMAGE,vm.image3=$rootScope.EMPTY_IMAGE,vm.answers[0]&&(vm.image1=vm.answers[0].imageurl),vm.answers[1]&&(vm.image2=vm.answers[1].imageurl),vm.answers[2]&&(vm.image3=vm.answers[2].imageurl)}function closeRank(){$rootScope.cCategory.title.indexOf("@")>-1?$state.go("answerDetail",{index:$rootScope.cCategory.owner}):$state.go("cwrapper")}function closeAddInfoMsg(){$rootScope.addInfoMsgAck=!0,vm.hideInfoBox=!0,vm.addInfoMsgAck=!0}function whyNoDistance(){dialog.getLocation(callGetLocation)}function gotoParentRank(){updateRecords(),$state.go("rankSummary",{index:vm.parentRank.id})}function callGetLocation(){console.log("emitGetLocation"),$rootScope.$emit("getLocation")}function checkUserCredentials(){if(0!=$rootScope.cCategory.owner&&void 0!=$rootScope.cCategory.owner&&(vm.hasAnswerParent=!0),$rootScope.isLoggedIn&&vm.hasAnswerParent){var idx=$rootScope.answers.map(function(x){return x.id}).indexOf(Number($rootScope.cCategory.owner)),owner=$rootScope.answers[idx].owner;$rootScope.user.id==owner&&(vm.userIsOwner=!0)}}function mergeObject(x,y){x.bc=y.bc,x.fc=y.fc,x.freq=y.freq,x.edate=y.edate,x.sdate=y.sdate,x.etime=y.etime,x.etime2=y.etime2,x.stime=y.stime,x.stime2=y.stime2,x.mon=y.mon,x.tue=y.tue,x.wed=y.wed,x.thu=y.thu,x.fri=y.fri,x.sat=y.sat,x.sun=y.sun}function cmFlag(x){if($rootScope.isLoggedIn)return $rootScope.DEBUG_MODE&&console.log("Comment Flagged"),flag.flagAnswer("comment-rank",$rootScope.cCategory.id,x),
void dialog.getDialog("commentFlagged");dialog.loginFacebook()}function share(){vm.linkurl=SERVER_URL+"rank"+$rootScope.cCategory.id+".html",vm.tweet=$rootScope.cCategory.title+", endorse your favorite ones at: ";var imageurl=$rootScope.cCategory.image1url;"Short-Phrase"==$rootScope.cCategory.type&&(imageurl="https://rank-x.com/assets/images/rankxlogosd2_sm.png"),dialog.shareOptions(shareFunction,vm.isMobile,vm.linkurl,"Rank-X, "+vm.ranking+", "+$rootScope.cCategory.question+"\n"+imageurl,$scope)}function shareFunction(x){var imageurl=$rootScope.cCategory.image1url;switch("Short-Phrase"==$rootScope.cCategory.type&&(imageurl="https://rank-x.com/assets/images/rankxlogosd2_sm.png"),x){case"twitter":$rootScope.DEBUG_MODE&&console.log(x),Socialshare.share({provider:"twitter",attrs:{socialshareUrl:vm.linkurl,socialshareText:vm.tweet,socialshareHashtags:"rankxsandiego"}});break;case"facebook":$rootScope.DEBUG_MODE&&console.log(x),FB.ui({method:"feed",link:vm.linkurl,caption:"Rank-X San Diego"},function(response){});break;case"email":$rootScope.DEBUG_MODE&&console.log(x),Socialshare.share({provider:"email",attrs:{socialshareSubject:"Rank-X, "+vm.ranking,socialshareBody:vm.linkurl}});break;case"gplus":$rootScope.DEBUG_MODE&&console.log(x),Socialshare.share({provider:"google",attrs:{socialshareUrl:vm.linkurl,socialshareText:vm.ranking+", "+$rootScope.cCategory.question,socialshareMedia:imageurl}});break;case"pinterest":$rootScope.DEBUG_MODE&&console.log(x),Socialshare.share({provider:"pinterest",attrs:{socialshareUrl:vm.linkurl,socialshareText:"Rank-X, "+vm.ranking+", "+$rootScope.cCategory.question,socialshareMedia:imageurl}});break;case"tumblr":$rootScope.DEBUG_MODE&&console.log(x),Socialshare.share({provider:"tumblr",attrs:{socialshareUrl:vm.linkurl,socialshareText:"Rank-X, "+vm.ranking+", "+$rootScope.cCategory.question,socialshareMedia:imageurl}});break;case"reddit":$rootScope.DEBUG_MODE&&console.log(x),Socialshare.share({provider:"reddit",attrs:{socialshareUrl:vm.linkurl,socialshareText:"Rank-X, "+vm.ranking,socialshareSubreddit:$rootScope.cCategory.question}})}}function changeMode(mode){vm.mode=mode}function displayVote(x){$rootScope.isLoggedIn?(1==x.dV&&(x.thumbUp="#0070c0",x.thumbDn="#bfbfbf"),0==x.dV&&(x.thumbUp="#bfbfbf",x.thumbDn="#bfbfbf"),-1==x.dV&&(x.thumbUp="#bfbfbf",x.thumbDn="#0070c0")):(x.thumbUp="#bfbfbf",x.thumbDn="#bfbfbf")}function UpVote(x,event){if(!$rootScope.isLoggedIn)return void dialog.loginFacebook();switch(x.dV){case-1:x.dV=1,x.upV++,x.downV--;break;case 0:x.dV=1,x.upV++;break;case 1:x.dV=0,x.upV--}1==x.dV&&addAnswer4Rank(x),-1!=x.dV&&0!=x.dV||removeAnswer4Rank(x),displayVote(x),$rootScope.DEBUG_MODE&&console.log("UpVote")}function addAnswer4Rank(x){$rootScope.canswers4rank.push(x),updateStatusRankButton()}function removeAnswer4Rank(x){var i=$rootScope.canswers4rank.map(function(x){return x.id}).indexOf(x.id);i>-1&&$rootScope.canswers4rank.splice(i,1),updateStatusRankButton()}function DownVote(x,event){if(!$rootScope.isLoggedIn)return void dialog.loginFacebook();switch(x.dV){case-1:x.dV=0,x.downV--;break;case 0:x.dV=-1,x.downV++;break;case 1:x.dV=-1,x.upV--,x.downV++}-1!=x.dV&&0!=x.dV||removeAnswer4Rank(x),displayVote(x),$rootScope.DEBUG_MODE&&console.log("DownVote")}function getAnswerVotes(){for(var i=0;i<vm.answers.length;i++){vm.answers[i].voteRecordExists=!1;for(var j=0;j<$rootScope.cvotes.length;j++)if($rootScope.cvotes[j].catans==vm.answers[i].catans){vm.answers[i].uservote=$rootScope.cvotes[j],vm.answers[i].uservote.ansvidx=i,vm.answers[i].voteRecordExists=!0;break}vm.answers[i].voteRecordExists?vm.answers[i].dV=vm.answers[i].uservote.vote:vm.answers[i].dV=0,displayVote(vm.answers[i])}}function updateRecords(){if($rootScope.DEBUG_MODE&&console.log("UpdateRecords @answerDetail"),vm.answers&&void 0!=$rootScope.cCategory)for(var i=0;i<vm.answers.length;i++){var voteRecordExists=vm.answers[i].voteRecordExists,userHasRank=!1,useractivityrec={};try{var idx=$rootScope.thisuseractivity.map(function(x){return x.category}).indexOf($rootScope.cCategory.id)}catch(err){console.log("Error: ",err),console.log("$rootScope.cCategory - ",$rootScope.cCategory);var idx=-1}idx>=0?(userHasRank=!0,useractivityrec=$rootScope.thisuseractivity[idx]):userHasRank=!1,voteRecordExists&&vm.answers[i].uservote.vote!=vm.answers[i].dV&&0!=vm.answers[i].dV&&($rootScope.DEBUG_MODE&&console.log("UR-1"),votes.patchRec(vm.answers[i].uservote.id,vm.answers[i].dV)),voteRecordExists&&vm.answers[i].uservote.vote!=vm.answers[i].dV&&0==vm.answers[i].dV&&($rootScope.DEBUG_MODE&&console.log("UR-2"),votes.deleteRec(vm.answers[i].uservote.id),useractivityrec.votes<2?($rootScope.DEBUG_MODE&&console.log("UR-3"),useractivity.deleteRec(useractivityrec.id)):($rootScope.DEBUG_MODE&&console.log("UR-4"),useractivity.patchRec(useractivityrec.id,useractivityrec.votes-1))),voteRecordExists||0==vm.answers[i].dV||($rootScope.DEBUG_MODE&&console.log("UR-5"),votes.postRec(vm.answers[i].catans,vm.answers[i].id,$rootScope.cCategory.id,vm.answers[i].dV),userHasRank?($rootScope.DEBUG_MODE&&console.log("UR-6"),useractivity.patchRec(useractivityrec.id,useractivityrec.votes+1)):($rootScope.DEBUG_MODE&&console.log("UR-7"),useractivity.postRec($rootScope.cCategory.id))),vm.answers[i].upV==vm.answers[i].upVi&&vm.answers[i].downV==vm.answers[i].downVi||($rootScope.DEBUG_MODE&&console.log("UR-8"),catans.updateRec(vm.answers[i].catans,["upV","downV"],[vm.answers[i].upV,vm.answers[i].downV]))}if(vm.vrows)for(var i=0;i<vm.vrows.length;i++){var voteRecExists=vm.vrows[i].voteExists;voteRecExists&&vm.vrows[i].dVi!=vm.vrows[i].dV&&($rootScope.DEBUG_MODE&&console.log("UR-9"),$rootScope.cvrowvotes[vm.vrows[i].vidx].val=vm.vrows[i].dV,vrowvotes.patchRec(vm.vrows[i].voteid,vm.vrows[i].dV)),voteRecExists||0==vm.vrows[i].dV||($rootScope.DEBUG_MODE&&console.log("UR-10"),vrowvotes.postRec(vm.vrows[i].id,vm.vrows[i].dV)),vm.vrows[i].upV==vm.vrows[i].upVi&&vm.vrows[i].downV==vm.vrows[i].downVi||($rootScope.DEBUG_MODE&&console.log("UR-11"),vrows.updateRec(vm.vrows[i].id,["upV","downV"],[vm.vrows[i].upV,vm.vrows[i].downV]))}}function sortbyHelpDialog(){dialog.sortbyHelpDialog()}function backToResults(){"trends"==$rootScope.previousState?$state.go("trends"):$rootScope.$emit("backToResults")}function seeMore(){vm.limit=vm.limit+20,loadTrendVotes(vm.limit-20),vm.answers.length>vm.limit?vm.thereIsMore=!0:vm.thereIsMore=!1}function loadTrendVotes(x){var answerIDs=vm.answers.map(function(answer){return answer.id});answerIDs.length>0&&votes.loadLastMonthVoting(answerIDs.slice(x,x+20)).then(function(resp){resp.forEach(function(vote){var idx=answerIDs.indexOf(vote.answer);void 0==vm.answers[idx].trendUpV&&(vm.answers[idx].trendUpV=0),vm.answers[idx].trendUpV++})})}function loadFriendsEndorsements(x){var ansIds=vm.answers,idx=-1,cidx=-1,ridx=-1;ansIds.forEach(function(answer){answer.userObjs=[];for(var i=0;i<$rootScope.friends_votes.length;i++)if($rootScope.friends_votes[i].answer==answer.id){var friend=getUser($rootScope.friends_votes[i]);friend&&(cidx=$rootScope.catansrecs.map(function(x){return x.id}).indexOf($rootScope.friends_votes[i].catans),cidx>-1&&(ridx=$rootScope.content.map(function(x){return x.id}).indexOf($rootScope.catansrecs[cidx].category)),idx=answer.userObjs.map(function(x){return x.id}).indexOf(friend.id),idx<0?(friend.endorsements=[],ridx>-1&&friend.endorsements.push($rootScope.content[ridx].title),answer.userObjs.push(friend)):ridx>-1&&answer.userObjs[idx].endorsements.push($rootScope.content[ridx].title))}})}function getUser(voterec){for(var i=0;i<$rootScope.user.friends.data.length;i++)if(voterec.user==$rootScope.user.friends.data[i].id)return $rootScope.user.friends.data[i]}function showAllFriendsList(userObjs,answername){dialog.showAllFriendsListDlg(userObjs,answername)}function incViews(){$rootScope.cCategory.views++;var url=SERVER_URL+"databaseOps/incViews/rank/"+$rootScope.cCategory.id;$http({method:"POST",url:url,headers:{"X-Dreamfactory-API-Key":void 0,"X-DreamFactory-Session-Token":void 0}})}function getResults(){var timeoutPromise;$timeout.cancel(timeoutPromise),timeoutPromise=$timeout(function(){vm.answers=[],$rootScope.canswers.forEach(function(cans){(cans.name.toLowerCase().indexOf(vm.val.toLowerCase())>-1||cans.cityarea.toLowerCase().indexOf(vm.val.toLowerCase())>-1)&&vm.answers.push(cans)})},300)}function getFilterOptions(){vm.opts=[],$rootScope.canswers.forEach(function(cans){vm.opts.indexOf(cans.name)<0&&vm.opts.push(cans.name),vm.opts.indexOf(cans.cityarea)<0&&vm.opts.push(cans.cityarea)})}function clearSearch(){vm.val="",vm.answers=$rootScope.canswers}var vm=this;vm.title="rankSummary",vm.addAnswerDisabled="",vm.mode="endorse",vm.answerDetail=answerDetail,vm.addAnswer=addAnswer,vm.goRank=goRank,vm.closeRank=closeRank,vm.rankOverall=rankOverall,vm.rankPersonal=rankPersonal,vm.closeAddInfoMsg=closeAddInfoMsg,vm.whyNoDistance=whyNoDistance,vm.sortByRank=sortByRank,vm.sortByDistance=sortByDistance,vm.sortByUpV=sortByUpV,vm.sortByDate=sortByDate,vm.sortByTrending=sortByTrending,vm.loadComments=loadComments,vm.postComment=postComment,vm.cmFlag=cmFlag,vm.share=share,vm.changeMode=changeMode,vm.UpVote=UpVote,vm.DownVote=DownVote,vm.sortbyHelpDialog=sortbyHelpDialog,vm.backToResults=backToResults,vm.seeMore=seeMore,vm.showAllFriendsList=showAllFriendsList,vm.getResults=getResults,vm.clearSearch=clearSearch,vm.gotoParentRank=gotoParentRank,vm.selOverall="active",vm.selPersonal="",vm.selRank="active",vm.selDistance="",vm.commLoaded=!1,vm.userIsOwner=!1,vm.dataReady=!1,vm.hasAnswerParent=!1,vm.isCustomRank=!1,vm.user=$rootScope.user,vm.loadingAnswers=!1,vm.sortByName="",vm.searchActive=$rootScope.searchActive,vm.limit=20;var answers=[],catansrecs=[],mrecs=[],catArr=[],answersFull=!1,updateExec=!1;vm.foodNearMe=!1;var foodNearMe=!1,rankIsNearMe=!1;vm.fnm=!1;var cObj={};cObj.commLoaded=!1,cObj.initials="",cObj.bc="",cObj.fc="",cObj.comments=[],cObj.newComment="",vm.cm=cObj,vm.isLoggedIn=void 0!=$rootScope.isLoggedIn&&$rootScope.isLoggedIn,$rootScope.userHasRank=!1,$rootScope.userActRecId=0;vm.hideInfoBox=!1,$rootScope.addInfoMsgAck?vm.addInfoMsgAck=$rootScope.addInfoMsgAck:vm.addInfoMsgAck=!1;var updateVoteTableListener=$rootScope.$on("updateVoteTable",function(){updateExec||updateVoteTable(),updateExec=!0}),rankDataLoadedListener=$rootScope.$on("rankDataLoaded",function(){0==vm.dataReady&&checkRankIsLoaded()}),coordsRdyRankListener=$rootScope.$on("coordsRdy",function(){$rootScope.DEBUG_MODE&&console.log("received coordsreadyrank"),vm.haveLocation=!0,getDistances(),sortByDistance(),$timeout(function(){$scope.$apply()})}),stateChangeListener=$rootScope.$on("$stateChangeStart",function(ev,to,toParams,from,fromParams){"rankSummary"==from.name&&"rankSummary"!=to.name&&$rootScope.isLoggedIn&&updateRecords()});$scope.$on("$destroy",stateChangeListener),$scope.$on("$destroy",updateVoteTableListener),$scope.$on("$destroy",rankDataLoadedListener),$scope.$on("$destroy",coordsRdyRankListener),vm.isMobile=!1,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|ipad|iris|kindle|Android|Silk|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(navigator.userAgent)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(navigator.userAgent.substr(0,4)))&&(vm.isMobile=!0),$window.innerWidth<512?(vm.sm=!0,vm.nsm=!1):(vm.sm=!1,vm.nsm=!0),null!=document.getElementById("SearchInput")&&void 0!=document.getElementById("SearchInput")&&document.getElementById("SearchInput").blur(),window.prerenderReady=!1,$rootScope.DEBUG_MODE&&console.log("$rootScope.rankSummaryDataLoaded - ",$rootScope.rankSummaryDataLoaded),$rootScope.DEBUG_MODE&&console.log("$rootScope.isCustomRank - ",$rootScope.isCustomRank),$rootScope.DEBUG_MODE&&console.log("$stateParams.index - ",$stateParams.index),$rootScope.DEBUG_MODE&&console.log("$rootScope.cCategory - ",$rootScope.cCategory.id,$rootScope.cCategory.cat),checkRankIsLoaded()}angular.module("app").controller("rankSummary",rankSummary),rankSummary.$inject=["dialog","$stateParams","$state","catans","datetime","color","locations","answer","rank","$filter","table","vrowvotes","$window","vrows","$scope","$http","$rootScope","$modal","editvote","votes","commentops","flag","Socialshare","SERVER_URL","$location","$q","fbusers","$timeout","table2","categories","dataloader","common"]}(),function(){"use strict";function promoter($http,$q,$rootScope){function getall(forceRefresh){if(_arepromotersLoaded()&&!forceRefresh)return $q.when(_promoters);var url0=baseURI+"?offset=0",p0=$http.get(url0);return $q.all([p0]).then(function(d){return _promoters=d[0].data.resource,$rootScope.DEBUG_MODE&&console.log("No. promoters: ",_promoters.length),_promoters},_queryFailed)}function get(id){function querySucceeded(result){return _promoter=result.data.resource}var url=baseURI+"/"+id;return $http.get(url).then(querySucceeded,_queryFailed)}function getbyUser(user){function querySucceeded(result){return _promoter=result.data.resource}var url=baseURI+"/?filter=user="+user;return $http.get(url).then(querySucceeded,_queryFailed)}function getbyCode(code){function querySucceeded(result){return _promoter=result.data.resource}var url=baseURI+"/?filter=code="+code;return $http.get(url).then(querySucceeded,_queryFailed)}function add(promoter){function querySucceeded(result){var promoterx=promoter;return promoterx.id=result.data.resource[0].id,_promoters.push(promoterx),result.data}var url=baseURI,resource=[];return resource.push(promoter),$http.post(url,resource,{headers:{"Content-Type":"multipart/form-data"},body:resource}).then(querySucceeded,_queryFailed)}function update(promoter_id,field,val){function querySucceeded(result){return $rootScope.DEBUG_MODE&&console.log("updating promoter succesful"),result.data}var obj={};obj.resource=[];var data={};data.id=promoter_id;for(var i=0;i<field.length;i++)switch(field[i]){case"firstname":data.firstname=val[i];break;case"lastname":data.lastname=val[i];break;case"email":data.email=val[i];break;case"address":data.address=val[i];break;case"phone":data.phone=val[i];break;case"code":data.code=val[i];break;case"stripeid":data.stripeid=val[i]}obj.resource.push(data);for(var url=baseURI,idx=_promoter.map(function(x){return x.id}).indexOf(promoter_id),i=0;i<field.length;i++)switch(field[i]){case"firstname":_promoter[idx].firstname=val[i];break;case"lastname":_promoter[idx].lastname=val[i];break;case"email":_promoter[idx].email=val[i];break;case"address":_promoter[idx].address=val[i];break;case"phone":_promoter[idx].phone=val[i];break;case"code":_promoter[idx].code=val[i];break;case"stripeid":_promoter[idx].stripeid=val[i]}return $http.patch(url,obj,{headers:{"Content-Type":"multipart/form-data"},body:obj}).then(querySucceeded,_queryFailed)}function deletepromoter(promoter_id){function querySucceeded(result){return $rootScope.DEBUG_MODE&&console.log("Deleting promote was succesful"),result.data}var obj={};obj.resource=[];var data={};data.id=promote_id,obj.resource.push(data);var url=baseURI+"/"+promoter_id,i=_promoters.map(function(x){return x.id}).indexOf(promoter_id);return i>-1&&_promoters.splice(i,1),$http.delete(url,data,{headers:{"Content-Type":"multipart/form-data"},body:obj}).then(querySucceeded,_queryFailed)}function getbycode(code){function querySucceeded(result){return _promoter=result.data.resource}var url=baseURI+"/?filter=code="+code;return $http.get(url).then(querySucceeded,_queryFailed)}function _arepromotersLoaded(){return _promoters.length>0}function _queryFailed(error){throw error}var _promoters=[],_promoter={},baseURI="/api/v2/mysql/_table/promoters";return{getall:getall,get:get,getbyUser:getbyUser,getbyCode:getbyCode,add:add,update:update,deletepromoter:deletepromoter,getbycode:getbycode}}angular.module("app").factory("promoter",promoter),promoter.$inject=["$http","$q","$rootScope"]}(),function(){"use strict";function userdata($rootScope,votes,editvote,vrowvotes,useraccnt,answer,table2,catans,special,dataloader,useractivity,$q,promoter,categorycode,codeprice,$http,SERVER_URL){function loadUserData(){if($rootScope.isLoggedIn){$rootScope.DEBUG_MODE&&console.log("user is logged in, loading data");var p0=votes.loadVotesByUser(),p1=editvote.loadEditVotesTable(),p2=vrowvotes.loadVrowVotes(),p3=useractivity.getActivitybyUser(),p4=promoter.getbyUser($rootScope.user.id),p5=categorycode.get(),p6=codeprice.get(),p7=votes.loadVotesByMyFriends();return $q.all([p0,p1,p2,p3,p4,p5,p6,p7]).then(function(d){$rootScope.cvotes=d[0],$rootScope.editvotes=d[1],$rootScope.cvrowvotes=d[2],$rootScope.thisuseractivity=d[3],$rootScope.userpromoter=d[4],$rootScope.catcodes=d[5],$rootScope.codeprices=d[6],$rootScope.friends_votes=d[7],dataloader.getDemoData(),$rootScope.DEBUG_MODE&&console.log("user promoter - ",$rootScope.userpromoter),$rootScope.userDataLoaded=!0,$rootScope.$emit("userDataLoaded")})}$rootScope.DEBUG_MODE&&console.log("user is not logged in, no need to load data"),$rootScope.cvotes=[],$rootScope.editvotes=[],$rootScope.cvrowvotes=[],$rootScope.thisuseractivity=[],$rootScope.userpromoter=[],$rootScope.catcodes=[],$rootScope.codeprices=[],$rootScope.userDataLoaded=!0,$rootScope.$emit("userDataLoaded")}function loadUserAccount(){$rootScope.isLoggedIn&&($rootScope.DEBUG_MODE&&console.log("user is logged in, loading loading user accounts data"),useraccnt.getuseraccnt().then(function(result){function succeedFunc(result){useraccnt.customer=result.data,syncDatatoAnswers()}if($rootScope.showWarning=!1,$rootScope.useraccnts.length>0){for(var missingEmail=!0,url="",i=0;i<$rootScope.useraccnts.length;i++)if(""!=$rootScope.useraccnts[i].email&&(missingEmail=!1),void 0!=$rootScope.useraccnts[i].stripeid&&""!=$rootScope.useraccnts[i].stripeid&&0!=$rootScope.useraccnts[i].stripeid){url=SERVER_URL+"dreamfactory-stripe-user/"+$rootScope.useraccnts[i].stripeid+"/"+$rootScope.useraccnts[i].id;var useraccnt=$rootScope.useraccnts[i],req={method:"GET",url:url,headers:{"X-Dreamfactory-API-Key":void 0,"X-DreamFactory-Session-Token":void 0}};$http(req).then(succeedFunc,function(error){console.log("Error updating Stripe Invoices - ",error)}),$rootScope.DEBUG_MODE&&console.log("Retrieving latest invoice info from Stripe")}$rootScope.$emit("userAccountsLoaded"),missingEmail?($rootScope.showWarning=!0,$rootScope.$emit("showWarning")):$rootScope.showWarning=!1}}))}function syncDatatoAnswers(){if($rootScope.isLoggedIn&&$rootScope.rankSummaryDataLoaded){$rootScope.DEBUG_MODE&&console.log("Syncing useraccnt data to answers");for(var idx=0,i=0;i<$rootScope.useraccnts.length;i++){var fields=[],vals=[];idx=$rootScope.answers.map(function(x){return x.id}).indexOf($rootScope.useraccnts[i].answer),$rootScope.answers[idx].ispremium!=$rootScope.useraccnts[i].ispremium&&(fields.push("ispremium"),vals.push($rootScope.useraccnts[i].ispremium)),$rootScope.answers[idx].hasranks!=$rootScope.useraccnts[i].hasranks&&(fields.push("hasranks"),vals.push($rootScope.useraccnts[i].hasranks)),$rootScope.answers[idx].ranksqty!=$rootScope.useraccnts[i].ranksqty&&(fields.push("ranksqty"),vals.push($rootScope.useraccnts[i].ranksqty)),fields.length>0&&answer.updateAnswer($rootScope.answers[idx].id,fields,vals)}}}function pullFavoriteData(){for(var favans=[],obj={},i=0;i<$rootScope.cvotes.length;i++)obj={},obj.id=$rootScope.cvotes[i].answer,obj.answer=$rootScope.cvotes[i].answer,favans.push(obj);dataloader.pulldata("answers",favans),$rootScope.friendsVotes=!0;for(var friendsans=[],i=0;i<$rootScope.friends_votes.length;i++)obj={},obj.id=$rootScope.friends_votes[i].answer,obj.answer=$rootScope.friends_votes[i].answer,friendsans.push(obj);dataloader.pulldata("answers",friendsans)}return{loadUserData:loadUserData,loadUserAccount:loadUserAccount,pullFavoriteData:pullFavoriteData}}angular.module("app").service("userdata",userdata),userdata.$inject=["$rootScope","votes","editvote","vrowvotes","useraccnt","answer","table2","catans","special","dataloader","useractivity","$q","promoter","categorycode","codeprice","$http","SERVER_URL"]}(),function(){"use strict";function useraccnt($http,$q,$rootScope,login,SERVER_URL){function payPromoter(promoter,STRIPE_COMMISSION_PERCENTAGE){var url=SERVER_URL+"stripeServer/payPromoter",req={method:"POST",url:url,data:{stripeId:promoter.stripeid,promoterId:promoter.id,amount:promoter.balance*STRIPE_COMMISSION_PERCENTAGE},headers:{"X-Dreamfactory-API-Key":void 0,"X-DreamFactory-Session-Token":void 0}};return $http(req).then(function(result){return result})}function deleteAccount(stripeid,accountId,answerId){function querySucceeded(result){var ind=_useraccnts.map(function(acc){return acc.id}).indexOf(result.data.id);return _useraccnts.splice(ind,1),result}var url=baseURI+"/"+accountId;return $http.delete(url).then(querySucceeded,_queryFailed)}function getuseraccntInvoicesAndCustomer(stripeid){return $http({method:"GET",url:SERVER_URL+"stripeServer/"+stripeid+"/invoices",headers:{"X-Dreamfactory-API-Key":void 0,"X-DreamFactory-Session-Token":void 0}}).then(function(result){return result.data})}function getallaccnts(){function querySucceeded(result){return _useraccnts=result.data.resource}var url=baseURI;return $http.get(url).then(querySucceeded,_queryFailed)}function getuseraccnt(){function querySucceeded(result){return _load(result.data.resource),_useraccnts}var url=baseURI+"?filter=(user="+$rootScope.user.id+")";return $http.get(url).then(querySucceeded,_queryFailed)}function getuseraccntans(answer){function querySucceeded(result){return result.data.resource}var url=baseURI+"?filter=(user="+$rootScope.user.id+") AND (answer="+answer+")";return $http.get(url).then(querySucceeded,_queryFailed)}function getaccntsbycode(code){function querySucceeded(result){return _promoteraccnts=result.data.resource}var url=baseURI+"?filter=(promocode="+code+")";return $http.get(url).then(querySucceeded,_queryFailed)}function adduseraccnt(answer){function querySucceeded(result){var datax=data;return datax.id=result.data.resource[0].id,_useraccnts.push(datax),datax}var data={};data.user=$rootScope.user.id,data.answer=answer.id,data.bizcat=getBizCat(answer.id),data.status="Basic",data.stripeid="0",data.email=$rootScope.user.email,data.username=$rootScope.user.name;var obj={};obj.resource=[],obj.resource.push(data);var url=baseURI;return $http.post(url,obj,{headers:{"Content-Type":"multipart/form-data"},body:obj}).then(querySucceeded,_queryFailed)}function updateuseraccnt(recid,field,val){function querySucceeded(result){return $rootScope.$emit("clear-notification-warning"),result.data}var obj={};obj.resource=[];var data={};data.id=recid;for(var i=0;i<field.length;i++)switch(field[i]){case"bizcat":data.bizcat=val[i];break;case"email":data.email=val[i];break;case"status":data.status=val[i];break;case"stripeid":data.stripeid=val[i];break;case"ispremium":data.ispremium=val[i];break;case"hasranks":data.hasranks=val[i];break;case"ranksqty":data.ranksqty=val[i];break;case"name":data.name=val[i]}obj.resource.push(data);for(var url=baseURI,idx=_useraccnts.map(function(x){return x.id}).indexOf(recid),i=0;i<field.length;i++)switch(field[i]){case"bizcat":_useraccnts[idx].bizcat=val[i];break;case"email":_useraccnts[idx].email=val[i];break;case"status":_useraccnts[idx].status=val[i];break;case"stripeid":_useraccnts[idx].stripeid=val[i];break;case"ispremium":_useraccnts[idx].ispremium=val[i];break;case"hasranks":_useraccnts[idx].hasranks=val[i];break;case"ranksqty":_useraccnts[idx].ranksqty=val[i];break;case"name":_useraccnts[idx].name=val[i]}return $http.patch(url,obj,{headers:{"Content-Type":"multipart/form-data"},body:obj}).then(querySucceeded,_queryFailed)}function getBizCat(answerid){for(var category=0,rank={},bizcat="",scale_current=0,scale_this=0,j=0;j<$rootScope.catansrecs.length;j++)if($rootScope.catansrecs[j].answer==answerid){category=$rootScope.catansrecs[j].category;var idx=$rootScope.content.map(function(x){return x.id}).indexOf(category);if(idx>-1){if(rank=$rootScope.content[idx],null!=rank.title)for(var k=0;k<$rootScope.catcodes.length;k++)if(rank.title.indexOf($rootScope.catcodes[k].category)>-1)if(""==bizcat)bizcat=$rootScope.catcodes[k].code;else{for(var l=0;l<$rootScope.codeprices.length;l++)$rootScope.codeprices[l].code==bizcat&&(scale_current=$rootScope.codeprices[l].scale),$rootScope.codeprices[l].code==$rootScope.catcodes[k].code&&(scale_this=$rootScope.codeprices[l].scale);scale_this>scale_current&&(bizcat=$rootScope.catcodes[k].code)}}else $rootScope.DEBUG_MODE&&console.log("Couldnt find rank: ",category)}return bizcat}function _load(data){_useraccnts.length=0,data.forEach(function(x){_useraccnts.push(x)})}function _queryFailed(error){throw error}var _useraccnts=[];$rootScope.useraccnts=_useraccnts;var _promoteraccnts=[],baseURI="/api/v2/mysql/_table/useraccnts";return{getuseraccnt:getuseraccnt,getaccntsbycode:getaccntsbycode,getuseraccntans:getuseraccntans,getallaccnts:getallaccnts,adduseraccnt:adduseraccnt,updateuseraccnt:updateuseraccnt,getuseraccntInvoicesAndCustomer:getuseraccntInvoicesAndCustomer,deleteAccount:deleteAccount,payPromoter:payPromoter,getBizCat:getBizCat}}angular.module("app").factory("useraccnt",useraccnt),useraccnt.$inject=["$http","$q","$rootScope","login","SERVER_URL"]}(),function(){"use strict";function login($http,$q,$cookies,$rootScope,INSTANCE_URL,$state,$location,$window,$facebook,fbusers){function facebookSDKLogin(){return service.loginWithFacebook().then(function(res){return $facebook.login("public_profile,email,user_friends").then(function(res){if("connected"===res.status)return $facebook.api("/me?fields=id,name,picture,first_name,last_name,gender,age_range,locale,email")}).then(function(me){return $rootScope.DEBUG_MODE&&console.log("My info: ",me),$rootScope.user=me,$facebook.api("me/friends?fields=first_name,gender,locale,last_name,email,picture")}).then(function(friends){$rootScope.DEBUG_MODE&&console.log("Got friends: ",friends),$rootScope.user.friends=friends,$rootScope.isLoggedIn=!0,fbusers.addFBUser($rootScope.user);try{window.localStorage.user=JSON.stringify($rootScope.user)}catch(e){}$rootScope.DEBUG_MODE&&console.log("oauthWithFacebook succesful")}).catch(function(err){console.log(err)})})}function initiate(options){return console.log("login/services/login.svc.js:initiate"),$http.post("/api/v2/user/session",options).then(function(result){$http.defaults.headers.common["X-DreamFactory-Session-Token"]=result.data.session_token,$cookies.session_token=result.data.session_token,$rootScope.user=result.data;try{window.localStorage.user=JSON.stringify(result.data)}catch(e){}})}function loginWithFacebook(){$rootScope.DEBUG_MODE&&console.log("@loginWithFacebook");var statename="",statenum=0,ccategory=0;statename=void 0==$rootScope.stateName?$state.current.name:$rootScope.stateName,void 0==$rootScope.stateName?("rankSummary"==statename&&(statenum=$rootScope.cCategory.id),"answerDetail"==statename&&(statenum=$rootScope.canswer.id)):statenum=$rootScope.stateNum,ccategory=void 0!=$rootScope.cCategory?$rootScope.cCategory.id:void 0,$cookies.put("statename",statename),$cookies.put("statenum",statenum),$cookies.put("ccategory",ccategory);var deferred=$q.defer(),url=INSTANCE_URL+"/api/v2/user/session?service=facebook";return deferred.resolve({url:url}),deferred.promise}function oauthWithFacebook(queryString){function querySucceeded(result){console.log("oauth results",result),$http.defaults.headers.common["X-DreamFactory-Session-Token"]=result.data.session_token,$cookies.session_token=result.data.session_token,$rootScope.user=result.data,$rootScope.isLoggedIn=!0;try{window.localStorage.user=JSON.stringify(result.data)}catch(e){}$rootScope.DEBUG_MODE&&console.log("oauthWithFacebook succesful"),$rootScope.$emit("redirectAfterLogin")}return $rootScope.DEBUG_MODE&&console.log("@oauthWithFacebook - ",queryString),$http.post("/api/v2/user/session?oauth_callback=true&service=facebook&"+queryString).then(querySucceeded,_queryFailed)}function logout(){return $http.delete("/api/v2/user/session").then(function(result){delete $http.defaults.headers.common["X-DreamFactory-Session-Token"],$cookies.remove("session_token"),delete $rootScope.user,$rootScope.isLoggedIn=!1,$rootScope.isAdmin=!1,$rootScope.dataAdmin=!1,$rootScope.$emit("adminCredentials");try{window.localStorage.removeItem("user")}catch(e){}})}function _queryFailed(error){throw console.log("error",error),error}function register(options){return console.log("options",options),$http.post("/api/v2/user/register?login=true",options).then(function(result){console.log("register result",result)},function(error){console.log("error",error)})}function setFakeLocalUser(){$rootScope.isLoggedIn=!0;var fakeResult=new Object;fakeResult.age_range={min:21},fakeResult.first_name="Test",fakeResult.friends={data:[{first_name:"John",gender:"male",id:"362411340826490",last_name:"Carter",locale:"en_US",picture:{data:{is_silhouette:!1,url:"https://scontent.xx.fbcdn.net/v/t1.0-1/p50x50/18034179_362408994160058_2814191765613662934_n.jpg?oh=03f00905624bc37bc3f57b76148a44aa&oe=59BC08B8"}}},{first_name:"John",gender:"male",id:"398314100568945",last_name:"Will",locale:"en_US",picture:{data:{is_silhouette:!1,url:"https://scontent.xx.fbcdn.net/v/t1.0-1/p50x50/14915696_288291968237826_1651783963192855784_n.jpg?oh=18bee38eafb63165ac9ecf37d649d8ee&oe=597C137F"}}}],summary:{}},fakeResult.gender="male",fakeResult.id="187959328383879",fakeResult.email="roy.smith0820@gmail.com",fakeResult.last_name="User",fakeResult.locale="us_EN",fakeResult.name="Test User",fakeResult.picture={data:{url:"https://scontent.xx.fbcdn.net/v/t1.0-1/p50x50/18057110_194133167766495_4123816583005617544_n.jpg?oh=7dc367a88a4d28f4f84137f9007f847e&oe=59836C25"}},$rootScope.isAdmin=!0,fakeResult.is_sys_admin=!0,$cookies.session_token=fakeResult.session_token,$rootScope.user=fakeResult;try{return window.localStorage.user=JSON.stringify(fakeResult),{email:fakeResult.email,first_name:fakeResult.first_name,host:fakeResult.host,id:fakeResult.id,is_sys_admin:fakeResult.is_sys_admin,last_login_date:fakeResult.last_login_date,last_name:fakeResult.last_name,name:fakeResult.name,role:fakeResult.role,role_id:fakeResult.role_id,session_id:fakeResult.session_id,session_token:fakeResult.session_token}}catch(e){}}var service={initiate:initiate,loginWithFacebook:loginWithFacebook,oauthWithFacebook:oauthWithFacebook,register:register,logout:logout,
setFakeLocalUser:setFakeLocalUser,facebookSDKLogin:facebookSDKLogin};return service}angular.module("app").factory("login",login),login.$inject=["$http","$q","$cookies","$rootScope","INSTANCE_URL","$state","$location","$window","$facebook","fbusers"]}(),function(){"use strict";angular.module("login",["ngCookies","ui.router"]).run(["$rootScope",function($rootScope){try{$rootScope.user=JSON.parse(window.localStorage.user),$rootScope.user&&($rootScope.isLoggedIn=!0),$rootScope.user.is_sys_admin&&($rootScope.isAdmin=!0)}catch(e){}}]).config(function(){})}(),function(){"use strict";function httpInterceptor($location,$q,$injector,INSTANCE_URL){function request(config){return config.url.indexOf("/api/v2")>-1&&(config.url=INSTANCE_URL+config.url),config.url.indexOf("api.instagram.com")>-1&&(config.headers.useXDomain=!0,config.headers.common="Content-Type: application/json",delete config.headers.common["X-Requested-With"],delete config.headers["X-DreamFactory-Session-Token"],delete config.headers["X-Dreamfactory-API-Key"]),"post"===config.method.toLowerCase()&&config.url.indexOf("/api/v2/user/session")>-1&&delete config.headers["X-DreamFactory-Session-Token"],config}function responseError(result){return 302==result.status?($location.path("/login"),$q.reject(result)):((401===result.status||403===result.status&&result.data.error.message.indexOf("token")>-1)&&$location.path("/login"),$q.reject(result))}return{request:request,responseError:responseError}}angular.module("login").factory("httpInterceptor",httpInterceptor),httpInterceptor.$inject=["$location","$q","$injector","INSTANCE_URL"]}(),function(){"use strict";function register($location,$rootScope,login){function register(){console.log("register",register),login.register({email:vm.username,password:vm.password,first_name:vm.firstName||"Address",last_name:vm.lastName||"Book"}).then(function(){$location.path("/bizlogin")},function(error){vm.message=error.Message,console.log("Error: ",error)})}function signIn(){$location.path("/bizlogin")}var vm=this;vm.title="register",vm.username="",vm.password="",vm.confirm="",vm.firstName="",vm.lastName="",vm.message="",vm.register=register,vm.signIn=signIn,function(){$rootScope.isLoggedIn=!1}()}angular.module("login").controller("register",register),register.$inject=["$location","$rootScope","login"]}(),function(){"use strict";function login($location,$window,$rootScope,login,dialog,$state,$cookies,$http,$facebook,fbusers,InstagramService){function facebookLogin(){login.facebookSDKLogin()}function submit(){console.log("submit"),login.initiate({email:vm.username,password:vm.password}).then(function(){$rootScope.isLoggedIn=!0,console.log("isLoggedIn",$rootScope.isLoggedIn),$location.path("/")})}function redirectToState(){var statename=$cookies.get("statename"),statenum=$cookies.get("statenum");"rankSummary"==statename||"answerDetail"==statename?$state.go(statename,{index:statenum}):$state.go("cwrapper")}function redirectForFacebook(){login.loginWithFacebook().then(function(result){console.log("result @loginWithFacebook - ",result),$window.location=result.url})}function register(){$location.path("/register")}function goBack(){$state.go("cwrapper")}function whyFacebookDialog(){dialog.getDialog("whyFacebook")}var vm=this;vm.title="login",vm.username="",vm.password="",vm.code="",vm.isProgressing=!1,vm.submit=submit,vm.register=register,vm.redirectForFacebook=redirectForFacebook,vm.whyFacebookDialog=whyFacebookDialog,vm.facebookLogin=facebookLogin,vm.goBack=goBack,$rootScope.$on("redirectAfterLogin",function(){redirectToState()}),$rootScope.isLoggedIn&&$state.go("cwrapper")}angular.module("login").controller("login",login),login.$inject=["$location","$window","$rootScope","login","dialog","$state","$cookies","$http","$facebook","fbusers","InstagramService"]}(),function(){"use strict";function bizlogin($location,$window,$rootScope,login,dialog,userDetail,$state){function submit(){console.log("bizlogin - submit"),login.initiate({email:vm.username,password:vm.password}).then(function(){$rootScope.isLoggedIn=!0,console.log("isLoggedIn",$rootScope.isLoggedIn),$state.go("cwrapper",{},{location:"replace"})})}var vm=this;vm.title="bizlogin",vm.username="",vm.password="",vm.code="",vm.isProgressing=!1,vm.submit=submit,function(){var queryString=location.search,idx=queryString.lastIndexOf("?");idx>=0&&(queryString=queryString.substr(idx+1)),queryString&&(vm.isProgressing=!0,login.oauthWithFacebook(queryString).then(function(result){$rootScope.isLoggedIn=!0,console.log("isLoggedIn",$rootScope.isLoggedIn),$state.go("cwrapper",{},{location:"replace"})},function(){vm.isProgressing=!1})),console.log("vm.code bizlogin --",vm.code),$rootScope.isLoggedIn=!1}()}angular.module("login").controller("bizlogin",bizlogin),bizlogin.$inject=["$location","$window","$rootScope","login","dialog","userDetail","$state"]}(),angular.module("app").directive("userDetailModal",["$rootScope","userDetail","dialog",function($rootScope,userDetail,dialog){"use strict";return{restrict:"E",templateUrl:"app/login/partials/add-user-detail.html",link:function($scope,element,attrs,ngModel){$scope.maxDate=moment().format("YYYY-MM-DD"),$rootScope.openUserDetailModal=function(){$rootScope.user&&($rootScope.user.gender="Male",$rootScope.user.birth_date=""),openModal("#addUserDetailModal")},$rootScope.addUserDetail=function(){userDetail.addUserDetail().then(function(result){userDetail.getUserDetail().then(function(result){if(0==Object.keys(result).length)$rootScope.openUserDetailModal();else{$rootScope.user.age=calculateAge(new Date(result[0].birth_date)),$rootScope.user.gender=result[0].gender,$rootScope.user.birth_date=result[0].birth_date;try{window.localStorage.user=JSON.stringify($rootScope.user)}catch(e){}}}),closeModal("#addUserDetailModal")})},$rootScope.whyThisInfoDialog=function(){dialog.getDialog("whyUserData")},$rootScope.user&&($rootScope.user.birth_date&&$rootScope.user.gender||$rootScope.openUserDetailModal())}}}]),function(){"use strict";function stateConfigurator($stateProvider,$urlRouterProvider){var states=[{name:"login",url:"/login",templateUrl:"app/login/partials/login.html",controller:"login as vm"},{name:"bizlogin",url:"/bizlogin",templateUrl:"app/login/partials/bizlogin.html",controller:"bizlogin as vm"},{name:"register",url:"/register",templateUrl:"app/login/partials/register.html",controller:"register as  vm"}];$(states).each(function(){$stateProvider.state(this)})}angular.module("login").config(["$stateProvider","$urlRouterProvider",stateConfigurator])}(),function(){"use strict";function color($http,$q,$rootScope){function shadeColor(color,percent){"#"!=color.charAt(0)&&("red"==color?color="#ff0000":"black"==color?color="#000000":"grey"==color||"gray"==color?color="#808080":"lightgrey"==color||"lightgray"==color?color="#d3d3d3":"darkgrey"==color||"darkgray"==color?color="#a9a9a9":"green"==color?color="#008000":"brown"==color?color="#a52a2a":"blue"==color?color="#0000ff":"white"==color?color="#ffffff":$rootScope.DEBUG_MODE&&console.log("Dont know what color is ",color));var f=parseInt(color.slice(1),16),t=percent<0?0:255,p=percent<0?-1*percent:percent,R=f>>16,G=f>>8&255,B=255&f;return"#"+(16777216+65536*(Math.round((t-R)*p)+R)+256*(Math.round((t-G)*p)+G)+(Math.round((t-B)*p)+B)).toString(16).slice(1)}function hsl2rgb(hsl){var b,g,h,l,p,q,r,ref,s;return ref=hsl.match(/hsla?\((.+?)\)/)[1].split(",").map(function(value){return value.trim(),parseFloat(value)}),h=ref[0],s=ref[1],l=ref[2],ref[3],h/=360,s/=100,l/=100,0===s?r=g=b=l:(q=l<.5?l*(1+s):l+s-l*s,p=2*l-q,r=hue2rgb(p,q,h+1/3),g=hue2rgb(p,q,h),b=hue2rgb(p,q,h-1/3)),"#"+Math.round(255*r).toString(16)+Math.round(255*g).toString(16)+Math.round(255*b).toString(16)}function hue2rgb(p,q,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?p+6*(q-p)*t:t<.5?q:t<2/3?p+(q-p)*(2/3-t)*6:p}function defaultRankColor(x){var bc="",fc="";return void 0!=x.tags&&null!=x.tags||(x.tags=""),x.tags.indexOf("food")>-1?(bc="brown",fc="#f8f8ff"):x.tags.indexOf("lifestyle")>-1?(bc="#008080",fc="#f8f8ff"):x.tags.indexOf("social")>-1?(bc="#4682b4",fc="#f8f8ff"):x.tags.indexOf("city")>-1?(bc="gray",fc="#f8f8ff"):x.tags.indexOf("neighborhood")>-1?(bc="gray",fc="#f8f8ff"):x.tags.indexOf("politics")>-1?(bc="#595959",fc="#f8f8ff"):x.tags.indexOf("sports")>-1?(bc="#4682b4",fc="#f8f8ff"):x.tags.indexOf("beauty")>-1?(bc="#a3297a",fc="#f8f8ff"):x.tags.indexOf("health")>-1?(bc="green",fc="#f8f8ff"):x.tags.indexOf("services")>-1?(bc="#c68c53",fc="#f8f8ff"):x.tags.indexOf("technology")>-1?(bc="gray",fc="#f8f8ff"):x.tags.indexOf("dating")>-1?(bc="#b22222",fc="#f8f8ff"):x.tags.indexOf("personalities")>-1?(bc="#c68c53",fc="#f8f8ff"):(bc="gray",fc="#f8f8ff"),[bc,fc]}return{shadeColor:shadeColor,hsl2rgb:hsl2rgb,hue2rgb:hue2rgb,defaultRankColor:defaultRankColor}}angular.module("app").factory("color",color),color.$inject=["$http","$q","$rootScope"]}(),function(){"use strict";function city($http,$q,$rootScope){function getCities(forceRefresh){function citySucceeded(result){return _cities=result.data.resource}if(_areCitiesLoaded()&&!forceRefresh)return $q.when(_cities);var url=baseURI;return $http.get(url).then(citySucceeded,_cityFailed)}function _areCitiesLoaded(){return _cities.length>0}function _cityFailed(error){throw error}var _cities=[],baseURI="/api/v2/mysql/_table/cities";return{getCities:getCities}}angular.module("app").factory("city",city),city.$inject=["$http","$q","$rootScope"]}(),function(){"use strict";function navbar($location,$rootScope,login,$state,$scope,city,$cookies,$http,GOOGLE_API_KEY,dialog,getgps,useraccnt,$q,users){function gotomybusiness(){$rootScope.$emit("hideBar"),$(".navbar-collapse").collapse("hide"),$state.go("mybusiness"),$(".navbar-collapse").collapse("hide")}function gotofavs(){$rootScope.$emit("hideBar"),$(".navbar-collapse").collapse("hide"),$state.go("favs")}function goPromoterConsole(){$rootScope.$emit("hideBar"),$(".navbar-collapse").collapse("hide"),$state.go("promoterconsole"),$(".navbar-collapse").collapse("hide")}function gotoAbout(){$rootScope.$emit("hideBar"),$(".navbar-collapse").collapse("hide"),$state.go("about")}function gotoFileUpload(){$state.go("fileuploadtest")}function gotoAdmin(){$rootScope.$emit("hideBar"),$(".navbar-collapse").collapse("hide"),$state.go("admin")}function gotoFeedback(){$rootScope.fbmode=!0,$state.go("cwrapper",{},{reload:!0})}function gotoTour(){dialog.tour(),$(".navbar-collapse").collapse("hide")}function selCity(){dialog.getDialog("onlySanDiego")}function gotoHome(){$rootScope.$emit("backToResults")}function gotoCustomer(){$state.go("customer")}function goToLogin(){$rootScope.stateName=$state.current.name,"rankSummary"==$rootScope.stateName?$rootScope.stateNum=$rootScope.cCategory.id:"answerDetail"==$rootScope.stateName?$rootScope.stateNum=$rootScope.canswer.id:$rootScope.stateNum=void 0,dialog.loginFacebook()}function logout(){login.logout().then(function(){vm.user="",vm.isLoggedIn=!1,vm.hasBusiness=!1,vm.isPromoter=!1,localStorage.clear(),$rootScope.$emit("backToResults"),$rootScope.$emit("userLoggedOut")})}function openCitySelection(){openModal("#selectCityModal")}function setUserLatitudeLongitude(location){$rootScope.DEBUG_MODE&&console.log("position.coords.latitude - ",location.coords.latitude),$rootScope.DEBUG_MODE&&console.log("position.coords.longitude - ",location.coords.longitude),$rootScope.currentUserLatitude=location.coords.latitude,$rootScope.currentUserLongitude=location.coords.longitude,$cookies.put("currentUserLatitude",$rootScope.currentUserLatitude),$cookies.put("currentUserLongitude",$rootScope.currentUserLongitude),$rootScope.coordsRdy=!0,showCoordsIcon(),$rootScope.loadFbnWhenCoordsRdy&&$state.go("rankSummary",{index:11942}),$rootScope.isLoggedIn&&($rootScope.user.latitude=$rootScope.currentUserLatitude,$rootScope.user.longitude=$rootScope.currentUserLongitude,$rootScope.DEBUG_MODE&&console.log("Geo Location is set for logged in user.")),$rootScope.DEBUG_MODE&&console.log("Geo Location is set for user."),"rankSummary"==$state.current.name&&$rootScope.$emit("coordsRdy")}function autoDetectCity(){$rootScope.DEBUG_MODE&&console.log("@autoDetectCity"),geolocator.locate(geoOptions,function(err,location){err?($rootScope.DEBUG_MODE&&console.log("Error getting geolocation - ERROR("+err.code+"): "+err.message),dialog.getDialog("errorGettingGeolocation")):($rootScope.DEBUG_MODE&&console.log(location),setUserLatitudeLongitude(location))})}function configGeolocation(){geolocator.config({language:"en",google:{version:"3",key:GOOGLE_API_KEY}}),geoOptions={enableHighAccuracy:!0,timeout:1e4,maximumWait:1e4,maximumAge:0,desiredAccuracy:30,fallbackToIP:!0}}function showWarningsIcon(){vm.warning=!0}function hideWarningsIcon(){vm.warning=!1}function showCoordsIcon(){vm.coordsRdy=!0}function goWarning(){var idx=$rootScope.answers.map(function(x){return x.id}).indexOf($rootScope.useraccnts[0].answer);dialog.askEmail($rootScope.answers[idx].name)}function goCoords(){dialog.askPermissionToLocate()}function getAttentionForUserPoints(points){var element=$("#navbar-user-points"),tmpClass=element.attr("class");element.removeClass(),setTimeout(function(){element.addClass(tmpClass).addClass("start-now")},0),setTimeout(function(){$rootScope.user.points=points,$scope.$apply()},4e3)}var vm=this;vm.title="navbar",$rootScope.user&&$q.all([users.getUser($rootScope.user.id)]).then(function(data){if(data[0]){var userinfo=data[0][0];$rootScope.user.level=userinfo.level,$rootScope.user.points=userinfo.points}}),vm.user=$rootScope.user,vm.isLoggedIn=!!$rootScope.isLoggedIn&&$rootScope.isLoggedIn,vm.logout=logout,vm.goToLogin=goToLogin,vm.gotoAbout=gotoAbout,vm.gotomybusiness=gotomybusiness,vm.gotofavs=gotofavs,vm.gotoFeedback=gotoFeedback,vm.gotoTour=gotoTour,vm.gotoHome=gotoHome,vm.selCity=selCity,vm.gotoAdmin=gotoAdmin,vm.goPromoterConsole=goPromoterConsole,vm.gotoFileUpload=gotoFileUpload,vm.gotoCustomer=gotoCustomer,vm.openCitySelection=openCitySelection,vm.goWarning=goWarning,vm.goCoords=goCoords,vm.isAdmin=$rootScope.isAdmin||$rootScope.dataAdmin||$rootScope.modAdmin,void 0==$rootScope.coordsRdy&&($rootScope.coordsRdy=!1),$rootScope.loadFbnWhenCoordsRdy=!1;var geoOptions={};vm.warning=!1;var geoLocationListener=$rootScope.$on("getLocation",function(e){autoDetectCity()}),coordsRdyListener=$rootScope.$on("coordsRdy",function(e){showCoordsIcon()}),adminCredentialsListener=$rootScope.$on("adminCredentials",function(e){vm.isAdmin=$rootScope.isAdmin||$rootScope.dataAdmin||$rootScope.modAdmin}),showWarningListener=$rootScope.$on("showWarning",function(e){$rootScope.DEBUG_MODE&&console.log("rx showWarning"),showWarningsIcon()}),hideWarningListener=$rootScope.$on("hideWarning",function(e){$rootScope.DEBUG_MODE&&console.log("rx clearWarning"),hideWarningsIcon()}),useAddressListener=$rootScope.$on("useAddress",function(e,address){var obj={};obj.location=address.address,obj.lat=0,obj.lng=0,$rootScope.coordForUSer=!0,getgps.getLocationGPS(obj)}),userDataLoadedListener=$rootScope.$on("userDataLoaded",function(e){$rootScope.isLoggedIn?(vm.isPromoter=!0,$rootScope.isPromoter=!0,$rootScope.DEBUG_MODE&&console.log("User is promoter")):($rootScope.isPromoter=!1,vm.isPromoter=!1)}),userAccountsLoadedListener=$rootScope.$on("userAccountsLoaded",function(e){$rootScope.isLoggedIn&&$rootScope.useraccnts.length>0?(vm.hasBusiness=!0,$rootScope.hasBusiness=!0,$rootScope.DEBUG_MODE&&console.log("User has business")):($rootScope.hasBusiness=!1,vm.hasBusiness=!1)});$scope.$on("$destroy",geoLocationListener),$scope.$on("$destroy",coordsRdyListener),$scope.$on("$destroy",adminCredentialsListener),$scope.$on("$destroy",showWarningListener),$scope.$on("$destroy",hideWarningListener),$scope.$on("$destroy",useAddressListener),$scope.$on("$destroy",userDataLoadedListener),$scope.$on("$destroy",userAccountsLoadedListener),function(){void 0==$rootScope.hasBusiness?vm.hasBusiness=!1:vm.hasBusiness=$rootScope.hasBusiness,void 0==$rootScope.isPromoter?vm.isPromoter=!1:vm.isPromoter=$rootScope.isPromoter,$rootScope.showWarning&&showWarningsIcon(),configGeolocation(),vm.coordsRdy=$rootScope.coordsRdy,$rootScope.isAdmin=!1,$rootScope.dataAdmin=!1,$rootScope.isLoggedIn&&("1599427743409374"==$rootScope.user.id&&($rootScope.dataAdmin=!0),"10104518570729893"==$rootScope.user.id&&($rootScope.isAdmin=!0),"10214255239240099"==$rootScope.user.id&&($rootScope.contentAdmin=!0),"1638806919478345"==$rootScope.user.id&&($rootScope.modAdmin=!0),vm.isAdmin=$rootScope.isAdmin||$rootScope.dataAdmin||$rootScope.modAdmin),$rootScope.DEBUG_MODE&&console.log("Navbar Loaded!")}(),$rootScope.getCurrentPositionOfUser=function(){geolocator.locate(geoOptions,function(err,location){err?($rootScope.DEBUG_MODE&&console.log("Error getting geolocation - ERROR("+err.code+"): "+err.message),dialog.getDialog("errorGettingGeolocation")):($rootScope.DEBUG_MODE&&console.log(location),setUserLatitudeLongitude(location))})},$scope.$on("getAttentionForUserPoints",function(event,args){getAttentionForUserPoints(args.points)})}angular.module("app").controller("navbar",navbar),navbar.$inject=["$location","$rootScope","login","$state","$scope","city","$cookies","$http","GOOGLE_API_KEY","dialog","getgps","useraccnt","$q","users"]}(),function(){"use strict";function layout($location,$rootScope,$window,$q,$http,pvisits,$cookies,$scope,$timeout,DEBUG_MODE,EMPTY_IMAGE,rankofday,answer,table,special,datetime,uaf,userdata,dialog,matchrec,edit,useractivity,vrows,headline,cblock,catans,$state,dataloader,setting,filter){function loadJSON(){$http.get("../../../assets/fields.json").then(function(response){$rootScope.typeSchema=response.data,loadData()});$http.get("../../../assets/dialogs.json").then(function(response){$rootScope.dialogs=response.data}),$http.get("../../../assets/foodans.json").then(function(response){$rootScope.foodans=response.data})}function loadData(){getDestination(),setting.getSetting()}function loadingDone(){void 0==$rootScope.pageDataLoaded&&($rootScope.pageDataLoaded=!1),void 0==$rootScope.userDataLoaded&&($rootScope.userDataLoaded=!1),window.location.href.indexOf("rankSummary")>-1?$rootScope.dataIsLoaded=$rootScope.userDataLoaded:window.location.href.indexOf("answerDetail")>-1?$rootScope.dataIsLoaded=$rootScope.userDataLoaded:($rootScope.dataIsLoaded=$rootScope.initalHomeDataLoaded,$state.go("cwrapper")),vm.isLoading=!$rootScope.dataIsLoaded,$rootScope.DEBUG_MODE&&console.log("@loadingDone - $rootScope.dataIsLoaded -",$rootScope.dataIsLoaded),$rootScope.DEBUG_MODE&&console.log("@loadingDone - $rootScope.pageDataLoaded -",$rootScope.pageDataLoaded),$rootScope.DEBUG_MODE&&console.log("@loadingDone - $rootScope.userDataLoaded -",$rootScope.userDataLoaded)}function isFacebookApp(){var ua=navigator.userAgent||navigator.vendor||window.opera;return ua.indexOf("FBAN")>-1||ua.indexOf("FBAV")>-1}function goPrivacyPolicy(){vm.childActive=!0,vm.barIsActive=!1,$state.go("privacypolicy")}function goRankofDayConsole(){vm.childActive=!0,vm.barIsActive=!1,$state.go("rodconsole")}function getResults(){$rootScope.inputVal=vm.val,1==vm.val.length&&(vm.showans=!0),$rootScope.searchActive=!0,vm.searchActive=$rootScope.searchActive,vm.childActive=!$rootScope.searchActive}function hideSearch(){vm.searchActive=!1,vm.childActive=!0,vm.barIsActive=!1}function gotoHome(){vm.searchActive=!0,vm.childActive=!1,vm.barIsActive=!0,"cwrapper"==$state.current.name&&($rootScope.inputVal="",vm.val="")}function backToResults(){"cwrapper"==$state.current.name&&($rootScope.inputVal="",vm.val=""),$state.go("cwrapper"),void 0!=$rootScope.inputVal&&""!=$rootScope.inputVal&&($rootScope.searchActive=!0,vm.searchActive=!0,vm.childActive=!1),$timeout(function(){$window.scrollTo(0,$rootScope.pageYOffset)})}function goAddRank(){$rootScope.isLoggedIn?(vm.childActive=!0,vm.barIsActive=!1,$rootScope.cCategory=void 0,$state.go("addCustomRank")):dialog.loginFacebook()}function editRank(){$rootScope.editMode=!0,vm.selEditRank="active",vm.selViewRank="",$rootScope.DEBUG_MODE&&console.log("$rootScope.editMode -- ",$rootScope.editMode)}function viewRank(){$rootScope.editMode=!1,vm.selEditRank="",vm.selViewRank="active"}function applyRule(){$rootScope.$emit("applyRule")}function quickFilter(x){vm.showans=!1,"neighborhood"==x?(0==vm.nhctrl?vm.nhctrl=!0:vm.nhctrl=!1,1==vm.nhctrl&&(vm.nhops=$rootScope.nhs)):""==vm.nh?vm.val=x:vm.val=vm.nh+" "+x}function selectNh(){vm.nhops.indexOf(vm.nhinp)>-1&&(vm.nh=vm.nhinp,vm.nhctrl=!1,vm.val=vm.nh)}function clearNh(){vm.nhinp="",vm.nh="",vm.nhctrl=!1,vm.val=""}function prepareNewCatansOptions(){$rootScope.DEBUG_MODE&&console.log("@prepareNewCatansOptions - $rootScope.content.length ",$rootScope.content.length),$rootScope.ctsOptions=[];for(var i=0;i<$rootScope.categories.length;i++)$rootScope.ctsOptions.push($rootScope.categories[i].category)}function getDestination(){window.location.href.indexOf("rankSummary")>-1?(vm.childActive=!0,vm.barIsActive=!1):window.location.href.indexOf("answerDetail")>-1?(vm.childActive=!0,vm.barIsActive=!1):($rootScope.SCOPE=2,dataloader.getInitialData(),$rootScope.childActive=!1)}function showTrends(){vm.childActive=!0,vm.barIsActive=!1,$rootScope.cCategory=void 0,$state.go("trends")}var vm=this;vm.title="layout",vm.header="",$scope.$parent.seo={pageTitle:"Rank-X",metaDescription:"Rank-X creates collective rankings on everything in your city."},vm.veilMsg="Just a moment, loading the best information about San Diego",vm.hidelogo=!1,vm.getResults=getResults,vm.hideSearch=hideSearch,vm.gotoHome=gotoHome,vm.goAddRank=goAddRank,vm.quickFilter=quickFilter,vm.foodNearMe=!1,-1!=$window.location.href.indexOf("rankSummary/food-near-me-9521")&&(vm.foodNearMe=!0,vm.veilMsg="Just a moment, finding some delicious food..."),vm.dataready=!1,vm.initready=!1,vm.barIsActive=!0,vm.childActive=!1,vm.rodready=!1,vm.showans=!1,vm.editRank=editRank,vm.viewRank=viewRank,vm.applyRule=applyRule,vm.selCityActive=!1,vm.selectNh=selectNh,vm.clearNh=clearNh,vm.nhctrl=!1,vm.nh="",vm.showTrends=showTrends,vm.goPrivacyPolicy=goPrivacyPolicy,vm.goRankofDayConsole=goRankofDayConsole,jQuery(document).ready(function(){jQuery(window).scroll(function(){jQuery(this).scrollTop()>250?jQuery(".back-to-top").fadeIn(300):jQuery(".back-to-top").fadeOut(300)}),jQuery(".back-to-top").click(function(event){return event.preventDefault(),jQuery("html, body").animate({scrollTop:0},300),!1})}),vm.showFilters=!1,vm.toggleFilterBox=function(){vm.showFilters=!vm.showFilters},vm.hideFilterBox=function(){vm.showFilters=!1};var refreshRanksListener=$rootScope.$on("refreshRanks",function(){"cwrapper"==$state.current.name&&(vm.hidelogo=$rootScope.hidelogo)}),showLogoListener=$rootScope.$on("showLogo",function(){"rankSummary"==$state.current.name||$state.current.name}),userDataLoadedListener=$rootScope.$on("userDataLoaded",function(){$rootScope.DEBUG_MODE&&console.log("RX - userDataLoaded"),loadingDone()}),homeDataLoadedListener=$rootScope.$on("homeDataLoaded",function(){$rootScope.DEBUG_MODE&&console.log("RX - homeDataLoaded"),vm.isLoading=!1,vm.dataready=!0,prepareNewCatansOptions(),$rootScope.isLoggedIn&&userdata.pullFavoriteData()}),rankDataLoadedListener=$rootScope.$on("rankDataLoaded",function(){$rootScope.DEBUG_MODE&&console.log("RX - rankDataLoaded"),1!=$rootScope.initalHomeDataLoaded&&(dataloader.getInitialData(),$rootScope.isLoggedIn&&userdata.pullFavoriteData()),loadingDone()}),answerDataLoadedListener=$rootScope.$on("answerDataLoaded",function(){$rootScope.DEBUG_MODE&&console.log("RX - answerDataLoaded"),1!=$rootScope.initalHomeDataLoaded&&(dataloader.getInitialData(),$rootScope.isLoggedIn&&userdata.pullFavoriteData()),loadingDone()}),initialHomeDataLoadedListener=$rootScope.$on("initalHomeDataLoaded",function(){$rootScope.DEBUG_MODE&&console.log("RX - initialHomeLoaded"),$rootScope.initalHomeDataLoaded=!0,vm.initready=!0,loadingDone()}),mainViewListener=$rootScope.$on("mainView",function(event){vm.childActive=!1,gotoHome()}),hideSearchBarListener=$rootScope.$on("hideBar",function(event){vm.childActive=!0,vm.barIsActive=!1}),backtoResultsListener=$rootScope.$on("backToResults",function(event){vm.childActive=!1,vm.barIsActive=!0,$rootScope.cCategory=void 0,backToResults()}),userLoggedOutListener=$rootScope.$on("userLoggedOut",function(event){vm.isAdmin=!1}),rodReadyListener=$rootScope.$on("rodReady",function(event){vm.rodready=!0,void 0!=$rootScope.rankofday&&($rootScope.DEBUG_MODE&&console.log("$rootScope.rankofday - ",$rootScope.rankofday),dataloader.pulldata("ranks",$rootScope.rankofday))});$rootScope.$on("$locationChangeSuccess",function(){window.location.href.indexOf("home")>-1&&(vm.childActive=!1,vm.barIsActive=!0),window.location.href.indexOf("rankSummary")>-1&&(vm.childActive=!0,vm.barIsActive=!1),window.location.href.indexOf("answerDetail")>-1&&(vm.childActive=!0,vm.barIsActive=!1),window.location.href.indexOf("trends")>-1&&(vm.childActive=!0,vm.barIsActive=!1)});$scope.$on("$destroy",userLoggedOutListener),$scope.$on("$destroy",backtoResultsListener),$scope.$on("$destroy",hideSearchBarListener),$scope.$on("$destroy",mainViewListener),$scope.$on("$destroy",initialHomeDataLoadedListener),$scope.$on("$destroy",answerDataLoadedListener),$scope.$on("$destroy",rankDataLoadedListener),$scope.$on("$destroy",homeDataLoadedListener),$scope.$on("$destroy",userDataLoadedListener),$scope.$on("$destroy",showLogoListener),$scope.$on("$destroy",refreshRanksListener),$scope.$on("$destroy",rodReadyListener),$window.innerWidth<512?(vm.logoimage="/assets/images/rankxlogosd2_sm.png",$rootScope.sm=!0,vm.sm=!0,$rootScope.DISPLAY_XSMALL=!0,$rootScope.numInitItems=12):(vm.logoimage="/assets/images/rankxlogosd2_sm.png",$rootScope.sm=!1,vm.sm=!1),$window.innerWidth>=512&&$window.innerWidth<768&&($rootScope.DISPLAY_SMALL=!0,$rootScope.numInitItems=12),$rootScope.md=!1,$window.innerWidth>=768&&$window.innerWidth<991&&($rootScope.md=!0,$rootScope.DISPLAY_MEDIUM=!0,$rootScope.numInitItems=16),$window.innerWidth>991&&($rootScope.DISPLAY_LARGE=!0,$rootScope.numInitItems=24),$rootScope.$on("$stateChangeSuccess",function(ev,to,toParams,from,fromParams){vm.hideFilterBox(),$rootScope.previousState=from.name});var tourviewed=$cookies.get("tourviewed");void 0==tourviewed&&(tourviewed=!1),function(){$rootScope.isAdmin=!1,$rootScope.dataAdmin=!1,$rootScope.isLoggedIn&&("1599427743409374"==$rootScope.user.id&&($rootScope.dataAdmin=!0),"10104518570729893"==$rootScope.user.id&&($rootScope.isAdmin=!0),"10214255239240099"==$rootScope.user.id&&($rootScope.contentAdmin=!0),"1638806919478345"==$rootScope.user.id&&($rootScope.modAdmin=!0)),vm.isAdmin=$rootScope.isAdmin||$rootScope.contentAdmin,$rootScope.$emit("adminCredentials"),$rootScope.DEBUG_MODE=DEBUG_MODE,$rootScope.EMPTY_IMAGE=EMPTY_IMAGE,$rootScope.facebookAppId="",$rootScope.facebookUrl="https://www.facebook.com/Rank-X-San-Diego-582174448644554",void 0==$rootScope.dataIsLoaded?(vm.isLoading=!0,loadJSON()):loadData(),userdata.loadUserData(),userdata.loadUserAccount(),$rootScope.isFacebookApp=isFacebookApp(),$rootScope.DEBUG_MODE&&console.log("Layout Loaded!")}()}angular.module("app").controller("layout",layout),layout.$inject=["$location","$rootScope","$window","$q","$http","pvisits","$cookies","$scope","$timeout","DEBUG_MODE","EMPTY_IMAGE","rankofday","answer","table","special","datetime","uaf","userdata","dialog","matchrec","edit","useractivity","vrows","headline","cblock","catans","$state","dataloader","setting","filter"]}(),function(){"use strict";function cwrapper($rootScope,$state,$http,$stateParams,$scope,query,table,dialog,uaf,$window,userdata,$location,color,fbusers,$q,$timeout,filter,search,mailing){function loadMore(){vm.scrollDataLoading=!0,$timeout(function(){vm.currentIndex+vm.loadingCountOneScroll>vm.scrollingData.length-1&&(vm.current=vm.scrollingData.length,vm.endReached=!0),vm.currentIndex+=vm.loadingCountOneScroll,vm.currentIndex-vm.startIndex>vm.scrollingItemsOnePage&&(vm.startIndex=vm.currentIndex-vm.scrollingItemsOnePage),vm.scrollDataLoading=!1},500)}function showLess(){vm.startIndex>=3&&(vm.startIndex-=3,vm.currentIndex-=3)}function switchScope(x){1==x&&(vm.isNh=!1,vm.isCity=!0,$rootScope.isNh=!1,$rootScope.isCity=!0,$rootScope.$emit("loadNh"),vm.searchScope="all San Diego",vm.ranks=$rootScope.cityranks,vm.querybc="white"),2==x&&(vm.isNh=!0,vm.isCity=!1,$rootScope.isNh=!0,$rootScope.isCity=!1,vm.val="",$rootScope.inputVal="",$rootScope.searchActive=!1,$rootScope.isNhRdy&&$rootScope.$emit("loadNh"),vm.searchScope="Neighborhood",vm.ranks=$rootScope.nhranks,vm.querybc="#428bca"),vm.searchActive=$rootScope.searchActive}function selnh(x){$rootScope.cnh=x,vm.cnh=x,vm.isNhRdy=!0,$rootScope.isNhRdy=vm.isNhRdy,vm.inputVal="",vm.searchActive=!1,$rootScope.$emit("loadNh"),vm.searchScope=x,vm.val="",$rootScope.inputVal="",$("#nhdropdown").dropdown("toggle")}function foodNearMe(){$rootScope.coordsRdy?$state.go("rankSummary",{index:9521}):($rootScope.loadFbnWhenCoordsRdy=!0,dialog.askPermissionToLocate())}function selfimprove(){for(var rankFound=!1,rn=0,N=$rootScope.content.length-1;!rankFound;)rn=Math.floor(Math.random()*(N-0+1))+0,$rootScope.content[rn].ismp&&(rankFound=!0);$state.go("rankSummary",{index:$rootScope.content[rn].id})}function events(){$state.go("rankSummary",{index:6949})}function goHome(){$rootScope.inputVal="",vm.val=""}function gotoAnswer(x){$state.go("answerDetail",{index:x.answer})}function gotoRank(x){$state.go("rankSummary",{index:x.category})}var vm=this;$scope.$parent.$parent.$parent.seo={pageTitle:"",metaDescription:"Rank-X creates collective rankings on everything in your city. Find the best restaurants, services, activities, events, places, events and more."};var datasource={};datasource.get=function(index,count,success){$timeout(function(){for(var result=[],i=index;i<=index+count-1;i++)result.push("item #"+i);success(result)},100)},vm.sm=$rootScope.sm,vm.md=$rootScope.md,vm.datasource=datasource,$timeout(function(){var width=$("#facebook-container").width();$("#facebook-display").html(""),$("#facebook-display").html('<div class="fb-page"                 ng-if="vm.pageDataLoaded"                           data-href="https://www.facebook.com/rankxsandiego/"                  data-tabs="timeline"                  data-height="70"                 data-width="'+width+'"                 data-small-header="false"                  data-adapt-container-width="true"                  data-hide-cover="false"                 data-show-facepile="true">                     <blockquote cite="https://www.facebook.com/rankxsandiego/" class="fb-xfbml-parse-ignore">                    <a href="https://www.facebook.com/rankxsandiego/">Rank-X San Diego</a></blockquote>            </div>'),FB.XFBML.parse()},2e3),vm.title="cwrapper",vm.switchScope=switchScope,void 0==$rootScope.hidelogo?vm.hidelogo=!1:vm.hidelogo=$rootScope.hidelogo,vm.foodNearMe=foodNearMe,vm.events=events,vm.selfimprove=selfimprove,vm.selnh=selnh,vm.goHome=goHome,vm.gotoAnswer=gotoAnswer,vm.gotoRank=gotoRank,$rootScope.editMode=!1,vm.content=[],vm.emptyspace="",vm.fbm=!!$rootScope.fbmode;var mainViewListener=$rootScope.$on("mainView",function(event){"cwrapper"==$state.current.name&&goHome()});vm.loadMore=loadMore,vm.showLess=showLess,$rootScope.$on("filterOptionChanged",function(){}),$rootScope.$on("initalHomeDataLoaded",function(){}),$rootScope.$on("homeDataLoaded",function(){vm.content=angular.copy($rootScope.content)}),$scope.$on("$destroy",mainViewListener),window.prerenderReady=!1}angular.module("app").controller("cwrapper",cwrapper),cwrapper.$inject=["$rootScope","$state","$http","$stateParams","$scope","query","table","dialog","uaf","$window","userdata","$location","color","fbusers","$q","$timeout","filter","search","mailing"]}(),function(){"use strict";function special($http,$q,$rootScope,imagelist){function getSpecials(forceRefresh){function querySucceeded(result){return _load(result.data.resource),_specials}if(_arespecialsLoaded()&&!forceRefresh)return $q.when(_specials);var url=baseURI;return $http.get(url).then(querySucceeded,_queryFailed)}function getSpecialsX(data){
function querySucceeded(result){$rootScope.DEBUG_MODE&&console.log("specialsX data loaded");var data=result.data.resource,map=_specials.map(function(x){return x.id});return data.forEach(function(obj){map.indexOf(obj.id)<0&&_specials.push(obj)}),data}var _datax=[];if(data.forEach(function(item){_fetchAnswersMem.indexOf(item.answer)<0&&(_datax.push(item),_fetchAnswersMem.push(item.answer))}),0==_datax.length)return $q.when(!1);for(var filterstr="?filter=(",i=0;i<_datax.length;i++)filterstr=filterstr+"answer="+_datax[i].answer+")OR(";filterstr=filterstr.substring(0,filterstr.length-3);var url=baseURI+filterstr;return $http.get(url).then(querySucceeded,_queryFailed)}function getSpecialsbyAnswer(answer_id){function querySucceeded(result){var data=result.data.resource,map=_specials.map(function(x){return x.id});return data.forEach(function(obj){map.indexOf(obj.id)<0&&_specials.push(obj)}),_specialsByAnswer=data,$rootScope.DEBUG_MODE&&console.log("gotSpecial for answer! ",_specialsByAnswer),data}var url=baseURI+"/?filter=answer="+answer_id;return $http.get(url).then(querySucceeded,_queryFailed)}function addSpecial(special){function querySucceeded(result){var specialx=special;return specialx.id=result.data.resource[0].id,_specials.length>0&&_specials.push(specialx),_specialsByAnswer.length>0&&_specialsByAnswer.push(specialx),$rootScope.DEBUG_MODE&&console.log("result",result),result.data}var url=baseURI,resource=[];return resource.push(special),$http.post(url,resource,{headers:{"Content-Type":"multipart/form-data"},body:resource}).then(querySucceeded,_queryFailed)}function updateSpecial(special_id,field,val){function querySucceeded(result){return $rootScope.DEBUG_MODE&&console.log("updating special succesful"),result.data}var obj={};obj.resource=[];var data={};data.id=special_id;for(var i=0;i<field.length;i++)data[field[i]]=val[i];obj.resource.push(data);for(var url=baseURI,idx=_specials.map(function(x){return x.id}).indexOf(special_id),i=0;i<field.length;i++)_specials[idx][field[i]]=val[i];for(var idx2=_specialsByAnswer.map(function(x){return x.id}).indexOf(special_id),i=0;i<field.length;i++)_specialsByAnswer[idx2][field[i]]=val[i];return $http.patch(url,obj,{headers:{"Content-Type":"multipart/form-data"},body:obj}).then(querySucceeded,_queryFailed)}function deleteSpecial(special_id){function querySucceeded(result){return-1!=blobImage.indexOf("https://rankx.blob")&&imagelist.deleteBlob(blobImage),console.log("Deleting special was succesful"),result.data}var obj={};obj.resource=[];var data={};data.id=special_id,obj.resource.push(data);var blobImage,url=baseURI+"/"+special_id;if(_specials.length>0){var i=_specials.map(function(x){return x.id}).indexOf(special_id);blobImage=_specials[i].image,i>-1&&_specials.splice(i,1)}if(_specialsByAnswer.length>0){var i=_specialsByAnswer.map(function(x){return x.id}).indexOf(special_id);i>-1&&_specialsByAnswer.splice(i,1)}return $http.delete(url,data,{headers:{"Content-Type":"multipart/form-data"},body:obj}).then(querySucceeded,_queryFailed)}function _load(data){_specials.length=0,data.forEach(function(x){_specials.push(x)})}function _arespecialsLoaded(){return _specials.length>0}function _queryFailed(error){throw error}var _specials=[],_fetchAnswersMem=[];$rootScope.specials=_specials;var _specialsByAnswer=[],baseURI="/api/v2/mysql/_table/specials";return{getSpecials:getSpecials,getSpecialsX:getSpecialsX,addSpecial:addSpecial,updateSpecial:updateSpecial,deleteSpecial:deleteSpecial,getSpecialsbyAnswer:getSpecialsbyAnswer}}angular.module("app").factory("special",special),special.$inject=["$http","$q","$rootScope","imagelist"]}(),function(){"use strict";function datetime($rootScope){function formatdatetime(sp){if("onetime"==sp.freq){formatTime(sp,"stime"),formatTime(sp,"etime");var d=new Date(sp.sdate),s=d.toString();sp.sdate=s.substring(0,15),d=new Date(sp.edate),s=d.toString(),sp.edate=s.substring(0,15)}"weekly"==sp.freq&&(formatTime(sp,"stime2"),formatTime(sp,"etime2"))}function formatTime(sp,s){var date="";switch(s){case"stime":date=sp.stime;break;case"etime":date=sp.etime;break;case"stime2":date=sp.stime2;break;case"etime2":date=sp.etime2}if(null!=date&&void 0!=date&&(date.indexOf("00:00")>-1||date.indexOf("30:00")>-1)){date=date.replace("00:00","00"),date=date.replace("30:00","30");var itsAM=parseInt(date.substring(0,2))<12;if(date+=itsAM?" AM":" PM",!itsAM){var hr=parseInt(date.substring(0,2))-12,hrstr="";hrstr=hr<10?"0"+hr.toString():hr.toString(),date=date.replace(date.substring(0,2),hrstr)}}switch(s){case"stime":sp.stime=date;break;case"etime":sp.etime=date;break;case"stime2":sp.stime2=date;break;case"etime2":sp.etime2=date}}function date2number(datestr){var d1=new Date(datestr),d1s=d1.getFullYear().toString()+(d1.getMonth()+1<10?"0"+(d1.getMonth()+1).toString():(d1.getMonth()+1).toString())+(d1.getDate()<10?"0"+d1.getDate().toString():d1.getDate().toString());return Number(d1s)}function dateIsCurrent(datestr){return date2number(datestr)-$rootScope.dateTodayNum>=0}function eventIsCurrent(obj,answer){var edate=0,edateValid=!1,sdate=0,eIsCurrent=!1;if(void 0!=answer.edate&&""!=answer.edate&&(edate=date2number(answer.edate.slice(4)),edateValid=!0),sdate=date2number(answer.sdate.slice(4)),edateValid)if(edate>=$rootScope.dateTodayNum)if(eIsCurrent=!0,sdate>=$rootScope.dateTodayNum)obj.date=answer.sdate.slice(4);else{var d=new Date($rootScope.dateToday),s=d.toString();obj.date=s.substring(0,15).slice(4)}else eIsCurrent=!1,obj.date=answer.edate.slice(4);else sdate>=$rootScope.dateTodayNum?(eIsCurrent=!0,obj.date=answer.sdate.slice(4)):(eIsCurrent=!1,obj.date=answer.sdate.slice(4));return eIsCurrent}return{formatdatetime:formatdatetime,formatTime:formatTime,date2number:date2number,dateIsCurrent:dateIsCurrent,eventIsCurrent:eventIsCurrent}}angular.module("app").service("datetime",datetime),datetime.$inject=["$rootScope"]}(),function(){"use strict";function table2($http,$q,$rootScope,answer,$state,filter){function getMostPopularData(){return $http.get(baseURI+"?order=views DESC&offset=0&limit=8&filter=ismp=1").then(function(data){$rootScope.initalHomeData=data.data.resource,filter.saveInitalHomeData($rootScope.initalHomeData),$rootScope.$emit("initalHomeDataLoaded")}),!0}function getTables(forceRefresh){var url0=baseURI+"?offset=0",p0=$http.get(url0);return $q.all([p0]).then(function(d){return _load(d[0].data.resource),$rootScope.DEBUG_MODE&&console.log("tables length: ",_tables.length),_tables},_queryFailed)}function getTablesX(data){var _datax=[];if(data.forEach(function(item){_fetchAnswersMem.indexOf(item.answer)<0&&(_datax.push(item),_fetchAnswersMem.push(item.answer))}),0==_datax.length)return $q.when(!1);for(var filterstr="?filter=(",i=0;i<_datax.length;i++)filterstr=filterstr+"owner="+_datax[i].answer+")OR(";filterstr=filterstr.substring(0,filterstr.length-3);var url0=baseURI+filterstr,p0=$http.get(url0);return $q.all([p0]).then(function(d){var _tablesx=d[0].data.resource,map=_tables.map(function(x){return x.id});return _tablesx.forEach(function(table){map.indexOf(table.id)<0&&_tables.push(table)}),$rootScope.DEBUG_MODE&&console.log("getTablesX 'custom ranks' ",_tables.length),_tables},_queryFailed)}function getTablesD(data){var _datax=[];if(data.forEach(function(item){_fetchAnswersMem.indexOf(item.category)<0&&(_datax.push(item),_fetchAnswersMem.push(item.category))}),0==_datax.length)return $q.when(!1);for(var filterstr="?filter=(",i=0;i<_datax.length;i++)filterstr=filterstr+"id="+_datax[i].category+")OR(";filterstr=filterstr.substring(0,filterstr.length-3);var url0=baseURI+filterstr,p0=$http.get(url0);return $q.all([p0]).then(function(d){var _tablesx=d[0].data.resource,map=_tables.map(function(x){return x.id});return _tablesx.forEach(function(table){map.indexOf(table.id)<0&&_tables.push(table)}),$rootScope.DEBUG_MODE&&console.log("getTablesD 'custom ranks' ",_tables.length),_tables},_queryFailed)}function getSingleTable(id){var url0=baseURI+"/?filter=id="+id,p0=$http.get(url0);return $q.all([p0]).then(function(d){var data=d[0].data.resource[0];return _tables.map(function(x){return x.id}).indexOf(data.id)<0&&_tables.push(data),$rootScope.DEBUG_MODE&&console.log("single table loaded: ",data),_tables},_queryFailed)}function addTable(table){function querySucceeded(result){var tablex=table;tablex.id=result.data.resource[0].id,_tables.push(tablex);var searchStr=tablex.tags+" "+tablex.title;$rootScope.searchStr.push(searchStr);var slug=tablex.title.toLowerCase();return slug=slug.replace(/ /g,"-"),slug=slug.replace("/","at"),slug=slug.replace("?",""),slug=slug+"-"+result.data.resource[0].id,update(result.data.resource[0].id,["slug"],[slug]),$rootScope.DEBUG_MODE&&console.log("result",result),result.data}table.isatomic=!0;var url=baseURI,resource=[];return resource.push(table),$http.post(url,resource,{headers:{"Content-Type":"multipart/form-data"},body:resource}).then(querySucceeded,_queryFailed)}function addTableforAnswer(table,colors,answerid){function querySucceeded(result){var tablex=table;tablex.id=result.data.resource[0].id,_tables.push(tablex);var searchStr=tablex.tags+" "+tablex.title;$rootScope.searchStr.push(searchStr);var slug=tablex.title.toLowerCase();slug=slug.replace(/ /g,"-"),slug=slug.replace("/","at"),slug=slug+"-"+result.data.resource[0].id,update(result.data.resource[0].id,["slug"],[slug]);var obj={};obj.id=result.data.resource[0].id,obj.bc=colors[0],obj.fc=colors[1];var ranksStr="",ranks=[];return void 0!=$rootScope.canswer.ranks&&null!=$rootScope.canswer.ranks&&""!=$rootScope.canswer.ranks?(ranksStr=$rootScope.canswer.ranks,ranks=JSON.parse(ranksStr),ranks.push(obj),ranksStr=JSON.stringify(ranks),answer.updateAnswer(answerid,["ranks"],[ranksStr])):(ranksStr="["+JSON.stringify(obj)+"]",answer.updateAnswer(answerid,["ranks"],[ranksStr])),$rootScope.DEBUG_MODE&&console.log("result",result),result.data}table.isatomic=!0;var url=baseURI,resource=[];return resource.push(table),$http.post(url,resource,{headers:{"Content-Type":"multipart/form-data"},body:resource}).then(querySucceeded,_queryFailed)}function deleteTable(table_id){function querySucceeded(result){return $rootScope.DEBUG_MODE&&console.log("Deleting table was succesful"),result.data}var obj={};obj.resource=[];var data={};data.id=table_id,obj.resource.push(data);var url=baseURI+"/"+table_id,i=_tables.map(function(x){return x.id}).indexOf(table_id);return i>-1&&_tables.splice(i,1),$http.delete(url,data,{headers:{"Content-Type":"multipart/form-data"},body:obj}).then(querySucceeded,_queryFailed)}function update(id,field,val){function querySucceeded(result){return $rootScope.DEBUG_MODE&&console.log("updating ranking record succesful"),result.data}var obj={};obj.resource=[];var data={};data.id=id;for(var i=0;i<field.length;i++)data[field[i]]=val[i];obj.resource.push(data);for(var url=baseURI,idx=_tables.map(function(x){return x.id}).indexOf(id),i=0;i<field.length;i++)_tables[idx][field[i]]=val[i];return $http.patch(url,obj,{headers:{"Content-Type":"multipart/form-data"},body:obj}).then(querySucceeded,_queryFailed)}function _load(data){_tables.length=0,data.forEach(function(x){_tables.push(x)})}function _queryFailed(error){throw error}var _tables=[],_fetchAnswersMem=[];$rootScope.customranks=_tables;var baseURI="/api/v2/mysql/_table/customranks";return{getTables:getTables,getTablesX:getTablesX,getTablesD:getTablesD,getSingleTable:getSingleTable,update:update,addTable:addTable,addTableforAnswer:addTableforAnswer,deleteTable:deleteTable,getMostPopularData:getMostPopularData}}angular.module("app").factory("table2",table2),table2.$inject=["$http","$q","$rootScope","answer","$state","filter"]}(),function(){"use strict";function table($http,$q,$rootScope,answer,$state,filter,uaf,$window,catans,staticpages){function getInitialHomeData(data){for(var filterstr="?filter=(",i=0;i<data.length;i++)filterstr=filterstr+"id="+data[i]+")OR(";filterstr=filterstr.substring(0,filterstr.length-3);var url0=baseURI+filterstr+"&fields="+fields,p0=$http.get(url0);return $q.all([p0]).then(function(d){return _append(d[0].data.resource),$rootScope.DEBUG_MODE&&console.log("_tables length after initialhomedata load: ",_tables.length),_tables},_queryFailed)}function getTablesX(scope){var url0=baseURI+"?offset=0&filter=scope="+scope+"&fields="+fields,url1=baseURI+"?offset=1000&filter=scope="+scope+"&fields="+fields,url2=baseURI+"?offset=2000&filter=scope="+scope+"&fields="+fields,url3=baseURI+"?offset=3000&filter=scope="+scope+"&fields="+fields,p0=$http.get(url0),p1=$http.get(url1),p2=$http.get(url2),p3=$http.get(url3);return $q.all([p0,p1,p2,p3]).then(function(d){return _load(d[0].data.resource.concat(d[1].data.resource,d[2].data.resource,d[3].data.resource)),$rootScope.DEBUG_MODE&&console.log("tables length: ",_tables.length),_tables},_queryFailed)}function getTablesL(data){for(var filterstr="?filter=(",i=0;i<data.length;i++)filterstr=filterstr+"id="+data[i].category+")OR(";filterstr=filterstr.substring(0,filterstr.length-3);var url0=baseURI+filterstr+"&fields="+fields,p0=$http.get(url0);return $q.all([p0]).then(function(d){return _load(d[0].data.resource),$rootScope.DEBUG_MODE&&console.log("tables L length: ",_tables.length),_tables},_queryFailed)}function getTables(forceRefresh){var url0=baseURI+"?offset=0",url1=baseURI+"?offset=1000",url2=baseURI+"?offset=2000",url3=baseURI+"?offset=3000",p0=$http.get(url0),p1=$http.get(url1),p2=$http.get(url2),p3=$http.get(url3);return $q.all([p0,p1,p2,p3]).then(function(d){return _load(d[0].data.resource.concat(d[1].data.resource,d[2].data.resource,d[3].data.resource)),$rootScope.DEBUG_MODE&&console.log("tables length: ",_tables.length),_tables},_queryFailed)}function getSingleTable(id){var url0=baseURI+"/?filter=id="+id+"&fields="+fields,p0=$http.get(url0);return $q.all([p0]).then(function(d){var data=d[0].data.resource[0];return _append([data]),$rootScope.DEBUG_MODE&&console.log("single table loaded: ",data),data},_queryFailed)}function addTable(table){function querySucceeded(result){var tablex=table;tablex.id=result.data.resource[0].id;var idx=$rootScope.categories.map(function(x){return x.id}).indexOf(tablex.cat),catObj=$rootScope.categories[idx],idx2=$rootScope.locations.map(function(x){return x.id}).indexOf(tablex.nh),nhObj=$rootScope.locations[idx2],title=catObj.category.replace("@Nh",nhObj.nh_name);tablex.title=title,tablex.fimage=catObj.fimage,tablex.tags=catObj.tags,tablex.keywords=catObj.keywords,tablex.fc=catObj.fc,tablex.bc=catObj.bc,tablex.shade=catObj.shade,tablex.type=catObj.type,tablex.user=$rootScope.user.id,tablex.introtext=catObj.introtext;var searchStr=tablex.tags+" "+tablex.title;$rootScope.searchStr.push(searchStr);var slug=tablex.title.toLowerCase();return slug=slug.replace(/ /g,"-"),slug=slug.replace("/","at"),slug=slug.replace("?",""),slug=slug+"-"+result.data.resource[0].id,tablex.slug=slug,_tables.push(tablex),update(result.data.resource[0].id,["slug"],[slug]),uaf.post("addedRank",["category"],[tablex.id]),$rootScope.DEBUG_MODE&&console.log("result",result),result.data.resource[0].id}table.scope=$rootScope.SCOPE;var url=baseURI,resource=[];return resource.push(table),$http.post(url,resource,{headers:{"Content-Type":"multipart/form-data"},body:resource}).then(querySucceeded,_queryFailed)}function ghostTablesWithAnswer(ranks,ans){console.log("addGhostTableWithAnswer ",ranks,ans);var tids=[],p=[],granks=[],granksids=[];return p.push(answer.addAnswer(ans,[])),ranks.forEach(function(rank){rank.isghost?(granks.push(rank),p.push(addTable(rank))):tids.push(rank.id)}),$q.all(p).then(function(d){var ansid=d[0].resource[0].id;console.log("answer id - ",ansid);for(var i=1;i<d.length;i++)tids.push(d[i]),granksids.push(d[i]);return _updateCatstr(granks,granksids),console.log("tids - ",tids),tids.forEach(function(t){catans.postRec2(ansid,t)}),d})}function _updateCatstr(ranks,ids){console.log("@ _updateCatstr ",ranks,ids);for(var catvals=[],catstr="",n=0;n<ranks.length;n++)catvals=[],catstr="",_tables.forEach(function(t){if(t.cat==ranks[n].cat&&1==t.nh){console.log("Found parent rank"),catvals=t.catstr.split(":").map(Number),catvals.push(ids[n]),catstr="";for(var i=0;i<catvals.length;i++)catstr=catstr+":"+catvals[i];catstr=catstr.substring(1),console.log("updated catstr for table - ",t.id),update(t.id,["catstr"],[catstr])}})}function deleteTable(table_id){function querySucceeded(result){var filename="rank"+table_id+".html",data={};return data.filename=filename,staticpages.removeFile(data),$rootScope.DEBUG_MODE&&console.log("Deleting table was succesful"),result.data}var obj={};obj.resource=[];var data={};data.id=table_id,obj.resource.push(data);var url=baseURI+"/"+table_id,i=_tables.map(function(x){return x.id}).indexOf(table_id);return i>-1&&_tables.splice(i,1),$http.delete(url,data,{headers:{"Content-Type":"multipart/form-data"},body:obj}).then(querySucceeded,_queryFailed)}function update(id,field,val){function querySucceeded(result){return $rootScope.updated_rank_id=result.data.resource[0].id,$rootScope.DEBUG_MODE&&console.log("updating ranking record succesful"),result.data}var obj={};obj.resource=[];var data={};data.id=id;for(var i=0;i<field.length;i++)data[field[i]]=val[i];obj.resource.push(data);for(var url=baseURI,idx=_tables.map(function(x){return x.id}).indexOf(id),i=0;i<field.length;i++)_tables[idx][field[i]]=val[i];return $http.patch(url,obj,{headers:{"Content-Type":"multipart/form-data"},body:obj}).then(querySucceeded,_queryFailed)}function storeInitialHomeData(rids){var data=[],idx=0;rids.forEach(function(i){(idx=_tables.map(function(x){return x.id}).indexOf(i))>-1&&data.push(_tables[idx])}),$window.localStorage.setItem("Ranks-HomeData",JSON.stringify(data))}function _load(data){_tables.length=0,data.forEach(function(x){_tables.push(x)})}function _append(data){data.forEach(function(item){_tables.map(function(x){return x.id}).indexOf(item.id)<0&&_tables.push(item)})}function _queryFailed(error){throw error}var _tables=[];$rootScope.content=_tables;var baseURI="/api/v2/mysql/_table/ranking",service={getTables:getTables,getSingleTable:getSingleTable,update:update,addTable:addTable,deleteTable:deleteTable,getTablesX:getTablesX,getTablesL:getTablesL,getInitialHomeData:getInitialHomeData,ghostTablesWithAnswer:ghostTablesWithAnswer,storeInitialHomeData:storeInitialHomeData},fields="";return fields+="id,type,tags,keywords,question,image1url,image2url,image3url,",fields+="catstr,owner,slug,views,answers,numcom,scope,isatomic,ismp,cat,nh,timestmp",service}angular.module("app").factory("table",table),table.$inject=["$http","$q","$rootScope","answer","$state","filter","uaf","$window","catans","staticpages"]}(),function(){"use strict";function search($rootScope){function searchAnswers(query){var tagCapitalized="",tagFirstLowered="",results_ans=[],input=query,m=!1,an="";if(input&&input.length>=3)for(var inputVal=input,valTags=inputVal.split(" "),j=0;j<$rootScope.answers.length;j++){an=$rootScope.answers[j].name,m=!0;for(var k=0;k<valTags.length;k++){tagCapitalized=valTags[k].charAt(0).toUpperCase()+valTags[k].slice(1),tagFirstLowered=valTags[k].charAt(0).toLowerCase()+valTags[k].slice(1);var caseInsensitive=!1,equals=an.toLowerCase().split(" ").filter(function(antag){return antag==valTags[k].toLowerCase()});equals.length>=1&&(caseInsensitive=!0),m=m&&(an.indexOf(valTags[k])>-1||an.indexOf(valTags[k].toUpperCase())>-1||an.indexOf(tagCapitalized)>-1||an.indexOf(tagFirstLowered)>-1||caseInsensitive)}m&&($rootScope.isNh?$rootScope.answers[j].cityarea==$rootScope.cnh&&results_ans.push($rootScope.answers[j]):results_ans.push($rootScope.answers[j]))}return results_ans}function searchRanksMainPage(isCity,query){var tagCapitalized="",tagFirstLowered="",results=[],ss="",input=query;if(input){for(var inputVal=input,results_ss=[],m_ss=!0,valTags=inputVal.split(" "),j=0;j<$rootScope.searchStrContent.length;j++){ss=$rootScope.searchStrContent[j],$rootScope.content[j],m_ss=!0;for(var k=0;k<valTags.length;k++)tagCapitalized=valTags[k].charAt(0).toUpperCase()+valTags[k].slice(1),tagFirstLowered=valTags[k].charAt(0).toLowerCase()+valTags[k].slice(1),ss||console.log(j),m_ss=m_ss&&(ss.indexOf(valTags[k])>-1||ss.indexOf(valTags[k].toUpperCase())>-1||ss.indexOf(tagCapitalized)>-1||ss.indexOf(tagFirstLowered)>-1);m_ss&&isCity?$rootScope.content[j].mp&&results_ss.push($rootScope.content[j]):m_ss&&results_ss.push($rootScope.content[j])}results=results_ss}return results}function sibblingRanks(catObj,neighborhood){function compare(a,b){return b.ctr-a.ctr}var sibblingRanksX=[],sibblingRanks=[],catArr=[],sibExists=!1,searchtitle="",ansCtr=0,rankObj={};catObj.isatomic?catArr.push(catObj.id):catArr=catObj.catstr.split(":").map(Number);for(var idx=0,i=0;i<$rootScope.catansrecs.length;i++)for(var n=0;n<catArr.length;n++)if($rootScope.catansrecs[i].category==catArr[n]){for(var j=0;j<$rootScope.catansrecs.length;j++)if($rootScope.catansrecs[j].answer==$rootScope.catansrecs[i].answer&&(idx=$rootScope.content.map(function(x){return x.id}).indexOf($rootScope.catansrecs[j].category))>-1){sibExists=!1;for(var k=0;k<sibblingRanksX.length;k++)sibblingRanksX[k].title.substr(0,6)==$rootScope.content[idx].title.substr(0,6)&&(sibblingRanksX[k].ctr++,sibExists=!0);sibExists||(rankObj=$rootScope.content[idx],rankObj.ctr=1,sibblingRanksX.push(rankObj))}if(++ansCtr>=50)break}for(var i=0;i<sibblingRanksX.length;i++)if(sibblingRanksX[i].isatomic&&sibblingRanksX[i].ismp&&sibblingRanks.push(sibblingRanksX[i]),sibblingRanksX[i].isatomic||1==catObj.nh){if(sibblingRanksX[i].isatomic&&!sibblingRanksX[i].ismp||!sibblingRanksX[i].isatomic&&1!=sibblingRanksX[i].nh)for(var j=0;j<$rootScope.locations.length;j++)if(sibblingRanksX[i].title.indexOf($rootScope.locations[j].nh_name)>-1){searchtitle=sibblingRanksX[i].title.replace($rootScope.locations[j].nh_name,neighborhood);for(var rFound=!1,k=0;k<$rootScope.content.length;k++)if($rootScope.content[k].title==searchtitle){rankObj=$rootScope.content[k],rankObj.ctr=sibblingRanksX[i].ctr,rankObj.isghost=!1,sibblingRanks.push(rankObj),rFound=!0;break}if(!rFound){$rootScope.DEBUG_MODE&&console.log("Couldnt find: ",searchtitle," made it ghost :)");var ghostObj={};ghostObj.title=searchtitle,ghostObj.cat=sibblingRanksX[i].cat;var nidx=$rootScope.locations.map(function(x){return x.nh_name}).indexOf(neighborhood);ghostObj.nh=$rootScope.locations[nidx].id,ghostObj.isghost=!0,ghostObj.isatomic=!0,$rootScope.DEBUG_MODE&&console.log("ghost - ",ghostObj),sibblingRanks.push(ghostObj)}}}else sibblingRanks.push(sibblingRanksX[i]);return sibblingRanks=sibblingRanks.sort(compare),sibblingRanks.length>8?sibblingRanks.slice(0,8):sibblingRanks}function searchRanks(query){var rt="",ss="",tagCapitalized="",tagFirstLowered="",short=[],shortnames=["pb","ob","dt","mb"],corrnh=["Pacific Beach","Ocean Beach","Downtown","Mission Beach"];if(!$rootScope.locations)return[];for(var nh_names=$rootScope.locations.map(function(loc){return loc.nh_name}),i=0;i<corrnh.length;i++){var ind=nh_names.indexOf(corrnh[i]);if(-1!=ind){var loc=angular.copy($rootScope.locations[ind]);loc.nh_short_name=shortnames[i],short.push(loc)}}var rte=!1,results=[],input=query;if(input)if(input.indexOf("best")>-1&&(input=input.replace("best","")),input.indexOf("Best")>-1&&(input=input.replace("Best","")),input.indexOf("top")>-1&&(input=input.replace("top","")),input.indexOf("Top")>-1&&(input=input.replace("Top","")),input.indexOf("great")>-1&&(input=input.replace("great","")),input.indexOf("Great")>-1&&(input=input.replace("Great","")),input.indexOf("awesome")>-1&&(input=input.replace("awesome","")),input.indexOf("Awesome")>-1&&(input=input.replace("Awesome","")),input.indexOf("amazing")>-1&&(input=input.replace("amazing","")),input.indexOf("Amazing")>-1&&(input=input.replace("Amazing","")),input.indexOf("most")>-1&&(input=input.replace("most","")),input.indexOf("Most")>-1&&(input=input.replace("Most","")),input.indexOf("the ")>-1&&(input=input.replace("the ","")),input.indexOf("The ")>-1&&(input=input.replace("The ","")),input.indexOf("shops")>-1&&(input=input.replace("shops","")),input.indexOf("Shops")>-1&&(input=input.replace("Shops","")),input.indexOf("places")>-1&&(input=input.replace("places","")),input.indexOf("Places")>-1&&(input=input.replace("Places","")),input.indexOf("delicious")>-1&&(input=input.replace("delicious","")),input.indexOf("Delicious")>-1&&(input=input.replace("Delicious","")),input.indexOf("what ")>-1&&(input=input.replace("what ","")),input.indexOf("What ")>-1&&(input=input.replace("What ","")),input.indexOf("are ")>-1&&(input=input.replace("are ","")),input.indexOf("where ")>-1&&(input=input.replace("where ","")),input.indexOf("Where ")>-1&&(input=input.replace("Where ","")),input.length>=3){var inputVal=input;inputVal.indexOf("near me")>-1||inputVal.indexOf("near")>-1||inputVal.indexOf("close")>-1||inputVal.indexOf("close to")>-1||inputVal.indexOf("close to me")>-1?(!0,inputVal=inputVal.replace("near me","in San Diego"),inputVal=inputVal.replace("near","in San Diego"),inputVal=inputVal.replace("close to me","in San Diego"),inputVal=inputVal.replace("close to","in San Diego"),inputVal=inputVal.replace("close","in San Diego")):!1,"Food"==inputVal&&(inputVal=inputVal.replace("Food","Food Near Me")),"food"==inputVal&&(inputVal=inputVal.replace("food","Food Near Me")),$rootScope.isNh&&(inputVal=inputVal+" "+$rootScope.cnh);for(var results_ss=[],results_rt=[],rObj={},ignoreTagsIdx=[],m_ss=!0,m_rt=!0,m_nh=!1,nh=[],valTags=inputVal.toLowerCase().split(" "),k=0;k<valTags.length;k++){if(tagCapitalized=valTags[k].charAt(0).toUpperCase()+valTags[k].slice(1),tagFirstLowered=valTags[k].charAt(0).toLowerCase()+valTags[k].slice(1),valTags[k].length>=3&&"car"!=valTags[k]&&"del"!=valTags[k]&&"bar"!=valTags[k])for(var q=0;q<$rootScope.locations.length;q++)($rootScope.locations[q].nh_name.toLowerCase().indexOf(valTags[k])>-1||$rootScope.locations[q].nh_name.toLowerCase().indexOf(valTags[k].toUpperCase())>-1||$rootScope.locations[q].nh_name.indexOf(tagCapitalized)>-1||$rootScope.locations[q].nh_name.indexOf(tagFirstLowered)>-1)&&(checkNoDupThenPush($rootScope.locations[q],nh),m_nh=!0,ignoreTagsIdx.push(k));if(2==valTags[k].length)for(var q=0;q<short.length;q++)(short[q].nh_short_name.toLowerCase().indexOf(valTags[k])>-1||short[q].nh_short_name.toLowerCase().indexOf(valTags[k].toUpperCase())>-1||short[q].nh_short_name.indexOf(tagCapitalized)>-1||short[q].nh_short_name.indexOf(tagFirstLowered)>-1)&&(checkNoDupThenPush(short[q],nh),m_nh=!0,ignoreTagsIdx.push(k))}ignoreTagsIdx.push(valTags.indexOf("la"));for(var j=0;j<$rootScope.categories.length;j++)if($rootScope.categories[j].category.indexOf("@Nh")>-1){ss=$rootScope.searchStr[j],rt=$rootScope.categories[j].category,$rootScope.categories[j],m_ss=!0,m_rt=!0;for(var k=0;k<valTags.length;k++)ignoreTagsIdx.indexOf(k)<0&&(tagCapitalized=valTags[k].charAt(0).toUpperCase()+valTags[k].slice(1),tagFirstLowered=valTags[k].charAt(0).toLowerCase()+valTags[k].slice(1),ss||console.log(j),m_ss=m_ss&&(ss.indexOf(valTags[k])>-1||ss.indexOf(valTags[k].toUpperCase())>-1||ss.indexOf(tagCapitalized)>-1||ss.indexOf(tagFirstLowered)>-1),m_rt=m_rt&&(rt.indexOf(valTags[k])>-1||rt.indexOf(valTags[k].toUpperCase())>-1||rt.indexOf(tagCapitalized)>-1||rt.indexOf(tagFirstLowered)>-1));if(m_rt){if(rObj={},rObj=JSON.parse(JSON.stringify($rootScope.categories[j])),m_nh)for(var n=0;n<nh.length;n++)rObj={},rObj=JSON.parse(JSON.stringify($rootScope.categories[j])),rObj.title=rObj.category.replace("@Nh",nh[n].nh_name),rObj.locationId=nh[n].id,rObj.useTemp=!0,results_rt.push(rObj);else rObj.title=rObj.category.replace("@Nh","San Diego"),rObj.locationId=1,rObj.useTemp=!0,results_rt.push(rObj);rte=!0}else if(m_ss)if(rObj={},rObj=JSON.parse(JSON.stringify($rootScope.categories[j])),m_nh)for(var n=0;n<nh.length;n++)rObj={},rObj=JSON.parse(JSON.stringify($rootScope.categories[j])),rObj.title=rObj.category.replace("@Nh",nh[n].nh_name),rObj.locationId=nh[n].id,rObj.useTemp=!0,results_ss.push(rObj);else rObj.title=rObj.category.replace("@Nh","San Diego"),rObj.locationId=1,rObj.useTemp=!0,results_ss.push(rObj)}rte&&(results=results.concat(results_rt)),results=results.concat(results_ss)}else results=[];return results}function searchRanks2(query){var rt="",ss="",tagCapitalized="",tagFirstLowered="",shortnames=["pb","ob","dt","mb"],corrnh=["Pacific Beach","Ocean Beach","Downtown","Mission Beach"],rte=!1,results=[],input=query;if(input)if(input.indexOf("best")>-1&&(input=input.replace("best","")),input.indexOf("Best")>-1&&(input=input.replace("Best","")),input.indexOf("top")>-1&&(input=input.replace("top","")),input.indexOf("Top")>-1&&(input=input.replace("Top","")),input.indexOf("great")>-1&&(input=input.replace("great","")),input.indexOf("Great")>-1&&(input=input.replace("Great","")),input.indexOf("awesome")>-1&&(input=input.replace("awesome","")),input.indexOf("Awesome")>-1&&(input=input.replace("Awesome","")),input.indexOf("amazing")>-1&&(input=input.replace("amazing","")),input.indexOf("Amazing")>-1&&(input=input.replace("Amazing","")),input.indexOf("most")>-1&&(input=input.replace("most","")),input.indexOf("Most")>-1&&(input=input.replace("Most","")),input.indexOf("the ")>-1&&(input=input.replace("the ","")),input.indexOf("The ")>-1&&(input=input.replace("The ","")),input.indexOf("shops")>-1&&(input=input.replace("shops","")),input.indexOf("Shops")>-1&&(input=input.replace("Shops","")),input.indexOf("places")>-1&&(input=input.replace("places","")),input.indexOf("Places")>-1&&(input=input.replace("Places","")),input.indexOf("delicious")>-1&&(input=input.replace("delicious","")),input.indexOf("Delicious")>-1&&(input=input.replace("Delicious","")),input.length>=3){var inputVal=input;"pho"!=inputVal&&"Pho"!=inputVal||(inputVal="vietnamese"),$rootScope.isNh&&(inputVal=inputVal+" "+$rootScope.cnh);for(var results_ss=[],results_rt=[],rObj={},m_ss=!0,m_rt=!0,m_nh=!1,valTags=inputVal.toLowerCase().split(" "),k=0;k<valTags.length;k++){if(tagCapitalized=valTags[k].charAt(0).toUpperCase()+valTags[k].slice(1),tagFirstLowered=valTags[k].charAt(0).toLowerCase()+valTags[k].slice(1),valTags[k].length>=3&&"car"!=valTags[k]&&"del"!=valTags[k]&&"bar"!=valTags[k])for(var q=0;q<$rootScope.locations.length;q++)($rootScope.locations[q].nh_name.toLowerCase().indexOf(valTags[k])>-1||$rootScope.locations[q].nh_name.toLowerCase().indexOf(valTags[k].toUpperCase())>-1||$rootScope.locations[q].nh_name.indexOf(tagCapitalized)>-1||$rootScope.locations[q].nh_name.indexOf(tagFirstLowered)>-1)&&(m_nh=!0);if(2==valTags[k].length)for(var q=0;q<shortnames.length;q++)shortnames[q]!=valTags[k]&&shortnames[q]!=valTags[k].toUpperCase()&&shortnames[q]!=tagCapitalized&&shortnames[q]!=tagFirstLowered||(m_nh=!0,valTags[k]=corrnh[q])}for(var j=0;j<$rootScope.content.length;j++)if(ss=$rootScope.searchStrContent[j],rt=$rootScope.content[j].title,$rootScope.content[j],rt&&ss){m_ss=!0,m_rt=!0;for(var k=0;k<valTags.length;k++)tagCapitalized=valTags[k].charAt(0).toUpperCase()+valTags[k].slice(1),tagFirstLowered=valTags[k].charAt(0).toLowerCase()+valTags[k].slice(1),ss||console.log(j),m_ss=m_ss&&(ss.indexOf(valTags[k])>-1||ss.indexOf(valTags[k].toUpperCase())>-1||ss.indexOf(tagCapitalized)>-1||ss.indexOf(tagFirstLowered)>-1),m_rt=m_rt&&(rt.indexOf(valTags[k])>-1||rt.indexOf(valTags[k].toUpperCase())>-1||rt.indexOf(tagCapitalized)>-1||rt.indexOf(tagFirstLowered)>-1);m_rt?(rObj={},rObj=JSON.parse(JSON.stringify($rootScope.content[j])),rObj.useTemp=!1,m_nh?results_rt.push(rObj):rObj.ismp&&results_rt.push(rObj),rte=!0):m_ss&&(rObj={},rObj=JSON.parse(JSON.stringify($rootScope.content[j])),rObj.useTemp=!1,m_nh?results_ss.push(rObj):rObj.ismp&&results_ss.push(rObj))}else console.log("this has issues - content.id - ",$rootScope.content[j]);results_rt.length>2&&shuffle(results_rt),rte&&(results=results.concat(results_rt)),results_ss.length>2&&shuffle(results_ss),results=results.concat(results_ss)}else results=[];return results}function checkNoDupThenPush(x,array){for(var isdup=!1,i=0;i<array.length;i++)if(x.nh_name==array[i].nh_name){isdup=!0;break}isdup||array.push(x)}function shuffle(array){
for(var temporaryValue,randomIndex,currentIndex=array.length;0!==currentIndex;)randomIndex=Math.floor(Math.random()*currentIndex),currentIndex-=1,temporaryValue=array[currentIndex],array[currentIndex]=array[randomIndex],array[randomIndex]=temporaryValue;return array}function searchRelatedRanks(ranks,query){for(var tagsm=[],tagsr=[],tstr="",idx1=0,obj={},i=0;i<ranks.length;i++)if(1==ranks[i].isAnswer);else{tstr=ranks[i].tags.replace(/,/g," "),tagsr=tstr.split(" ");for(var j=0;j<tagsr.length;j++)"isMP"!=tagsr[j]&&tagsr[j]!=query&&(idx1=tagsm.map(function(x){return x.tag}).indexOf(tagsr[j]),idx1<0?(obj={},obj.tag=tagsr[j],obj.ctr=1,tagsm.push(obj)):tagsm[idx1].ctr++)}return tagsm=tagsm.sort(compare)}function compare(a,b){return b.ctr-a.ctr}return{searchRanks:searchRanks,searchRanks2:searchRanks2,searchAnswers:searchAnswers,searchRanksMainPage:searchRanksMainPage,sibblingRanks:sibblingRanks,searchRelatedRanks:searchRelatedRanks}}angular.module("app").service("search",search),search.$inject=["$rootScope"]}(),function(){"use strict";function rankofday($http,$q,$rootScope){function getrankofday(forceRefresh){function pad(n){return n}function querySucceeded(result){if(0!=result.data.resource.length){var rodObj=result.data.resource[0],url1="/api/v2/mysql/_table/categories/?filter=id="+rodObj.category,url2="/api/v2/mysql/_table/ranking/?filter=(cat="+rodObj.category+") AND (nh=1)",p1=$http.get(url1),p2=$http.get(url2);return $q.all([p1,p2]).then(function(d){var rankObj=d[1].data.resource[0],catObj=d[0].data.resource[0];return rankObj.title=catObj.category.replace("@Nh","San Diego"),rankObj.fimage=catObj.fimage,rankObj.introtext=catObj.introtext,rankObj.tags=catObj.tags,rankObj.question=catObj.question,rankObj.type=catObj.type,rankObj.fc=catObj.fc,rankObj.bc=catObj.bc,rankObj.shade=catObj.shade,_rankofday.push(rankObj),$rootScope.$emit("rodReady"),_rankofday},function(err){console.log("Error getting rank of day data: ",err)})}}var datenow=new Date,tz=datenow.getTimezoneOffset();datenow.setMinutes(datenow.getMinutes()-tz);var dateStr=pad(datenow.getMonth()+1)+"/"+pad(datenow.getDate())+"/"+datenow.getFullYear(),url=baseURI+"/?filter=date="+dateStr;return $http.get(url).then(querySucceeded,_queryFailed)}function getall(){function querySucceeded(result){return _allranks=result.data.resource}var url=baseURI;return $http.get(url).then(querySucceeded,_queryFailed)}function update(id,field,val){function querySucceeded(result){return console.log("updating rank of day succesful"),result.data}var obj={};obj.resource=[];var data={};data.id=id;for(var i=0;i<field.length;i++)data[field[i]]=val[i];obj.resource.push(data);for(var url=baseURI,idx=_allranks.map(function(x){return x.id}).indexOf(id),i=0;i<field.length;i++)_allranks[idx][field[i]]=val[i];return $http.patch(url,obj,{headers:{"Content-Type":"multipart/form-data"},body:obj}).then(querySucceeded,_queryFailed)}function _queryFailed(error){throw error}var _rankofday=[];$rootScope.rankofday=_rankofday;var _allranks=[],baseURI="/api/v2/mysql/_table/rankofday";return{getrankofday:getrankofday,getall:getall,update:update}}angular.module("app").factory("rankofday",rankofday),rankofday.$inject=["$http","$q","$rootScope"]}(),function(){"use strict";function pvisits($http,$q,$rootScope){function getpvisits(forceRefresh){function querySucceeded(result){return _pvisits=result.data.resource}if(_arepvisitsLoaded()&&!forceRefresh)return $q.when(_pvisits);var url=baseURI;return $http.get(url).then(querySucceeded,_queryFailed)}function postRec(date){function querySucceeded(result){var id=result.data.resource[0].id;return _pvisits[_pvisits.length-1].id=id,$rootScope.DEBUG_MODE&&console.log("creating pvisits record was succesful"),result.data}var data={};data.date=date,data.nvisits=1;var obj={};obj.resource=[],obj.resource.push(data),_pvisits.push(data);var url=baseURI;return $http.post(url,obj,{headers:{"Content-Type":"multipart/form-data"},body:obj}).then(querySucceeded,_queryFailed)}function patchRec(rec_id,visits){function querySucceeded(result){return $rootScope.DEBUG_MODE&&console.log("Updating pvisits record was succesful"),result.data}var obj={};obj.resource=[];var data={};data.id=rec_id,data.nvisits=visits,obj.resource.push(data);var url=baseURI;return $http.patch(url,obj,{headers:{"Content-Type":"multipart/form-data"},body:obj}).then(querySucceeded,_queryFailed)}function deleteRec(rec_id){function querySucceeded(result){return $rootScope.DEBUG_MODE&&console.log("Deleting user activity record was succesful"),result.data}for(var i=0;i<_pvisits.length;i++)_pvisits[i].id==rec_id&&_pvisits.splice(i,1);var url=baseURI+"/"+rec_id;return $http.delete(url).then(querySucceeded,_queryFailed)}function _arepvisitsLoaded(){return _pvisits.length>0}function _queryFailed(error){throw error}var _pvisits=[],baseURI="/api/v2/mysql/_table/pvisits";return{getpvisits:getpvisits,postRec:postRec,patchRec:patchRec,deleteRec:deleteRec}}angular.module("app").factory("pvisits",pvisits),pvisits.$inject=["$http","$q","$rootScope"]}(),function(){"use strict";function locations($http,$q,$rootScope){function getAllLocations(forceRefresh){if(_locations.length>0&&!forceRefresh)return $q.when(_locations);var url0=baseURI+"?offset=0",p0=$http.get(url0);return $q.all([p0]).then(function(d){return _load(d[0].data.resource),$rootScope.DEBUG_MODE&&console.log("No. Categories ",_locations.length),_locations},_queryFailed)}function getLocationsL(data){for(var filterstr="?filter=(",i=0;i<data.length;i++)filterstr=filterstr+"id="+data[i].nh+")OR(";filterstr=filterstr.substring(0,filterstr.length-3);var url0=baseURI+filterstr,p0=$http.get(url0);return $q.all([p0]).then(function(d){return _load(d[0].data.resource),$rootScope.DEBUG_MODE&&console.log("No. Categories ",_categories.length),_locations},_queryFailed)}function getLocation(id){var url0=baseURI+"/?filter=id="+id,p0=$http.get(url0);return $q.all([p0]).then(function(d){var data=d[0].data.resource;return $rootScope.DEBUG_MODE&&console.log("loaded single location ",data),data},_queryFailed)}function addLocation(location){function querySucceeded(result){var locationx=location;return locationx.id=result.data.resource[0].id,_locations.push(locationx),$rootScope.DEBUG_MODE&&console.log("adding locationx succesful",result),result.data}var url=baseURI,resource=[];return resource.push(location),$http.post(url,resource,{headers:{"Content-Type":"multipart/form-data"},body:resource}).then(querySucceeded,_queryFailed)}function update(id,field,val){function querySucceeded(result){return $rootScope.DEBUG_MODE&&console.log("updating locationx succesful"),result.data}var obj={};obj.resource=[];var data={};data.id=id;for(var i=0;i<field.length;i++)data[field[i]]=val[i];obj.resource.push(data);for(var url=baseURI,idx=_locations.map(function(x){return x.id}).indexOf(id),i=0;i<field.length;i++)_locations[idx][field[i]]=val[i];return $http.patch(url,obj,{headers:{"Content-Type":"multipart/form-data"},body:obj}).then(querySucceeded,_queryFailed)}function deleteRec(location_id){function querySucceeded(result){return $rootScope.DEBUG_MODE&&console.log("Deleting location was succesful"),result.data}var obj={};obj.resource=[];var data={};data.id=location_id,obj.resource.push(data);var url=baseURI+"/"+location_id,i=_locations.map(function(x){return x.id}).indexOf(location_id);return i>-1&&_locations.splice(i,1),$http.delete(url,data,{headers:{"Content-Type":"multipart/form-data"},body:obj}).then(querySucceeded,_queryFailed)}function _load(data){_locations.length=0,data.forEach(function(x){_locations.push(x)})}function _queryFailed(error){throw error}var _locations=[];$rootScope.locations=_locations;var baseURI="/api/v2/mysql/_table/locations";return{getAllLocations:getAllLocations,getLocationsL:getLocationsL,getLocation:getLocation,addLocation:addLocation,update:update,deleteRec:deleteRec}}angular.module("app").factory("locations",locations),locations.$inject=["$http","$q","$rootScope"]}(),function(){"use strict";function headline($http,$q,$rootScope){function getheadlines(forceRefresh){if(_areheadlinesLoaded()&&!forceRefresh)return $q.when(_headlines);var url0=baseURI+"?offset=0",p0=$http.get(url0);return $q.all([p0]).then(function(d){return _load(d[0].data.resource),_headlines},_queryFailed)}function addheadline(headline){function querySucceeded(result){var headlinex=headline;return headlinex.id=result.data.resource[0].id,_headlines.push(headlinex),$rootScope.DEBUG_MODE&&console.log("result",result),result.data}var url=baseURI,resource=[];return resource.push(headline),$http.post(url,resource,{headers:{"Content-Type":"multipart/form-data"},body:resource}).then(querySucceeded,_queryFailed)}function update(id,field,val){function querySucceeded(result){return console.log("updating headlines succesful"),result.data}var obj={};obj.resource=[];var data={};data.id=id;for(var i=0;i<field.length;i++)switch(field[i]){case"city":data.city=val[i];break;case"nh":data.nh=val[i];break;case"title":data.title=val[i];break;case"filter":data.filter=val[i];break;case"bc":data.bc=val[i];break;case"fc":data.fc=val[i]}obj.resource.push(data);for(var url=baseURI,idx=_headlines.map(function(x){return x.id}).indexOf(id),i=0;i<field.length;i++)switch(field[i]){case"city":$rootScope.content[idx].city=val[i];break;case"nh":$rootScope.content[idx].nh=val[i];break;case"title":$rootScope.content[idx].title=val[i];break;case"filter":$rootScope.content[idx].filter=val[i];break;case"bc":$rootScope.content[idx].bc=val[i];break;case"fc":$rootScope.content[idx].fc=val[i]}return $http.patch(url,obj,{headers:{"Content-Type":"multipart/form-data"},body:obj}).then(querySucceeded,_queryFailed)}function _load(data){_headlines.length=0,data.forEach(function(x){_headlines.push(x)})}function _areheadlinesLoaded(){return _headlines.length>0}function _queryFailed(error){throw error}var _headlines=[];$rootScope.headlines=_headlines;var baseURI="/api/v2/mysql/_table/headlines";return{getheadlines:getheadlines,addheadline:addheadline,update:update}}angular.module("app").factory("headline",headline),headline.$inject=["$http","$q","$rootScope"]}(),function(){"use strict";function dataloader($http,$q,$rootScope,pvisits,table2,dialog,rankofday,answer,table,special,datetime,uaf,common,$timeout,matchrec,edit,useractivity,vrows,headline,cblock,catans,categories,locations){function getInitialData(){$rootScope.DEBUG_MODE&&console.log("get initial data called"),shuffle();var p1=table.getInitialHomeData(ridsx),p2=categories.getInitialHomeData(cidsx);$q.all([p1,p2]).then(function(d){unwrap(),waitforImages(d[1]),gethomedataX($rootScope.SCOPE)})}function gethomedataX(scope){$rootScope.DEBUG_MODE&&console.log("gethomedataX called"),$rootScope.pageDataLoaded=!1;var p0=table.getTablesX(scope),p1=categories.getAllCategoriesX(scope),p2=locations.getAllLocations();answer.getAnswersX(scope).then(function(){getEstablishmentAnswers(),$rootScope.pageDataLoaded=!0,checkStatus()});return $q.all([p0,p1,p2]).then(function(d){unwrap(),createSearchStrings(),$rootScope.isLoggedIn&&getDemoData(),getSecondaryData(),table.storeInitialHomeData(ridsx),categories.storeInitialHomeData(cidsx),$rootScope.nhs=$rootScope.locations.map(function(x){return x.nh_name}),$rootScope.DEBUG_MODE&&console.log("cwrapper data ready!"),$rootScope.$emit("homeDataLoaded")})}function getSecondaryData(){uaf.getactions(),headline.getheadlines()}function unwrap(){$rootScope.DEBUG_MODE&&console.log("dataloader.unwrap");for(var nhObj={},catObj={},idx=-1,idx2=-1,idx=0,i=0;i<$rootScope.content.length;i++)idx=$rootScope.locations.map(function(x){return x.id}).indexOf($rootScope.content[i].nh),nhObj=$rootScope.locations[idx],idx2=$rootScope.categories.map(function(x){return x.id}).indexOf($rootScope.content[i].cat),catObj=$rootScope.categories[idx2],void 0==nhObj&&(nhObj={},nhObj.nh_name="San Diego",nhObj.id=1,nhObj.sub_areas=""),catObj?($rootScope.content[i].title=catObj.category.replace("@Nh",nhObj.nh_name),$rootScope.content[i].fimage=catObj.fimage,$rootScope.content[i].bc=catObj.bc,$rootScope.content[i].fc=catObj.fc,$rootScope.content[i].tags=catObj.tags,$rootScope.content[i].keywords=catObj.keywords,$rootScope.content[i].type=catObj.type,$rootScope.content[i].question=catObj.question,$rootScope.content[i].shade=catObj.shade,1==$rootScope.content[i].nh?$rootScope.content[i].introtext=catObj.introtext:$rootScope.content[i].introtext="",$rootScope.content[i].user=catObj.user,nhObj.sub_areas&&catObj.category.indexOf("@Nh")>-1?$rootScope.content[i].isatomic=!1:$rootScope.content[i].isatomic=!0,null!=catObj.ismp&&void 0!=catObj.ismp?$rootScope.content[i].ismp=catObj.ismp:1==nhObj.id?$rootScope.content[i].ismp=!0:$rootScope.content[i].ismp=!1):$rootScope.DEBUG_MODE&&console.log("Couldnt find this category --- ",$rootScope.content[i].cat)}function unwrapSingle(rankObj,catObj,nhObj){$rootScope.DEBUG_MODE&&console.log("dataloader.unwrapSingle");var idx=$rootScope.content.map(function(x){return x.id}).indexOf(rankObj.id),rank=$rootScope.content[idx];rank.title=catObj.category.replace("@Nh",nhObj.nh_name),rank.fimage=catObj.fimage,rank.bc=catObj.bc,rank.fc=catObj.fc,rank.tags=catObj.tags,rank.keywords=catObj.keywords,rank.type=catObj.type,rank.question=catObj.question,rank.shade=catObj.shade,1==rank.nh?rank.introtext=catObj.introtext:rank.introtext="",rank.user=catObj.user,nhObj.sub_areas&&catObj.category.indexOf("@Nh")>-1?rank.isatomic=!1:rank.isatomic=!0,null!=catObj.ismp&&void 0!=catObj.ismp?rank.ismp=catObj.ismp:1==nhObj.id?rank.ismp=!0:rank.ismp=!1}function getDemoData(){var demoCustomRanks=[{category:11091,id:11091},{category:11092,id:11092},{category:11093,id:11093}];table2.getTablesD(demoCustomRanks).then(function(){demoData1of3=!0,checkDemoDataStatus()}),catans.getAllcatansX(demoCustomRanks).then(function(result2){0!=result2?answer.getAnswersFromCatans(result2).then(function(){demoData2of3=!0,checkDemoDataStatus()}):(demoData2of3=!0,checkDemoDataStatus())}),special.getSpecialsbyAnswer(1).then(function(){demoData3of3=!0,checkDemoDataStatus()})}function checkDemoDataStatus(){demoDataReady=demoData1of3&&demoData2of3&&demoData3of3}function getEstablishmentAnswers(){$rootScope.estAnswers=[],$rootScope.estNames=[],$rootScope.pplAnswers=[],$rootScope.pplNames=[],$rootScope.plaAnswers=[],$rootScope.plaNames=[],$rootScope.freAnswers=[],$rootScope.freNames=[],$rootScope.orgNames=[],$rootScope.orgAnswers=[],$rootScope.orgNames=[];for(var i=0;i<$rootScope.answers.length;i++)"Establishment"==$rootScope.answers[i].type&&($rootScope.estNames.push($rootScope.answers[i].name),$rootScope.estAnswers.push($rootScope.answers[i])),"Person"==$rootScope.answers[i].type&&($rootScope.pplNames.push($rootScope.answers[i].name),$rootScope.pplAnswers.push($rootScope.answers[i])),"Place"==$rootScope.answers[i].type&&($rootScope.plaNames.push($rootScope.answers[i].name),$rootScope.plaAnswers.push($rootScope.answers[i])),"Organization"==$rootScope.answers[i].type&&($rootScope.orgNames.push($rootScope.answers[i].name),$rootScope.orgAnswers.push($rootScope.answers[i])),"PersonCust"==$rootScope.answers[i].type&&($rootScope.freNames.push($rootScope.answers[i].name),$rootScope.freAnswers.push($rootScope.answers[i]))}function createSearchStrings(){$rootScope.searchStr=[];for(var i=0;i<$rootScope.categories.length;i++)$rootScope.searchStr[i]=($rootScope.categories[i].tags?$rootScope.categories[i].tags:"")+" "+($rootScope.categories[i].title?$rootScope.categories[i].title:"");$rootScope.searchStrContent=[];for(var i=0;i<$rootScope.content.length;i++)$rootScope.searchStrContent[i]=($rootScope.content[i].tags?$rootScope.content[i].tags:"")+" "+($rootScope.content[i].title?$rootScope.content[i].title:"")}function pulldata(type,data){"ranks"==type&&catans.getAllcatansX(data).then(function(result){if(result)for(var si=0,ei=result.length>200?200:result.length;si<result.length;)answer.getAnswersFromCatans(result.slice(si,ei)),special.getSpecialsX(result.slice(si,ei)),vrows.getVrowsX(result.slice(si,ei)),matchrec.GetMatchTableX(result.slice(si,ei)),edit.getEditsX(result.slice(si,ei)),table2.getTablesX(result.slice(si,ei)),si=ei,(ei+=200)>result.length&&(ei=result.length)}),"answers"==type&&(answer.getAnswers(data),catans.getAllcatansY(data).then(function(result){if(result){for(var si=0,ei=result.length>200?200:result.length;si<result.length;)special.getSpecialsX(result.slice(si,ei)),vrows.getVrowsX(result.slice(si,ei)),matchrec.GetMatchTableX(result.slice(si,ei)),edit.getEditsX(result.slice(si,ei)),table2.getTablesX(result.slice(si,ei)).then(function(result2){0!=result2&&pulldata("ranks",result2)}),si=ei,(ei+=200)>result.length&&(ei=result.length);var cranks=[],cr={};data.forEach(function(item){if(null!=item.ranks&&item.ranks.length>2){cr=JSON.parse(item.ranks);for(var i=0;i<cr.length;i++)cranks.push(cr[i])}}),cranks.length>0&&pulldata("ranks",cranks)}}))}function getRank(slug){$rootScope.DEBUG_MODE&&console.log("getRank exec");var rankid=common.getIndexFromSlug(slug);if($rootScope.isCustomRank){var p0=table2.getSingleTable(rankid);catans.getAllcatansX([{id:rankid}]).then(function(result){if(result){var p1=answer.getAnswersFromCatans(result),p2=special.getSpecialsX(result),p3=vrows.getVrowsX(result),p4=matchrec.GetMatchTableX(result),p5=edit.getEditsX(result),p6=table2.getTablesX(result);$q.all([p0,p1,p2,p3,p4,p5,p6]).then(function(){$rootScope.$emit("rankDataLoaded")})}})}else var p0=table.getSingleTable(rankid).then(function(res){var rankObj=res,p1=categories.getCategory(rankObj.cat),p2=locations.getLocation(rankObj.nh);catans.getAllcatansX([rankObj]).then(function(result){if(result){var p4=answer.getAnswersFromCatans(result),p5=special.getSpecialsX(result),p6=vrows.getVrowsX(result),p7=matchrec.GetMatchTableX(result),p8=edit.getEditsX(result),p9=table2.getTablesX(result);$q.all([p1,p2,p4,p5,p6,p7,p8,p9]).then(function(d){var catObj=d[0][0],nhObj=d[1][0];unwrapSingle(rankObj,catObj,nhObj),$rootScope.$emit("rankDataLoaded")})}}),void 0==$rootScope.SCOPE&&($rootScope.SCOPE=rankObj.scope)})}function getAnswer(slug){var ansid=common.getIndexFromSlug(slug),data={};data.id=ansid,data.answer=ansid;var p0=answer.getAnswer(ansid),p1=special.getSpecialsX([data]),p2=matchrec.GetMatchTableX([data]),p3=edit.getEditsX([data]),p4=table2.getTablesX([data]),p5=vrows.getVrowsX([data]);catans.getAllcatansY([data]).then(function(result){if(result)var p6=table.getTablesL(result).then(function(resultx){resultx.constructor===Array||(resultx=[resultx]);var p7=categories.getCategoriesL(resultx),p8=locations.getLocationsL(resultx);$q.all([p0,p1,p2,p3,p4,p5,p6,p7,p8]).then(function(d){var ans=d[0];unwrap(),void 0==$rootScope.SCOPE&&($rootScope.SCOPE=ans.scope),$rootScope.$emit("answerDataLoaded")})});else $rootScope.$emit("answerDataLoaded")})}function checkStatus(){$rootScope.pageDataLoaded&&_ranksLoaded&&!landAnswerActive&&($rootScope.rankSummaryDataLoaded=!0,$rootScope.answerDetailLoaded=!0,$rootScope.$emit("rankDataLoaded"))}function waitforImages(cats){var pArr=[];cats.forEach(function(item){null!=item.fimage&&void 0!=item.fimage&&item.fimage.indexOf("rankx")>-1&&pArr.push($http.get(item.fimage))}),$q.all(pArr).then(function(){$rootScope.$emit("initalHomeDataLoaded")})}function shuffle(){for(var N=rids.length,idxs=[],n=0;idxs.length<12;)n=Math.floor(Math.random()*N),-1==idxs.indexOf(n)&&idxs.push(n);idxs.forEach(function(i){ridsx.push(rids[i]),cidsx.push(cids[i])})}var service={gethomedataX:gethomedataX,getRank:getRank,getAnswer:getAnswer,getInitialData:getInitialData,unwrap:unwrap,unwrapSingle:unwrapSingle,createSearchStrings:createSearchStrings,pulldata:pulldata,getDemoData:getDemoData},_ranksLoaded=!1,demoData1of3=!1,demoData2of3=!1,demoData3of3=!1,demoDataReady=!1,landAnswerActive=!1,rids=[1733,11619,11285,11288,11673,9734,468,9822,11271,11927,11241,7674,368,43,1728,7965,9735,192,10339,9903,11598,12041,93,12020,3125],cids=[1164,1130,1403,1407,1313,1275,1149,1276,1390,1475,1367,1241,1128,1092,1161,1260,1277,1112,1305,1293,1106,1542,1104,1535,1200],ridsx=[],cidsx=[];return service}angular.module("app").factory("dataloader",dataloader),dataloader.$inject=["$http","$q","$rootScope","pvisits","table2","dialog","rankofday","answer","table","special","datetime","uaf","common","$timeout","matchrec","edit","useractivity","vrows","headline","cblock","catans","categories","locations"]}(),function(){"use strict";function cblock($http,$q,$rootScope){function getcblocks(forceRefresh){if(_arecblocksLoaded()&&!forceRefresh)return $q.when(_cblocks);var url0=baseURI+"?offset=0",p0=$http.get(url0);return $q.all([p0]).then(function(d){return _cblocks=d[0].data.resource,$rootScope.DEBUG_MODE&&console.log("No. C-Blocks: ",_cblocks.length),_cblocks},_queryFailed)}function getcblocksmain(){var url0=baseURI+"/?filter=ismp=true",p0=$http.get(url0);return $q.all([p0]).then(function(d){return _cblocks=d[0].data.resource,$rootScope.DEBUG_MODE&&console.log("No. C-Blocks: ",_cblocks.length),_cblocks},_queryFailed)}function getcblocksall(){var url0=baseURI+"/?filter=ismp=false",p0=$http.get(url0);return $q.all([p0]).then(function(d){return _cblocks=_cblocks.concat(d[0].data.resource),$rootScope.DEBUG_MODE&&console.log("No. C-Blocks: ",_cblocks.length),_cblocks},_queryFailed)}function addcblock(cblock){function querySucceeded(result){var cblockx=cblock;return cblockx.id=result.data.resource[0].id,_cblocks.push(cblockx),console.log("adding cblock succesful",result),result.data}var url=baseURI,resource=[];return resource.push(cblock),$http.post(url,resource,{headers:{"Content-Type":"multipart/form-data"},body:resource}).then(querySucceeded,_queryFailed)}function update(id,field,val){function querySucceeded(result){return console.log("updating cblocks succesful"),result.data}var obj={};obj.resource=[];var data={};data.id=id;for(var i=0;i<field.length;i++)switch(field[i]){case"catstr":data.catstr=val[i];break;case"ismp":data.ismp=val[i]}obj.resource.push(data);for(var url=baseURI,idx=_cblocks.map(function(x){return x.id}).indexOf(id),i=0;i<field.length;i++)switch(field[i]){case"catstr":_cblocks[idx].catstr=val[i];break;case"ismp":_cblocks[idx].ismp=val[i]}return $http.patch(url,obj,{headers:{"Content-Type":"multipart/form-data"},body:obj}).then(querySucceeded,_queryFailed)}function deleteRec(block_id){function querySucceeded(result){return console.log("Deleting cblock was succesful"),result.data}var obj={};obj.resource=[];var data={};data.id=block_id,obj.resource.push(data);var url=baseURI+"/"+block_id,i=_cblocks.map(function(x){return x.id}).indexOf(block_id);return i>-1&&_cblocks.splice(i,1),$http.delete(url,data,{headers:{"Content-Type":"multipart/form-data"},body:obj}).then(querySucceeded,_queryFailed)}function _arecblocksLoaded(){return _cblocks.length>0}function _queryFailed(error){throw error}var _cblocks=[],baseURI="/api/v2/mysql/_table/cblocks";return{getcblocks:getcblocks,getcblocksmain:getcblocksmain,getcblocksall:getcblocksall,addcblock:addcblock,update:update,deleteRec:deleteRec}}angular.module("app").factory("cblock",cblock),cblock.$inject=["$http","$q","$rootScope"]}(),function(){"use strict";function categories($http,$q,$rootScope,$window){function getInitialHomeData(data){for(var filterstr="?filter=(",i=0;i<data.length;i++)filterstr=filterstr+"id="+data[i]+")OR(";filterstr=filterstr.substring(0,filterstr.length-3);var url0=baseURI+filterstr,p0=$http.get(url0);return $q.all([p0]).then(function(d){return _append(d[0].data.resource),$rootScope.DEBUG_MODE&&console.log("categories length: ",_categories.length),_categories},_queryFailed)}function getAllCategories(forceRefresh){var url0=baseURI+"?offset=0",p0=$http.get(url0);return $q.all([p0]).then(function(d){return _load(d[0].data.resource),$rootScope.DEBUG_MODE&&console.log("No. Categories ",_categories.length),_categories},_queryFailed)}function getAllCategoriesX(scope){var url0=baseURI+"?offset=0&filter=scope="+scope,p0=$http.get(url0);return $q.all([p0]).then(function(d){return _load(d[0].data.resource),$rootScope.DEBUG_MODE&&console.log("No. Categories ",_categories.length),_categories},_queryFailed)}function getCategoriesL(data){for(var filterstr="?filter=(",i=0;i<data.length;i++)filterstr=filterstr+"id="+data[i].cat+")OR(";filterstr=filterstr.substring(0,filterstr.length-3);var url0=baseURI+filterstr,p0=$http.get(url0);return $q.all([p0]).then(function(d){return _append(d[0].data.resource),$rootScope.DEBUG_MODE&&console.log("No. Categories ",_categories.length),_categories},_queryFailed)}function getCategory(id){var url0=baseURI+"/?filter=id="+id,p0=$http.get(url0);return $q.all([p0]).then(function(d){var data=d[0].data.resource;return $rootScope.DEBUG_MODE&&console.log("loaded single category ",data),data},_queryFailed)}function addCategory(category){function querySucceeded(result){var categoryx=category;return categoryx.id=result.data.resource[0].id,_categories.push(categoryx),console.log("adding categoryx succesful",result),result.data}category.scope=$rootScope.SCOPE;var url=baseURI,resource=[];return resource.push(category),$http.post(url,resource,{headers:{"Content-Type":"multipart/form-data"},body:resource}).then(querySucceeded,_queryFailed)}function update(id,field,val){function querySucceeded(result){for(var idx=_categories.map(function(x){return x.id}).indexOf(id),i=0;i<field.length;i++)_categories[idx][field[i]]=val[i];for(var i=0;i<$rootScope.content.length;i++)if($rootScope.content[i].cat==_categories[idx].id){for(var j=0;j<field.length;j++)$rootScope.content[i][field[j]]=val[j];$rootScope.searchStrContent[i]=$rootScope.content[i].tags+$rootScope.content[i].title}return $rootScope.DEBUG_MODE&&console.log("updating categoryx succesful"),result.data}var obj={};obj.resource=[];var data={};data.id=id;for(var i=0;i<field.length;i++)data[field[i]]=val[i];obj.resource.push(data);var url=baseURI;return $http.patch(url,obj,{headers:{"Content-Type":"multipart/form-data"},body:obj}).then(querySucceeded,_queryFailed)}function deleteRec(category_id){function querySucceeded(result){return $rootScope.DEBUG_MODE&&console.log("Deleting category was succesful"),result.data}var obj={};obj.resource=[];var data={};data.id=category_id,obj.resource.push(data);var url=baseURI+"/"+category_id,i=_categories.map(function(x){return x.id}).indexOf(category_id);return i>-1&&_categories.splice(i,1),$http.delete(url,data,{headers:{"Content-Type":"multipart/form-data"},body:obj}).then(querySucceeded,_queryFailed)}function storeInitialHomeData(cids){var data=[],idx=0;cids.forEach(function(i){(idx=_categories.map(function(x){return x.id}).indexOf(i))>-1&&data.push(_categories[idx])}),$window.localStorage.setItem("Categories-HomeData",JSON.stringify(data))}function _load(data){_categories.length=0,data.forEach(function(x){_categories.push(x)})}function _append(data){data.forEach(function(item){_categories.map(function(x){return x.id}).indexOf(item.id)<0&&_categories.push(item)})}function _queryFailed(error){throw error}var _categories=[];$rootScope.categories=_categories;var baseURI="/api/v2/mysql/_table/categories";return{getAllCategories:getAllCategories,getAllCategoriesX:getAllCategoriesX,getCategoriesL:getCategoriesL,getCategory:getCategory,addCategory:addCategory,update:update,deleteRec:deleteRec,getInitialHomeData:getInitialHomeData,storeInitialHomeData:storeInitialHomeData}}angular.module("app").factory("categories",categories),categories.$inject=["$http","$q","$rootScope","$window"]}(),angular.module("app").directive("userfeedBlock",["$rootScope","$state","fbusers","$q","uaf","color","dataloader",function($rootScope,$state,fbusers,$q,uaf,color,dataloader){"use strict";return{templateUrl:"app/content/partials/userfeed-block.html",transclude:!0,scope:{showAll:"@",showQty:"@"},controller:["$scope","$window","uaf",function($scope,$window,uaf){var vm=$scope;vm.title="mycontent",vm.sm=$rootScope.sm,$window.innerWidth<768&&(vm.thumbheight="80px"),$window.innerWidth>=768&&$window.innerWidth<992&&(vm.thumbheight="100px"),$window.innerWidth>=992&&$window.innerWidth<1200&&(vm.thumbheight="80px"),$window.innerWidth>1200&&(vm.thumbheight="100px")}],link:function(scope){function getFeed(){load(),0==scope.feeds.length&&(scope.feeds=$rootScope.uafs),scope.fres=scope.showQty}function load(){scope.feeds=[],$q.all($rootScope.uafs.map(function(feed){return fbusers.getFBUserById(feed.userid)})).then(function(fbUsers){scope.feeds=[];for(var i=0;i<$rootScope.uafs.length;i++){var userWithPic=angular.copy($rootScope.uafs[i]);userWithPic.picture=fbUsers[i]?fbUsers[i].picture.data.url:null,scope.feeds[i]=userWithPic}})}function pullData(uafs){for(var ranks=[],ans=[],item={},i=0;i<uafs.length;i++)item={},"addedCustomRank"==uafs[i].action&&(item.id=uafs[i].answer,ans.push(item)),"addedRank"==uafs[i].action&&(item.id=uafs[i].category,ranks.push(item)),"binded"==uafs[i].action&&(item.id=uafs[i].answer,ans.push(item)),"downVotedVrow"==uafs[i].action&&(item.id=uafs[i].answer,ans.push(item)),"upVotedVrow"==uafs[i].action&&(item.id=uafs[i].answer,ans.push(item)),"editA"==uafs[i].action&&(item.id=uafs[i].answer,ans.push(item)),"commentA"==uafs[i].action&&(item.id=uafs[i].answer,ans.push(item)),"commentR"==uafs[i].action&&(item.id=uafs[i].category,ranks.push(item)),"downVoted"==uafs[i].action&&(item.id=uafs[i].category,ranks.push(item),item={},item.id=uafs[i].answer,ans.push(item)),"upVoted"==uafs[i].action&&(item.id=uafs[i].category,ranks.push(item),item={},item.id=uafs[i].answer,ans.push(item)),"addedAnswer"==uafs[i].action&&(item.id=uafs[i].category,ranks.push(item),item={},item.id=uafs[i].answer,ans.push(item));ans.length>0&&dataloader.pulldata("answers",ans),ranks.length>0&&dataloader.pulldata("ranks",ranks)}var si=0;pullData($rootScope.uafs.slice(si,scope.showQty)),void 0==scope.isDestroyed&&getFeed();var bgc="#595959",bgc2=color.shadeColor(bgc,.5);scope.headerStyle="color:#f8f8ff;width:100%;border-style:none;background:#595959;background: -webkit-linear-gradient(left,#595959,"+bgc2+");background: -o-linear-gradient(right,"+bgc+","+bgc2+");background: -moz-linear-gradient(right,"+bgc+", "+bgc2+");background: linear-gradient(to right,"+bgc+", "+bgc2+");",scope.$watch("showQty",function(){si=scope.fres,scope.fres=scope.showQty,pullData($rootScope.uafs.slice(si,scope.showQty))}),scope.refreshFeed=function(){$rootScope.DEBUG_MODE&&console.log("refreshFeed"),uaf.getactions().then(function(response){$rootScope.uafs=response,getFeed()})},scope.gotoAnswer=function(x){$state.go("answerDetail",{index:x.answer})},scope.gotoRank=function(x){$state.go("rankSummary",{index:x.category})},scope.$on("$destroy",function(){scope.isDestroyed=!0})}}}]),angular.module("app").directive("trendBlock",["$rootScope","$state","answer","table","catans","$timeout","vrows","$window","cblock","color","search","dataloader",function($rootScope,$state,answer,table,catans,$timeout,vrows,$window,cblock,color,search,dataloader){"use strict";return{templateUrl:"app/content/partials/trend-block.html",transclude:!0,scope:{showAll:"@"},controller:["$scope","query","$http","answer","table","catans","$timeout","vrows","$window","cblock","color","search",function($scope,query,$http,answer,table,catans,$timeout,vrows,$window,cblock,color,search){var vm=$scope;vm.title="mycontent",vm.sm=$rootScope.sm,$window.innerWidth<768&&(vm.thumbheight="80px"),$window.innerWidth>=768&&$window.innerWidth<992&&(vm.thumbheight="100px"),$window.innerWidth>=992&&$window.innerWidth<1200&&(vm.thumbheight="80px"),$window.innerWidth>1200&&(vm.thumbheight="100px")}],link:function(scope){scope.isDestroyed,scope.popularLimit=10;var sip=0;scope.newestLimit=10;var sin=0;scope.userfeedLimit=10,scope.seeTab=function(x){1==x&&(scope.popular=!0,scope.newest=!1),2==x&&(scope.newest=!0,scope.popular=!1)},scope.seeTab(1),function(){var res=angular.copy($rootScope.content.filter(function(ranking){return 1==ranking.ismp}));res.sort(function(ranking1,ranking2){var view1=ranking1.views?ranking1.views:0,view2=ranking2.views?ranking2.views:0;return ranking1.id==ranking2.id?0:view1<view2?1:-1}),res.forEach(function(ranking){
ranking.fimage&&""!=ranking.fimage?ranking.realimage=ranking.fimage:ranking.image1url&&""!=ranking.image1url?ranking.realimage=ranking.image1url:ranking.realimage=$rootScope.EMPTY_IMAGE,ranking.humanized=moment(ranking.timestmp).fromNow()}),scope.popularOrder=res,dataloader.pulldata("ranks",scope.popularOrder.slice(sip,scope.popularLimit)),res=angular.copy($rootScope.content.filter(function(ranking){return 1==ranking.ismp})),res.sort(function(ranking1,ranking2){var view1=ranking1.timestmp?ranking1.timestmp:0,view2=ranking2.timestmp?ranking2.timestmp:0;return ranking1.id==ranking2.id?0:view1<view2?1:-1}),res.forEach(function(ranking){ranking.fimage&&""!=ranking.fimage?ranking.realimage=ranking.fimage:ranking.image1url&&""!=ranking.image1url?ranking.realimage=ranking.image1url:ranking.realimage=$rootScope.EMPTY_IMAGE,ranking.humanized=moment(ranking.timestmp).fromNow()}),scope.newestOrder=res,dataloader.pulldata("ranks",scope.newestOrder.slice(sin,scope.newestLimit))}(),scope.seeMore=function(status){"newest"==status&&(sin=scope.newestLimit,scope.newestLimit+=8,dataloader.pulldata("ranks",scope.newestOrder.slice(sin,scope.newestLimit))),"popular"==status&&(sip=scope.popularLimit,scope.popularLimit+=8,dataloader.pulldata("ranks",scope.popularOrder.slice(sip,scope.popularLimit))),"userfeed"==status&&(scope.userfeedLimit+=8)},scope.goBack=function(){$rootScope.$emit("backToResults")},scope.rankSel=function(x,nm){$rootScope.rankIsNearMe=!!nm,$rootScope.editMode?$state.go("editRanking",{index:x.slug}):$state.go("rankSummary",{index:x.slug})},scope.$on("$destroy",function(){scope.isDestroyed=!0}),scope.getHumanized=function(timstamp){return moment(timstamp).fromNow()}}}}]),angular.module("app").directive("searchBlock",["$rootScope","$state","search","$timeout","$window","dataloader","$http","$q",function($rootScope,$state,search,$timeout,$window,dataloader,$http,$q){"use strict";return{templateUrl:"app/content/partials/search-block.html",transclude:!0,scope:{query:"@",ans:"=",ranks:"=",length:"=",init:"=",data:"=",rod:"=",scrollactive:"="},controller:["$scope",function($scope){$window.innerWidth<768&&($scope.itemWidth=($window.innerWidth-8)/2),$window.innerWidth>=768&&$window.innerWidth<992&&($scope.itemWidth=($window.innerWidth-8)/3),$window.innerWidth>=992&&$window.innerWidth<1200&&($scope.itemWidth=($window.innerWidth-8)/4),$window.innerWidth>1200&&($scope.itemWidth=($window.innerWidth-8)/6)}],link:function(scope){function queryPreamble(){$timeout.cancel(timeoutPromise),timeoutPromise=$timeout(function(){if(scope.query.length>=2&&(scope.disableScrolling=!1,scope.endReached=!1,scope.getResults(scope.query)),0==scope.query.length){var temp=homeRanks.map(function(rank){return rank.id==$rootScope.updated_rank_id&&$rootScope.content.map(function(x){if(x.id==$rootScope.updated_rank_id)return rank=angular.copy(x)}),rank});homeRanks=temp,scope.searchResults=homeRanks,scope.endReached=!1,scope.displayResults=scope.searchResults.slice(0,scope.scrollingItemsOnePage)}},300)}function pullData(type,data){dataloader.pulldata(type,data)}function resolveImages(results){var pArr=[];return scope.contentLoaded=!1,results.forEach(function(item){item.isAnswer||null!=item.fimage&&void 0!=item.fimage&&item.fimage.indexOf("rankx")>-1&&pArr.push($http.get(item.fimage))}),$q.all(pArr)}function shuffle(array){for(var temporaryValue,randomIndex,currentIndex=array.length;0!==currentIndex;)randomIndex=Math.floor(Math.random()*currentIndex),currentIndex-=1,temporaryValue=array[currentIndex],array[currentIndex]=array[randomIndex],array[randomIndex]=temporaryValue;return array}var pullDataArray=[],homeRanks=[],ranksLoaded=!1,_currentOffset=-1,_lastOffset=-1,_loadMoreThreshold=0,_renderTime=0;scope.contentLoaded=!1,1==$rootScope.DISPLAY_XSMALL&&(_loadMoreThreshold=400),1==$rootScope.DISPLAY_SMALL&&(_loadMoreThreshold=400),1==$rootScope.DISPLAY_MEDIUM&&(_loadMoreThreshold=400),1==$rootScope.DISPLAY_LARGE&&(_loadMoreThreshold=300),1!=$rootScope.DISPLAY_XSMALL&&1!=$rootScope.DISPLAY_SMALL||(_renderTime=1e3),1!=$rootScope.DISPLAY_MEDIUM&&1!=$rootScope.DISPLAY_LARGE||(_renderTime=1e3),scope.rankSel=function(x,nm){if(x.useTemp){$rootScope.rankIsNearMe=!!nm;for(var selectedRank={},i=0;i<$rootScope.content.length;i++)x.id==$rootScope.content[i].cat&&x.locationId==$rootScope.content[i].nh&&(selectedRank=$rootScope.content[i]);if(void 0==selectedRank.id){$rootScope.DEBUG_MODE&&console.log("Rank is Ghost");var maxId=0;$rootScope.content.forEach(function(ranking){ranking.id>maxId&&(maxId=ranking.id)}),maxId++;var slug=x.title.toLowerCase();slug=slug.replace(/ /g,"-"),slug=slug.replace("/","at"),slug=slug+"-"+maxId;var ghostRank={id:maxId,catstr:""+maxId,slug:slug,isGhost:!0,title:x.title,type:x.type,tags:x.tags,keywords:x.keywords,question:x.question,fimage:x.fimage,bc:x.bc,fc:x.fc,shade:x.shade,introtext:x.introtext,user:x.user,views:0,answers:0,image1url:$rootScope.EMPTY_IMAGE,image2url:$rootScope.EMPTY_IMAGE,image3url:$rootScope.EMPTY_IMAGE,answertags:"",isatomic:1,timestmp:new Date,cat:x.id,nh:x.locationId};$rootScope.DEBUG_MODE&&console.log("ghostRank - ",ghostRank),$rootScope.content.push(ghostRank),$rootScope.searchStrContent.push(ghostRank.tags?ghostRank.tags:""),$state.go("rankSummary",{index:slug})}else $rootScope.DEBUG_MODE&&console.log("rank is normal ",selectedRank),$rootScope.editMode?$state.go("editRanking",{index:selectedRank.slug}):$state.go("rankSummary",{index:selectedRank.slug})}else $rootScope.editMode?$state.go("editRanking",{index:x.slug}):$state.go("rankSummary",{index:x.slug})},scope.ansSel=function(x){$rootScope.PAGEYOFFSET=window.pageYOffset,$rootScope.cCategory=void 0,$state.go("answerDetail",{index:x.slug})},scope.resRanks=[],scope.resAnswers=[],scope.searchResults=[],scope.displayResults=[],scope.maxRes=4e3;var timeoutPromise;scope.$watch("query",function(){ranksLoaded?queryPreamble():scope.contentLoaded=!1}),$rootScope.$on("updateSearch",function(){queryPreamble()}),scope.getResults=function(){scope.useTemp=!1,scope.resRanks=[];var catRanks=[];scope.resRanks=search.searchRanks2(scope.query),catRanks=search.searchRanks(scope.query);for(var catmap=scope.resRanks.map(function(x){return x.cat}),i=0;i<catRanks.length;i++)catmap.indexOf(catRanks[i].id)<0&&scope.resRanks.push(catRanks[i]);scope.resRanks.length>0&&(scope.disableScrolling=!1,scope.currentIndex=scope.intialDataCount,scope.startIndex=0,scope.endReached=!1),scope.resAnswers=[],scope.ans&&(scope.resAnswers=search.searchAnswers(scope.query));for(var i=0;i<scope.resAnswers.length;i++)scope.resAnswers[i].isAnswer=!0,"Establishment"==scope.resAnswers[i].type&&(scope.resAnswers[i].itext="Establishment",scope.resAnswers[i].icon="fa fa-building-o"),"Person"==scope.resAnswers[i].type&&(scope.resAnswers[i].itext="Public Figure",scope.resAnswers[i].icon="fa fa-male"),"PersonCust"==scope.resAnswers[i].type&&(scope.resAnswers[i].itext="Contractor",scope.resAnswers[i].icon="fa fa-male"),"Short-Phrase"==scope.resAnswers[i].type&&(scope.resAnswers[i].itext="Opinion",scope.resAnswers[i].icon="fa fa-comment-o"),"Event"==scope.resAnswers[i].type&&(scope.resAnswers[i].itext="Event",scope.resAnswers[i].icon="fa fa-calendar-o"),"Organization"==scope.resAnswers[i].type&&(scope.resAnswers[i].itext="Brand",scope.resAnswers[i].icon="fa fa-trademark"),"Place"==scope.resAnswers[i].type&&(scope.resAnswers[i].itext="Place",scope.resAnswers[i].icon="fa fa-map-marker");scope.length=scope.resRanks.length+scope.resAnswers.length,scope.searchResults=scope.resRanks.concat(scope.resAnswers),resolveImages(scope.searchResults.slice(0,scope.scrollingItemsOnePage)).then(function(){scope.contentLoaded=!0,scope.displayResults=scope.searchResults.slice(0,scope.scrollingItemsOnePage),scope.loadMore(!0),$timeout(function(){$rootScope.$broadcast("masonry.reload")},500)}),pullDataArray=scope.searchResults.slice(0,scope.scrollingItemsOnePage);for(var ranksRes=[],answerRes=[],i=0;i<pullDataArray.length;i++)pullDataArray[i].isAnswer?answerRes.push(pullDataArray[i]):ranksRes.push(pullDataArray[i]);ranksRes.length>0&&pullData("ranks",ranksRes),answerRes.length>0&&pullData("answers",answerRes),scope.relTags=search.searchRelatedRanks(ranksRes,scope.query),scope.relTagsIdx=0,scope.searchResults.length<3?scope.disableScrolling=!0:scope.disableScrolling=!1};var timeoutPromise2;scope.$watch("init",function(){$timeout.cancel(timeoutPromise2),timeoutPromise2=$timeout(function(){scope.init&&scope.getContent()},50)}),scope.getContent=function(){homeRanks=[],$rootScope.content.length<50?homeRanks=JSON.parse(JSON.stringify($rootScope.content)):$rootScope.content.forEach(function(item){item.ismp&&homeRanks.push(item)}),homeRanks.length>0&&(shuffle(homeRanks),scope.disableScrolling=!1,scope.currentIndex=scope.intialDataCount,scope.startIndex=0,scope.endReached=!1),ranksLoaded=!1,scope.searchResults=homeRanks,scope.displayResults=scope.searchResults.slice(0,scope.scrollingItemsOnePage),pullDataArray=scope.searchResults.slice(0,scope.scrollingItemsOnePage),pullData("ranks",pullDataArray),scope.contentLoaded=!0,$timeout(function(){$rootScope.$broadcast("masonry.reload")},1500)};var timeoutPromise3;scope.$watch("data",function(){$timeout.cancel(timeoutPromise3),timeoutPromise3=$timeout(function(){scope.data&&scope.addContent()},50)}),scope.addContent=function(){var map=homeRanks.map(function(x){return x.id});$rootScope.content.forEach(function(ranking){map.indexOf(ranking.id)<0&&ranking.ismp&&homeRanks.push(ranking)}),scope.searchResults=JSON.parse(JSON.stringify(homeRanks)),ranksLoaded=!0,scope.contentLoaded=!0,queryPreamble()};var timeoutPromise4;scope.$watch("rod",function(){$timeout.cancel(timeoutPromise4),timeoutPromise4=$timeout(function(){if(1==scope.rod&&$rootScope.rankofday){var obj=$rootScope.rankofday;obj[0].isrod=!0,homeRanks[0]=obj[0],scope.displayResults[0]=obj[0]}},50)}),scope.$watch("scrollactive",function(){scope.disableScrolling=!scope.scrollactive,!scope.disableScrolling&&scope.displayResults.length<20&&$rootScope.$broadcast("masonry.reload")}),$rootScope.sm?(scope.scrollingItemsOnePage=6,scope.loadingCountOneScroll=3):(scope.loadingCountOneScroll=6,scope.scrollingItemsOnePage=12),scope.scrollingItemsOnePage=12,scope.scrollingData=[],scope.scrollDataLoading=!1,scope.content=[],scope.intialDataCount=$rootScope.numInitItems,scope.endReached=!1,scope.disableScrolling=!0,scope.scrollingData=[],scope.uniqueResult=[],function(reloading){scope.currentIndex=12,scope.startIndex=0,scope.loadingCountOneScroll=6,scope.scrollingData=[],scope.scrollDataLoading=!1,scope.content=[],scope.endReached=!1,scope.scrollingData=[]}(),scope.loadMore=function(forceLoad){if(_currentOffset=$window.pageYOffset,Math.abs(_currentOffset-_lastOffset)<_loadMoreThreshold&&!forceLoad);else if(_lastOffset=_currentOffset,scope.scrollactive){scope.scrollDataLoading=!0;var b=scope.displayResults.length;pullDataArray=[];for(var i=b;i<b+scope.scrollingItemsOnePage;i++)if(scope.searchResults[i]){var idx=scope.displayResults.map(function(x){return x.id}).indexOf(scope.searchResults[i].id);idx<0&&(scope.displayResults.push(scope.searchResults[i]),pullDataArray.push(scope.searchResults[i]))}if(pullDataArray.length>0&&pullData("ranks",pullDataArray),scope.scrollDataLoading=!1,scope.searchResults.length-scope.displayResults.length<12&&void 0!=scope.relTags&&void 0!=scope.relTags[scope.relTagsIdx]){var moreRanks=search.searchRanks2(scope.relTags[scope.relTagsIdx].tag);scope.relTagsIdx++,moreRanks.forEach(function(nrank){scope.searchResults.map(function(x){return x.id}).indexOf(nrank.id)<0&&1==nrank.ismp&&scope.searchResults.push(nrank)})}void 0!=scope.relTags&&scope.relTagsIdx==scope.relTags.length-1&&(scope.relTags=search.searchRelatedRanks(scope.searchResults,scope.query),scope.relTagsIdx=0),scope.displayResults.length==scope.searchResults.length&&ranksLoaded&&(void 0!=scope.relTags?scope.relTagsIdx==scope.relTags.length-1&&(scope.endReached=!0):scope.endReached=!0),$timeout(function(){$rootScope.$broadcast("masonry.reload")},_renderTime)}}}}}]),angular.module("app").directive("resultItem",["$rootScope","$state","answer","table","catans","$timeout","vrows","$window","cblock","color","search",function($rootScope,$state,answer,table,catans,$timeout,vrows,$window,cblock,color,search){"use strict";return{templateUrl:"app/content/partials/result-block.html",transclude:!0,scope:{resultObject:"="},controller:["$scope","query","$http","answer","table","catans","$timeout","vrows","$window","cblock","color","search",function($scope,query,$http,answer,table,catans,$timeout,vrows,$window,cblock,color,search){var vm=$scope;vm.title="mycontent",vm.sm=$rootScope.sm,$window.innerWidth<768&&(vm.thumbheight="80px"),$window.innerWidth>=768&&$window.innerWidth<992&&(vm.thumbheight="100px"),$window.innerWidth>=992&&$window.innerWidth<1200&&(vm.thumbheight="80px"),$window.innerWidth>1200&&(vm.thumbheight="100px")}],link:function(scope,elem,attr){void 0==scope.isDestroyed&&function(){var w=$window.innerWidth-20;scope.w2=Math.round(w/2),scope.w4=Math.round(w/4)-5,scope.w8=Math.round(w/8);var resObj={};resObj={},resObj=scope.resultObject,scope.result=resObj,1==resObj.isAnswer?scope.title=resObj.name:scope.title=resObj.title,1==resObj.isAnswer?scope.imageurl=resObj.imageurl:scope.imageurl=resObj.fimage,scope.isAnswer=void 0!=resObj.isAnswer&&resObj.isAnswer,resObj.isAnswer?("Establishment"==resObj.type&&(scope.type="Establishment"),"Event"==resObj.type&&(scope.type="Event"),"Organization"==resObj.type&&(scope.type="Organization"),"Person"==resObj.type&&(scope.type="Public Figure"),"PersonCust"==resObj.type&&(scope.type="Professional"),"Place"==resObj.type&&(scope.type="Place"),"Short-Phrase"==resObj.type&&(scope.type="Opinion")):scope.type="Ranking",scope.stats={},scope.stats.views=resObj.views,scope.stats.answers=resObj.answers,scope.stats.numcom=resObj.numcom,void 0!=scope.stats.numcom&&null!=scope.stats.numcom||(scope.stats.numcom=0),resObj.isAnswer?("Organization"==resObj.type&&(scope.bc="brown",scope.fc="#f8f8ff"),"Establishment"==resObj.type&&(scope.bc="#4682b4",scope.fc="#f8f8ff"),"Place"==resObj.type&&(scope.bc="#008080",scope.fc="#f8f8ff"),"Short-Phrase"==resObj.type&&(scope.bc="#2d5a6a",scope.fc="#f8f8ff"),"Event"==resObj.type&&(scope.bc="#176ced",scope.fc="#f8f8ff"),"Person"!=resObj.type&&"PersonCust"!=resObj.type||(scope.bc="#c68c53",scope.fc="#f8f8ff"),scope.shade=-4):(void 0!=scope.imageurl&&""!=scope.imageurl&&null!=scope.imageurl||(scope.imageurl=resObj.image1url),scope.bc="gray",scope.fc="#f8f8ff",scope.shade=4),"Short-Phrase"==resObj.type&&(scope.image1=$rootScope.EMPTY_IMAGE)}(),scope.resSel=function(x){$rootScope.pageYOffset=$window.pageYOffset,scope.stats.views++,x.isAnswer?($rootScope.cCategory=void 0,$state.go("answerDetail",{index:x.id})):$rootScope.editMode?$state.go("editRanking",{index:x.slug}):$state.go("rankSummary",{index:x.slug})},scope.$on("$destroy",function(){scope.isDestroyed=!0})}}}]),angular.module("app").directive("rankOfDay",["$rootScope","$state","answer","table","catans","$timeout","vrows","$window","cblock","color","search",function($rootScope,$state,answer,table,catans,$timeout,vrows,$window,cblock,color,search){"use strict";return{templateUrl:"app/content/partials/rank-of-day.html",transclude:!0,scope:{part:"="},controller:["$scope","$rootScope","query","$http","answer","table","catans","$timeout","vrows","$window","cblock","color","search","rankofday",function($scope,$rootScope,query,$http,answer,table,catans,$timeout,vrows,$window,cblock,color,search,rankofday){function loadContent(){var w=$window.innerWidth-20;$scope.w2=Math.round(w/2),$scope.w4=Math.round(w/4)-5,$scope.w8=Math.round(w/8);var resObj={};if(resObj={},resObj=JSON.parse(JSON.stringify($scope.rankObject)),editTitle(resObj),parseShortAnswer(resObj),$scope.rank=resObj,$scope.title=resObj.title,$scope.stats={},$scope.stats.views=resObj.views,$scope.stats.answers=resObj.answers,$scope.stats.numcom=resObj.numcom,void 0!=$scope.stats.numcom&&null!=$scope.stats.numcom||($scope.stats.numcom=0),$scope.isBasic=!0,void 0!=resObj.fimage&&""!=resObj.fimage)$scope.image4=resObj.image3url,$scope.image3=resObj.image2url,$scope.image2=resObj.image1url,$scope.image1=resObj.fimage,$scope.bc=resObj.bc,$scope.fc=resObj.fc,$scope.shade=resObj.shade;else{var colors=color.defaultRankColor(resObj);$scope.bc=colors[0],$scope.fc=colors[1],$scope.shade=-4,$scope.image3=resObj.image3url,$scope.image2=resObj.image2url,$scope.image1=resObj.image1url}}function editTitle(x){x.titlex=x.title.replace(" in San Diego",""),0==x.answers&&"Short-Phrase"!=x.type&&(x.image1url=$rootScope.EMPTY_IMAGE)}function parseShortAnswer(x){if("Short-Phrase"==x.type){if(x.isShortPhrase=!0,void 0!=x.image1url){var sPVals1=x.image1url.split("##");$scope.title1=sPVals1[0],$scope.addinfo1=sPVals1[1]}if(void 0!=x.image2url){var sPVals2=x.image2url.split("##");$scope.title2=sPVals2[0],$scope.addinfo2=sPVals2[1]}if(void 0!=x.image3url){var sPVals3=x.image3url.split("##");$scope.title3=sPVals3[0],$scope.addinfo3=sPVals3[1]}$scope.isShortPhrase=!0,$scope.bcp="#2952a3",$scope.bc2p="#5c85d6",$scope.fcp="#e6e6e6"}}var vm=$scope;vm.title="mycontent",$rootScope.rankofday?($scope.rankObject=$rootScope.rankofday,loadContent()):rankofday.getrankofday().then(function(rankofday){$scope.rankObject=$rootScope.rankofday=rankofday,loadContent()}),vm.sm=$rootScope.DISPLAY_XSMALL,vm.maxRes=2,$window.innerWidth<768&&(vm.thumbheight="80px"),$window.innerWidth>=768&&$window.innerWidth<992&&(vm.thumbheight="100px"),$window.innerWidth>=992&&$window.innerWidth<1200&&(vm.thumbheight="80px"),$window.innerWidth>1200&&(vm.thumbheight="100px")}],link:function(scope){scope.rankSel=function(x,nm){nm?$rootscope.rankIsNearMe=!0:$rootScope.rankIsNearMe=!1,$rootScope.editMode?$state.go("editRanking",{index:x.slug}):$state.go("rankSummary",{index:x.slug})},scope.$on("$destroy",function(){scope.isDestroyed=!0})}}}]),angular.module("app").directive("rankItem",["$rootScope","$state","answer","table","catans","$timeout","vrows","$window","cblock","color","search",function($rootScope,$state,answer,table,catans,$timeout,vrows,$window,cblock,color,search){"use strict";return{templateUrl:"app/content/partials/rank-block.html",transclude:!0,scope:{rankObject:"="},controller:["$scope","query","$http","answer","table","catans","$timeout","vrows","$window","cblock","color","search",function($scope,query,$http,answer,table,catans,$timeout,vrows,$window,cblock,color,search){var vm=$scope;vm.title="mycontent",vm.sm=$rootScope.sm,$window.innerWidth<768&&(vm.thumbheight="80px"),$window.innerWidth>=768&&$window.innerWidth<992&&(vm.thumbheight="100px"),$window.innerWidth>=992&&$window.innerWidth<1200&&(vm.thumbheight="80px"),$window.innerWidth>1200&&(vm.thumbheight="100px")}],link:function(scope){function editTitle(x){0==x.answers&&"Short-Phrase"!=x.type&&(x.image1url=$rootScope.EMPTY_IMAGE)}void 0==scope.isDestroyed&&function(){var w=$window.innerWidth-20;scope.w2=Math.round(w/2),scope.w4=Math.round(w/4)-5,scope.w8=Math.round(w/8);var resObj={};if(resObj={},resObj=scope.rankObject,scope.rank=resObj,editTitle(scope.rankObject),scope.title=resObj.title,scope.rod=resObj.isrod,scope.stats={},scope.stats.views=resObj.views,scope.stats.answers=resObj.answers,scope.stats.numcom=resObj.numcom,void 0!=scope.stats.numcom&&null!=scope.stats.numcom||(scope.stats.numcom=0),void 0!=resObj.fimage&&""!=resObj.fimage)if(scope.image4=resObj.image3url,scope.image3=resObj.image2url,scope.image2=resObj.image1url,scope.image1=resObj.fimage,void 0!=resObj.bc&&""!=resObj.bc)scope.bc=resObj.bc,scope.fc=resObj.fc,scope.shade=resObj.shade;else{var colors=color.defaultRankColor(resObj);scope.bc=colors[0],scope.fc=colors[1],scope.shade=-4}else{var colors=color.defaultRankColor(resObj);scope.bc=colors[0],scope.fc=colors[1],scope.shade=-4,scope.image3=resObj.image3url,scope.image2=resObj.image2url,scope.image1=resObj.image1url}}(),scope.rankSel=function(x,nm){$rootScope.rankIsNearMe=!!nm,$rootScope.editMode?$state.go("editRanking",{index:x.slug}):$state.go("rankSummary",{index:x.slug})},scope.$on("$destroy",function(){scope.isDestroyed=!0})}}}]),angular.module("app").directive("rankBlock",["$rootScope","$state","answer","table","catans","$timeout","vrows","$window","cblock","color","search",function($rootScope,$state,answer,table,catans,$timeout,vrows,$window,cblock,color,search){"use strict";return{templateUrl:"app/content/partials/rank-block.html",transclude:!0,scope:{theme:"@",type:"@"},controller:["$scope","query","$http","answer","table","catans","$timeout","vrows","$window","cblock","color","search",function($scope,query,$http,answer,table,catans,$timeout,vrows,$window,cblock,color,search){var vm=$scope;vm.title="mycontent",vm.sm=$rootScope.sm,$window.innerWidth<768&&(vm.thumbheight="80px"),$window.innerWidth>=768&&$window.innerWidth<992&&(vm.thumbheight="100px"),$window.innerWidth>=992&&$window.innerWidth<1200&&(vm.thumbheight="80px"),$window.innerWidth>1200&&(vm.thumbheight="100px")}],link:function(scope){function shuffle(array){for(var temporaryValue,randomIndex,currentIndex=array.length;0!==currentIndex;)randomIndex=Math.floor(Math.random()*currentIndex),currentIndex-=1,temporaryValue=array[currentIndex],array[currentIndex]=array[randomIndex],array[randomIndex]=temporaryValue;return array}function editTitle(x){x.titlex=x.title.replace(" in San Diego",""),0==x.answers&&"Short-Phrase"!=x.type&&(x.image1url=$rootScope.EMPTY_IMAGE)}function parseShortAnswer(x){if("Short-Phrase"==x.type){if(x.isShortPhrase=!0,void 0!=x.image1url){var sPVals1=x.image1url.split("##");x.title1=sPVals1[0],x.addinfo1=sPVals1[1]}if(void 0!=x.image2url){var sPVals2=x.image2url.split("##");x.title2=sPVals2[0],x.addinfo2=sPVals2[1]}if(void 0!=x.image3url){var sPVals3=x.image3url.split("##");x.title3=sPVals3[0],x.addinfo3=sPVals3[1]}}}void 0==scope.isDestroyed&&function(){console.log("-------------------load content------------------");var catstr="",idxs=[],nidx=0;scope.results=[];var w=$window.innerWidth-20;scope.w2=Math.round(w/2),scope.w4=Math.round(w/4)-5,scope.w8=Math.round(w/8);for(var i=0;i<$rootScope.cblocks.length;i++)if("city"==$rootScope.cblocks[i].scope&&$rootScope.isCity&&$rootScope.cblocks[i].type==scope.theme){catstr=$rootScope.cblocks[i].catstr,idxs=catstr.split(":"),shuffle(idxs);for(var j=0;j<idxs.length;j++)nidx=$rootScope.content.map(function(x){return x.id}).indexOf(Number(idxs[j])),scope.results.push($rootScope.content[nidx]);break}scope.resultsTop=[];var resObj={},M=scope.results.length;if(M>0)for(var n=0;n<M;n++)resObj={},resObj=JSON.parse(JSON.stringify(scope.results[n])),scope.results[n].image1url!=$rootScope.EMPTY_IMAGE&&void 0!=scope.results[n].image1url&&""!=scope.results[n].image1url&&(editTitle(resObj),parseShortAnswer(resObj),"Short-Phrase"==resObj.type&&void 0==resObj.fimage||scope.resultsTop.push(resObj));var tr=scope.resultsTop[0];if(scope.title=tr.title,scope.stats={},scope.stats.views=tr.views,scope.stats.answers=tr.answers,scope.stats.numcom=tr.numcom,void 0!=scope.stats.numcom&&null!=scope.stats.numcom||(scope.stats.numcom=0),"basic"==scope.type&&(scope.isBasic=!0),"grid4"==scope.type&&(scope.isGrid4=!0),void 0!=tr.fimage&&""!=tr.fimage)scope.image4=tr.image3url,scope.image3=tr.image2url,scope.image2=tr.image1url,scope.image1=tr.fimage,scope.bc=tr.bc,scope.fc=tr.fc,scope.shade=tr.shade;else{var colors=color.defaultRankColor(tr);scope.bc=colors[0],scope.fc=colors[1],scope.shade=-4,scope.image3=tr.image3url,scope.image2=tr.image2url,scope.image1=tr.image1url}}(),scope.rankSel=function(x,nm){$rootScope.rankIsNearMe=!!nm,$rootScope.editMode?$state.go("editRanking",{index:x.slug}):$state.go("rankSummary",{index:x.slug})},scope.$on("$destroy",function(){scope.isDestroyed=!0})}}}]),angular.module("app").directive("facebookFollow",["$rootScope","$state","answer","table","catans","$timeout","vrows","$window","cblock","color","search",function($rootScope,$state,answer,table,catans,$timeout,vrows,$window,cblock,color,search){"use strict";return{templateUrl:"app/content/partials/facebook-follow.html",transclude:!0,scope:{theme:"@",type:"@"},controller:["$scope","query","$http","answer","table","catans","$timeout","vrows","$window","cblock","color","search",function($scope,query,$http,answer,table,catans,$timeout,vrows,$window,cblock,color,search){}],link:function(scope){}}}]),angular.module("app").directive("contentBlock",["$rootScope","$state","search","$timeout","$window",function($rootScope,$state,search,$timeout,$window){"use strict";return{templateUrl:"app/content/partials/content-block.html",transclude:!0,scope:{query:"@",ans:"=",ranks:"=",length:"="},controller:["$scope",function($scope){$window.innerWidth<768&&($scope.itemWidth=($window.innerWidth-8)/2),$window.innerWidth>=768&&$window.innerWidth<992&&($scope.itemWidth=($window.innerWidth-8)/3),$window.innerWidth>=992&&$window.innerWidth<1200&&($scope.itemWidth=($window.innerWidth-8)/4),$window.innerWidth>1200&&($scope.itemWidth=($window.innerWidth-8)/6)}],link:function(scope){scope.rankSel=function(x,nm){if(scope.disableScrolling=!0,x.useTemp){$rootScope.rankIsNearMe=!!nm;for(var selectedRank={},i=0;i<$rootScope.content.length;i++)x.id==$rootScope.content[i].cat&&x.locationId==$rootScope.content[i].nh&&(selectedRank=$rootScope.content[i]);if(void 0==selectedRank.id){var maxId=0;$rootScope.content.forEach(function(ranking){ranking.id>maxId&&(maxId=ranking.id)}),maxId++;var slug=x.title.toLowerCase();slug=slug.replace(/ /g,"-"),slug=slug.replace("/","at"),slug=slug+"-"+maxId;var ghostRank={id:maxId,catstr:""+maxId,slug:slug,isGhost:!0,title:x.title,type:x.type,tags:x.tags,keywords:x.keywords,question:x.question,fimage:x.fimage,bc:x.bc,fc:x.fc,shade:x.shade,introtext:x.introtext,user:x.user,views:0,answers:0,image1url:$rootScope.EMPTY_IMAGE,image2url:$rootScope.EMPTY_IMAGE,image3url:$rootScope.EMPTY_IMAGE,answertags:"",isatomic:1,timestmp:new Date,cat:x.id,nh:x.locationId};$rootScope.content.push(ghostRank),$rootScope.searchStrContent.push(ghostRank.tags?ghostRank.tags:""),$state.go("rankSummary",{index:slug})}else $rootScope.editMode?$state.go("editRanking",{index:selectedRank.slug}):$state.go("rankSummary",{index:selectedRank.slug})}else $rootScope.editMode?$state.go("editRanking",{index:x.slug}):$state.go("rankSummary",{index:x.slug})},scope.ansSel=function(x){$rootScope.cCategory=void 0,scope.disableScrolling=!0,$state.go("answerDetail",{index:x.slug})},scope.resRanks=[],scope.resAnswers=[],scope.searchResults=[],scope.maxRes=4e3;var timeoutPromise;scope.$watch("query",function(){$timeout.cancel(timeoutPromise),timeoutPromise=$timeout(function(){scope.getResults()},300)}),scope.getResults=function(){scope.useTemp=!1,scope.resRanks=[];var catRanks=[];if(scope.ranks){catRanks=[],scope.resRanks=search.searchRanks2(scope.query),catRanks=search.searchRanks(scope.query);for(var catmap=scope.resRanks.map(function(x){return x.cat}),i=0;i<catRanks.length;i++)catmap.indexOf(catRanks[i].id)<0&&scope.resRanks.push(catRanks[i]);scope.resRanks.length>0&&(scope.disableScrolling=!1,scope.currentIndex=scope.intialDataCount,scope.startIndex=0,scope.endReached=!1)}scope.length=scope.resRanks.length+scope.resAnswers.length,scope.searchResults=scope.resRanks},scope.currentIndex=0,scope.startIndex=0,$rootScope.sm?(scope.scrollingItemsOnePage=6,scope.loadingCountOneScroll=3):(scope.loadingCountOneScroll=6,scope.scrollingItemsOnePage=6),scope.scrollingItemsOnePage=1e3,scope.scrollingData=[],scope.scrollDataLoading=!1,scope.content=[],scope.intialDataCount=12,scope.endReached=!1,scope.disableScrolling=!0,scope.scrollingData=[],scope.uniqueResult=[],function(reloading){scope.currentIndex=12,scope.startIndex=0,scope.loadingCountOneScroll=6,scope.scrollingData=[],scope.scrollDataLoading=!1,scope.content=[],scope.endReached=!1,scope.scrollingData=[]}(),scope.loadMore=function(){scope.scrollDataLoading=!0,$timeout(function(){scope.currentIndex=scope.currentIndex+12,scope.currentIndex>=scope.searchResults.length&&(scope.endReached=!0),scope.currentIndex-scope.startIndex>scope.scrollingItemsOnePage&&(scope.startIndex=scope.currentIndex-scope.scrollingItemsOnePage),scope.scrollDataLoading=!1},500)}}}}]),angular.module("app").directive("answerItem",["$rootScope","$state","answer","table","catans","$timeout","vrows","$window","cblock","color","search",function($rootScope,$state,answer,table,catans,$timeout,vrows,$window,cblock,color,search){"use strict";return{templateUrl:"app/content/partials/answer-block.html",transclude:!0,scope:{answerObject:"="},controller:["$scope","query","$http","answer","table","catans","$timeout","vrows","$window","cblock","color","search",function($scope,query,$http,answer,table,catans,$timeout,vrows,$window,cblock,color,search){var vm=$scope;vm.title="mycontent",vm.sm=$rootScope.sm,$window.innerWidth<768&&(vm.thumbheight="80px"),$window.innerWidth>=768&&$window.innerWidth<992&&(vm.thumbheight="100px"),$window.innerWidth>=992&&$window.innerWidth<1200&&(vm.thumbheight="80px"),$window.innerWidth>1200&&(vm.thumbheight="100px")}],link:function(scope){function parseShortAnswer(x){if("Short-Phrase"==x.type){if(x.isShortPhrase=!0,void 0!=x.image1url){var sPVals1=x.image1url.split("##");x.title1=sPVals1[0],x.addinfo1=sPVals1[1]}if(void 0!=x.image2url){var sPVals2=x.image2url.split("##");x.title2=sPVals2[0],x.addinfo2=sPVals2[1]}if(void 0!=x.image3url){var sPVals3=x.image3url.split("##");x.title3=sPVals3[0],x.addinfo3=sPVals3[1]}}}void 0==scope.isDestroyed&&function(){var w=$window.innerWidth-20;scope.w2=Math.round(w/2),scope.w4=Math.round(w/4)-5,scope.w8=Math.round(w/8);var resObj={};resObj={},resObj=JSON.parse(JSON.stringify(scope.answerObject)),scope.answer=resObj,"Short-Phrase"==resObj.type&&parseShortAnswer(resObj),scope.stats={},scope.stats.views=resObj.views,scope.stats.answers=resObj.answers,scope.stats.numcom=resObj.numcom,void 0!=scope.stats.numcom&&null!=scope.stats.numcom||(scope.stats.numcom=0);var x=Math.floor(5*Math.random())+1;1==x&&(scope.bc="brown",scope.fc="#f8f8ff"),2==x&&(scope.bc="#4682b4",scope.fc="#f8f8ff"),3==x&&(scope.bc="#008080",scope.fc="#f8f8ff"),4==x&&(scope.bc="gray",scope.fc="#f8f8ff"),5==x&&(scope.bc="#c68c53",scope.fc="#f8f8ff"),scope.shade=-4,void 0!=resObj.imageurl&&""!=resObj.imageurl&&null!=resObj.imageurl?scope.image1=resObj.imageurl:scope.image1=$rootScope.EMPTY_IMAGE,"Short-Phrase"==resObj.type&&(scope.image1=$rootScope.EMPTY_IMAGE)}(),scope.ansSel=function(x){$state.go("answerDetail",{index:x.slug})},scope.$on("$destroy",function(){scope.isDestroyed=!0})}}}]),angular.module("app").directive("fileModel",["$parse",function($parse){"use strict";return{restrict:"A",link:function(scope,element,attrs){var model=$parse(attrs.fileModel),modelSetter=model.assign;element.bind("change",function(){scope.$apply(function(){modelSetter(scope,element[0].files[0])})})}}}]),angular.module("app").directive("bgBox3",["color","$timeout","$rootScope",function(color,$timeout,$rootScope){"use strict";return{templateUrl:"app/common/partials/bgbox3.html",transclude:!0,scope:{bc:"@",bc2:"@",fc:"@",shade:"@",text:"@",dir:"@",stats:"@",w:"@",h:"@",introtext:"@",type:"@",imageurl:"@",isAnswer:"@"},link:function(scope){$timeout(function(){scope.showStats="Ranking"==scope.type;var S=JSON.parse(scope.stats);scope.views=S.views,scope.answers=S.answers,scope.comments=S.numcom,1==$rootScope.DISPLAY_XSMALL?scope.sm=!0:scope.sm=!1,"horizontal"==scope.dir&&(scope.dirHor=!0,scope.dirVer=!1),"vertical"==scope.dir&&(scope.dirHor=!1,scope.dirVer=!0),void 0==scope.bc2&&(scope.bc2=color.shadeColor(scope.bc,scope.shade/10))}),scope.$on("$destroy",function(){scope.isDestroyed=!0}),scope.addView=function(){scope.views++}}}}]),angular.module("app").directive("bgBox2",["color","$timeout",function(color,$timeout){"use strict";return{templateUrl:"app/common/partials/bgbox2.html",transclude:!0,scope:{bc:"@",bc2:"@",fc:"@",shade:"@",text:"@",dir:"@",stats:"@",w:"@",h:"@",question:"@",isRankOfDay:"@"},link:function(scope,elem,attrs){$timeout(function(){
var S=JSON.parse(scope.stats);scope.views=S.views,scope.answers=S.answers,scope.comments=S.numcom,"horizontal"==scope.dir&&(scope.dirHor=!0,scope.dirVer=!1),"vertical"==scope.dir&&(scope.dirHor=!1,scope.dirVer=!0),void 0==scope.bc2&&(scope.bc2=color.shadeColor(scope.bc,scope.shade/10))}),scope.$on("$destroy",function(){scope.isDestroyed=!0})}}}]),angular.module("app").directive("bgBox",["color",function(color){"use strict";return{templateUrl:"app/common/partials/bgbox.html",transclude:!0,scope:{bc:"@",bc2:"@",fc:"@",shade:"@",text:"@",dir:"@",w:"@",h:"@"},link:function(scope){"horizontal"==scope.dir&&(scope.dirHor=!0,scope.dirVer=!1),"vertical"==scope.dir&&(scope.dirHor=!1,scope.dirVer=!0),void 0==scope.bc2&&(scope.bc2=color.shadeColor(scope.bc,scope.shade/10))}}}]),function(){"use strict";function vrowvotes($http,$q,$rootScope,uaf){function loadVrowVotes(forceRefresh){function querySucceeded(result){return _vrowvotes=result.data.resource}if(_areVrowVotesLoaded()&&!forceRefresh)return $q.when(_vrowvotes);var url=baseURI+"?filter=user="+$rootScope.user.id;return $http.get(url).then(querySucceeded,_queryFailed)}function postRec(vrow_id,vote){function querySucceeded(result){var datax=data;return datax.id=result.data.resource[0].id,_vrowvotes.push(datax),$rootScope.cvrowvotes.push(datax),1==data.val&&uaf.post("upVotedVrow",["answer","vrow"],[data.answer,datax.vrow]),-1==data.val&&uaf.post("downVotedVrow",["answer","vrow"],[data.answer,datax.vrow]),$rootScope.DEBUG_MODE&&console.log("Creating new vrowvoting record was succesful"),result.data}var obj={};obj.resource=[];var data={};data.user=$rootScope.user.id,data.answer=$rootScope.canswer.id,data.vrow=vrow_id,data.val=vote,data.timestmp=Date.now(),obj.resource.push(data);var url=baseURI;return $http.post(url,obj,{headers:{"Content-Type":"multipart/form-data"},body:obj}).then(querySucceeded,_queryFailed)}function patchRec(rec_id,vote){function querySucceeded(result){return $rootScope.DEBUG_MODE&&console.log("Updating vrow vote record was succesful"),result.data}var obj={};obj.resource=[];var data={};data.id=rec_id,data.val=vote,data.timestmp=Date.now(),obj.resource.push(data);var url=baseURI,i=_vrowvotes.map(function(x){return x.id}).indexOf(rec_id);return _vrowvotes[i].vote=vote,_vrowvotes[i].timestmp=data.timestmp,$http.patch(url,obj,{headers:{"Content-Type":"multipart/form-data"},body:obj}).then(querySucceeded,_queryFailed)}function deleteVrowVotesbyVrow(vrow_id){function querySucceeded(result){return $rootScope.DEBUG_MODE&&console.log("Deleting vrow votes records was succesful"),result.data}for(var i=0;i<_vrowvotes.length;i++)_vrowvotes[i].vrow==vrow_id&&_vrowvotes.splice(i,1);var url=baseURI+"?filter=vrow="+vrow_id;return $http.delete(url).then(querySucceeded,_queryFailed)}function _areVrowVotesLoaded(id){return _vrowvotes.length>0}function _queryFailed(error){throw error}var _vrowvotes=[],baseURI="/api/v2/mysql/_table/vrowvotes";return{loadVrowVotes:loadVrowVotes,patchRec:patchRec,postRec:postRec,deleteVrowVotesbyVrow:deleteVrowVotesbyVrow}}angular.module("app").factory("vrowvotes",vrowvotes),vrowvotes.$inject=["$http","$q","$rootScope","uaf"]}(),function(){"use strict";function vrows($http,$q,$rootScope,vrowvotes){function getAllvrows(forceRefresh){var url0=baseURI+"?offset=0",p0=$http.get(url0);return $q.all([p0]).then(function(d){return _load(d[0].data.resource),$rootScope.DEBUG_MODE&&console.log("No. Vrows: ",_allvrows.length),_allvrows},_queryFailed)}function getVrowsX(data){var _datax=[];if(data.forEach(function(item){_fetchAnswersMem.indexOf(item.answer)<0&&(_datax.push(item),_fetchAnswersMem.push(item.answer))}),0==_datax.length)return $q.when(!1);for(var filterstr="?filter=(",i=0;i<_datax.length;i++)filterstr=filterstr+"answer="+_datax[i].answer+")OR(";filterstr=filterstr.substring(0,filterstr.length-3);var url0=baseURI+filterstr,p0=$http.get(url0);return $q.all([p0]).then(function(d){var _allvrowsx=d[0].data.resource,map=_allvrows.map(function(x){return x.id});return _allvrowsx.forEach(function(vrowobj){map.indexOf(vrowobj.id)<0&&_allvrows.push(vrowobj)}),$rootScope.DEBUG_MODE&&console.log("No. Vrows: ",_allvrows.length),_allvrowsx},_queryFailed)}function postRec(x){function querySucceeded(result){var newVRow=data;return newVRow.id=result.data.resource[0].id,_allvrows.push(newVRow),uaf.post("addedOpinion",["answer","vrow"],[newVRow.answer,newVRow.id]),result.data}var data={};data.title=x,data.answer=$rootScope.canswer.id,data.gtitle="",data.user=$rootScope.user.id,data.gnum=0,data.upV=0,data.downV=0,data.timestmp=Date.now();var obj={};obj.resource=[],obj.resource.push(data);var url=baseURI;return $http.post(url,obj,{headers:{"Content-Type":"multipart/form-data"},body:obj}).then(querySucceeded,_queryFailed)}function postRec2(x){function querySucceeded(result){for(var eidx=_allvrows.length-1,n=result.data.resource.length-1;n>=0;n--)_allvrows[eidx].id=result.data.resource[n].id,eidx--;return result.data}var obj={};obj.resource=[],obj.resource.push(x),_allvrows.push.apply(_allvrows,x);var url=baseURI;return $http.post(url,x,{headers:{"Content-Type":"multipart/form-data"},body:obj}).then(querySucceeded,_queryFailed)}function deleteVrowByAnswer(answer_id){function querySucceeded(result){for(var i=0;i<result.data.resource.length;i++)vrowvotes.deleteVrowVotesbyVrow(result.data.resource[i].id);return $rootScope.DEBUG_MODE&&console.log("Deleting vrows records for answer was succesful"),result.data}for(var i=0;i<_allvrows.length;i++)_allvrows[i].answer==answer_id&&_allvrows.splice(i,1);var url=baseURI+"?filter=answer="+answer_id;return $http.delete(url).then(querySucceeded,_queryFailed)}function deleteVrowByGroup(gnum,answer){function querySucceeded(result){for(var i=0;i<result.data.resource.length;i++)vrowvotes.deleteVrowVotesbyVrow(result.data.resource[i].id);return $rootScope.DEBUG_MODE&&console.log("Deleting vrows records for group was succesful"),result.data}for(var i=_allvrows.length-1;i>=0;i--)_allvrows[i].gnum==gnum&&_allvrows.splice(i,1);var url=baseURI+"?filter=(gnum="+gnum+") AND (answer="+answer+")";return $http.delete(url).then(querySucceeded,_queryFailed)}function deleteVrow(vrow_id){function querySucceeded(result){for(var i=0;i<result.data.resource.length;i++)vrowvotes.deleteVrowVotesbyVrow(result.data.resource[i].id);return $rootScope.DEBUG_MODE&&console.log("Deleting vrow was succesful"),result.data}var obj={};obj.resource=[];var data={};data.id=vrow_id,obj.resource.push(data);var url=baseURI+"/"+vrow_id,i=_allvrows.map(function(x){return x.id}).indexOf(vrow_id);return i>-1&&_allvrows.splice(i,1),$http.delete(url,data,{headers:{"Content-Type":"multipart/form-data"},body:obj}).then(querySucceeded,_queryFailed)}function updateRec(rec_id,field,val){function querySucceeded(result){return $rootScope.DEBUG_MODE&&console.log("updating vrows record succesful"),result.data}var obj={};obj.resource=[];var data={};data.id=rec_id;for(var i=0;i<field.length;i++)data[field[i]]=val[i];obj.resource.push(data);for(var url=baseURI,idx=_allvrows.map(function(x){return x.id}).indexOf(rec_id),i=0;i<field.length;i++)_allvrows[idx][field[i]]=val[i];return $http.patch(url,obj,{headers:{"Content-Type":"multipart/form-data"},body:obj}).then(querySucceeded,_queryFailed)}function _load(data){_allvrows.length=0,data.forEach(function(x){_allvrows.push(x)})}function _queryFailed(error){throw error}var _allvrows=[],_fetchAnswersMem=[];$rootScope.cvrows=_allvrows;var baseURI="/api/v2/mysql/_table/vrows";return{getAllvrows:getAllvrows,getVrowsX:getVrowsX,postRec:postRec,postRec2:postRec2,deleteVrowByAnswer:deleteVrowByAnswer,deleteVrow:deleteVrow,updateRec:updateRec,deleteVrowByGroup:deleteVrowByGroup}}angular.module("app").factory("vrows",vrows),vrows.$inject=["$http","$q","$rootScope","vrowvotes"]}(),function(){"use strict";function votes($http,$q,$rootScope,uaf){function loadVotesByUser(forceRefresh){function querySucceeded(result){return _votes=result.data.resource}if(_isVotesLoaded()&&!forceRefresh)return $q.when(_votes);var url=baseURI+"/?filter=user="+$rootScope.user.id;return $http.get(url).then(querySucceeded,_queryFailed)}function loadVotesByMyFriends(forceRefresh){function querySucceeded(result){return result.data.resource}for(var filterQuery="",i=0;i<$rootScope.user.friends.data.length;i++)filterQuery+="(user=",filterQuery+=$rootScope.user.friends.data[i].id,filterQuery+=")",i!=$rootScope.user.friends.data.length-1&&(filterQuery+=" or ");var url=baseURI+"/?filter="+filterQuery;return $http.get(url).then(querySucceeded,_queryFailed)}function loadAllVotes(forceRefresh){function querySucceeded(result){return _votes=result.data.resource}var url=baseURI;return $http.get(url).then(querySucceeded,_queryFailed)}function postRec(catans_id,answer_id,category_id,vote){function querySucceeded(result){var datax=data;return datax.id=result.data.resource[0].id,_votes.push(datax),1==data.vote&&uaf.post("upVoted",["answer","category"],[answer_id,category_id]),-1==data.vote&&uaf.post("downVoted",["answer","category"],[answer_id,category_id]),$rootScope.$emit("updateVoteTable"),console.log("Creating new voting record was succesful"),result.data}var obj={};obj.resource=[];var data={};data.user=$rootScope.user.id,data.catans=catans_id,data.answer=answer_id,data.vote=vote,data.timestmp=Date.now(),obj.resource.push(data);var url=baseURI;return $http.post(url,obj,{headers:{"Content-Type":"multipart/form-data"},body:obj}).then(querySucceeded,_queryFailed)}function patchRec(rec_id,vote){function querySucceeded(result){return $rootScope.DEBUG_MODE&&console.log("Updating vote record was succesful"),result.data}var obj={};obj.resource=[];var data={};data.id=rec_id,data.vote=vote,data.timestmp=Date.now(),obj.resource.push(data);var url=baseURI,i=_votes.map(function(x){return x.id}).indexOf(rec_id);return _votes[i].vote=vote,_votes[i].timestmp=data.timestmp,$http.patch(url,obj,{headers:{"Content-Type":"multipart/form-data"},body:obj}).then(querySucceeded,_queryFailed)}function deleteVotesbyCatans(catans_id){function querySucceeded(result){return $rootScope.DEBUG_MODE&&console.log("Deleting vote records by Catans was succesful"),result.data}for(var i=0;i<_votes.length;i++)_votes[i].catans==catans_id&&_votes.splice(i,1);var url=baseURI+"/?filter=catans="+catans_id;return $http.delete(url).then(querySucceeded,_queryFailed)}function deleteRec(rec_id){function querySucceeded(result){return $rootScope.DEBUG_MODE&&console.log("Deleting vote record was succesful"),result.data}for(var i=0;i<_votes.length;i++)_votes[i].id==rec_id&&_votes.splice(i,1);var url=baseURI+"/"+rec_id;return $http.delete(url).then(querySucceeded,_queryFailed)}function _isVotesLoaded(id){return _votes.length>0}function _queryFailed(error){throw error}function loadLastMonthVoting(answerIDs){function querySucceeded(result){return result.data.resource}for(var filterQuery="(",i=0;i<answerIDs.length;i++)filterQuery+="(answer=",filterQuery+=answerIDs[i],filterQuery+=")",i!=answerIDs.length-1&&(filterQuery+=" or ");filterQuery+=" and (timestmp > "+moment().subtract(1,"month").startOf("month").format("YYYY-MM-DD")+")",filterQuery+=" and (vote = 1))";var url=baseURI+"/?filter="+filterQuery;return $http.get(url).then(querySucceeded,_queryFailed)}var _votes=[],baseURI="/api/v2/mysql/_table/votetable";return{loadVotesByUser:loadVotesByUser,loadAllVotes:loadAllVotes,patchRec:patchRec,postRec:postRec,deleteVotesbyCatans:deleteVotesbyCatans,deleteRec:deleteRec,loadVotesByMyFriends:loadVotesByMyFriends,loadLastMonthVoting:loadLastMonthVoting}}angular.module("app").factory("votes",votes),votes.$inject=["$http","$q","$rootScope","uaf"]}(),function(){"use strict";function useractivity($http,$q,$rootScope){function getAllUserActivity(forceRefresh){function querySucceeded(result){return _load(result.data.resource),_alluseractivity}var url=baseURI;return $http.get(url).then(querySucceeded,_queryFailed)}function getAllUserActivityX(data){function querySucceeded(result){var _alluseractivityx=result.data.resource,map=_alluseractivity.map(function(x){return x.id});return _alluseractivityx.forEach(function(obj){map.indexOf(obj.id)<0&&_alluseractivity.push(obj)}),$rootScope.DEBUG_MODE&&console.log("useractivityX loaded"),_alluseractivity}var _datax=[];if(0!=data&&data.forEach(function(item){_fetchRanksMem.indexOf(item.category)<0&&(_datax.push(item),_fetchRanksMem.push(item.category))}),0==_datax.length)return $q.when(!1);for(var filterstr="?filter=(",i=0;i<_datax.length;i++)filterstr=filterstr+"category="+_datax[i].category+")OR(";filterstr=filterstr.substring(0,filterstr.length-3);var url=baseURI+filterstr;return $http.get(url).then(querySucceeded,_queryFailed)}function getActivitybyUser(){function querySucceeded(result){return _useractivity=result.data.resource}var url=baseURI+"/?filter=user="+$rootScope.user.id;return $http.get(url).then(querySucceeded,_queryFailed)}function postRec(category){function querySucceeded(result){var datax=data;return datax.id=result.data.resource[0].id,_alluseractivity.push(datax),$rootScope.thisuseractivity.push(datax),$rootScope.DEBUG_MODE&&console.log("creating useractivity record was succesful"),result.data}var data={};data.user=$rootScope.user.id,data.category=category,data.votes=1,data.timestmp=Date.now();var obj={};obj.resource=[],obj.resource.push(data);var url=baseURI;return $http.post(url,obj,{headers:{"Content-Type":"multipart/form-data"},body:obj}).then(querySucceeded,_queryFailed)}function patchRec(rec_id,votes){function querySucceeded(result){return $rootScope.DEBUG_MODE&&console.log("Updating useractivity record was succesful"),result.data}var obj={};obj.resource=[];var data={};data.id=rec_id,data.user=$rootScope.user.id,data.votes=votes,data.timestmp=Date.now(),obj.resource.push(data);var url=baseURI,idx=_alluseractivity.map(function(x){return x.id}).indexOf(rec_id);return _alluseractivity[idx].votes=votes,$http.patch(url,obj,{headers:{"Content-Type":"multipart/form-data"},body:obj}).then(querySucceeded,_queryFailed)}function deleteRec(rec_id){function querySucceeded(result){return $rootScope.DEBUG_MODE&&console.log("Deleting user activity record was succesful"),result.data}var i=_alluseractivity.map(function(x){return x.id}).indexOf(rec_id);i>-1&&_alluseractivity.splice(i,1);var url=baseURI+"/"+rec_id;return $http.delete(url).then(querySucceeded,_queryFailed)}function _load(data){_alluseractivity.length=0,data.forEach(function(x){_alluseractivity.push(x)})}function _queryFailed(error){throw error}var _alluseractivity=[],_fetchRanksMem=[];$rootScope.alluseractivity=_alluseractivity;var _useractivity=[],baseURI="/api/v2/mysql/_table/useractivity";return{getAllUserActivity:getAllUserActivity,getAllUserActivityX:getAllUserActivityX,getActivitybyUser:getActivitybyUser,postRec:postRec,patchRec:patchRec,deleteRec:deleteRec}}angular.module("app").factory("useractivity",useractivity),useractivity.$inject=["$http","$q","$rootScope"]}(),function(){"use strict";function uaf($http,$q,$rootScope,userpts){function getactions(forceRefresh){var url0=baseURI+"?limit=100&order=id%20DESC",p0=$http.get(url0);return $q.all([p0]).then(function(d){return _load(d[0].data.resource),$rootScope.DEBUG_MODE&&console.log("No. user actions: ",_actions.length),_actions},_queryFailed)}function getAllUafs(){function querySucceeded(result){return result.data.resource}var url=baseURI;return $http.get(url).then(querySucceeded,_queryFailed)}function getUafsFromId(ids){function querySucceeded(result){return result.data.resource}var url=baseURI+"?ids="+ids;return $http.get(url).then(querySucceeded,_queryFailed)}function getnext10actions(forceRefresh){var url0=baseURI+"?limit=20&order=id%20DESC&offset="+$rootScope.uafs.length,p0=$http.get(url0);return $q.all([p0]).then(function(d){var data=d[0].data.resource,map=_actions.map(function(x){return x.id});return data.forEach(function(obj){map.indexOf(obj.id)<0&&_actions.push(obj)}),$rootScope.DEBUG_MODE&&console.log("No. user actions: ",_actions.length),_actions},_queryFailed)}function post(action,field,val){function querySucceeded(result){var uafx=data;return uafx.id=result.data.resource[0].id,_actions.push(uafx),userpts.addrec(uafx),$rootScope.DEBUG_MODE&&console.log("Posted user activity feed"),result.data}var url=baseURI,_colors={};_colors.bc="",_colors.fc="";var data={},n=0;data.userid=$rootScope.user.id,data.action=action,data.initials=$rootScope.user.name.replace(/[^A-Z]/g,""),getIconColors($rootScope.user.id,_colors),data.fc=_colors.fc,data.bc=_colors.bc,data.date=moment().format("YYYY-MM-DD"),data.actorusername=$rootScope.user.first_name;for(var i=0;i<field.length;i++)switch(field[i]){case"answer":data.answer=val[i],n=$rootScope.answers.map(function(x){return x.id}).indexOf(data.answer),data.text1=$rootScope.answers[n].name;break;case"category":data.category=val[i],n=$rootScope.content.map(function(x){return x.id}).indexOf(data.category),data.text2=$rootScope.content[n].title;break;case"comment":data.comment=val[i];break;case"edit":data.edit=val[i],n=$rootScope.edits.map(function(x){return x.id}).indexOf(data.edit),data.text2=$rootScope.edits[n].field;break;case"vrow":data.vrow=val[i],n=$rootScope.cvrows.map(function(x){return x.id}).indexOf(data.vrow),data.text2=$rootScope.cvrows[n].title;break;case"text1":data.text1=val[i];break;case"text2":data.text2=val[i]}var resource=[];return resource.push(data),$http.post(url,resource,{headers:{"Content-Type":"multipart/form-data"},body:resource}).then(querySucceeded,_queryFailed)}function deletebyId(id){function querySucceeded(result){return $rootScope.DEBUG_MODE&&console.log("Deleting user activity feed was succesful"),result.data}var obj={};obj.resource=[];var data={};data.id=id,obj.resource.push(data);var url=baseURI+"/"+id,i=_actions.map(function(x){return x.id}).indexOf(id);return i>-1&&_actions.splice(i,1),$http.delete(url,data,{headers:{"Content-Type":"multipart/form-data"},body:obj}).then(querySucceeded,_queryFailed)}function getIconColors(x,c){switch(x%10){case 0:c.bc="#b3b3b3",c.fc="black";break;case 1:c.bc="#666666",c.fc="white";break;case 2:c.bc="#006bb3",c.fc="white";break;case 3:c.bc="#009933",c.fc="white";break;case 4:c.bc="#cc0000",c.fc="white";break;case 5:c.bc="#538cc6",c.fc="black";break;case 6:c.bc="#b36b00",c.fc="white";break;case 7:c.bc="#999966",c.fc="black";break;case 8:c.bc="#4d0099",c.fc="white";break;case 9:c.bc="#009999",c.fc="black"}}function _load(data){_actions.length=0,data.forEach(function(x){_actions.push(x)})}function _queryFailed(error){throw error}var _actions=[];$rootScope.uafs=_actions;var baseURI="/api/v2/mysql/_table/useractivityfeed";return{getactions:getactions,post:post,deletebyId:deletebyId,getnext10actions:getnext10actions,getAllUafs:getAllUafs,getUafsFromId:getUafsFromId}}angular.module("app").factory("uaf",uaf),uaf.$inject=["$http","$q","$rootScope","userpts"]}(),function(){"use strict";function tablefield($http,$q){function getAllTableFields(forceRefresh){function querySucceeded(result){return _alltablefields=result.data.resource}if(_areAllTableFieldsLoaded()&&!forceRefresh)return $q.when(_alltablefields);var url=baseURI;return $http.get(url).then(querySucceeded,_queryFailed)}function getTableFields(id,forceRefresh){function querySucceeded(result){return _selectedtablefields=result.data}var url=baseURI+"/?fields=field&filter=tableid="+id;return $http.get(url).then(querySucceeded,_queryFailed)}function _areAllTableFieldsLoaded(){return _alltablefields.length>0}function _queryFailed(error){throw error}var _selectedtablefields,_alltablefields=[],baseURI="/api/v2/mysql/_table/tablefield";return{getAllTableFields:getAllTableFields,getTableFields:getTableFields}}angular.module("app").factory("tablefield",tablefield),tablefield.$inject=["$http","$q"]}(),function(){"use strict";function pixabay($http,$rootScope,APP_API_KEY,$cookies){function search(query){delete $http.defaults.headers.common["X-Dreamfactory-API-Key"],delete $http.defaults.headers.common["X-DreamFactory-Session-Token"];var url=baseURI+"?key="+PIXABAY_API_KEY+"&q="+query+"&image_type=photo";return $http.get(url).then(function(result){return _results=[],_results=result.data.hits,$rootScope.DEBUG_MODE&&console.log("pixabay results success! - ",result),$http.defaults.headers.common["X-Dreamfactory-API-Key"]=APP_API_KEY,$http.defaults.headers.common["X-DreamFactory-Session-Token"]=$cookies.session_token,_results},function(){$http.defaults.headers.common["X-Dreamfactory-API-Key"]=APP_API_KEY,$http.defaults.headers.common["X-DreamFactory-Session-Token"]=$cookies.session_token,$rootScope.DEBUG_MODE&&console.log("Problem getting Pixabay Images")})}var _results=[],baseURI="https://pixabay.com/api/",PIXABAY_API_KEY="5296312-7285c9a61e74685606fe28209";return{search:search}}angular.module("app").factory("pixabay",pixabay),pixabay.$inject=["$http","$rootScope","APP_API_KEY","$cookies"]}(),function(){"use strict";function pexels($http,$rootScope,APP_API_KEY,$cookies,SERVER_URL){function search(query){delete $http.defaults.headers.common["X-Dreamfactory-API-Key"],delete $http.defaults.headers.common["X-DreamFactory-Session-Token"],$http.defaults.headers.common.Authorization=PEXELS_API_KEY,console.log("$http.defaults ",$http.defaults);var url=baseURI+"/v1/search?query="+query;return $http.get(url).then(function(result){return _results=[],_results=result.data.photos,$rootScope.DEBUG_MODE&&console.log("pexels results success! - ",results),delete $http.defaults.headers.common.Authorization,$http.defaults.headers.common["X-Dreamfactory-API-Key"]=APP_API_KEY,$http.defaults.headers.common["X-DreamFactory-Session-Token"]=$cookies.session_token,_results},function(){delete $http.defaults.headers.common.Authorization,$http.defaults.headers.common["X-Dreamfactory-API-Key"]=APP_API_KEY,$http.defaults.headers.common["X-DreamFactory-Session-Token"]=$cookies.session_token,$rootScope.DEBUG_MODE&&console.log("Problem getting pexels Images")})}function reqFromServer(query){var data={};return data.query=query,$http({method:"POST",data:data,url:SERVER_URL+"ImageServer/requestPexels",headers:{"X-Dreamfactory-API-Key":void 0,"X-DreamFactory-Session-Token":void 0}})}var _results=[],baseURI="http://api.pexels.com",PEXELS_API_KEY="563492ad6f9170000100000116ed76e3fd2b47bb574fb0174737aaf8";return{search:search,reqFromServer:reqFromServer}}angular.module("app").factory("pexels",pexels),pexels.$inject=["$http","$rootScope","APP_API_KEY","$cookies","SERVER_URL"]}(),function(){"use strict";function instagram($http,$rootScope){function getImages(){$rootScope.igimages=[];var url=($rootScope.canswer.name.replace(" ",""),"https://api.instagram.com/v1/tags/rankxdemo/media/recent?access_token=4368719989.c46745e.407288e972a64c119093166b8ba280c0&callback=JSON_CALLBACK");return $rootScope.DEBUG_MODE&&console.log(url),$http.jsonp(url).success(function(data){var myObj={};$rootScope.DEBUG_MODE&&console.log(data);for(var i=0;i<data.data.length;i++)myObj={},myObj.url=data.data[i].images.standard_resolution.url,myObj.caption=data.data[i].caption?data.data[i].caption.text:void 0,myObj.from=data.data[i].user.username,$rootScope.igimages.push(myObj),$rootScope.DEBUG_MODE&&console.log(data.data[i].images.standard_resolution.url)})}return{getImages:getImages}}angular.module("app").factory("instagram",instagram),instagram.$inject=["$http","$rootScope"]}(),function(){"use strict";function imagelist($http,$rootScope){function getFeatureImageList(){function querySucceeded(result){var x2js=new X2JS,myJSON=x2js.xml_str2json(result.data),myObj={},images=[],resParse=myJSON.EnumerationResults.Blobs.Blob;if(resParse&&resParse.constructor===Array)for(var i=0;i<resParse.length;i++)myObj={},myObj.url="https://rankx.blob.core.windows.net/sandiego/"+resParse[i].Name,myObj.type="azure-uploaded",myObj.size=resParse[i].Properties["Content-Length"]/1024,images.push(myObj);else resParse&&resParse.constructor===Object&&(myObj={},myObj.url="https://rankx.blob.core.windows.net/sandiego/"+resParse.Name,myObj.type="Uploaded",myObj.size=resParse.Properties["Content-Length"]/1024,images.push(myObj));return $rootScope.DEBUG_MODE&&console.log("query succeded"),images}function queryFailed(result){$rootScope.DEBUG_MODE&&console.log("image query failed")}return $http.get("https://rankx.blob.core.windows.net/sandiego?restype=container&comp=list&prefix=featuredImages/&sv=2015-04-05&ss=bfqt&srt=sco&sp=rwdlacup&se=2018-08-30T01:15:12Z&st=2016-08-29T17:15:12Z&spr=https,http&sig=PpyWE0X%2Fpz9SuRje5GtHh44WaWIii0GBU9PbIcDIka8%3D").then(querySucceeded,queryFailed)}function getImageList(){function querySucceeded(result){var x2js=new X2JS,myJSON=x2js.xml_str2json(result.data),myObj={},resParse=myJSON.EnumerationResults.Blobs.Blob;if(void 0!=resParse)if(resParse&&resParse.constructor===Array)for(var i=0;i<resParse.length;i++)myObj={},myObj.url="https://rankx.blob.core.windows.net/sandiego/"+resParse[i].Name,myObj.type="azure-uploaded",$rootScope.blobs.push(myObj);else resParse&&resParse.constructor===Object&&(myObj={},myObj.url="https://rankx.blob.core.windows.net/sandiego/"+resParse.Name,myObj.type="Uploaded",$rootScope.blobs.push(myObj));else $rootScope.blobs=[];$rootScope.DEBUG_MODE&&console.log("query succeded")}function queryFailed(result){$rootScope.DEBUG_MODE&&console.log("image query failed")}var storageurl="https://rankx.blob.core.windows.net/sandiego?restype=container&comp=list&prefix="+$rootScope.canswer.id+"/&sv=2015-04-05&ss=bfqt&srt=sco&sp=rwdlacup&se=2018-08-30T01:15:12Z&st=2016-08-29T17:15:12Z&spr=https,http&sig=PpyWE0X%2Fpz9SuRje5GtHh44WaWIii0GBU9PbIcDIka8%3D";return $http.get(storageurl).then(querySucceeded,queryFailed)}function deleteBlob(blobName){function querySucceeded(result){$rootScope.$emit("refreshImages"),$rootScope.DEBUG_MODE&&console.log("Blob image deleted succesfully")}function queryFailed(result){$rootScope.DEBUG_MODE&&console.log("Blob image delete failed")}$rootScope.DEBUG_MODE&&console.log("blobname, ",blobName);var url=blobName+"?sv=2015-04-05&ss=bfqt&srt=sco&sp=rwdlacup&se=2018-08-30T01:15:12Z&st=2016-08-29T17:15:12Z&spr=https,http&sig=PpyWE0X%2Fpz9SuRje5GtHh44WaWIii0GBU9PbIcDIka8%3D";return $http.delete(url).then(querySucceeded,queryFailed)}return{getImageList:getImageList,deleteBlob:deleteBlob,getFeatureImageList:getFeatureImageList}}angular.module("app").factory("imagelist",imagelist),imagelist.$inject=["$http","$rootScope"]}(),function(){"use strict";function image($http,$rootScope){function getImageLinks(fields,attNum,type){function querySucceeded(result){return $rootScope.DEBUG_MODE&&console.log("query succeded"),_searchResults=result,filterImageResults(_searchResults)}function queryFailed(result){$rootScope.DEBUG_MODE&&console.log("image query failed")}return imageSearch(fields,attNum,type).then(querySucceeded,queryFailed)}function imageSearch(fields,attNum,type){var searchQuery="",f1="",f2="",keywords="";$rootScope.cCategory&&(keywords=$rootScope.cCategory.keywords);for(var data=[],i=0;i<fields.length;i++)"edit"==type?data[i]=fields[i].cval:"add"==type&&(data[i]=fields[i].val);switch(1==fields.length&&data[0]&&(f1=data[0]),2==fields.length&&(data[0]&&(f1=data[0]),data[1]&&(f2=data[1])),3==fields.length&&(data[0]&&(f1=data[0]),data[1]&&(f2=data[1]),data[2]&&data[2]),fields.length>3&&(data[0]&&(f1=data[0]),data[1]&&(f2=data[1]),data[2]&&data[2],data[3]&&data[3]),attNum){case 1:searchQuery="q="+f1+" "+f2+" "+keywords;break;case 2:case 3:searchQuery="q="+f1+" "+keywords;break;case 4:searchQuery="q="+f1+" "+f2+" "+keywords}var url="https://www.googleapis.com/customsearch/v1?"+searchQuery+"&cx=000139851817949790257%3Aqwkdgi2q2ew&num=10&searchType=image&fileType=jpg%2C+png%2C+bmp&imgType=photo&imgSize=large&filter=1&key=AIzaSyBr143lDEROCrUWdKvqPQmhQ5BoFo13oSE";return $http.get(url)}function filterImageResults(_searchResults){for(var _imageLinks=[],sizeOk=!1,linkOk=!1,link_length=0,iheight=0,iwidth=0,i=0;i<numRes;i++)if(sizeOk=!1,linkOk=!1,iheight=_searchResults.data.items[i].image.height,iwidth=_searchResults.data.items[i].image.width,iwidth>iheight&&iwidth/iheight<1.8&&(sizeOk=!0),link_length=_searchResults.data.items[i].link.length,("g"==_searchResults.data.items[i].link[link_length-1]||"p"==_searchResults.data.items[i].link[link_length-1])&&_searchResults.data.items[i].link.indexOf("https")>-1&&(linkOk=!0),sizeOk&&linkOk){var url=_searchResults.data.items[i].link;_imageLinks.push(url)}return _imageLinks}var _searchResults=[],numRes=10;return{imageSearch:imageSearch,getImageLinks:getImageLinks,filterImageResults:filterImageResults}}angular.module("app").factory("image",image),image.$inject=["$http","$rootScope"]}(),function(){"use strict";function htmlops($rootScope){function specialHtml(x){var sch_str="";if("weekly"==x.freq){sch_str=strLimit("Every: "+(x.mon?" - Monday":"")+(x.tue?" - Tuesday":"")+(x.wed?" - Wednesday":"")+(x.thu?" - Thursday":"")+(x.fri?" - Friday":"")+(x.sat?" - Saturday":"")+(x.sun?" - Sunday":""))+"<br>From: "+x.stime2+" to "+x.etime2}if("onetime"==x.freq){sch_str=x.sdate==x.edate?x.sdate+" from "+x.stime+" to "+x.etime:"Starts: "+x.sdate+" at "+x.stime+"<br>Ends: "+x.edate+" at "+x.etime}var newstr=strLimit(x.details);return'<div style="background-color:'+x.bc+";color:"+x.fc+';"><div class="text-center"><h3>'+x.stitle+"</h3><p>"+sch_str+"</p><p>"+newstr+"</p></div></div>"}function eventHtml(x){var addinfomessage="",sch_str="";if("weekly"==x.freq&&(sch_str=x.sdate+" to "+x.edate+"<br>"+strLimit("Every: "+(x.mon?" - Monday":"")+(x.tue?" - Tuesday":"")+(x.wed?" - Wednesday":"")+(x.thu?" - Thursday":"")+(x.fri?" - Friday":"")+(x.sat?" - Saturday":"")+(x.sun?" - Sunday":""))+"<br>"+(void 0==x.stime2?"":"From: "+x.stime2)+(void 0==x.etime2?"":" to "+x.etime2)),"onetime"==x.freq){sch_str=x.sdate==x.edate?x.sdate+" from "+x.stime+" to "+x.etime:(void 0==x.edate?"":"Starts: ")+x.sdate+(void 0==x.stime?"":" at "+x.stime)+(void 0==x.edate?"":"<br>Ends: "+x.edate)+(void 0==x.etime?"":" at "+x.etime)}return addinfomessage='<div style="background-color:'+x.bc+";color:"+x.fc+';"><p>'+sch_str+"</p>"+(void 0!=x.addinfo?"<p>"+strLimit(x.addinfo)+"</p>":"")+"</div>",addinfomessage}function strLimit(x){var charlim=0;$rootScope.DISPLAY_XSMALL&&(charlim=45),$rootScope.DISPLAY_SMALL&&(charlim=60),$rootScope.DISPLAY_MEDIUM&&(charlim=90),$rootScope.DISPLAY_LARGE&&(charlim=150);var cc=0,newstr="";if(void 0==x)return"";if(x.length>charlim)for(var n=0;n<x.length;n++)cc>charlim-5&&" "==x[n]&&(newstr+="<br>",cc=0),newstr+=x[n],cc++;else newstr=x;return newstr}return{specialHtml:specialHtml,eventHtml:eventHtml}}angular.module("app").service("htmlops",htmlops),htmlops.$inject=["$rootScope"]}(),function(){"use strict";function getwiki($rootScope,$http,APP_API_KEY,GOOGLE_API_KEY,$cookies){function getWiki(answer){delete $http.defaults.headers.common["X-Dreamfactory-API-Key"],delete $http.defaults.headers.common["X-DreamFactory-Session-Token"];var url="https://en.wikipedia.org/w/api.php?action=query&format=json&origin=*&prop=extracts&list=&meta=&continue=&titles="+answer;return $http.post(url,{},{headers:{"Content-Type":"multipart/form-data"}}).then(function(result){var wikiRaw=JSON.stringify(result.data.query.pages),wikiRes=wikiRaw.slice(wikiRaw.indexOf("<p><b>"),wikiRaw.indexOf("<h2>"));wikiRes=wikiRes.replace(/<p>/g,""),wikiRes=wikiRes.replace(/<\/p>/g,""),wikiRes=wikiRes.replace(/<i>/g,""),wikiRes=wikiRes.replace(/<\/i>/g,""),wikiRes=wikiRes.replace(/<small>/g,""),wikiRes=wikiRes.replace(/<\/small>/g,""),wikiRes=wikiRes.replace(/<span title\=\\"Representation in the International Phonetic Alphabet \(IPA\)\\">/g,""),wikiRes=wikiRes.replace(/<\/span>/g,""),wikiRes=wikiRes.replace(/<b>/g,""),wikiRes=wikiRes.replace(/<\/b>/g,""),wikiRes=wikiRes.replace(/.\\n\\n/g,"."),wikiRes=wikiRes.replace(/.\\n/g,"."),wikiRes=wikiRes.replace(/<(?:.|\n)*?>/gm,""),$rootScope.DEBUG_MODE&&console.log("1. wiki results res - ",wikiRes),$http.defaults.headers.common["X-Dreamfactory-API-Key"]=APP_API_KEY,$http.defaults.headers.common["X-DreamFactory-Session-Token"]=$cookies.session_token,
$rootScope.$emit("wikiReady",wikiRes)})}return{getWiki:getWiki}}angular.module("app").service("getwiki",getwiki),getwiki.$inject=["$rootScope","$http","APP_API_KEY","GOOGLE_API_KEY","$cookies"]}(),function(){"use strict";function getgps($rootScope,$http,APP_API_KEY,GOOGLE_API_KEY,$cookies,$state){function getLocationGPS(answer){delete $http.defaults.headers.common["X-Dreamfactory-API-Key"],delete $http.defaults.headers.common["X-DreamFactory-Session-Token"],answer.location=answer.location.replace("#","");for(var myLoc="",nhs=$rootScope.nhs,locationHasNh=!1,i=0;i<nhs.length;i++)if(answer.location.indexOf(nhs[i])>-1){locationHasNh=!0;break}myLoc=!locationHasNh&&answer.location.indexOf("San Diego")<0?answer.location+" San Diego, CA":answer.location;var url="https://maps.googleapis.com/maps/api/geocode/json?address="+myLoc+"&key="+GOOGLE_API_KEY;return $http.get(url,{},{headers:{"Content-Type":"multipart/form-data"}}).then(function(result){answer.location=result.data.results[0].formatted_address,answer.lat=result.data.results[0].geometry.location.lat,answer.lng=result.data.results[0].geometry.location.lng,$http.defaults.headers.common["X-Dreamfactory-API-Key"]=APP_API_KEY,$http.defaults.headers.common["X-DreamFactory-Session-Token"]=$cookies.session_token,void 0!=answer.location&&null!=answer.location&&void 0!=answer.lat&&null!=answer.lat&&void 0!=answer.lng&&null!=answer.lng&&($rootScope.coordForUSer?($rootScope.currentUserLatitude=answer.lat,$rootScope.currentUserLongitude=answer.lng,$rootScope.coordForUSer=!1,$rootScope.coordsRdy=!0,$rootScope.$emit("coordsRdy"),$rootScope.DEBUG_MODE&&console.log("@gps - 71")):$rootScope.$emit("answerGPSready"))})}return{getLocationGPS:getLocationGPS}}angular.module("app").service("getgps",getgps),getgps.$inject=["$rootScope","$http","APP_API_KEY","GOOGLE_API_KEY","$cookies","$state"]}(),function(){"use strict";function flag($http,$q,$rootScope){function flagAnswer(type,id,flag){function querySucceeded(result){return console.log("creating flag answer record was succesful"),result.data}var data={};data.user=$rootScope.user.id,data.number=id,data.type=type,data.flag=flag,data.timestmp=Date.now();var obj={};obj.resource=[],obj.resource.push(data);var url=baseURI;return $http.post(url,obj,{headers:{"Content-Type":"multipart/form-data"},body:obj}).then(querySucceeded,_queryFailed)}function getFlags(){function querySucceeded(result){return _flags=result.data.resource}var url=baseURI;return $http.get(url).then(querySucceeded,_queryFailed)}function deleteFlag(flag_id){function querySucceeded(result){return $rootScope.DEBUG_MODE&&console.log("Deleting flag was succesful"),result.data}var obj={};obj.resource=[];var data={};data.id=flag_id,obj.resource.push(data);var url=baseURI+"/"+flag_id;return $http.delete(url,data,{headers:{"Content-Type":"multipart/form-data"},body:obj}).then(querySucceeded,_queryFailed)}function _queryFailed(error){throw error}var _flags=[],baseURI="/api/v2/mysql/_table/flagtable";return{flagAnswer:flagAnswer,getFlags:getFlags,deleteFlag:deleteFlag}}angular.module("app").factory("flag",flag),flag.$inject=["$http","$q","$rootScope"]}(),function(){"use strict";function fileupload($http,$cookies,APP_API_KEY){this.uploadFileToUrl=function(file,uploadUrl){delete $http.defaults.headers.common["X-Dreamfactory-API-Key"],delete $http.defaults.headers.common["X-DreamFactory-Session-Token"],delete $http.defaults.headers.common.Accept,delete $http.defaults.headers.common["Accept-Language"],delete $http.defaults.headers.common["Accept-Encoding"],delete $http.defaults.headers.common.Referer,delete $http.defaults.headers.common.origin,delete $http.defaults.headers.common.Connection;var url="https://rankx.file.core.windows.net/sandiego/est/"+file.name,now=(new Date).toUTCString();console.log("date in UTC format --- ",now);var canonicalizedHeader="x-ms-date:"+now+"\nx-ms-version:2015-02-21",canonicalizedResource="/sandiego/est/"+file.name,StringToSign="PUT\n\nmultipart/form-data\n\n"+canonicalizedHeader+canonicalizedResource;console.log("StringToSign",StringToSign);var keyWords=CryptoJS.enc.Base64.parse("XvsnVKjNv25OVh37Z6UviHjw0DCfo0V5XTXpxqktR9PxHBw=="),keyUTF8=CryptoJS.enc.Utf8.stringify(keyWords.words),StringToSignUTF8=CryptoJS.enc.Utf8.parse(StringToSign),hash=CryptoJS.HmacSHA256(StringToSignUTF8.sigBytes,keyUTF8),signature=CryptoJS.enc.Base64.stringify(hash);return console.log("signature---",signature),$http.put(url,file,{headers:{"Content-Type":"multipart/form-data","x-ms-date":now,"x-ms-version":"2015-02-21",Authorization:"SharedKey rankx:"+signature}}).success(function(result){console.log("Uploading file was succesful")}).error(function(error){console.log("There was a problem uploading your file")})}}angular.module("app").service("fileupload",fileupload),fileupload.$inject=["$http","$cookies","APP_API_KEY"]}(),function(){"use strict";function file($http,APP_API_KEY){function uploadFile(myFile){function querySucceeded(result){return $rootScope.DEBUG_MODE&&console.log("result",result),result.data}console.log("file",myFile);var url=baseUri+"/"+myFile.name;return $http.post(url,myFile,{headers:{"Content-Type":"multipart/form-data"}}).then(querySucceeded,_queryFailed)}function getFile(fileName){function querySucceeded(result){return result.data}var url=baseUri+"/"+encodeURIComponent(fileName);return $http.get(url,{params:{api_key:APP_API_KEY}}).then(querySucceeded,_queryFailed)}function _queryFailed(error){throw console.log("Error: ",error),error}var baseUri="/api/v2/files/images";return{uploadFile:uploadFile,getFile:getFile}}angular.module("app").factory("file",file),file.$inject=["$http","APP_API_KEY"]}(),function(){"use strict";function event($http,$q,$rootScope,catans,vrows){function getevents(forceRefresh){if(_areeventsLoaded()&&!forceRefresh)return $q.when(_events);var url0=baseURI+"?offset=0",url1=baseURI+"?offset=1000",p0=$http.get(url0),p1=$http.get(url1);return $q.all([p0,p1]).then(function(d){return _events=d[0].data.resource.concat(d[1].data.resource),$rootScope.DEBUG_MODE&&console.log("No. events: ",_events.length),_events},_queryFailed)}function getevent(id,forceRefresh){function querySucceeded(result){return _selectedevent=result.data}if(_isSelectedeventLoaded(id)&&!forceRefresh)return $q.when(_selectedevent);var url=baseURI+"/"+id;return $http.get(url).then(querySucceeded,_queryFailed)}function addevent(event){function querySucceeded(result){var eventx=event;return eventx.id=result.data.resource[0].id,_events.push(eventx),result.data}var url=baseURI,resource=[];return resource.push(event),$http.post(url,resource,{headers:{"Content-Type":"multipart/form-data"},body:resource}).then(querySucceeded,_queryFailed)}function update(event_id,field,val){function querySucceeded(result){return $rootScope.DEBUG_MODE&&console.log("updating event succesful"),result.data}var obj={};obj.resource=[];var data={};data.id=event_id;for(var i=0;i<field.length;i++)data[field[i]]=val[i];obj.resource.push(data);for(var url=baseURI,idx=_events.map(function(x){return x.id}).indexOf(event_id),i=0;i<field.length;i++)_events[idx][field[i]]=val[i];return $http.patch(url,obj,{headers:{"Content-Type":"multipart/form-data"},body:obj}).then(querySucceeded,_queryFailed)}function flagEvent(event_id,flag){function querySucceeded(result){return $rootScope.DEBUG_MODE&&console.log(" event flagged succesful"),result.data}var obj={};obj.resource=[];var data={};data.id=event_id,data.flag=flag,obj.resource.push(data);var url=baseURI;return $http.patch(url,obj,{headers:{"Content-Type":"multipart/form-data"},body:obj}).then(querySucceeded,_queryFailed)}function deleteEvent(event_id){function querySucceeded(result){return $rootScope.DEBUG_MODE&&console.log("Deleting event was succesful"),result.data}var obj={};obj.resource=[];var data={};data.id=event_id,obj.resource.push(data);var url=baseURI+"/"+event_id,i=_events.map(function(x){return x.id}).indexOf(event_id);return i>-1&&_events.splice(i,1),$http.delete(url,data,{headers:{"Content-Type":"multipart/form-data"},body:obj}).then(querySucceeded,_queryFailed)}function _areeventsLoaded(){return _events.length>0}function _isSelectedeventLoaded(id){return _selectedevent&&_selectedevent.id==id}function _queryFailed(error){throw error}var _selectedevent,_events=[],baseURI="/api/v2/mysql/_table/events";return{getevents:getevents,getevent:getevent,addevent:addevent,update:update,deleteEvent:deleteEvent,flagEvent:flagEvent}}angular.module("app").factory("event",event),event.$inject=["$http","$q","$rootScope","catans","vrows"]}(),function(){"use strict";function editvote($http,$q,$rootScope,uaf){function loadEditVotesTable(forceRefresh){function querySucceeded(result){return _editvotes=result.data.resource}if(_isEditVotesLoaded()&&!forceRefresh)return $q.when(_editvotes);var url=baseURI+"/_table/editvotetable/?filter=user="+$rootScope.user.id;return $http.get(url).then(querySucceeded,_queryFailed)}function postEditVoteRec(items){function querySucceeded(result){for(var itemx={},i=0;i<result.data.resource.length;i++)itemx=items[i],itemx.id=result.data.resource[i].id,_editvotes.push(itemx),$rootScope.ceditvotes.push(itemx),1==itemx.vote&&uaf.post("upVotedEdit",["answer","edit"],[itemx.answer,itemx.edit]),-1==itemx.vote&&uaf.post("downVotedEdit",["answer","edit"],[itemx.answer,itemx.edit]);return $rootScope.DEBUG_MODE&&console.log("Creating new voting record for edit was succesful"),result.data}var obj={};obj.resource=[],obj.resource.push(items);var url=baseURI+"/_table/editvotetable";return $http.post(url,items,{headers:{"Content-Type":"multipart/form-data"},body:items}).then(querySucceeded,_queryFailed)}function patchEditVoteRec(rec_id,vote){function querySucceeded(result){return $rootScope.DEBUG_MODE&&console.log("Updating vote record for edit was succesful"),result.data}var obj={};obj.resource=[];var data={};data.id=rec_id,data.vote=vote,data.timestmp=Date.now(),obj.resource.push(data);var url=baseURI+"/_table/editvotetable",i=_editvotes.map(function(x){return x.id}).indexOf(rec_id);return _editvotes[i].vote=vote,_editvotes[i].timestmp=data.timestmp,$http.patch(url,obj,{headers:{"Content-Type":"multipart/form-data"},body:obj}).then(querySucceeded,_queryFailed)}function deleteEditVotesbyAnswer(answer_id){function querySucceeded(result){return $rootScope.DEBUG_MODE&&console.log("Deleting edit vote records for answer was succesful"),result.data}for(var i=0;i<_editvotes.length;i++)_editvotes[i].answer==answer_id&&_editvotes.splice(i,1);var url=baseURI+"/_table/editvotetable?filter=answer="+answer_id;return $http.delete(url).then(querySucceeded,_queryFailed)}function deleteEditVotes(edit_id){function querySucceeded(result){return $rootScope.DEBUG_MODE&&console.log("Deleting edit vote records for answer was succesful"),result.data}for(var i=0;i<_editvotes.length;i++)_editvotes[i].edit==edit_id&&_editvotes.splice(i,1);var url=baseURI+"/_table/editvotetable?filter=edit="+edit_id;return $http.delete(url).then(querySucceeded,_queryFailed)}function _isEditVotesLoaded(id){return _editvotes.length>0}function _queryFailed(error){throw error}var _editvotes=[],baseURI="/api/v2/mysql";return{loadEditVotesTable:loadEditVotesTable,patchEditVoteRec:patchEditVoteRec,postEditVoteRec:postEditVoteRec,deleteEditVotes:deleteEditVotes,deleteEditVotesbyAnswer:deleteEditVotesbyAnswer}}angular.module("app").factory("editvote",editvote),editvote.$inject=["$http","$q","$rootScope","uaf"]}(),function(){"use strict";function edit($http,$q,$rootScope,uaf){function getEdits(forceRefresh){function querySucceeded(result){return _load(result.data.resource),$rootScope.DEBUG_MODE&&console.log("Edits Loaded"),_edits}var url=baseURI;return $http.get(url).then(querySucceeded,_queryFailed)}function getEditsX(data){function querySucceeded(result){var _editsx=result.data.resource,map=$rootScope.edits.map(function(x){return x.id});return _editsx.forEach(function(obj){map.indexOf(obj.id)<0&&_edits.push(obj)}),$rootScope.DEBUG_MODE&&console.log("editsX data loaded - ",_editsx),_editsx}var _datax=[];if(data.forEach(function(item){_fetchAnswersMem.indexOf(item.answer)<0&&(_datax.push(item),_fetchAnswersMem.push(item.answer))}),0==_datax.length)return $q.when(!1);for(var filterstr="?filter=(",i=0;i<_datax.length;i++)filterstr=filterstr+"answer="+_datax[i].answer+")OR(";filterstr=filterstr.substring(0,filterstr.length-3);var url=baseURI+filterstr;return $http.get(url).then(querySucceeded,_queryFailed)}function addEdit(newEdit){function querySucceeded(result){var newEditx=newEdit;return newEditx.id=result.data.resource[0].id,_edits.push(newEditx),console.log("newEditx - ",newEditx),console.log("_edits - ",_edits),console.log("$rootScope.edits - ",$rootScope.edits),uaf.post("editA",["answer","edit"],[newEditx.answer,newEditx.id]),$rootScope.DEBUG_MODE&&console.log("Adding new Edit succesful",result),result.data}var url=baseURI,resource=[];return resource.push(newEdit),$http.post(url,resource,{headers:{"Content-Type":"multipart/form-data"},body:resource}).then(querySucceeded,_queryFailed)}function updateEdit(edit_id,upV,downV){function querySucceeded(result){return $rootScope.DEBUG_MODE&&console.log("updating edit vote counts succesful"),result.data}var obj={};obj.resource=[];var data={};data.id=edit_id,data.upV=upV,data.downV=downV,obj.resource.push(data);var url=baseURI;return $http.patch(url,obj,{headers:{"Content-Type":"multipart/form-data"},body:obj}).then(querySucceeded,_queryFailed)}function deleteEdit(edit_id){function querySucceeded(result){return $rootScope.DEBUG_MODE&&console.log("Deleting edit was succesful"),result.data}var obj={};obj.resource=[];var data={};data.id=edit_id,obj.resource.push(data);var url=baseURI+"/"+edit_id,i=_edits.map(function(x){return x.id}).indexOf(edit_id);return i>-1&&_edits.splice(i,1),$http.delete(url,data,{headers:{"Content-Type":"multipart/form-data"},body:obj}).then(querySucceeded,_queryFailed)}function deleteEditbyAnswer(answer_id){function querySucceeded(result){return $rootScope.DEBUG_MODE&&console.log("Deleting edits for answer was succesful"),result.data}for(var i=0;i<_edits.length;i++)_edits[i].answer==answer_id&&_edits.splice(i,1);var url=baseURI+"?filter=answer="+answer_id;return $http.delete(url).then(querySucceeded,_queryFailed)}function _load(data){_edits.length=0,_fetchAnswersMem.length=0,data.forEach(function(x){_edits.push(x),_fetchAnswersMem.push(x.id)})}function _queryFailed(error){throw error}var _edits=[],_fetchAnswersMem=[];$rootScope.edits=_edits;var baseURI="/api/v2/mysql/_table/edittable";return{getEdits:getEdits,getEditsX:getEditsX,addEdit:addEdit,updateEdit:updateEdit,deleteEdit:deleteEdit,deleteEditbyAnswer:deleteEditbyAnswer}}angular.module("app").factory("edit",edit),edit.$inject=["$http","$q","$rootScope","uaf"]}(),function(){"use strict";function dialog($q,$rootScope,useraccnt,imagelist,answer,login,$window,$cookies,$state,$compile,htmlops,datetime,InstagramService,users){function showDialog(title,text){BootstrapDialog.TYPE_PRIMARY,BootstrapDialog.show({title:title,message:text,buttons:[{id:"btn-ok",label:"OK",cssClass:"btn-primary",autospin:!1,action:function(dialogRef){dialogRef.close()}}]})}function getDialog(x){showDialog($rootScope.dialogs["dialog."+x+".title"],$rootScope.dialogs["dialog."+x+".text"])}function editConfirm(edit,type,callback){var title="",message="",btnCancelLabel="",btnOkLabel="";title="Please Confirm",btnCancelLabel="Cancel",btnOkLabel="Confirm","image"==type&&(message="You want to change the image of <strong><em>"+edit.name+"</em></strong> to this one: </br><img src="+edit.imageURL+' class="thumbnail" style="width:60%; max-height:150px">'),"field"==type&&"addinfo"!=edit.field&&(message='You want to change the <strong class="capitalize"><em>'+edit.field+"</em></strong> of <strong><em>"+edit.name+"</em></strong> to <strong><em>"+edit.nval+"</em></strong>."),"field"==type&&"addinfo"==edit.field&&(message="You want to change the information of <strong><em>"+edit.name+"</em></strong> to: <br><br>"+edit.nval+"</br>."),BootstrapDialog.confirm({type:BootstrapDialog.TYPE_PRIMARY,title:title,message:message,closable:!0,draggable:!0,btnCancelLabel:btnCancelLabel,btnOKLabel:btnOkLabel,btnOKClass:"btn-primary",btnCancelAction:function(dialogRef){dialogRef.close()},callback:function(result){result&&callback(edit)}})}function addAnswer(answer,ranks,url,callback){for(var answerhtml="",rankshtml="",newline="",i=($rootScope.cCategory.id,0);i<$rootScope.fields.length;i++){switch($rootScope.fields[i].name){case"name":newline='<strong class="capitalize">Name</strong>: '+answer.name+"</br>";break;case"location":newline=answer.location?'<strong class="capitalize">Location</strong>: '+answer.location+"</br>":"<strong>Location</strong>: </br>";break;case"cityarea":newline='<strong class="capitalize">City Area</strong>: '+answer.cityarea+"</br>";break;case"addinfo":newline=answer.addinfo?'<strong class="capitalize">Additional Info</strong>: '+answer.addinfo+"</br>":"<strong>Additional Info</strong>: </br>";break;case"phone":newline=answer.phone?'<strong class="capitalize">Phone</strong>: '+answer.phone+"</br>":"<strong>Phone</strong>: </br>";break;case"website":newline=answer.website?'<strong class="capitalize">Website</strong>: '+answer.website+"</br>":"<strong>Website</strong>: </br>";break;case"email":newline=answer.email?'<strong class="capitalize">Email</strong>: '+answer.email+"</br>":"<strong>Email</strong>: </br>"}answerhtml+=newline}for(var j=0;j<ranks.length;j++)ranks[j].sel&&(rankshtml=rankshtml+"<em>"+ranks[j].title+"</em></br>");showAddAnswer(answer,rankshtml,answerhtml,url,callback)}function showAddAnswer(answer,rankshtml,answerhtml,imageurl,callback){var title="",message="",btnCancelLabel="",btnOkLabel="";title="Please Confirm",btnCancelLabel="Cancel",btnOkLabel="Confirm",message="You want to add the following: </br></br>"+answerhtml+'</br>With the following image:<div class="text-center"><img src='+imageurl+' class="thumbnail" style="width:60%; max-height:150px"></div>to the rankings:<br><div class="text-center" style="padding-top:10px">'+rankshtml+"</div>",BootstrapDialog.confirm({type:BootstrapDialog.TYPE_PRIMARY,title:title,message:message,closable:!0,draggable:!0,btnCancelLabel:btnCancelLabel,btnOKLabel:btnOkLabel,btnOKClass:"btn-primary",btnCancelAction:function(dialogRef){dialogRef.close()},callback:function(result){result&&callback(answer)}})}function editChangeEffective(edit,index,type,callback){var title="",message="";"approve"==type&&"addinfo"!=edit.field&&(title="Changed Approved",message="Congrats! With your vote, the change of <strong>"+edit.field+"</strong> of <strong>"+edit.name+"</strong> to <strong>"+edit.nval+"</strong> gets approved."),"approve"==type&&"addinfo"==edit.field&&(title="Changed Approved",message="Congrats! With your vote, the information of <strong>"+edit.name+"</strong> to <br><br>"+edit.nval+"</br> gets approved."),"reject"==type&&(title="Changed Rejected",message="Congrats! With your vote, the change of <strong>"+edit.field+"</strong> of <strong>"+edit.name+"</strong> to <strong>"+edit.nval+"</strong> has been rejected."),BootstrapDialog.show({type:BootstrapDialog.TYPE_PRIMARY,title:title,message:message,buttons:[{id:"btn-ok",label:"OK",cssClass:"btn-primary",autospin:!1,action:function(dialogRef,result){callback(index,type),dialogRef.close()}}]})}function howItWorks(type){var message="",title="";"editAnswer"==type&&(title="Information Edits",message="Use edits to correct, add or update information in a profile. All edits need to be accepted by other users before they are approved. </br></br>An edit or change becomes approved when the number of people that agree exceeds the number of people that disagree by 3. </br></br>An edit or change gets rejected when the number of people that disagree exceeds those that agree by 3. </br></br> Only one edit per field at a time is allowed. Make sure you vote on the edits you agree or disagree."),"addAnswer"==type&&(title="Add a new answer",message="1. Fill out the form. The fields marked with ** are required. All other fields are not required but recommended. <br/><br/>2. Click the 'Get Images' button. <br/><br/>3. Use '>>' and '<<' buttons to browse through the images. You can 'Get More Images' button to load more images.<br/><br/>4. When the image you want shows in the image box, click the button 'Add' to add the new answer to the list.<br/><br/>NOTE: Not all images will correspond to your answer. Entering all fields will help with the image results."),"shortPhrase"==type&&(title="Add an Answer",message="Fill out the form. The fields marked with ** are required. <br/><br/> - The <strong>Title</strong> is the main idea of your answer. <br/><br/> - In the <strong>Details</strong> box, write additional details about your answer. You can also write arguments on why it should be included in this list.<br/><br/>For example: <br/><br/>In the rank <strong><em>Reasons why dogs are awesome</em></strong> you can add following answer: <br/><br/><strong>Title:</strong> They enjoy the simple things in life <br/><br/><strong>Details:</strong> Dogs dont need much to be happy, they are happy with simple things like a belly rub, a walk around the block, playing in the snow or going for a drive."),BootstrapDialog.show({type:BootstrapDialog.TYPE_PRIMARY,title:title,message:message,buttons:[{id:"btn-ok",label:"OK",cssClass:"btn-primary",autospin:!1,action:function(dialogRef){dialogRef.close()}}]})}function url(link){BootstrapDialog.show({type:BootstrapDialog.TYPE_PRIMARY,title:"Image URL",message:link,buttons:[{id:"btn-ok",label:"OK",cssClass:"btn-primary",autospin:!1,action:function(dialogRef){dialogRef.close()}}]})}function checkSameAnswer(answer1,answer2,callback1,callback2){for(var answerhtml="",answerhtml2="",newline="",newline2="",i=0;i<$rootScope.fields.length;i++){switch($rootScope.fields[i].name){case"name":newline='<strong class="capitalize">Name</strong>: '+answer1.name+"</br>",newline2='<strong class="capitalize">Name</strong>: '+answer2.name+"</br>";break;case"location":newline=answer1.location?'<strong class="capitalize">Location</strong>: '+answer1.location+"</br>":"<strong>Location</strong>: </br>",newline2=answer2.location?'<strong class="capitalize">Location</strong>: '+answer2.location+"</br>":"<strong>Location</strong>: </br>";break;case"cityarea":newline='<strong class="capitalize">City Area</strong>: '+answer1.cityarea+"</br>",newline2='<strong class="capitalize">City Area</strong>: '+answer2.cityarea+"</br>";break;case"addinfo":newline=answer1.addinfo?'<strong class="capitalize">Additional Infob</strong>: '+answer1.addinfo+"</br>":"<strong>Additional Info</strong>: </br>",newline2=answer2.addinfo?'<strong class="capitalize">Additional Infob</strong>: '+answer2.addinfo+"</br>":"<strong>Additional Info</strong>: </br>";break;case"phone":newline=answer1.phone?'<strong class="capitalize">Phoneb</strong>: '+answer1.phone+"</br>":"<strong>Phone</strong>: </br>",newline2=answer2.phone?'<strong class="capitalize">Phoneb</strong>: '+answer2.phone+"</br>":"<strong>Phone</strong>: </br>";break;case"website":newline=answer1.website?'<strong class="capitalize">Websiteb</strong>: '+answer1.website+"</br>":"<strong>Website</strong>: </br>",newline2=answer2.website?'<strong class="capitalize">Websiteb</strong>: '+answer2.website+"</br>":"<strong>Website</strong>: </br>";break;case"email":newline=answer1.email?'<strong class="capitalize">Emailb</strong>: '+answer1.email+"</br>":"<strong>Email</strong>: </br>",newline2=answer2.email?'<strong class="capitalize">Emailb</strong>: '+answer2.email+"</br>":"<strong>Email</strong>: </br>"}answerhtml+=newline,answerhtml2+=newline2}showSameAnswer(answer1,answerhtml,answer2,answerhtml2,callback1,callback2)}function showSameAnswer(answer1,answerhtml,answer2,answerhtml2,callback1,callback2){var title="",message="",btnCancelLabel="",btnOkLabel="";title="Just checking",btnCancelLabel="No, they are different",btnOkLabel="Yeah, same",message="Are these the same "+$rootScope.cCategory.type+'? </br></br><div class="row"><div class="col-sm-6">'+answerhtml+"</br><img src="+answer1.imageurl+' class="thumbnail" style="width:60%; max-height:150px"></div><div class="col-sm-6">'+answerhtml2+"</br><img src="+answer2.imageurl+' class="thumbnail" style="width:60%; max-height:150px"></div></div>',BootstrapDialog.confirm({type:BootstrapDialog.TYPE_PRIMARY,title:title,message:message,closable:!0,draggable:!0,btnCancelLabel:btnCancelLabel,btnOKLabel:btnOkLabel,btnOKClass:"btn-primary",btnCancelAction:function(dialogRef){dialogRef.close()},callback:function(result){result?callback2():callback1(answer1)}})}function deleteType(thisCatOnly,everywhere){var title="",message="",btnCancelLabel="",btnOkLabel="";title="Scope of Delete",btnCancelLabel="Just in the category: "+$rootScope.cCategory.title,btnOkLabel="Everywhere",message="Choose scope to delete:",BootstrapDialog.confirm({type:BootstrapDialog.TYPE_DANGER,title:title,message:message,closable:!0,draggable:!0,btnCancelLabel:btnCancelLabel,btnOKLabel:btnOkLabel,btnOKClass:"btn-primary",btnCancelAction:function(dialogRef){dialogRef.close()},callback:function(result){result?everywhere():thisCatOnly()}})}function deleteThisCatans(answer,category,callback){var title="",message="",btnCancelLabel="",btnOkLabel="";title="Confirm Delete",btnCancelLabel="Cancel",btnOkLabel="Delete",message="This will delete the CatAns record for <strong>"+answer+"</strong> in the category of <strong>"+category+"</strong>.",BootstrapDialog.confirm({type:BootstrapDialog.TYPE_DANGER,title:title,message:message,closable:!0,draggable:!0,btnCancelLabel:btnCancelLabel,btnOKLabel:btnOkLabel,btnOKClass:"btn-primary",btnCancelAction:function(dialogRef){dialogRef.close()},callback:function(result){result&&callback()}})}function createSpecialPreview(x,addSpecial){var title="",message="",btnCancelLabel="",btnOkLabel="";title="Special Preview",btnCancelLabel="Back",btnOkLabel="Save Special";var specialhtml=htmlops.specialHtml(x);message='This is how this special will look: </br></br>In the ranking summary:<br><table class="table table-hover cursor "><thead><tr><th>Rank</th><th>Name</th><th>Distance</th><th>Specials</th></tr></thead><tbody><tr><td>1</td><td>'+x.name+'</td><td>1.5</td><td style="background-color:'+x.bc+";color:"+x.fc+';">'+x.stitle+"<td></tr></tbody></table><br>Inside your business profile:<br>"+specialhtml+"</br>With the following image:<img src="+x.image+' class="thumbnail" style="width:70%; max-height:150px">',BootstrapDialog.confirm({type:BootstrapDialog.TYPE_PRIMARY,title:title,message:message,closable:!0,draggable:!0,btnCancelLabel:btnCancelLabel,btnOKLabel:btnOkLabel,btnOKClass:"btn-primary",btnCancelAction:function(dialogRef){dialogRef.close()},callback:function(result){result&&addSpecial()}})}function deleteRank(x,callback,isSpecial){var title="",message="",btnCancelLabel="",btnOkLabel="";title="Yes, Delete",btnCancelLabel="Cancel",btnOkLabel="Delete",message=isSpecial?"Just confirming, do you want to delete the special <strong>"+x.stitle+"</strong>?":"Just confirming, do you want to delete the ranking <strong>"+x.title+"</strong>?",BootstrapDialog.confirm({type:BootstrapDialog.TYPE_DANGER,title:title,message:message,closable:!0,draggable:!0,btnCancelLabel:btnCancelLabel,btnOKLabel:btnOkLabel,btnOKClass:"btn-primary",btnCancelAction:function(dialogRef){dialogRef.close()},callback:function(result){result&&callback()}})}function getLocation(callback){var title="",message="",btnCancelLabel="",btnOkLabel="";title="Share Location",btnCancelLabel="Not Now",btnOkLabel="Ok",message="Please allow browser share location so we can calculate distance to the best places.",BootstrapDialog.confirm({type:BootstrapDialog.TYPE_PRIMARY,title:title,message:message,closable:!0,draggable:!0,btnCancelLabel:btnCancelLabel,btnOKLabel:btnOkLabel,btnOKClass:"btn-primary",btnCancelAction:function(dialogRef){dialogRef.close()},callback:function(result){result&&callback()}})}function bizRegistration(callback){var title="",message="",btnCancelLabel="",btnOkLabel="";title="Do you own this business?",btnCancelLabel="Cancel",btnOkLabel="Bind",message="If you own or represent this business, please bind to your account so only you can change or edit its information.<br><br><strong>* Name of Business</strong><br><strong>* Address</strong><br><strong>* Phone Number</strong><br><strong>* Main Photo</strong><br><strong>* Hours</strong><br><br>Binding this business to your account is free.",BootstrapDialog.confirm({type:BootstrapDialog.TYPE_PRIMARY,title:title,message:message,closable:!0,draggable:!0,btnCancelLabel:btnCancelLabel,btnOKLabel:btnOkLabel,btnOKClass:"btn-primary",btnCancelAction:function(dialogRef){dialogRef.close()},callback:function(result){result&&callback()}})}function bindAccount(name,business,callback){var title="",message="",btnCancelLabel="",btnOkLabel="";title="Confirmation",btnCancelLabel="Cancel",btnOkLabel="Yes, bind this business to my account",message="<br><strong>Note:</strong> Claiming to have false authority over a business is against the law.<br><br>Please confirm:<br><br>You, <strong>"+name+"</strong>, have the authority to represent <strong>"+business+"</strong>.",BootstrapDialog.confirm({type:BootstrapDialog.TYPE_PRIMARY,title:title,message:message,closable:!0,draggable:!0,btnCancelLabel:btnCancelLabel,btnOKLabel:btnOkLabel,btnOKClass:"btn-primary",btnCancelAction:function(dialogRef){dialogRef.close()},callback:function(result){result&&callback()}})}function addVRow(x,callback){var title="",message="";title="Enter Data",message="<br> Enter new vote row to be added in Group: <strong>"+x.gtitle+'</strong><br><br>Vote Row Name:<input class="form-control" type="text" placeholder="Enter Vote Row Name"><br><br>',BootstrapDialog.show({type:BootstrapDialog.TYPE_PRIMARY,title:title,message:message,closable:!0,draggable:!0,buttons:[{label:"Cancel",action:function(dialogRef){dialogRef.close()}},{label:"OK",action:function(dialogRef,result){var vrowname=dialogRef.getModalBody().find("input").val();result&&callback(x,vrowname),dialogRef.close()}}]})}function deleteVRow(x,callback){var title="",message="",btnCancelLabel="",btnOkLabel="";title="Please Confirm",btnCancelLabel="Cancel",btnOkLabel="Yes, Delete",message="<br>Please confirm, you want to delete vote row <strong>"+x.title+"</strong> from <strong>"+x.gtitle+"</strong>.<br><br><strong>Note:</strong> All vote records will be lost",BootstrapDialog.confirm({type:BootstrapDialog.TYPE_DANGER,title:title,message:message,closable:!0,draggable:!0,btnCancelLabel:btnCancelLabel,btnOKLabel:btnOkLabel,btnOKClass:"btn-default",btnCancelAction:function(dialogRef){dialogRef.close()},callback:function(result){result&&callback(x)}})}function addVRowGroup(x,callback){var title="",message="";title="Enter Data",message='<br>Enter name of Vote Group you want to create: <br><br>Group Name:<input class="form-control" type="text" placeholder="Enter Vote Row Group Name"><br><br>',BootstrapDialog.show({type:BootstrapDialog.TYPE_PRIMARY,title:title,message:message,closable:!0,draggable:!0,buttons:[{label:"Cancel",action:function(dialogRef){dialogRef.close()}},{label:"OK",action:function(dialogRef,result){var vrowgroupname=dialogRef.getModalBody().find("input").val();result&&callback(x,vrowgroupname),dialogRef.close()}}]})}function editVRowGroup(x,callback,callback2){var title="",message="";title="Enter Data",message='<br>Enter new name of Vote Group: <br><br>Group Name:<input class="form-control" type="text" placeholder="'+x.gtitle+'"><br><br>',BootstrapDialog.show({type:BootstrapDialog.TYPE_PRIMARY,title:title,message:message,closable:!0,draggable:!0,buttons:[{label:"Cancel",action:function(dialogRef){dialogRef.close()}},{label:"Edit",action:function(dialogRef,result){var vrowgroupname=dialogRef.getModalBody().find("input").val();result&&callback(x,vrowgroupname),dialogRef.close()}},{label:"Delete",action:function(dialogRef,result){result&&callback2(x),dialogRef.close()}}]})}
function deleteVRowGroup(x,callback){var title="",message="",btnCancelLabel="",btnOkLabel="";title="Please Confirm",btnCancelLabel="Cancel",btnOkLabel="Yes, Delete",message="<br>Please confirm, you want to delete the vote group <strong>"+x.gtitle+"</strong> and all the items within it.<br><br><strong>Note:</strong> All vote records for all items will be lost",BootstrapDialog.confirm({type:BootstrapDialog.TYPE_DANGER,title:title,message:message,closable:!0,draggable:!0,btnCancelLabel:btnCancelLabel,btnOKLabel:btnOkLabel,btnOKClass:"btn-default",btnCancelAction:function(dialogRef){dialogRef.close()},callback:function(result){result&&callback(x)}})}function createEventPreview(event,mode,callback){var answerhtml="",newline='<p style="text-align:left">';event.name&&(newline=newline+'<strong class="capitalize">Name</strong>: '+event.name+"</br>"),event.eventloc&&(newline=newline+'<strong class="capitalize">Venue</strong>: '+event.eventloc+"</br>"),event.location&&(newline=newline+'<strong class="capitalize">Address</strong>: '+event.location+"</br>"),event.cityarea&&(newline=newline+'<strong class="capitalize">Neighborhood</strong>: '+event.cityarea+"</br>"),event.phone&&(newline=newline+'<strong class="capitalize">Phone Number</strong>: '+event.phone+"</br>"),event.website&&(newline=newline+'<strong class="capitalize">Website</strong>: '+event.website+"</br>"),answerhtml=newline+"</p>",showAddEvent(event,answerhtml,htmlops.eventHtml(event),event.imageurl,mode,callback)}function showAddEvent(event,answerhtml,addinfomessage,imageurl,mode,callback){var title="",message="",btnCancelLabel="",btnOkLabel="";"add"==mode?message="You want to add the following event to <strong>"+$rootScope.cCategory.title+"</strong>. </br><p></p>"+answerhtml+addinfomessage+"</br>With the following image:<img src="+imageurl+' class="thumbnail" style="width:60%; max-height:150px">':"edit"==mode&&(message="Please confirm the new information. </br><p></p>"+answerhtml+addinfomessage+"</br>With the following image:<img src="+imageurl+' class="thumbnail" style="width:60%; max-height:150px">'),title="Please Confirm",btnCancelLabel="Cancel",btnOkLabel="Confirm",BootstrapDialog.confirm({type:BootstrapDialog.TYPE_PRIMARY,title:title,message:message,closable:!0,draggable:!0,btnCancelLabel:btnCancelLabel,btnOKLabel:btnOkLabel,btnOKClass:"btn-primary",btnCancelAction:function(dialogRef){dialogRef.close()},callback:function(result){result&&callback(event)}})}function askPermissionToLocate(){var title="",messagehtml="",messageLoading="";title="Please Confirm",messagehtml='<div class="text-left">Is it ok if we locate your position?</div><br><div class="row"><div class="container col-xs-12"><div class="text-left" style="color:blue">Option 1</div><div class="text-center" style="border:2px"><button class="btn btn-success" id="useGeo">Yes, locate me using geolocation</button></div><br><div class="text-left" style="color:blue">Option 2 <small>(recommended for accuracy)</small></div><br><p>Yes, use this address as my current location</p><div class="input-group"><input id="address" type="text" class="form-control" placeholder="Enter address"><span class="input-group-btn text-right"><button class="btn btn-success" type="button" id="gobutton">Go</button></span></div><br><br></div><div class="container col-xs-12"><div class="text-center" style="border:2px"><button class="btn btn-default" id="noapprove">No, I don\'t approve</button></div></div></div>',messageLoading='<div style="height:80px;position:relative"><img src="/assets/images/loading.gif" class="img" style="width:50px;height:50px;position:absolute; top:50%; left:50%; margin-right:-50%;transform: translate(-50%,-50%)"/></div><p>Just a moment, finding your location...</p>',BootstrapDialog.show({type:BootstrapDialog.TYPE_PRIMARY,title:title,message:function(dialogRef){var $content=$(messagehtml);return $content.find("#useGeo").click({},function(){if($rootScope.isFacebookApp)getDialog("FacebookAppNotSupported");else{var x=dialogRef;$rootScope.$emit("getLocation"),x.enableButtons(!1),x.setClosable(!1),x.getModalBody().html(messageLoading),x.setTitle("Please wait"),setTimeout(function(){x.close()},1e4)}}),$content.find("#gobutton").click({},function(){var address=$content.find("input").val(),x=dialogRef;$rootScope.$emit("useAddress",{address:address}),x.close()}),$content.find("#noapprove").click({},function(){dialogRef.close()}),$content},closable:!0,draggable:!0,btnCancelLabel:"No, I don't approve",btnOKLabel:"Yes, locate me",btnOKClass:"btn-success",btnCancelClass:"btn-warning",btnCancelAction:function(dialogRef){dialogRef.close()}})}function askEmail(accntname){var title="",messagehtml="";title="Missing info",messagehtml='<div class="text-left">Let\'s stay in touch. Please provide us an email address where we can keep you updated on everything related to the <strong>'+accntname+'</strong> account.</div><br><div class="input-group"><input id="email" type="text" class="form-control" placeholder="Enter email address"><span class="input-group-btn text-right"><button class="btn btn-primary" type="button" id="gobutton">Submit</button></span></div><br>',BootstrapDialog.show({type:BootstrapDialog.TYPE_PRIMARY,title:title,message:function(dialogRef){var $content=$(messagehtml);return $content.find("#gobutton").click({},function(){var address=$content.find("input").val(),x=dialogRef;$rootScope.showWarning=!1,useraccnt.updateuseraccnt($rootScope.useraccnts[0].id,["email"],[address]),x.close(),$rootScope.$emit("hideWarning")}),$content},closable:!0,draggable:!0,btnCancelLabel:"No, I don't approve",btnOKLabel:"Yes, locate me",btnOKClass:"btn-success",btnCancelClass:"btn-warning",btnCancelAction:function(dialogRef){dialogRef.close()}})}function seePhotos(blobList,idx,answer,isOwner){var title="",messagehtml="",n=idx,L=blobList.length,img_style="";img_style=($rootScope.sm,"width:100%;height:auto"),title="Photos - "+answer.name;var m1="",m2="",m3="",m4="",cap="";isOwner?(m1='<div class="row"><div class="text-left col-xs-3 col-md-4"><button class="btn btn-default pull-left" id="prevbutton">&lt;&lt</button></div><div class="text-middle col-xs-5 col-md-4"><button class="btn btn-default" id="makeprimary">Make Main Photo</button></div><div class="text-right col-xs-4 col-md-4"><button class="btn btn-default pull-right" id="nextbutton">&gt;&gt</button></div></div>',m4='<div class="text-right"><button type="button" class="btn btn-default pull-right" style="vertical-align:middle;" id="trashbutton"><span class="glyphicon glyphicon-trash" style="padding-top:0px;padding-bottom:0px;" aria-hidden="true"></span></button></div><br/>'):(m1='<div class="row"><div class="text-left col-xs-6"><button class="btn btn-default pull-left" id="prevbutton">&lt;&lt</button></div><div class="text-right col-xs-6"><button class="btn btn-default pull-right" id="nextbutton">&gt;&gt</button></div></div>',m4="<br/>"),m2='<br><div class="text-center"><img id="image" class="displayed" src="',m3='" style="'+img_style+'"></div><p>Photo from &nbsp<strong id="source">'+blobList[n].type+"</strong></p></br><br/>",cap=void 0!=blobList[n].from?'<p id="credit">Photo by:&nbsp<strong>@'+blobList[n].from+'</strong></p></br><p id="caption">'+(blobList[n].caption?blobList[n].caption:"")+"</p>":'<p id="credit"></p><p id="caption"></p>';messagehtml=m1+m2+blobList[n].url+m3+m4+cap,BootstrapDialog.show({type:BootstrapDialog.TYPE_PRIMARY,title:title,message:function(dialogRef){var $content=$(messagehtml),x=dialogRef;return $content.find("#prevbutton").click({},function(){n-=1,n<0&&(n=L-1),$content.find("#image").attr("src",blobList[n].url),$content.find("#source").html(blobList[n].type),void 0!=blobList[n].from?$("#credit").html("Photo by:&nbsp<strong>@"+blobList[n].from+"</strong></br>"):$("#credit").html(""),void 0!=blobList[n].caption?$("#caption").html(blobList[n].caption):$("#caption").html("")}),$content.find("#nextbutton").click({},function(){n+=1,n>=L&&(n=0),$content.find("#image").attr("src",blobList[n].url),$content.find("#source").html(blobList[n].type),void 0!=blobList[n].from?$("#credit").html("Photo by:&nbsp<strong>@"+blobList[n].from+"</strong></br>"):$("#credit").html(""),void 0!=blobList[n].caption?$("#caption").html(blobList[n].caption):$("#caption").html("")}),$content.find("#trashbutton").click({},function(){confirmPhotoDelete(blobList,n,answer),x.close()}),$content.find("#makeprimary").click({},function(){confirmMakePrimary(blobList,n,answer),x.close()}),$content},closable:!0,draggable:!0,btnCancelLabel:"No, I don't approve",btnOKLabel:"Yes, locate me",btnOKClass:"btn-success",btnCancelClass:"btn-warning",btnCancelAction:function(dialogRef){dialogRef.close()}})}function confirmPhotoDelete(blobList,n,current_answer){var title="",message="",btnCancelLabel="",btnOkLabel="";title="Please Confirm",btnCancelLabel="Cancel",btnOkLabel="Yes, Delete",message='<br>Please confirm, you want to delete this photo: <br/><img id="image" class="displayed" src="'+blobList[n].url+'" style="width:100%;height:auto"><br><br>',BootstrapDialog.confirm({type:BootstrapDialog.TYPE_DANGER,title:title,message:message,closable:!0,draggable:!0,btnCancelLabel:btnCancelLabel,btnOKLabel:btnOkLabel,btnOKClass:"btn-default",btnCancelAction:function(dialogRef){dialogRef.close()},callback:function(result){if(result)if($rootScope.DEBUG_MODE&&console.log(blobList),"Instagram"==blobList[n].type){var itempos=current_answer.ig_image_urls.indexOf(blobList[n].url);-1!=itempos&&(current_answer.ig_image_urls=current_answer.ig_image_urls.substr(0,itempos-1)+current_answer.ig_image_urls.substr(itempos+blobList[n].url.length),setInstagramImageUrl(current_answer.id,current_answer.ig_image_urls).then(function(answer){$rootScope.$emit("refreshImages")}))}else imagelist.deleteBlob(blobList[n].url)}})}function confirmMakePrimary(blobList,n,myanswer){var title="",message="",btnCancelLabel="",btnOkLabel="";title="Please Confirm",btnCancelLabel="Cancel",btnOkLabel="Yes, make primary",message='<br>Please confirm, you want to make this the primary photo: <br/><img id="image" class="displayed" src="'+blobList[n].url+'" style="width:100%;height:auto"><br><br>',BootstrapDialog.confirm({type:BootstrapDialog.TYPE_PRIMARY,title:title,message:message,closable:!0,draggable:!0,btnCancelLabel:btnCancelLabel,btnOKLabel:btnOkLabel,btnOKClass:"btn-default",btnCancelAction:function(dialogRef){dialogRef.close()},callback:function(result){if(result){var imageurl=blobList[n].url;answer.updateAnswer(myanswer.id,["imageurl"],[imageurl])}}})}function loginFacebook(){var title="",message="";title="Login required",message="You must be logged in to add rankings, answers, opinions, endorse establishments and participate in the rankings.</br></br>Do you want to log in?",BootstrapDialog.show({title:title,message:message,buttons:[{label:"Not now",action:function(dialogItself){dialogItself.close()}},{icon:"fa fa-facebook",label:"Login",cssClass:"btn-primary",action:function(dialogItself){$rootScope.stateName=$state.current.name,"rankSummary"==$rootScope.stateName?$rootScope.stateNum=$rootScope.cCategory.id:"answerDetail"==$rootScope.stateName?$rootScope.stateNum=$rootScope.canswer.id:$rootScope.stateNum=void 0,login.facebookSDKLogin().then(function(){$q.all([users.getUser($rootScope.user.id)]).then(function(data){data?($rootScope.user.level=data[0][0].level,$rootScope.user.points=data[0][0].points):(welcomeNewUser($rootScope.user.first_name),users.addUser())}),dialogItself.close(),$state.go($state.current,{},{reload:!0})})}}]})}function shareOptions(callback,isMobile,link,text,scope){var title="",rendercode="";title="Share Options",rendercode='<div class="row"><div class="col-xs-3 col-sm-3 col-md-2 col-lg-2 text-center" style="cursor: pointer"><img src="/assets/images/1485385043_mail.png" id="email" style="width:50px;margin-bottom:20px"></div><div class="col-xs-3 col-sm-3 col-md-2 col-lg-2 text-center" style="cursor: pointer"><img src="/assets/images/1485384809_2_-_Facebook.png" id="facebook" style="width:50px;margin-bottom:20px"></div><div class="col-xs-3 col-sm-3 col-md-2 col-lg-2 text-center" style="cursor: pointer"><img src="/assets/images/1485384868_1_-_Twitter.png" id="twitter" style="width:50px;margin-bottom:20px"></div><div class="col-xs-3 col-sm-3 col-md-2 col-lg-2 text-center" style="cursor: pointer"><img src="/assets/images/1485384841_13_-_Pintrest.png" id="pinterest" style="width:50px;margin-bottom:20px"></div><div class="col-xs-3 col-sm-3 col-md-2 col-lg-2 text-center" style="cursor: pointer"><img src="/assets/images/1485384824_6_-_Google_Plus.png" id="gplus" style="width:50px;margin-bottom:20px"></div><div class="col-xs-3 col-sm-3 col-md-2 col-lg-2 text-center" style="cursor: pointer"><img src="/assets/images/1485384853_5_-_Tumbler.png" id="tumblr" style="width:50px;margin-bottom:20px"></div><div class="col-xs-3 col-sm-3 col-md-2 col-lg-2 text-center" style="cursor: pointer"><img src="/assets/images/1485425301_reddit.png" id="reddit" style="width:50px;margin-bottom:20px"></div><div class="col-xs-3 col-sm-3 col-md-2 col-lg-2 text-center style="cursor: pointer""><a href="#" socialshare socialshare-provider="whatsapp" socialshare-text="'+text+'" socialshare-url="'+link+'"><img src="/assets/images/1485384832_16_-_Whatsapp.png" id="whatsapp" style="width:50px;margin-bottom:20px;display:'+(isMobile?"inline":"none")+'"> </a></div><div class="col-xs-3 col-sm-3 col-md-2 col-lg-2 text-center style="cursor: pointer""><a href="#" socialshare socialshare-provider="facebook-messenger" socialshare-url="'+link+'"><img src="/assets/images/1485385110_Facebook_Messenger.png" id="messenger" style="width:50px;margin-bottom:20px;display:'+(isMobile?"inline":"none")+'"> </a></div><div class="col-xs-3 col-sm-3 col-md-2 col-lg-2 text-center style="cursor: pointer""><a href="#" socialshare socialshare-provider="sms" socialshare-text="'+text+'" socialshare-url="'+link+'"><img src="/assets/images/1485385026_sms.png" id="sms" style="width:50px;margin-bottom:20px;display:'+(isMobile?"inline":"none")+'"> </a></div></div>';var messagehtml=$compile(rendercode)(scope);BootstrapDialog.show({title:title,message:function(dialogRef){var $content=$(messagehtml),x=dialogRef;return $content.find("#twitter").click({},function(){callback("twitter"),x.close()}),$content.find("#facebook").click({},function(){callback("facebook"),x.close()}),$content.find("#email").click({},function(){callback("email"),x.close()}),$content.find("#pinterest").click({},function(){callback("pinterest"),x.close()}),$content.find("#gplus").click({},function(){callback("gplus"),x.close()}),$content.find("#reddit").click({},function(){callback("reddit"),x.close()}),$content.find("#tumblr").click({},function(){callback("tumblr"),x.close()}),$content.find("#whatsapp").click({},function(){x.close()}),$content.find("#messenger").click({},function(){x.close()}),$content.find("#sms").click({},function(){x.close()}),$content},buttons:[{label:"Cancel",action:function(dialogItself){dialogItself.close()}}]})}function tour(){var title="",messagehtml="",n=1,img_style="";img_style="width:100%;max-width:450px;height:auto;margin-left:auto;margin-right:auto;",title="Rank-X Intro Tour";var m1="";m1='<img id="image" class="displayed" src="/assets/images/rxtour1.jpg" style="'+img_style+'">',messagehtml=m1,BootstrapDialog.show({type:BootstrapDialog.TYPE_PRIMARY,title:title,message:messagehtml,closable:!0,draggable:!0,buttons:[{id:"btn1",label:"No, thanks",action:function(dialog,messagehtml){1==n?($cookies.put("tourviewed",!0),dialog.close()):(n-=1,1==n?($("#btn1").text("No, thanks"),$("#btn2").text("Yes, take tour")):17==n?($("#btn1").text("Back"),$("#btn2").text("Close"),$cookies.put("tourviewed",!0)):($("#btn1").text("Back"),$("#btn2").text("Next")),m1='<img id="image" class="displayed" src="/assets/images/rxtour'+n+'.jpg" style="'+img_style+'">',dialog.setMessage(m1))}},{id:"btn2",label:"Yes, take tour",action:function(dialog,messagehtml){17==n?($cookies.put("tourviewed",!0),dialog.close()):(17==n?dialog.getButton(this.id).label="Close":(n+=1,1==n?($("#btn1").text("No, thanks"),$("#btn2").text("Yes, take tour")):17==n?($("#btn1").text("Back"),$("#btn2").text("Close"),$cookies.put("tourviewed",!0)):($("#btn1").text("Back"),$("#btn2").text("Next"))),m1='<img id="image" class="displayed" src="/assets/images/rxtour'+n+'.jpg" style="'+img_style+'">',dialog.setMessage(m1))}}]})}function unbindAccount(x,callback){var title="",message="",btnCancelLabel="",btnOkLabel="";title="Confirm Unbind",btnCancelLabel="Cancel",btnOkLabel="Yes, Unbind",message="Just confirming, do you want to unbind <strong>"+x.name+"</strong> from your account?",BootstrapDialog.confirm({type:BootstrapDialog.TYPE_DANGER,title:title,message:message,closable:!0,draggable:!0,btnCancelLabel:btnCancelLabel,btnOKLabel:btnOkLabel,btnOKClass:"btn-primary",btnCancelAction:function(dialogRef){dialogRef.close()},callback:function(result){result&&callback()}})}function confirmCancel(x,type,callback){var title="",message="",btnCancelLabel="",btnOkLabel="";"Premium"==type&&(btnOkLabel="Cancel Premium Membership",message="Do you want to cancel your Premium Membership for <strong>"+x.name+"</strong>?"),"Ranks"==type&&(btnOkLabel="Cancel All Custom Ranks",message="Do you want to cancel all of your Custom Ranks for <strong>"+x.name+"</strong>?"),"All"==type&&(btnOkLabel="Cancel All Subscriptions",message="Do you want to cancel all of your Subscriptions for <strong>"+x.name+"</strong>?"),title="Please confirm",btnCancelLabel="Back",BootstrapDialog.confirm({type:BootstrapDialog.TYPE_DANGER,title:title,message:message,closable:!0,draggable:!0,btnCancelLabel:btnCancelLabel,btnOKLabel:btnOkLabel,btnOKClass:"default",btnCancelAction:function(dialogRef){dialogRef.close()},callback:function(result){result&&callback()}})}function editNumRanks(x,callback){var title="Buy or Cancel Custom Ranks",message="",n=1,N=x.ranksQty,action="purchase",msg="You have selected to <strong>purchase "+n+"</strong> Custom Ranks.<br><br>If purchasing Custom Ranks you will be ask for your payment info after clicking the Purchase button.",message="<p>You are currently subscribed to <strong>"+N+'</strong> Custom Ranks.</p><br><p class="text-left">Select what you want to do.</p><br><div class="radio"><label><input type="radio" value="0" checked name="radiogrp">PURCHASE CUSTOM RANKINGS</label></div><div class="radio"><label><input type="radio" value="1" name="radiogrp">CANCEL CUSTOM RANKINGS</label></div><br><div class="row"><div class="col-xs-7"><p class="text-right">Select quantity:</p></div><div class="col-xs-5"><div class="input-group"><span class="input-group-btn"><button class="btn btn-primary" id="btn_minus"><i class="fa fa-minus"></i></button></span><input style="text-align:center" id="numRanks" class="form-control" type="text" placeholder="'+n+'"><span class="input-group-btn"><button class="btn btn-primary" id="btn_plus"><i class="fa fa-plus"></i></button></span></div></div></div><br><p class="text-left" id="mytext">'+msg+"</p>";title="Please confirm",BootstrapDialog.show({type:BootstrapDialog.TYPE_PRIMARY,title:title,message:function(dialogRef){var $content=$(message),msg="",msgpayment="<br><br>If purchasing Custom Ranks you will be ask for your payment info after clicking the Purchase button.",msgcancel="<br><br>Your Custom Ranks will be active until last day of your subscription.";return $content.find("#btn_minus").click({},function(){n-=1,n<1&&(n=1),$content.find("#numRanks").val(n),"purchase"==action?(msg="You have selected to <strong>purchase "+n+"</strong> Custom Ranks. "+msgpayment,$("#btn2").text("Purchase "+n+" Custom Rankings")):(msg="You have selected to <strong>cancel "+n+"</strong> Custom Ranks. "+msgcancel,$("#btn2").text("Cancel "+n+" Custom Rankings")),$("#mytext").html(msg)}),$content.find("#btn_plus").click({},function(){n+=1,n>10&&(n=10),"cancel"==action&&n>=N&&(n=N),$content.find("#numRanks").val(n),"purchase"==action?(msg="You have selected to <strong>purchase "+n+"</strong> Custom Ranks. "+msgpayment,$("#btn2").text("Purchase "+n+" Custom Rankings")):(msg="You have selected to <strong>cancel "+n+"</strong> Custom Ranks. "+msgcancel,$("#btn2").text("Cancel "+n+" Custom Rankings")),$("#mytext").html(msg)}),$content.find("input[type=radio][name=radiogrp]").change(function(){n=1,0==this.value?(action="purchase",$("#btn2").text("Purchase "+n+" Custom Rankings"),msg="You have selected to <strong>purchase "+n+"</strong> Custom Ranks. "+msgpayment):1==this.value&&(action="cancel",$("#btn2").text("Cancel "+n+" Custom Rankings"),msg="You have selected to <strong>cancel "+n+"</strong> Custom Ranks. "+msgcancel),$content.find("#numRanks").val(n),$("#mytext").html(msg)}),$content},closable:!0,draggable:!0,buttons:[{id:"btn1",label:"Back",action:function(dialog){dialog.close()}},{id:"btn2",label:"Purchase "+n+" Custom Rankings",action:function(dialog,messagehtml){callback(action,n),dialog.close()}}]})}function editInfo(fields,labels,vals,callback){var title="",messagehtml="";title="Edit Information",messagehtml="<p>Please verify the information is correct.</p>";for(var i=0;i<fields.length;i++)messagehtml=messagehtml+'<div class="input-group"><label class="input-group-addon">'+labels[i]+':</label><input type="text" class="form-control" id="'+fields[i]+'" value="'+vals[i]+'"></div>';BootstrapDialog.show({type:BootstrapDialog.TYPE_PRIMARY,title:title,message:function(dialogRef){return $(messagehtml)},closable:!0,draggable:!0,btnCancelLabel:"Cancel",btnOKLabel:"Save",btnOKClass:"btn-success",btnCancelClass:"btn-warning",btnCancelAction:function(dialogRef){dialogRef.close()},buttons:[{id:"btn1",label:"Cancel",action:function(dialog){dialog.close()}},{id:"btn2",label:"Save",action:function(dialog,messagehtml){for(var newvals=[],val="",i=0;i<fields.length;i++)val=dialog.getModalBody().find("#"+fields[i])[0].value,newvals.push(val);callback(newvals),dialog.close()}}]})}function notificationWithCallback(title,message,callback){var title=title,message=message;BootstrapDialog.show({type:BootstrapDialog.TYPE_PRIMARY,title:title,message:message,buttons:[{id:"btn-ok",label:"OK",cssClass:"btn-primary",autospin:!1,action:function(dialogRef){callback(),dialogRef.close()}}]})}function notificationSuccess(title,message){var title=title,message=message;BootstrapDialog.show({type:BootstrapDialog.TYPE_SUCCESS,title:title,message:message,buttons:[{id:"btn-ok",label:"OK",cssClass:"btn-primary",autospin:!1,action:function(dialogRef){dialogRef.close()}}]})}function notificationDanger(title,message){var title=title,message=message;BootstrapDialog.show({type:BootstrapDialog.TYPE_DANGER,title:title,message:message,buttons:[{id:"btn-ok",label:"OK",cssClass:"btn-primary",autospin:!1,action:function(dialogRef){dialogRef.close()}}]})}function endorse(type){var typeStr="";"Establishment"==type&&(typeStr="establishment"),"Person"==type&&(typeStr="person"),"Place"==type&&(typeStr="place"),"Organization"==type&&(typeStr="organization"),"PersonCust"==type&&(typeStr="person"),"Event"==type&&(typeStr="event"),"Thing"==type&&(typeStr="item"),"Short-Phrase"==type&&(typeStr="answer");var message="Switch to Vote Mode to Vote! <br><br>Your endorsements make the rankings! <br><br>Give a <strong>thumb up</strong> if you <strong>endorse</strong> this "+typeStr+" in each ranking; a <strong>thumb down</strong> if you <strong>do not endorse</strong>.";BootstrapDialog.show({type:BootstrapDialog.TYPE_PRIMARY,title:"Endorse!",message:message,buttons:[{id:"btn-ok",label:"Got it",cssClass:"btn-primary",autospin:!1,action:function(dialogRef){dialogRef.close()}}]})}function enterPassword(ok_callback,nok_callback){var title="",message="";title="Password Required",message='<br> Please enter access password:<br><br><input class="form-control" type="text" placeholder="Enter password"><br><br>',BootstrapDialog.show({type:BootstrapDialog.TYPE_PRIMARY,title:title,message:message,closable:!1,draggable:!0,buttons:[{id:"btn1",label:"Cancel",action:function(dialog){nok_callback(),dialog.close()}},{id:"btn2",label:"Go",action:function(dialog){"S@nDieg0"==dialog.getModalBody().find("input").val()?ok_callback():(nok_callback(),getDialog("wrongPassword")),dialog.close()}}]})}function setInstagramImageUrl(id,urls){return answer.updateAnswer(id,["ig_image_urls"],[urls])}function chooseImgFromIgDlg(blobList,answer,isOwner,navigateTowards){var title="",messagehtml="",img_style=(blobList.length,"");img_style=($rootScope.sm,"width:100%;height:auto"),title="My Instagram Photos";var m1="",m2="",m3="",m4="";m1='<div class="row"><div class="col-xs-12">',InstagramService.isPreviousAvailable()&&(m1+='<button class="btn btn-default pull-left" id="previgpage">Previous</button>'),InstagramService.isNextAvailable()&&(m1+='<button class="btn btn-default pull-right" id="nextigpage">Next</button>'),m1+="</div>",m4='<div class="text-right"></div><br/>';var imageListHtml="";m2='<img id="image" class="displayed col-xs-3 thumbnail" src="',m3='" style="'+img_style+'">',imageListHtml='<div class="row">';for(var i=0;i<blobList.length;i++)if("image"==blobList[i].type){imageListHtml+='<div class="col-xs-6 col-md-4" style="position:relative">',imageListHtml+=m2+blobList[i].images.low_resolution.url+m3;var opacity=0;-1!=answer.ig_image_urls.indexOf(blobList[i].images.low_resolution.url)&&(opacity=.7),imageListHtml+='<div id="add_photo" style="background-color: grey;opacity:'+opacity+';position: absolute;left: 19px;right: 19px;top: 4px;bottom: 24px;border-radius: 5px;display: flex;align-items: center;">',imageListHtml+='<i class="fa fa-check-circle-o" aria-hidden="true" style="color: #2d6c38;font-size: 100px;margin: auto" ></i>',imageListHtml+="</div>",imageListHtml+="</div>"}imageListHtml+="</div>",messagehtml=m1+imageListHtml+m4,BootstrapDialog.show({size:BootstrapDialog.SIZE_WIDE,type:BootstrapDialog.TYPE_PRIMARY,cssClass:"instagram-image-dialog",title:title,message:function(dialogRef){var $content=$(messagehtml);return $content.find("#previgpage").click({},function(){dialogRef.close(),navigateTowards("previous")}),$content.find("#nextigpage").click({},function(){dialogRef.close(),navigateTowards("next")}),$content.find("#add_photo").click({},function(){console.log(answer.ig_image_urls);var url=$(this).parent().children("#image").attr("src");if(-1!=answer.ig_image_urls.indexOf(url)){var _this=this,itempos=answer.ig_image_urls.indexOf(url);-1!=itempos&&(answer.ig_image_urls=answer.ig_image_urls.substr(0,itempos-1)+answer.ig_image_urls.substr(itempos+url.length),setInstagramImageUrl(answer.id,answer.ig_image_urls).then(function(answer){$rootScope.$emit("refreshImages"),$(_this).css("opacity",0)}))}else{var _this=this;answer.ig_image_urls+=";"+url,setInstagramImageUrl(answer.id,answer.ig_image_urls).then(function(answer){$rootScope.$emit("refreshImages"),$(_this).css("opacity",.7)})}}),$content},buttons:[{label:"Close",action:function(dialogRef){dialogRef.close()}}],closable:!0,draggable:!0,btnCancelLabel:"No, I don't approve",btnOKLabel:"Yes, locate me",btnOKClass:"btn-success",btnCancelClass:"btn-warning",btnCancelAction:function(dialogRef){dialogRef.close()}})}function whatisrankquestion(){BootstrapDialog.show({type:BootstrapDialog.TYPE_PRIMARY,title:"Ranking Question",message:'The <strong>Ranking Question</strong> is what you ask users when comparing two items in the rank. It is the question to determine which item deserves the higher ranking.<br><br>For example, if ranking the "Hamburgers in Pacific Beach", the <strong>Ranking Question</strong> would be "Who makes the better burgers?".<br><br>The Ranking Question is shown in the Rank Console, when users rank their endorsements.<br><br><img style="width:100%;height:auto" src="/assets/images/whatisrankquestion.png">',buttons:[{id:"btn-ok",label:"Got it",cssClass:"btn-primary",autospin:!1,action:function(dialogRef){dialogRef.close()}}]})}function showAllFriendsListDlg(userObjs,answername){for(var imageListHtml="",i=0;i<userObjs.length;i++){imageListHtml+='<div class="row" style="padding-bottom:10px">',imageListHtml+='<div class="col-xs-3 col-md-3 text-center">',imageListHtml+='<img src="'+userObjs[i].picture.data.url+'" class="img-responsive img-circle profile-avatar" style="width: 100%;height: 100%;"/>',imageListHtml+="</div>",imageListHtml+='<div class="col-xs-9 col-md-9 text-center">',imageListHtml+='<div class="text-left"><strong>'+userObjs[i].first_name+" "+userObjs[i].last_name+"</strong> endorsed in: </div>";for(var j=0;j<userObjs[i].endorsements.length;j++)imageListHtml+="<i>"+userObjs[i].endorsements[j]+"</i></br>";imageListHtml+="</div>",imageListHtml+="</div>"}BootstrapDialog.show({size:BootstrapDialog.SIZE_SM,type:BootstrapDialog.TYPE_PRIMARY,cssClass:"fav-list-user-image-dialog",title:"Friends that like "+answername,message:function(dialogRef){var $content=$(imageListHtml);return $content},buttons:[{label:"Close",action:function(dialogRef){dialogRef.close()}}],closable:!0,draggable:!0,btnCancelLabel:"OK",btnOKLabel:"Close",btnOKClass:"btn-success",btnCancelClass:"btn-warning",btnCancelAction:function(dialogRef){dialogRef.close()}})}function showBusinessDetailDlg(x,STRIPE_COMMISSION_PERCENTAGE,CUSTOM_RANK_PRICE){var imageListHtml='<div class="row"> <div class="col-xs-12"> <tr ng-repeat-end> <td colspan=3> <table class="table" > <thead style="border-style:none;"> <tr>    <th style="width:45%" text-align="center">Subscription</th>    <th style="width:15%" text-align="center">Commission</th> </tr> </thead> <tbody> ';x.ispremium&&(imageListHtml+='<tr style="cursor:pointer;">   <td style="width:45%">Premium Membership</td>    <td style="width:15%">'+x.price*STRIPE_COMMISSION_PERCENTAGE+"</td></tr>"),x.hasranks&&(imageListHtml+='<tr style="cursor:pointer;"><td style="width:45%">'+x.ranksqty+' Custom Ranks</td><td style="width:15%">$'+x.ranksqty*CUSTOM_RANK_PRICE*STRIPE_COMMISSION_PERCENTAGE+"</td></tr>"),imageListHtml+='                <tr>                    <td style="width:45%">Total</td>                    <td style="width:15%; background-color: darkgray;">$'+x.totalCommission+"</td>                </tr>            </tbody>        </table>    </td></tr></div></div>",BootstrapDialog.show({size:BootstrapDialog.SIZE_SM,type:BootstrapDialog.TYPE_PRIMARY,cssClass:"admin-payment-business-detail-dialog",title:x.answerObj.name+" Details",message:function(dialogRef){var $content=$(imageListHtml);return $content},buttons:[{label:"Close",action:function(dialogRef){dialogRef.close()}}],closable:!0,draggable:!0,btnCancelLabel:"OK",btnOKLabel:"Close",btnOKClass:"btn-success",btnCancelClass:"btn-warning",btnCancelAction:function(dialogRef){dialogRef.close()}})}function changeCommissionDlg(STRIPE_COMMISSION_PERCENTAGE,execChangeFee){var imageListHtml='<div class="row"> <div class="col-xs-12"> <div class="form-group">    <label for="commission-percent">Please Type Commission Percentage.</label>     <div class="col-xs-11"><input type="commission-percent" class="form-control" id="commission-percent" value="'+100*STRIPE_COMMISSION_PERCENTAGE+'"> </div>    <div class="col-xs-1" style="padding: 10px;padding-left: 0px;"><span>%</span></div></div>';BootstrapDialog.show({size:BootstrapDialog.SIZE_SM,type:BootstrapDialog.TYPE_PRIMARY,cssClass:"change-commission-percentage-dialog",title:"Change Commmission",message:function(dialogRef){var $content=$(imageListHtml);return $content},buttons:[{label:"Close",action:function(dialogRef){dialogRef.close()}},{label:"OK",action:function(dialogRef,result){var percent=dialogRef.getModalBody().find("input").val();result&&execChangeFee(percent),dialogRef.close()}}],closable:!0,draggable:!0,btnCancelLabel:"OK",btnOKLabel:"Close",btnOKClass:"btn-success",btnCancelClass:"btn-warning",btnCancelAction:function(dialogRef){dialogRef.close()}})}function changeCodePriceDlg(codeprice,execChangeCodePrice){
var imageListHtml='<div class="row"> <div class="col-xs-12"> <div class="form-group">    <label for="commission-percent">Please Enter '+codeprice.code+' plan price.</label>     <div class="col-xs-11"><input type="commission-percent" class="form-control" id="commission-percent" value="'+codeprice.price+'"> </div>    <div class="col-xs-1" style="padding: 10px;padding-left: 0px;"><span>$</span></div></div>';BootstrapDialog.show({size:BootstrapDialog.SIZE_SM,type:BootstrapDialog.TYPE_PRIMARY,cssClass:"change-commission-percentage-dialog",title:"Change "+codeprice.code+" Price",message:function(dialogRef){var $content=$(imageListHtml);return $content},buttons:[{label:"Close",action:function(dialogRef){dialogRef.close()}},{label:"Change",action:function(dialogRef,result){var price=dialogRef.getModalBody().find("input").val();result&&execChangeCodePrice(codeprice,price),dialogRef.close()}}],closable:!0,draggable:!0,btnCancelLabel:"OK",btnOKLabel:"Close",btnOKClass:"btn-success",btnCancelClass:"btn-warning",btnCancelAction:function(dialogRef){dialogRef.close()}})}function openSubscriptionDlg(execSubscription){var imageListHtml='<div class="row"> <div class="col-xs-12"> <div class="form-group">    <p>Hey there, enjoying <strong>Rank-X</strong>? <br><br> Let\'s stay in touch!<br><br> Enter your email address below to subscribe to our newsletter to get <strong>updates</strong> about new and popular rankings and <strong>stay informed</strong> of local deals and events!</p><br>    <div class="col-xs-11"><input type="text" id="subscribe-email" class="form-control"      value="'+($rootScope.user?$rootScope.user.email:"")+'" placeholder="Enter your email here"> </div></div>';BootstrapDialog.show({size:BootstrapDialog.SIZE_SM,type:BootstrapDialog.TYPE_PRIMARY,cssClass:"subscription-dialog",title:"Sign up for our newsletter!",message:function(dialogRef){var $content=$(imageListHtml);return $content},buttons:[{label:"Not Now",action:function(dialogRef){dialogRef.close()}},{label:"Subscribe",cssClass:"btn-success",action:function(dialogRef,result){var email=dialogRef.getModalBody().find("input").val();result&&execSubscription(email),dialogRef.close()}}],closable:!0,draggable:!0})}function confirmSameAnswer(answer1,callback){var answerhtml=generateAnswerHtml(answer1),title="",message="",btnCancelLabel="",btnOkLabel="";title="Just checking",btnCancelLabel="No, different one",btnOkLabel="Yes, that's it",message="Do you mean this <strong>"+answer1.name+"</strong>? </br></br>"+answerhtml+'</br><div class="row"><div class="col-xs-2 col-sm-3 col-md-3"></div><div class="col-xs-8 col-sm-6 col-md-6"><img src='+answer1.imageurl+' class="thumbnail" style="width:100%; max-height:200px;" id="ansimage"></div><div class="col-xs-2 col-sm-3 col-md-3"></div></div>',BootstrapDialog.confirm({type:BootstrapDialog.TYPE_PRIMARY,title:title,message:message,closable:!0,draggable:!0,btnCancelLabel:btnCancelLabel,btnOKLabel:btnOkLabel,btnOKClass:"btn-primary",btnCancelAction:function(dialogRef){dialogRef.close()},callback:function(result){result&&callback()}})}function generateAnswerHtml(answer1){for(var answerhtml="",newline="",i=0;i<$rootScope.fields.length;i++){switch($rootScope.fields[i].name){case"name":newline='<strong class="capitalize">Name</strong>: '+answer1.name+"</br>";break;case"location":newline=answer1.location?'<strong class="capitalize">Location</strong>: '+answer1.location+"</br>":"<strong>Location</strong>: </br>";break;case"cityarea":newline='<strong class="capitalize">Neighborhood</strong>: '+answer1.cityarea+"</br>";break;case"addinfo":newline=answer1.addinfo?'<strong class="capitalize">Additional Info</strong>: '+answer1.addinfo+"</br>":"<strong>Additional Info</strong>: </br>";break;case"phone":newline=answer1.phone?'<strong class="capitalize">Phone</strong>: '+answer1.phone+"</br>":"<strong>Phone</strong>: </br>";break;case"website":newline=answer1.website?'<strong class="capitalize">Website</strong>: '+answer1.website+"</br>":"<strong>Website</strong>: </br>";break;case"email":newline=answer1.email?'<strong class="capitalize">Email</strong>: '+answer1.email+"</br>":"<strong>Email</strong>: </br>"}answerhtml+=newline}return answerhtml}function confirmSameAnswerMultiple(answers,callback){var title="",messagehtml="",btnCancelLabel="",btnOkLabel="",answerhtml=generateAnswerHtml(answers[0]),n=0;title="Just checking",btnCancelLabel="None of the options",btnOkLabel="Yes, that's it",messagehtml="<p>We have "+answers.length+" records for <strong>"+answers[0].name+"</strong>. Please browse these records to see if the one wish to add to the ranking <strong><i>"+$rootScope.cCategory.title+'</i></strong> already exists.</p></br><div class="text-center"><div class="row"><button class="btn btn-default" id="nextbutton">Next</button><p id="number">&nbsp&nbsp'+(n+1)+'</p></div></div><br><p id="answerinfo">'+answerhtml+'</p></br><div class="row"><div class="col-xs-2 col-sm-3 col-md-3"></div><div class="col-xs-8 col-sm-6 col-md-6"><img src='+answers[0].imageurl+' class="thumbnail" style="width:100%; max-height:200px;" id="ansimage"></div><div class="col-xs-2 col-sm-3 col-md-3"></div></div>',BootstrapDialog.confirm({type:BootstrapDialog.TYPE_PRIMARY,title:title,message:function(dialogRef){var $content=$(messagehtml);return $content.find("#nextbutton").click({},function(){n+=1,n>answers.length-1&&(n=0),answerhtml=generateAnswerHtml(answers[n]),$("#number").html(n+1),$("#answerinfo").html(answerhtml),$content.find("#ansimage").attr("src",answers[n].imageurl)}),$content},closable:!0,draggable:!0,btnCancelLabel:btnCancelLabel,btnOKLabel:btnOkLabel,btnOKClass:"btn-primary",btnCancelAction:function(dialogRef){dialogRef.close()},callback:function(result){result&&callback(n)}})}function showTOSPromotersDlg(){BootstrapDialog.confirm({type:BootstrapDialog.TYPE_PRIMARY,title:"Terms of Service",message:$("<div></div>").load("/assets/partials/tospromoter.tem"),closable:!0,draggable:!0,btnOKLabel:"Back",btnOKClass:"btn-primary",size:BootstrapDialog.SIZE_WIDE})}function sortbyHelpDialog(type){BootstrapDialog.show({type:BootstrapDialog.TYPE_PRIMARY,title:"Sorting Options",message:"<p style='text-align:left'><strong>Rank</strong>. Sorts list by rank points, which are a mix of endorsements and rank matches.</p><p style='text-align:left'><strong>Popular</strong>. Sorts list by votes (endorsements) in this ranking.</p><p style='text-align:left'><strong>Distance</strong>. Sorts list by distance closest to you. </p><p style='text-align:left'><strong>Trending</strong>. Sorts list by votes (endorsements) in the last month.</p>",buttons:[{id:"btn-ok",label:"Got it",cssClass:"btn-primary",autospin:!1,action:function(dialogRef){dialogRef.close()}}]})}function maybeRepeatVrows(newop,vrows,callback){var title="",message="",btnCancelLabel="",btnOkLabel="";title="Just checking",btnCancelLabel="Cancel",btnOkLabel="My opinion is different, add it",message='Your opinion:<br><p class="text-center"><i>'+newop+'</i></p>might be similar to these already existing opinions: <br><br><p class="text-center">';for(var i=0;i<vrows.length;i++)message=message+"<i>"+vrows[i].title+"</i><br>";message+="</p>Double check you are not adding an opinion that is essentially same as one already there.<br>",BootstrapDialog.confirm({type:BootstrapDialog.TYPE_PRIMARY,title:title,message:message,closable:!0,draggable:!0,btnCancelLabel:btnCancelLabel,btnOKLabel:btnOkLabel,btnOKClass:"btn-primary",btnCancelAction:function(dialogRef){dialogRef.close()},callback:function(result){result&&callback()}})}function showSpecial(x){var message="",imageStyle="";datetime.formatdatetime(x);var htmlmsg=htmlops.specialHtml(x),spStyle="background-color:"+x.bc+";color:"+x.fc+";white-space:pre;";x.style=spStyle,void 0!=x.image&&x.image!=$rootScope.EMPTY_IMAGE?x.hasimage=!0:x.hasimage=!1,$rootScope.DISPLAY_XSMALL&&(imageStyle="width:100%;height:auto;"),$rootScope.DISPLAY_SMALL&&(imageStyle="width:100%;height:auto;max-height:300px;"),$rootScope.DISPLAY_MEDIUM&&(imageStyle="width:100%;height:auto;max-height:350px;"),$rootScope.DISPLAY_LARGE&&(imageStyle="width:100%;height:auto;max-height:400px;"),message='<div ng-attr-style="'+x.style+'">'+htmlmsg+"</div>"+(x.hasimage?'<div class="text-middle"><img class="displayed" src='+x.image+' style="'+imageStyle+'margin-left:auto;margin-right:auto;"></div><br>':"<br>"),BootstrapDialog.show({type:BootstrapDialog.TYPE_PRIMARY,title:"Special Details",message:message,buttons:[{id:"btn-ok",label:"OK",cssClass:"btn-primary",autospin:!1,action:function(dialogRef,result){dialogRef.close()}}]})}function typemismatch(y,x){var message="";message="Can not add an answer of type <em>"+("Establishment"==x||"Place"==x||"Organization"==x?"Establishment or Place":"")+("PersonCust"==x?"Freelancer":"")+("Short-Phrase"==x?"Opinion":"")+("Event"==x?"Event":"")+("Thing"==x?"Item":"")+("Simple"==x?"Private Item":"")+"</em> to a ranking of type <em>"+("Establishment"==y||"Place"==y||"Organization"==y?"Establishment or Place":"")+("PersonCust"==y?"Freelancer":"")+("Short-Phrase"==y?"Opinion":"")+("Event"==y?"Event":"")+("Thing"==y?"Item":"")+("Simple"==y?"Private Item":"")+"</em>.",BootstrapDialog.show({type:BootstrapDialog.TYPE_PRIMARY,title:"Type MisMatch",message:message,buttons:[{id:"btn-ok",label:"OK",cssClass:"btn-primary",autospin:!1,action:function(dialogRef,result){dialogRef.close()}}]})}function confirmAddRank(category,answer,callback){var title="",message="",btnCancelLabel="",btnOkLabel="";title="Please Confirm",message="This will add "+answer.name+" to <em>"+category.title+"</em>.",btnCancelLabel="Cancel",btnOkLabel="Ok",BootstrapDialog.confirm({type:BootstrapDialog.TYPE_PRIMARY,title:title,message:message,closable:!0,draggable:!0,btnCancelLabel:btnCancelLabel,btnOKLabel:btnOkLabel,btnOKClass:"default",btnCancelAction:function(dialogRef){dialogRef.close()},callback:function(result){result&&callback(category,answer)}})}function confirmRemoveRank(category,answer,callback){var title="",message="",btnCancelLabel="",btnOkLabel="";title="Please Confirm",message="This will remove "+answer.name+" from <em>"+category.title+"</em>.",btnCancelLabel="Cancel",btnOkLabel="Yes, delete",BootstrapDialog.confirm({type:BootstrapDialog.TYPE_PRIMARY,title:title,message:message,closable:!0,draggable:!0,btnCancelLabel:btnCancelLabel,btnOKLabel:btnOkLabel,btnOKClass:"default",btnCancelAction:function(dialogRef){dialogRef.close()},callback:function(result){result&&callback(category,answer)}})}function confirmSiblings(answer,callback){for(var title="",message="",btnCancelLabel="",btnOkLabel="",siblingshtml='<div class="text-center">',idx=0,i=0;i<answer.ansLocs.length;i++)idx=$rootScope.answers.map(function(x){return x.id}).indexOf(answer.ansLocs[i]),siblingshtml=siblingshtml+$rootScope.answers[idx].name+"</br>";siblingshtml+="</div>",title="Please Confirm",message="This will add the following sibling Establishments: <br>"+siblingshtml+"<br> to <strong>"+answer.name+"</strong>.",btnCancelLabel="Cancel",btnOkLabel="Ok",BootstrapDialog.confirm({type:BootstrapDialog.TYPE_PRIMARY,title:title,message:message,closable:!0,draggable:!0,btnCancelLabel:btnCancelLabel,btnOKLabel:btnOkLabel,btnOKClass:"default",btnCancelAction:function(dialogRef){dialogRef.close()},callback:function(result){result&&callback()}})}function showLocations(locs){var message="",list="";list='<ul class="list-group">';for(var i=0;i<locs.length;i++)list=list+'<li id="item'+i+'"class="list-group-item" style="cursor:pointer;"><strong>'+locs[i].name+"</strong>,&nbsp"+locs[i].location+",&nbsp"+locs[i].cityarea+"</li>";list+="</ul>",message=list,BootstrapDialog.show({type:BootstrapDialog.TYPE_PRIMARY,title:"Additional Locations",message:function(dialogRef){var $content=$(message);return $content.find("#item0").click({},function(){$window.scrollTo(0,0),$state.go("answerDetail",{index:locs[0].id}),dialogRef.close()}),$content.find("#item1").click({},function(){$window.scrollTo(0,0),$state.go("answerDetail",{index:locs[1].id}),dialogRef.close()}),$content.find("#item2").click({},function(){$window.scrollTo(0,0),$state.go("answerDetail",{index:locs[2].id}),dialogRef.close()}),$content.find("#item3").click({},function(){$window.scrollTo(0,0),$state.go("answerDetail",{index:locs[3].id}),dialogRef.close()}),$content.find("#item4").click({},function(){$window.scrollTo(0,0),$state.go("answerDetail",{index:locs[4].id}),dialogRef.close()}),$content},buttons:[{id:"btn-ok",label:"OK",cssClass:"btn-primary",autospin:!1,action:function(dialogRef,result){dialogRef.close()}}]})}function showLearnMore(url){var message='<div class="text-center"><iframe width="'+($rootScope.sm?"300":"500")+'" height="'+($rootScope.sm?"200":"350")+'" src="'+url+'?autoplay=1" frameborder="0" allowfullscreen></iframe></div>';BootstrapDialog.show({size:BootstrapDialog.SIZE_WIDE,type:BootstrapDialog.TYPE_PRIMARY,title:"Learn More",message:function(dialogRef){return $(message)},buttons:[{id:"btn-ok",label:"I got it.",cssClass:"btn-primary",autospin:!1,action:function(dialogRef,result){dialogRef.close()}}]})}function imageBank(){BootstrapDialog.show({type:BootstrapDialog.TYPE_PRIMARY,title:"Image Banks",message:'<strong>Pixabay</strong> and <strong>Pexels</strong> are databases of royalty free images. We encourage you to visit their websites to learn more about the services they offer. <br><br><div class="row"><div class="col-xs-12 col-sm-6"><img src="../../../assets/images/pixabay-logo.png" alt="Pixabay"style="width:100%;height:45px;padding:3px;border-style:solid;border-width:1px;"><div class="text-center"><a href="https://www.pixabay.com/">Visit Pixabay</a></div></div><div class="col-xs-12 col-sm-6"><img src="../../../assets/images/pexels-logo.png" alt="Pexels"style="width:100%;height:45px;padding:3px;border-style:solid;border-width:1px;"><div class="text-center"><a href="https://www.pexels.com/">Visit Pexels</a></div></div></div>',buttons:[{id:"btn-ok",label:"OK",cssClass:"btn-primary",autospin:!1,action:function(dialogRef){dialogRef.close()}}]})}function welcomeNewUser(first_name){var message="<h1>Welcome <strong>"+first_name+"!</strong></h1>";BootstrapDialog.show({type:BootstrapDialog.TYPE_PRIMARY,title:"Welcome",message:message,buttons:[{id:"btn-ok",label:"OK",cssClass:"btn-primary",autospin:!1,action:function(dialogRef){dialogRef.close()}}]})}return{editConfirm:editConfirm,getDialog:getDialog,showDialog:showDialog,howItWorks:howItWorks,addAnswer:addAnswer,showAddAnswer:showAddAnswer,editChangeEffective:editChangeEffective,checkSameAnswer:checkSameAnswer,showSameAnswer:showSameAnswer,confirmSameAnswer:confirmSameAnswer,deleteType:deleteType,deleteThisCatans:deleteThisCatans,deleteRank:deleteRank,getLocation:getLocation,url:url,createSpecialPreview:createSpecialPreview,bizRegistration:bizRegistration,bindAccount:bindAccount,addVRow:addVRow,deleteVRow:deleteVRow,addVRowGroup:addVRowGroup,editVRowGroup:editVRowGroup,deleteVRowGroup:deleteVRowGroup,showAddEvent:showAddEvent,createEventPreview:createEventPreview,askPermissionToLocate:askPermissionToLocate,askEmail:askEmail,seePhotos:seePhotos,loginFacebook:loginFacebook,shareOptions:shareOptions,tour:tour,unbindAccount:unbindAccount,confirmCancel:confirmCancel,editNumRanks:editNumRanks,editInfo:editInfo,notificationWithCallback:notificationWithCallback,notificationSuccess:notificationSuccess,notificationDanger:notificationDanger,enterPassword:enterPassword,endorse:endorse,chooseImgFromIgDlg:chooseImgFromIgDlg,showAllFriendsListDlg:showAllFriendsListDlg,showBusinessDetailDlg:showBusinessDetailDlg,whatisrankquestion:whatisrankquestion,changeCommissionDlg:changeCommissionDlg,changeCodePriceDlg:changeCodePriceDlg,openSubscriptionDlg:openSubscriptionDlg,generateAnswerHtml:generateAnswerHtml,confirmSameAnswerMultiple:confirmSameAnswerMultiple,showTOSPromotersDlg:showTOSPromotersDlg,showTOSCustomersDlg:showTOSPromotersDlg,sortbyHelpDialog:sortbyHelpDialog,maybeRepeatVrows:maybeRepeatVrows,showSpecial:showSpecial,typemismatch:typemismatch,confirmAddRank:confirmAddRank,confirmRemoveRank:confirmRemoveRank,confirmSiblings:confirmSiblings,showLocations:showLocations,showLearnMore:showLearnMore,imageBank:imageBank,welcomeNewUser:welcomeNewUser}}angular.module("app").factory("dialog",dialog),dialog.$inject=["$q","$rootScope","useraccnt","imagelist","answer","login","$window","$cookies","$state","$compile","htmlops","datetime","InstagramService","users"]}(),function(){"use strict";function commentops($rootScope,table,answer,comment,comment2){function loadComments(type,x){if(!x.commLoaded){if(x.commLoaded=!0,$rootScope.isLoggedIn&&(x.initials=$rootScope.user.name.replace(/[^A-Z]/g,""),getIconColors($rootScope.user.id,_colors),x.bc=_colors.bc,x.fc=_colors.fc),"answer"==type)return comment2.getcomments().then(function(_comments){function pad(n){return n<10?"0"+n:n}x.comments=_comments;for(var i=0;i<x.comments.length;i++){x.comments[i].initials=x.comments[i].username.replace(/[^A-Z]/g,"");var datenow=new Date,tz=datenow.getTimezoneOffset(),t=x.comments[i].timestmp.split(/[- :]/),cdate=new Date(t[0],t[1]-1,t[2],t[3],t[4],t[5]);cdate.setMinutes(cdate.getMinutes()-tz);var dateStr=cdate.getMonth()+1+"/"+cdate.getDate()+"/"+cdate.getFullYear(),hrs=cdate.getHours(),timeStr=hrs>12?hrs%12+":"+pad(cdate.getMinutes())+" PM":hrs+":"+pad(cdate.getMinutes())+" AM";x.comments[i].date=dateStr+" "+timeStr,getIconColors(x.comments[i].user,_colors),x.comments[i].bc=_colors.bc,x.comments[i].fc=_colors.fc}});if("category"==type)return comment.getcomments().then(function(_comments){function pad(n){return n<10?"0"+n:n}x.comments=_comments;for(var i=0;i<x.comments.length;i++){x.comments[i].initials=x.comments[i].username.replace(/[^A-Z]/g,"");var datenow=new Date,tz=datenow.getTimezoneOffset(),t=x.comments[i].timestmp.split(/[- :]/),cdate=new Date(t[0],t[1]-1,t[2],t[3],t[4],t[5]);cdate.setMinutes(cdate.getMinutes()-tz);var dateStr=cdate.getMonth()+1+"/"+cdate.getDate()+"/"+cdate.getFullYear(),hrs=cdate.getHours(),timeStr=hrs>12?hrs%12+":"+pad(cdate.getMinutes())+" PM":hrs+":"+pad(cdate.getMinutes())+" AM";x.comments[i].date=dateStr+" "+timeStr,getIconColors(x.comments[i].user,_colors),x.comments[i].bc=_colors.bc,x.comments[i].fc=_colors.fc}})}}function postComment(type,x){var cobj={};cobj.body=x.newComment,cobj.username=$rootScope.user.name,cobj.user=$rootScope.user.id,cobj.picture=$rootScope.user.picture.data.url,cobj.timestmp=Date.now(),x.newComment="","category"==type&&(cobj.category=$rootScope.cCategory.id,comment.addcomment(cobj).then(function(){cobj.initials=$rootScope.user.name.replace(/[^A-Z]/g,""),getIconColors($rootScope.user.id,_colors),cobj.fc=_colors.fc,cobj.bc=_colors.bc,cobj.date="Just now",x.comments.push(cobj),table.update($rootScope.cCategory.id,["numcom"],[x.comments.length])})),"answer"==type&&(cobj.answer=$rootScope.canswer.id,comment2.addcomment(cobj).then(function(){cobj.initials=$rootScope.user.name.replace(/[^A-Z]/g,""),getIconColors($rootScope.user.id,_colors),cobj.fc=_colors.fc,cobj.bc=_colors.bc,cobj.date="Just now",x.comments.push(cobj),answer.updateAnswer($rootScope.canswer.id,["numcom"],[x.comments.length])}))}function getIconColors(x,c){switch(x%10){case 0:c.bc="#b3b3b3",c.fc="black";break;case 1:c.bc="#666666",c.fc="white";break;case 2:c.bc="#006bb3",c.fc="white";break;case 3:c.bc="#009933",c.fc="white";break;case 4:c.bc="#cc0000",c.fc="white";break;case 5:c.bc="#538cc6",c.fc="black";break;case 6:c.bc="#b36b00",c.fc="white";break;case 7:c.bc="#999966",c.fc="black";break;case 8:c.bc="#4d0099",c.fc="white";break;case 9:c.bc="#009999",c.fc="black"}}var service={loadComments:loadComments,postComment:postComment,getIconColors:getIconColors},_colors={};return _colors.bc="",_colors.fc="",service}angular.module("app").service("commentops",commentops),commentops.$inject=["$rootScope","table","answer","comment","comment2"]}(),function(){"use strict";function comment2($http,$q,$rootScope,uaf){function getcomments(forceRefresh){function querySucceeded(result){return _comments=result.data.resource}var url=baseURI+"/?filter=answer="+$rootScope.canswer.id;return $http.get(url).then(querySucceeded,_queryFailed)}function getcommentsbyanswer(answer){function querySucceeded(result){return _comments=result.data.resource}var url=baseURI+"/?filter=answer="+answer;return $http.get(url).then(querySucceeded,_queryFailed)}function addcomment(newcomment){function querySucceeded(result){return newcomment.id=result.data.resource[0].id,uaf.post("commentA",["answer","comment"],[newcomment.answer,newcomment.body]),$rootScope.DEBUG_MODE&&console.log("Adding new comment succesful",result),result.data}var url=baseURI,resource=[];return resource.push(newcomment),$http.post(url,resource,{headers:{"Content-Type":"multipart/form-data"},body:resource}).then(querySucceeded,_queryFailed)}function updatecomment(comment_id,upV,downV){function querySucceeded(result){return $rootScope.DEBUG_MODE&&console.log("updating comment vote counts succesful"),result.data}var obj={};obj.resource=[];var data={};data.id=comment_id,data.upV=upV,data.downV=downV,obj.resource.push(data);var url=baseURI;return $http.patch(url,obj,{headers:{"Content-Type":"multipart/form-data"},body:obj}).then(querySucceeded,_queryFailed)}function deletecomment(comment_id){function querySucceeded(result){return $rootScope.DEBUG_MODE&&console.log("Deleting comment was succesful"),result.data}var obj={};obj.resource=[];var data={};data.id=comment_id,obj.resource.push(data);var url=baseURI+"/"+comment_id,i=_comments.map(function(x){return x.id}).indexOf(comment_id);return i>-1&&_comments.splice(i,1),$http.delete(url,data,{headers:{"Content-Type":"multipart/form-data"},body:obj}).then(querySucceeded,_queryFailed)}function deletecommentsbyuser(user_id){function querySucceeded(result){return $rootScope.DEBUG_MODE&&console.log("Deleting comments for answer was succesful"),result.data}for(var i=0;i<_comments.length;i++)_comments[i].user==user_id&&_comments.splice(i,1);var url=baseURI+"?filter=user="+user_id;return $http.delete(url).then(querySucceeded,_queryFailed)}function _queryFailed(error){throw error}var _comments=[],baseURI="/api/v2/mysql/_table/comments2";return{getcomments:getcomments,getcommentsbyanswer:getcommentsbyanswer,addcomment:addcomment,updatecomment:updatecomment,deletecomment:deletecomment,deletecommentsbyuser:deletecommentsbyuser}}angular.module("app").factory("comment2",comment2),comment2.$inject=["$http","$q","$rootScope","uaf"]}(),function(){"use strict";function comment($http,$q,$rootScope,uaf){function getcomments(forceRefresh){function querySucceeded(result){return _comments=result.data.resource}var url=baseURI+"/?filter=category="+$rootScope.cCategory.id;return $http.get(url).then(querySucceeded,_queryFailed)}function getcommentsbyrank(category){function querySucceeded(result){return _comments=result.data.resource}var url=baseURI+"/?filter=category="+category;return $http.get(url).then(querySucceeded,_queryFailed)}function addcomment(newcomment){function querySucceeded(result){return newcomment.id=result.data.resource[0].id,uaf.post("commentR",["category"],[newcomment.category]),$rootScope.DEBUG_MODE&&console.log("Adding new comment succesful",result),result.data}var url=baseURI,resource=[];return resource.push(newcomment),$http.post(url,resource,{headers:{"Content-Type":"multipart/form-data"},body:resource}).then(querySucceeded,_queryFailed)}function updatecomment(comment_id,upV,downV){function querySucceeded(result){return $rootScope.DEBUG_MODE&&console.log("updating comment vote counts succesful"),result.data}var obj={};obj.resource=[];var data={};data.id=comment_id,data.upV=upV,data.downV=downV,obj.resource.push(data);var url=baseURI;return $http.patch(url,obj,{headers:{"Content-Type":"multipart/form-data"},body:obj}).then(querySucceeded,_queryFailed)}function deletecomment(comment_id){function querySucceeded(result){return $rootScope.DEBUG_MODE&&console.log("Deleting comment was succesful"),result.data}var obj={};obj.resource=[];var data={};data.id=comment_id,obj.resource.push(data);var url=baseURI+"/"+comment_id,i=_comments.map(function(x){return x.id}).indexOf(comment_id);return i>-1&&_comments.splice(i,1),$http.delete(url,data,{headers:{"Content-Type":"multipart/form-data"},body:obj}).then(querySucceeded,_queryFailed)}function deletecommentsbyuser(user_id){function querySucceeded(result){return $rootScope.DEBUG_MODE&&console.log("Deleting comments for answer was succesful"),result.data}for(var i=0;i<_comments.length;i++)_comments[i].user==user_id&&_comments.splice(i,1);var url=baseURI+"?filter=user="+user_id;return $http.delete(url).then(querySucceeded,_queryFailed)}function _queryFailed(error){throw error}var _comments=[],baseURI="/api/v2/mysql/_table/comments";return{getcomments:getcomments,getcommentsbyrank:getcommentsbyrank,addcomment:addcomment,updatecomment:updatecomment,deletecomment:deletecomment,deletecommentsbyuser:deletecommentsbyuser}}angular.module("app").factory("comment",comment),comment.$inject=["$http","$q","$rootScope","uaf"]}(),function(){"use strict";function catans($http,$q,$rootScope,votes,uaf){function getCatan(id){function querySucceeded(result){return result.data}var url=baseURI+"/"+id;return $http.get(url).then(querySucceeded,_queryFailed)}function getAllcatans(forceRefresh){var url0=baseURI+"?offset=0",url1=baseURI+"?offset=1000",url2=baseURI+"?offset=2000",url3=baseURI+"?offset=3000",url4=baseURI+"?offset=4000",url5=baseURI+"?offset=5000",url6=baseURI+"?offset=6000",url7=baseURI+"?offset=7000",url8=baseURI+"?offset=8000",url9=baseURI+"?offset=9000",p0=$http.get(url0),p1=$http.get(url1),p2=$http.get(url2),p3=$http.get(url3),p4=$http.get(url4),p5=$http.get(url5),p6=$http.get(url6),p7=$http.get(url7),p8=$http.get(url8),p9=$http.get(url9);return $q.all([p0,p1,p2,p3,p4,p5,p6,p7,p8,p9]).then(function(d){return _load(d[0].data.resource.concat(d[1].data.resource,d[2].data.resource,d[3].data.resource,d[4].data.resource,d[5].data.resource,d[6].data.resource,d[7].data.resource,d[8].data.resource,d[9].data.resource)),$rootScope.DEBUG_MODE&&console.log("No. Cat-Ans: ",_allcatans.length),_allcatans},_queryFailed)}function getAllcatansX(data){var _datax=[];if(data.length>0&&data.forEach(function(item){_fetchRanksMem.indexOf(item.id)<0&&(_datax.push(item),_fetchRanksMem.push(item.id))}),0==_datax.length)return $q.when(!1);for(var filterstr="?filter=(",i=0;i<_datax.length;i++)if(_datax[i].catstr)for(var catArr=_datax[i].catstr.split(":").map(Number),j=0;j<catArr.length;j++)filterstr=filterstr+"category="+catArr[j]+")OR(";else filterstr=filterstr+"category="+_datax[i].id+")OR(";filterstr=filterstr.substring(0,filterstr.length-3);var url0=baseURI+filterstr+"&fields="+fields,p0=$http.get(url0);return $q.all([p0]).then(function(d){var _allcatansx=d[0].data.resource,map=_allcatans.map(function(x){return x.id});return _allcatansx.forEach(function(catansobj){map.indexOf(catansobj.id)<0&&_allcatans.push(catansobj)}),$rootScope.DEBUG_MODE&&console.log("getAllCatansX loaded: ",_allcatansx.length),_allcatansx},_queryFailed)}function getAllcatansY(data){var _datax=[];if(data.length>0&&data.forEach(function(item){_fetchAnswersMem.indexOf(item.id)<0&&(_datax.push(item),_fetchAnswersMem.push(item.id))}),0==_datax.length)return $q.when(!1);for(var filterstr="?filter=(",i=0;i<_datax.length;i++)filterstr=filterstr+"answer="+_datax[i].id+")OR(";filterstr=filterstr.substring(0,filterstr.length-3);var url0=baseURI+filterstr+"&fields="+fields,p0=$http.get(url0);return $q.all([p0]).then(function(d){var _allcatansy=d[0].data.resource,map=_allcatans.map(function(x){return x.id});return _allcatansy.forEach(function(catansobj){map.indexOf(catansobj.id)<0&&_allcatans.push(catansobj)}),$rootScope.DEBUG_MODE&&console.log("getAllCatansY loaded: ",_allcatansy.length),_allcatansy},_queryFailed)}function deleteCatan(catan_id){function querySucceeded(result){for(var i=0;i<result.data.resource.length;i++)votes.deleteVotesbyCatans(result.data.resource[i].id);return $rootScope.DEBUG_MODE&&console.log("Deleting catans records was succesful"),result.data}for(var i=0;i<_allcatans.length;i++)if(_allcatans[i].id==catan_id){_allcatans.splice(i,1);break}var url=baseURI+"?filter=id="+catan_id;return $http.delete(url).then(querySucceeded,_queryFailed)}function postRec(x){function querySucceeded(result){return _allcatans.forEach(function(item){item.category==data.category&&item.answer==data.answer&&(item.id=result.data.resource[0].id)}),uaf.post("addedAnswer",["answer","category"],[data.answer,data.category]),$rootScope.DEBUG_MODE&&console.log("creating catans record was succesful"),result.data}var data={};data.answer=x,data.category=$rootScope.cCategory.id,data.upV=0,data.downV=0,data.user=$rootScope.user.id,data.timestmp=Date.now();var obj={};obj.resource=[],_allcatans.push(data),obj.resource.push(data);var url=baseURI;return $http.post(url,obj,{headers:{"Content-Type":"multipart/form-data"},body:obj}).then(querySucceeded,_queryFailed)}function postRec2(answer,category){function querySucceeded(result){return _allcatans.forEach(function(item){item.category==data.category&&item.answer==data.answer&&(item.id=result.data.resource[0].id)}),uaf.post("addedAnswer",["answer","category"],[answer,category]),console.log("@postRec2 creating catans record was succesful"),result.data}var data={};data.answer=answer,data.category=category,data.upV=0,data.downV=0,data.user=$rootScope.user.id,data.timestmp=Date.now();var obj={};obj.resource=[],_allcatans.push(data),obj.resource.push(data);var url=baseURI;return $http.post(url,obj,{headers:{"Content-Type":"multipart/form-data"},body:obj}).then(querySucceeded,_queryFailed)}function deleteAnswer(answer_id){function querySucceeded(result){for(var i=0;i<result.data.resource.length;i++)votes.deleteVotesbyCatans(result.data.resource[i].id);return $rootScope.DEBUG_MODE&&console.log("Deleting catans records was succesful"),result.data}for(var i=0;i<_allcatans.length;i++)_allcatans[i].answer==answer_id&&_allcatans.splice(i,1);var url=baseURI+"?filter=answer="+answer_id;return $http.delete(url).then(querySucceeded,_queryFailed)}function deleteRec(answer_id,category_id){function querySucceeded(result){for(var i=0;i<result.data.resource.length;i++)votes.deleteVotesbyCatans(result.data.resource[i].id);return $rootScope.DEBUG_MODE&&console.log("Deleting catans records by answer and category was succesful"),result.data}for(var i=0;i<_allcatans.length;i++)_allcatans[i].answer==answer_id&&_allcatans[i].category==category_id&&_allcatans.splice(i,1);var url=baseURI+"?filter=(answer="+answer_id+") AND (category="+category_id+")";return $http.delete(url).then(querySucceeded,_queryFailed)}function deletebyCategory(category_id){function querySucceeded(result){for(var i=0;i<result.data.resource.length;i++)votes.deleteVotesbyCatans(result.data.resource[i].id);return $rootScope.DEBUG_MODE&&console.log("Deleting catans records by category was succesful"),result.data}for(var i=0;i<_allcatans.length;i++)_allcatans[i].category==category_id&&_allcatans.splice(i,1);var url=baseURI+"?filter=category="+category_id;return $http.delete(url).then(querySucceeded,_queryFailed)}function updateRec(rec_id,field,val){function querySucceeded(result){return $rootScope.DEBUG_MODE&&console.log("updating catans record succesful"),result.data}var obj={};obj.resource=[];var data={};data.id=rec_id;for(var i=0;i<field.length;i++)data[field[i]]=val[i];obj.resource.push(data);for(var url=baseURI,idx=_allcatans.map(function(x){return x.id}).indexOf(rec_id),i=0;i<field.length;i++)_allcatans[idx][field[i]]=val[i];return $http.patch(url,obj,{headers:{"Content-Type":"multipart/form-data"},body:obj}).then(querySucceeded,_queryFailed)}function _load(data){_allcatans.length=0,data.forEach(function(x){_allcatans.push(x)})}function _queryFailed(error){throw error}var _allcatans=[],_fetchAnswersMem=[],_fetchRanksMem=[];$rootScope.catansrecs=_allcatans;var baseURI="/api/v2/mysql/_table/catans",fields="";return fields+="category,answer,upV,downV,rank,scope,id",{
getAllcatans:getAllcatans,getAllcatansX:getAllcatansX,getAllcatansY:getAllcatansY,postRec:postRec,postRec2:postRec2,deleteRec:deleteRec,deleteAnswer:deleteAnswer,updateRec:updateRec,deletebyCategory:deletebyCategory,getCatan:getCatan,deleteCatan:deleteCatan}}angular.module("app").factory("catans",catans),catans.$inject=["$http","$q","$rootScope","votes","uaf"]}(),function(){"use strict";function answer($http,$q,$rootScope,catans,vrows,uaf,staticpages){function getAnswersX(scope){var fields="";fields+="id,name,imageurl,type";var url0=baseURI+"?offset=0&filter=scope="+scope+"&fields="+fields,url1=baseURI+"?offset=1000&filter=scope="+scope+"&fields="+fields,url2=baseURI+"?offset=2000&filter=scope="+scope+"&fields="+fields,url3=baseURI+"?offset=3000&filter=scope="+scope+"&fields="+fields,url4=baseURI+"?offset=4000&filter=scope="+scope+"&fields="+fields,url5=baseURI+"?offset=5000&filter=scope="+scope+"&fields="+fields,url6=baseURI+"?offset=6000&filter=scope="+scope+"&fields="+fields,url7=baseURI+"?offset=7000&filter=scope="+scope+"&fields="+fields,p0=$http.get(url0),p1=$http.get(url1),p2=$http.get(url2),p3=$http.get(url3),p4=$http.get(url4),p5=$http.get(url5),p6=$http.get(url6),p7=$http.get(url7);return $q.all([p0,p1,p2,p3,p4,p5,p6,p7]).then(function(d){var data=d[0].data.resource.concat(d[1].data.resource,d[2].data.resource,d[3].data.resource,d[4].data.resource,d[5].data.resource,d[6].data.resource,d[7].data.resource);return 0==_answers.length?_load(data):_merge(data,_answers),$rootScope.DEBUG_MODE&&console.log("No. Answers: ",_answers.length),_answers},_queryFailed)}function getAnswersFromCatans(catans){var _datax=[];if(catans.forEach(function(item){_fetchAnswersMem.indexOf(item.answer)<0&&(_datax.push(item),_fetchAnswersMem.push(item.answer))}),0==_datax.length)return $q.when(!1);for(var filterstr="?filter=(",i=0;i<_datax.length;i++)filterstr=filterstr+"id="+_datax[i].answer+")OR(";filterstr=filterstr.substring(0,filterstr.length-3);var url0=baseURI+filterstr,p0=$http.get(url0);return $q.all([p0]).then(function(d){var _answersx=d[0].data.resource;return _answersx.constructor===Array?_merge(_answers,_answersx):_merge(_answers,[_answersx]),$rootScope.DEBUG_MODE&&console.log("answer.getAnswersFromCatans ",_answersx),_answersx},_queryFailed)}function getAnswers(answers){var _datax=[];if(answers.forEach(function(item){_fetchAnswersMem.indexOf(item.id)<0&&(_datax.push(item),_fetchAnswersMem.push(item.id))}),0==_datax.length)return $q.when(!1);for(var filterstr="?filter=(",i=0;i<_datax.length;i++)filterstr=filterstr+"id="+_datax[i].id+")OR(";filterstr=filterstr.substring(0,filterstr.length-3);var url0=baseURI+filterstr,p0=$http.get(url0);return $q.all([p0]).then(function(d){var _answersx=d[0].data.resource;return _answersx.constructor===Array?_merge(_answers,_answersx):_merge(_answers,[_answersx]),$rootScope.DEBUG_MODE&&console.log("answer.getAnswers ",_answersx),_answersx},_queryFailed)}function getAnswer(id){var url0=baseURI+"/?filter=id="+id,p0=$http.get(url0);return $q.all([p0]).then(function(d){var answerx=d[0].data.resource[0];return _merge(_answers,[answerx]),$rootScope.DEBUG_MODE&&console.log("single answer loaded: ",_answerx),answerx})}function getAnswerbyCustomer(customer_id){function querySucceeded(result){return result.data}var url=baseURI+"/?filter=customer="+customer_id;return $http.get(url).then(querySucceeded,_queryFailed)}function addAnswer(answer,ranks){function querySucceeded(result){var answerx=answer;answerx.id=result.data.resource[0].id;var slug=answerx.name.toLowerCase();slug=slug.replace(/ /g,"-"),slug=slug.replace("/","at"),slug=slug+"-"+result.data.resource[0].id,answerx.slug=slug,_answers.push(answerx),updateAnswer(result.data.resource[0].id,["slug"],[slug]),"Establishment"==answerx.type&&($rootScope.estNames.push(answerx.name),$rootScope.estAnswers.push(answerx)),"Person"==answerx.type&&($rootScope.pplNames.push(answerx.name),$rootScope.pplAnswers.push(answerx)),"Place"==answerx.type&&($rootScope.plaNames.push(answerx.name),$rootScope.plaAnswers.push(answerx));for(var i=0;i<ranks.length;i++)catans.postRec2(answerx.id,ranks[i].id);return $rootScope.DEBUG_MODE&&console.log("created catans for a new answer"),$rootScope.DEBUG_MODE&&console.log("result",result),result.data}answer.scope=$rootScope.SCOPE;var url=baseURI,resource=[];return void 0!=$rootScope.cCategory.owner&&0!=$rootScope.cCategory.owner?answer.isprivate=!0:answer.isprivate=!1,resource.push(answer),$http.post(url,resource,{headers:{"Content-Type":"multipart/form-data"},body:resource}).then(querySucceeded,_queryFailed)}function addAnswer2(answer,category){function querySucceeded(result){var answerx=answer;answerx.id=result.data.resource[0].id;var slug=answerx.name.toLowerCase();slug=slug.replace(/ /g,"-"),slug=slug.replace("/","at"),slug=slug+"-"+result.data.resource[0].id,answerx.slug=slug,_answers.push(answerx),updateAnswer(result.data.resource[0].id,["slug"],[slug]),"Establishment"==answerx.type&&($rootScope.estNames.push(answerx.name),$rootScope.estAnswers.push(answerx)),"Person"==answerx.type&&($rootScope.pplNames.push(answerx.name),$rootScope.pplAnswers.push(answerx)),"Place"==answerx.type&&($rootScope.plaNames.push(answerx.name),$rootScope.plaAnswers.push(answerx));for(var n=0;n<category.length;n++)catans.postRec2(answerx.id,category[n]);return $rootScope.DEBUG_MODE&&console.log("created "+category.length+"catans records for the new answer"),$rootScope.DEBUG_MODE&&console.log("result",result),result.data}answer.scope=$rootScope.SCOPE;var url=baseURI,resource=[];return answer.user=$rootScope.user.id,void 0!=category.owner&&0!=category.owner?answer.isprivate=!0:answer.isprivate=!1,resource.push(answer),$http.post(url,resource,{headers:{"Content-Type":"multipart/form-data"},body:resource}).then(querySucceeded,_queryFailed)}function updateAnswer(answer_id,field,val){function querySucceeded(result){return"owner"==field[0]&&uaf.post("binded",["answer"],[answer_id]),$rootScope.DEBUG_MODE&&console.log("updating answer succesful"),result.data}var obj={};obj.resource=[];var data={};data.id=answer_id;for(var i=0;i<field.length;i++)data[field[i]]=val[i];obj.resource.push(data);for(var url=baseURI,idx=_answers.map(function(x){return x.id}).indexOf(answer_id),i=0;i<field.length;i++)_answers[idx][field[i]]=val[i];for(var i=0;i<field.length;i++)if("name"==field[i]||"slug"==field[i]&&field.length>1||"imageurl"==field[i]||"addinfo"==field[i]){!0;break}return $http.patch(url,obj,{headers:{"Content-Type":"multipart/form-data"},body:obj}).then(querySucceeded,_queryFailed)}function flagAnswer(answer_id,flag){function querySucceeded(result){return $rootScope.DEBUG_MODE&&console.log(" answer flagged succesful"),result.data}var obj={};obj.resource=[];var data={};data.id=answer_id,data.flag=flag,obj.resource.push(data);var url=baseURI;return $http.patch(url,obj,{headers:{"Content-Type":"multipart/form-data"},body:obj}).then(querySucceeded,_queryFailed)}function deleteAnswer(answer_id){function querySucceeded(result){var filename="answer"+answer_id+".html",data={};return data.filename=filename,staticpages.removeFile(data),$rootScope.DEBUG_MODE&&console.log("Deleting answer was succesful"),result.data}var obj={};obj.resource=[];var data={};data.id=answer_id,obj.resource.push(data);var url=baseURI+"/"+answer_id,i=_answers.map(function(x){return x.id}).indexOf(answer_id);return i>-1&&_answers.splice(i,1),$http.delete(url,data,{headers:{"Content-Type":"multipart/form-data"},body:obj}).then(querySucceeded,_queryFailed)}function _load(data){_answers.length=0,_fetchAnswersMem.length=0,data.forEach(function(x){_answers.push(x)})}function _merge(lg,sm){sm.forEach(function(item){var idx=lg.map(function(x){return x.id}).indexOf(item.id);idx<0?lg.push(item):lg[idx]=item,_fetchAnswersMem.push(item.id)})}function _queryFailed(error){throw error}var _answers=[],_fetchAnswersMem=[];$rootScope.answers=_answers;var baseURI="/api/v2/mysql/_table/answers";return{getAnswers:getAnswers,getAnswersX:getAnswersX,getAnswersFromCatans:getAnswersFromCatans,getAnswer:getAnswer,addAnswer:addAnswer,addAnswer2:addAnswer2,updateAnswer:updateAnswer,deleteAnswer:deleteAnswer,flagAnswer:flagAnswer,getAnswerbyCustomer:getAnswerbyCustomer}}angular.module("app").factory("answer",answer),answer.$inject=["$http","$q","$rootScope","catans","vrows","uaf","staticpages"]}(),angular.module("app").directive("catBar",["color","$window","$rootScope","$state",function(color,$window,$rootScope,$state){"use strict";return{templateUrl:"app/answer/Partials/catbar.html",transclude:!0,scope:{text:"@",leftFn:"&leftFn",rightFn:"&rightFn",closeRank:"&closeRank"},link:function(scope){scope.bc="#006dcc",scope.bc2=color.shadeColor(scope.bc,-.3),scope.fc="white",$window.innerWidth<769?(scope.ht=50,scope.text.length>50&&(scope.ht=90)):$window.innerWidth<870?(scope.ht=50,scope.text.length>50&&(scope.ht=75)):scope.ht=50,scope.goPrev=function(){scope.leftFn()},scope.goNext=function(){scope.rightFn()},scope.selRank=function(){scope.closeRank()}}}}]),angular.module("app").directive("blobUpload",["$rootScope","$state",function($rootScope,$state){"use strict";return{templateUrl:"app/answer/Partials/blobupload.html",transclude:!0,scope:{},controller:["$scope","Upload","$timeout","$http","$rootScope","useruploadedimages","mailing",function($scope,Upload,$timeout,$http,$rootScope,useruploadedimages,mailing){function displayError(s){$scope.errorMsg=s}function postUserUploadedRecord(x){var obj={};console.log("$rootScope.user - ",$rootScope.user),obj.user=$rootScope.user.id,obj.username=$rootScope.user.name,obj.imageurl=x,obj.answer=$rootScope.canswer.id,obj.answername=$rootScope.canswer.name,useruploadedimages.postRecord(obj),mailing.newImageUploaded(obj).then(function(data){console.log("Send mail request for image notification")})}displayError(""),$scope.uploadFiles=function(file,errFiles){if($scope.f=file,$scope.errFile=errFiles&&errFiles[0],null==file)if(console.log("file is null"),void 0!=$scope.errFile){var errorMgs="Uploading failed for "+$scope.errFile.name+", "+$scope.errFile.$error+" exceeds "+$scope.errFile.$errorParam;displayError(errorMgs)}else displayError("");else{var storageurl="https://rankx.blob.core.windows.net/sandiego/"+$rootScope.canswer.id+"/"+file.name+"?sv=2015-04-05&ss=bfqt&srt=sco&sp=rwdlacup&se=2018-08-30T01:15:12Z&st=2016-08-29T17:15:12Z&spr=https,http&sig=PpyWE0X%2Fpz9SuRje5GtHh44WaWIii0GBU9PbIcDIka8%3D",fileReader=new FileReader;fileReader.readAsArrayBuffer(file),fileReader.onload=function(e){Upload.http({url:storageurl,method:"PUT",headers:{"x-ms-blob-type":"BlockBlob","x-ms-blob-content-type":file.type},data:e.target.result}).then(function(response){response.status>0&&($scope.errorMsg=response.status+": "+response.data);var imageurl="https://rankx.blob.core.windows.net/sandiego/"+$rootScope.canswer.id+"/"+file.name;console.log("emitted fileUploaded!!"),postUserUploadedRecord(imageurl),$rootScope.$emit("fileUploaded",imageurl)},null,function(evt){file.progress=Math.min(100,parseInt(100*evt.loaded/evt.total))})}}}}]}}]),angular.module("app").directive("answerHeader",["color","$window","$rootScope","$state","dialog",function(color,$window,$rootScope,$state,dialog){"use strict";return{templateUrl:"app/answer/Partials/answerheader.html",transclude:!0,scope:{ans:"@",idx:"@"},link:function(scope){function setImage(){scope.imgmode="Show Map",scope.imgmodeicon="fa fa-globe",scope.modeIsImage=!0,$rootScope.modeIsImage=!0}function setMap(){scope.imgmode="Show Image",scope.imgmodeicon="fa fa-picture-o",scope.modeIsImage=!1,$rootScope.modeIsImage=!1}scope.isMobile=!1,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|ipad|iris|kindle|Android|Silk|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(navigator.userAgent)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(navigator.userAgent.substr(0,4)))&&(scope.isMobile=!0),scope.answer=JSON.parse(scope.ans),"Short-Phrase"==scope.answer.type?scope.isShortPhrase=!0:scope.isShortPhrase=!1,"Event"==scope.answer.type?scope.isEvent=!0:scope.isEvent=!1,$rootScope.isLoggedIn&&$rootScope.user.id==scope.answer.owner?scope.userIsOwner=!0:scope.userIsOwner=!1,scope.modeIsImage=!0,scope.imgmode="Show Map",scope.imgmodeicon="fa fa-globe",scope.hasMap=void 0!=scope.answer.location&&""!=scope.answer.location;for(var iWa=[0,401,474,769,971,996,1173,1201,1635,1960,3500],eWa=[.86,.86,.88,.96,.75,.96,.68,.96,.64,.6,.6],iW=$window.innerWidth,eW=0,n=0;n<iWa.length-1;n++)if(iW>iWa[n]&&iW<iWa[n+1]){var slp=(eWa[n+1]-eWa[n])/(iWa[n+1]-iWa[n]),bpt=eWa[n]-iWa[n]*slp;eW=iW*slp+bpt}if($window.innerWidth<763){if(scope.sp1="width:5%;padding:0px;",scope.sp2="width:25%;max-height:50px",scope.sp3="width:20%",scope.sm=!0,scope.nsm=!1,scope.width=Math.round(iW*eW),scope.mxheight=Math.round(scope.width/1.25),scope.mxheight>300&&(scope.mxheight=300),$rootScope.cCategory){var colors=color.defaultRankColor($rootScope.cCategory);scope.bc=colors[0],scope.fc=colors[1]}else scope.bc="gray",scope.fc="black";scope.bc2=color.shadeColor(scope.bc,.4)}else{if(scope.mxheight="300",scope.sp1="width:15%",scope.sp2="width:22.5%;max-height:50px;",scope.sp3="width:20%",scope.sm=!1,scope.nsm=!0,scope.width=Math.round(iW*eW),scope.width2=Math.round(iW*eW/2),scope.width3=Math.round(iW*eW/3),$rootScope.cCategory){var colors=color.defaultRankColor($rootScope.cCategory);scope.bc=colors[0],scope.fc=colors[1]}else scope.bc="gray",scope.fc="black";scope.bc2="#d8d8d8"}if(void 0!=scope.answer.addinfo&&(scope.answer.addinfo_teaser=scope.answer.addinfo.slice(0,300),scope.answer.addinfo_complete=scope.answer.addinfo.slice(300)),scope.moretext=" more ",scope.completeinfo=!1,$rootScope.coordsRdy&&scope.answer.location&&void 0==scope.answer.dist){var p=.017453292519943295,c=Math.cos,a=0,lat_o=$rootScope.currentUserLatitude,lng_o=$rootScope.currentUserLongitude,lat=0,lng=0,dist_mi=0;lat=scope.answer.lat,lng=scope.answer.lng,a=.5-c((lat-lat_o)*p)/2+c(lat_o*p)*c(lat*p)*(1-c((lng-lng_o)*p))/2,dist_mi=12742*Math.asin(Math.sqrt(a))/1.609,scope.answer.dist=dist_mi<1?dist_mi.toPrecision(2):dist_mi.toPrecision(3)}!function(){if(scope.hrset=!1,void 0!=scope.answer.strhours&&null!=scope.answer.strhours){scope.hrset=!0;var cdate=new Date,dayOfWeek=cdate.getDay(),idx=dayOfWeek-1;idx<0&&(idx=6);var openhours=JSON.parse(scope.answer.strhours);"CLOSED"==openhours[idx].opn?scope.hourstr="Closed today":scope.hourstr="Open today from: "+openhours[idx].st+" to "+openhours[idx].ct}}(),scope.toggleimgmode=function(){scope.modeIsImage?setMap():setImage()},scope.editAnswer=function(){$rootScope.isLoggedIn?"Event"==scope.answer.type?($rootScope.eventmode="edit",$state.go("addEvent",{index:scope.answer.id})):$state.go("editAnswer",{index:scope.answer.id}):dialog.loginFacebook()},scope.showcomplete=function(){return" more "==scope.moretext?(scope.moretext=" less ",void(scope.completeinfo=!0)):" less "==scope.moretext?(scope.moretext=" more ",void(scope.completeinfo=!1)):void 0},scope.gotoLocationAnswer=function(){console.log("eventlocid - ",scope.answer.eventlocid),$state.go("answerDetail",{index:scope.answer.eventlocid})}}}}]),function(){"use strict";function answerDetail(flag,$stateParams,$state,answer,dialog,$rootScope,$window,useractivity,htmlops,votes,matchrec,edit,editvote,catans,datetime,commentops,userdata,useraccnt,dataloader,$timeout,$location,vrows,vrowvotes,imagelist,instagram,$scope,table,SERVER_URL,$http,common,$cookies,$q,fbusers,InstagramService,mailing,Socialshare){function checkAnswerExists(){$rootScope.canswer=null;var ansid=common.getIndexFromSlug($stateParams.index),idx=$rootScope.answers.map(function(x){return x.id}).indexOf(Number(ansid));idx>-1&&($rootScope.canswer=$rootScope.answers[idx]),null!=$rootScope.canswer?activate():dataloader.getAnswer($stateParams.index)}function activate(){if(vm.dataReady=!0,vm.answer=$rootScope.canswer,answers=$rootScope.canswers,vm.fields=$rootScope.fields,vm.isAdmin=$rootScope.isAdmin||$rootScope.dataAdmin,vm.isAdmin&&(vm.bizcat=useraccnt.getBizCat(vm.answer.id)),$rootScope.isLoggedIn=!!$rootScope.isLoggedIn&&$rootScope.isLoggedIn,vm.isLoggedIn=$rootScope.isLoggedIn,$rootScope.cansvrows=void 0,$scope.$parent.$parent.$parent.seo={pageTitle:vm.answer.name,metaDescription:vm.answer.addinfo},void 0==vm.answer.isprivate&&(vm.answer.isprivate=!1),vm.type=vm.answer.type,vm.i=-1,($rootScope.DISPLAY_XSMALL||$rootScope.DISPLAY_SMALL)&&(numImagesPage=4),$rootScope.DISPLAY_MEDIUM&&(numImagesPage=6),$rootScope.DISPLAY_LARGE&&(numImagesPage=12),getImages(),$rootScope.inFavMode?vm.ranking=$rootScope.myfavs.title:$rootScope.cCategory?vm.ranking=$rootScope.cCategory.title:vm.ranking="",void 0==answers&&(answers=[vm.answer]),vm.idx=answers.map(function(x){return x.id}).indexOf(vm.answer.id)+1,void 0==$rootScope.cCategory&&(vm.idx=0),2225==vm.answer.id?vm.igdemo=!0:vm.igdemo=!1,getFields(),vm.modeIsImage=void 0==$rootScope.modeIsImage||$rootScope.modeIsImage,void 0==vm.answer.location&&(vm.modeIsImage=!0),"answerDetail"!=$rootScope.previousState&&$window.scrollTo(0,0),getHeader(),getEdits(vm.answer.id),vm.access=!1,$rootScope.isLoggedIn?($rootScope.user.id==vm.answer.owner?(vm.userIsOwner=!0,vm.answer.isactive&&(vm.access=!0)):vm.userIsOwner=!1,$rootScope.isAdmin&&(vm.userIsOwner=!0)):vm.userIsOwner=!1,$rootScope.userIsOwner=vm.userIsOwner,deleteButtonAccess(),"Establishment"!=vm.type&&vm.type,"Establishment"==vm.type&&getSpecials(vm.answer.id),getVRows(vm.answer.id),getAnswerRanks(),dataloader.pulldata("ranks",vm.answerRanks),"Event"==vm.type){var eventObj=JSON.parse(vm.answer.eventstr);mergeObject(vm.answer,eventObj),vm.ehtml=htmlops.eventHtml(vm.answer),vm.estyle="background-color:"+vm.answer.bc+";color:"+vm.answer.fc+";white-space:pre;"}if(vm.answer.hasranks){var n=0;if(vm.myranks=JSON.parse(vm.answer.ranks),void 0!=vm.myranks&&vm.myranks.length>0)for(var i=0;i<vm.myranks.length;i++)n=$rootScope.customranks.map(function(x){return x.id}).indexOf(vm.myranks[i].id),vm.myranks[i].title=$rootScope.customranks[n].title.replace(" @ "+vm.answer.name,""),vm.myranks[i].image=$rootScope.customranks[n].image1url,void 0!=vm.myranks[i].image&&""!=vm.myranks[i].image||(vm.myranks[i].image=$rootScope.EMPTY_IMAGE)}else if(vm.userIsOwner){vm.myranks=[];var demorank={};demorank.id=11091,demorank.bc="#027fa8",demorank.fc="white",vm.myranks.push(demorank),demorank={},demorank.id=11092,demorank.bc="#027fa8",demorank.fc="white",vm.myranks.push(demorank),demorank={},demorank.id=11093,demorank.bc="#027fa8",demorank.fc="white",vm.myranks.push(demorank);for(var i=0;i<vm.myranks.length;i++)n=$rootScope.customranks.map(function(x){return x.id}).indexOf(vm.myranks[i].id),n>-1&&(vm.myranks[i].title=$rootScope.customranks[n].title.replace(" @ Demo",""),vm.myranks[i].image=$rootScope.customranks[n].image1url),void 0!=vm.myranks[i].image&&""!=vm.myranks[i].image||(vm.myranks[i].image=$rootScope.EMPTY_IMAGE);$rootScope.rankOwner={},$rootScope.rankOwner.name=vm.answer.name,$rootScope.rankOwner.slug=vm.answer.slug}void 0==vm.answer.numcom?vm.numcom=0:vm.numcom=vm.vrows.length,vm.answer.numcom!=vm.vrows.length&&answer.updateAnswer(vm.answer.id,["numcom"],[vm.numcom]),vm.ranking?vm.showNextnPrev=!0:vm.showNextnPrev=!1,incViews(),votemodeOFF(),$rootScope.DEBUG_MODE&&console.log("Answer details loaded"),window.prerenderReady=!0}function getFields(){if(!$rootScope.fields){var fidx=0;switch(vm.answer.type){case"Place":fidx=0;break;case"Person":fidx=1;break;case"Event":fidx=2;break;case"Organization":fidx=3;break;case"Short-Phrase":fidx=4;break;case"Activity":fidx=5;break;case"Establishment":fidx=6;break;case"Thing":fidx=7;break;case"PersonCust":fidx=8;break;case"Simple":fidx=9}var fields=$rootScope.typeSchema[fidx].fields;$rootScope.fields=fields}}function getHeader(){void 0==vm.answer.owner||null==vm.answer.owner||0==vm.answer.owner?vm.answer.hasOwner=!1:vm.answer.hasOwner=!0,vm.bindtxt="","Establishment"==vm.type&&(vm.bindtxt="I represent this business"),"PersonCust"==vm.type&&(vm.bindtxt="I am this person"),"Event"==vm.type&&(vm.bindtxt="I organize this event")}function makeRelativeTable(id){var PctF=0,PctC=0,vsName="";vm.relativetable=[];for(var R=$rootScope.R,GP=$rootScope.GP,answersR=$rootScope.answersR,x=A.indexOf(+id),W=0,mainField=$rootScope.fields[0].name,isC=!1,n=0;n<answersR.length;n++)if(A[n]!=id){switch(W=R[x][n],mainField){case"name":vsName=answersR[n].name;break;case"nickname":vsName=answersR[n].nickname;break;case"country":vsName=answersR[n].country,isC=!0;break;case"club":vsName=answersR[n].club}GP[x][n]?(PctF=Math.round(W/GP[x][n]*100),PctC=100-PctF):(PctF=0,PctC=0),vm.relativetable.push({id:answersR[n].id,Rank:answersR[n].Rank,PctF:PctF,vsName:vsName,PctC:PctC,GP:GP[x][n],isC:isC})}}function refresh(x){updateRecords(),recordsUpdated=!1,voteRecordExists=!1,vm.answer=answers[A.indexOf(+x)],$rootScope.canswer=vm.answer,getEdits(vm.answer.id),upVi=vm.catans.upV,downVi=vm.catans.downV,getHeader(),getAnswerRanks(),getAnswerVotes(),makeRelativeTable(x),getSpecials(vm.answer.id),getVRows(vm.answer.id)}function updateRecords(){if($rootScope.isLoggedIn&&answerFound){$rootScope.DEBUG_MODE&&console.log("UpdateRecords @answerDetail");for(var i=0;i<vm.answerRanks.length;i++){var voteRecordExists=vm.answerRanks[i].voteRecordExists,userHasRank=!1,useractivityrec={};try{var idx=$rootScope.thisuseractivity.map(function(x){return x.category}).indexOf(vm.answerRanks[i].id)}catch(err){console.log("Error: ",err),console.log("$rootScope.thisuseractivity - ",$rootScope.thisuseractivity);var idx=-1}idx>=0?(userHasRank=!0,useractivityrec=$rootScope.thisuseractivity[idx]):userHasRank=!1,voteRecordExists&&vm.answerRanks[i].uservote.vote!=vm.answerRanks[i].dV&&0!=vm.answerRanks[i].dV&&($rootScope.DEBUG_MODE&&console.log("UR-1"),votes.patchRec(vm.answerRanks[i].uservote.id,vm.answerRanks[i].dV)),voteRecordExists&&vm.answerRanks[i].uservote.vote!=vm.answerRanks[i].dV&&0==vm.answerRanks[i].dV&&($rootScope.DEBUG_MODE&&console.log("UR-2"),votes.deleteRec(vm.answerRanks[i].uservote.id),useractivityrec.votes<2?($rootScope.DEBUG_MODE&&console.log("UR-3"),useractivity.deleteRec(useractivityrec.id)):($rootScope.DEBUG_MODE&&console.log("UR-4"),useractivity.patchRec(useractivityrec.id,useractivityrec.votes-1))),voteRecordExists||0==vm.answerRanks[i].dV||($rootScope.DEBUG_MODE&&console.log("UR-5"),votes.postRec(vm.answerRanks[i].catans,vm.answer.id,vm.answerRanks[i].id,vm.answerRanks[i].dV),userHasRank?($rootScope.DEBUG_MODE&&console.log("UR-6"),useractivity.patchRec(useractivityrec.id,useractivityrec.votes+1)):($rootScope.DEBUG_MODE&&console.log("UR-7"),useractivity.postRec(vm.answerRanks[i].id))),vm.answerRanks[i].upV==vm.answerRanks[i].upVi&&vm.answerRanks[i].downV==vm.answerRanks[i].downVi||($rootScope.DEBUG_MODE&&console.log("UR-8"),catans.updateRec(vm.answerRanks[i].catans,["upV","downV"],[vm.answerRanks[i].upV,vm.answerRanks[i].downV]))}if(vm.vrows)for(var i=0;i<vm.vrows.length;i++){var voteRecExists=vm.vrows[i].voteExists;voteRecExists&&vm.vrows[i].dVi!=vm.vrows[i].dV&&($rootScope.DEBUG_MODE&&console.log("UR-9"),$rootScope.cvrowvotes[vm.vrows[i].vidx].val=vm.vrows[i].dV,vrowvotes.patchRec(vm.vrows[i].voteid,vm.vrows[i].dV)),voteRecExists||0==vm.vrows[i].dV||($rootScope.DEBUG_MODE&&console.log("UR-10"),vrowvotes.postRec(vm.vrows[i].id,vm.vrows[i].dV)),vm.vrows[i].upV==vm.vrows[i].upVi&&vm.vrows[i].downV==vm.vrows[i].downVi||($rootScope.DEBUG_MODE&&console.log("UR-11"),vrows.updateRec(vm.vrows[i].id,["upV","downV"],[vm.vrows[i].upV,vm.vrows[i].downV]))}recordsUpdated=!0}}function getAnswerVotes(){for(var i=0;i<vm.answerRanks.length;i++){vm.answerRanks[i].voteRecordExists=!1;for(var j=0;j<$rootScope.cvotes.length;j++)if($rootScope.cvotes[j].catans==vm.answerRanks[i].catans){vm.answerRanks[i].uservote=$rootScope.cvotes[j],vm.answerRanks[i].uservote.ansvidx=i,vm.answerRanks[i].voteRecordExists=!0;break}vm.answerRanks[i].voteRecordExists?vm.answerRanks[i].dV=vm.answerRanks[i].uservote.vote:vm.answerRanks[i].dV=0,displayVote(vm.answerRanks[i])}}function getVRowVotes(){if($rootScope.isLoggedIn)for(var i=0;i<$rootScope.cansvrows.length;i++)for(var j=0;j<$rootScope.cvrowvotes.length;j++)$rootScope.cvrowvotes[j].vrow==$rootScope.cansvrows[i].id&&($rootScope.cansvrows[i].voteExists=!0,$rootScope.cansvrows[i].dVi=$rootScope.cvrowvotes[j].val,$rootScope.cansvrows[i].dV=$rootScope.cvrowvotes[j].val,$rootScope.cansvrows[i].voteid=$rootScope.cvrowvotes[j].id,$rootScope.cansvrows[i].vidx=j,setVRowVoteImage($rootScope.cansvrows[i],$rootScope.cvrowvotes[j].val));displayVRows()}function setVRowVoteImage(obj,val){1==val&&(obj.upImage="thumbs_up_blue_table.png",obj.downImage="thumbs_down_gray_table.png"),0==val&&(obj.dVi=0,obj.dV=0,obj.upImage="thumbs_up_gray_table.png",obj.downImage="thumbs_down_gray_table.png"),-1==val&&(obj.dVi=-1,obj.dV=-1,obj.upImage="thumbs_up_gray_table.png",obj.downImage="thumbs_down_blue_table.png")}function getEdits(id){vm.numEdits=0;for(var i=0;i<$rootScope.edits.length;i++)$rootScope.edits[i].answer==id&&vm.numEdits++}function displayVote(x){1==x.dV&&(x.thumbUp="#0070c0",x.thumbDn="grey"),0==x.dV&&(x.thumbUp="grey",x.thumbDn="grey"),-1==x.dV&&(x.thumbUp="grey",x.thumbDn="#0070c0")}function UpVote(x){if(!$rootScope.isLoggedIn)return void dialog.loginFacebook();switch(x.dV){case-1:x.dV=1,x.upV++,x.downV--;break;case 0:x.dV=1,x.upV++;break;case 1:x.dV=0,x.upV--}displayVote(x),$rootScope.DEBUG_MODE&&console.log("UpVote")}function DownVote(x){if(!$rootScope.isLoggedIn)return void dialog.loginFacebook();switch(x.dV){case-1:x.dV=0,x.downV--;break;case 0:x.dV=-1,x.downV++;break;case 1:x.dV=-1,x.upV--,x.downV++}displayVote(x),$rootScope.DEBUG_MODE&&console.log("DownVote")}function goBack(){$rootScope.DEBUG_MODE&&console.log("goBack"),"match"==$rootScope.previousState?$state.go("match"):$rootScope.inFavMode?$state.go("favs"):$rootScope.cCategory?($rootScope.cCategory.title.indexOf("@")>-1&&($rootScope.isCustomRank=!0),$state.go("rankSummary",{index:$rootScope.cCategory.id})):backToResults()}function rankSel(x){$rootScope.title=x.title,$state.go("rankSummary",{index:x.id})}function deleteAnswer(){console.log("Delete Answer"),dialog.deleteType(function(){matchrec.deleteRecordsbyCatans($rootScope.cCategory.id,vm.answer.id),catans.deleteRec(vm.answer.id,$rootScope.cCategory.id).then(function(){vm.addctsactive=!1,getAnswerRanks(),vm.dispRanks--})},function(){answer.deleteAnswer(vm.answer.id),matchrec.deleteRecordsbyAnswer(vm.answer.id),edit.deleteEditbyAnswer(vm.answer.id),editvote.deleteEditVotesbyAnswer(vm.answer.id),catans.deleteAnswer(vm.answer.id),vrows.deleteVrowByAnswer(vm.answer.id),$state.go("rankSummary",{index:$rootScope.cCategory.id})})}function deleteThisCatans(r){var thisAnswer=vm.answer.name,idx=$rootScope.content.map(function(x){return x.id}).indexOf(r.id),thisCategory=$rootScope.content[idx].title;dialog.deleteThisCatans(thisAnswer,thisCategory,function(){matchrec.deleteRecordsbyCatans(r.id,vm.answer.id),catans.deleteRec(vm.answer.id,r.id).then(function(){vm.addctsactive=!1,getAnswerRanks(),vm.dispRanks--})})}function flagAnswer(x){if($rootScope.isLoggedIn)return $rootScope.DEBUG_MODE&&console.log("Answer Flagged"),flag.flagAnswer("answer",vm.answer.id,x),void dialog.getDialog("answerFlagged");dialog.loginFacebook()}function cmFlag(x){if($rootScope.isLoggedIn)return $rootScope.DEBUG_MODE&&console.log("Answer Comment Flagged"),flag.flagAnswer("comment-answer",vm.answer.id,x),void dialog.getDialog("commentFlagged");dialog.loginFacebook()}function getAnswerRanks(){vm.answerRanks=[];for(var rankObj={},i=0;i<$rootScope.catansrecs.length;i++)if($rootScope.catansrecs[i].answer==vm.answer.id)for(var j=0;j<$rootScope.content.length;j++)$rootScope.content[j].id==$rootScope.catansrecs[i].category&&(rankObj={},rankObj=$rootScope.content[j],rankObj.upV=$rootScope.catansrecs[i].upV,rankObj.downV=$rootScope.catansrecs[i].downV,rankObj.catans=$rootScope.catansrecs[i].id,rankObj.rank=$rootScope.catansrecs[i].rank,rankObj.rank>rankObj.answers&&(rankObj.rank=rankObj.answers),rankObj.uservote={},rankObj.upVi=$rootScope.catansrecs[i].upV,rankObj.downVi=$rootScope.catansrecs[i].downV,1==rankObj.rank?rankObj.icon="/assets/images/gold.png":2==rankObj.rank?rankObj.icon="/assets/images/silver.png":3==rankObj.rank?rankObj.icon="/assets/images/bronze.png":rankObj.rank>3&&rankObj.rank<11?rankObj.icon="/assets/images/top10.png":rankObj.rank>=11&&rankObj.rank<21?rankObj.icon="/assets/images/top20.png":rankObj.rank>=21&&rankObj.rank<51?rankObj.icon="/assets/images/top50.png":rankObj.rank>=51&&rankObj.rank<101?rankObj.icon="/assets/images/top100.png":rankObj.icon="/assets/images/blank.png",vm.answerRanks.push(rankObj));vm.otherRanksExist=!0,getAnswerVotes()}function getSpecials(x){var answerid=0;answerid=!vm.answer.ispremium&&vm.userIsOwner?1:x,vm.specialsList=[];for(var i=0;i<$rootScope.specials.length;i++)$rootScope.specials[i].answer==answerid&&vm.specialsList.push($rootScope.specials[i])}function showSpecial(x){dialog.showSpecial(x)}function showsimage(x){x.showimage?x.showimage=!1:x.showimage=!0}function getVRows(answerid){var objExists=!1,obj={},callgetVotes=!1;if(void 0==$rootScope.cansvrows&&($rootScope.cansvrows=[],callgetVotes=!0),$rootScope.cvrows){for(var i=0;i<$rootScope.cvrows.length;i++)if($rootScope.cvrows[i].answer==answerid){objExists=!1;for(var j=0;j<$rootScope.cansvrows.length;j++)$rootScope.cansvrows[j].id==$rootScope.cvrows[i].id&&(objExists=!0);objExists||(obj={},obj=$rootScope.cvrows[i],obj.idx=i,obj.voteExists=!1,obj.dV=0,obj.upVi=$rootScope.cvrows[i].upV,obj.downVi=$rootScope.cvrows[i].downV,obj.upImage="thumbs_up_gray_table.png",obj.downImage="thumbs_down_gray_table.png",obj.delta=obj.upV-obj.downV,$rootScope.isLoggedIn&&obj.user==$rootScope.user.id&&vrowsByUserCounter++,$rootScope.cansvrows.push(obj))}callgetVotes?getVRowVotes():vm.newop="",(vrowsByUserCounter>=3||!$rootScope.isLoggedIn)&&(vm.addvrowbutton="disabled")}}function displayVRows(){vm.vrows=$rootScope.cansvrows}function validateNewVrow(){vm.maybeRepeatedVrows=[];var tags=[],vrowtitle="",newop=vm.newop,foundMatch=!1;newop=newop.toLowerCase(),newop=newop.replace(","," "),newop=newop.replace("!"," ");for(var tagsnewop=newop.split(" "),i=0;i<vm.vrows.length;i++){foundMatch=!1,vrowtitle=vm.vrows[i].title,vrowtitle=vrowtitle.toLowerCase(),
vrowtitle=vrowtitle.replace(","," "),vrowtitle=vrowtitle.replace("!"," "),tags=vrowtitle.split(" ");for(var j=0;j<tags.length;j++){for(var k=0;k<tagsnewop.length;k++)if(tags[j].length>3&&tagsnewop[k].length>3)if(tags[j].length>=tagsnewop[k].length){if(tags[j].indexOf(tagsnewop[k])>-1){vm.maybeRepeatedVrows.push(vm.vrows[i]),foundMatch=!0;break}}else if(tagsnewop[k].indexOf(tags[j])>-1){vm.maybeRepeatedVrows.push(vm.vrows[i]),foundMatch=!0;break}if(foundMatch)break}}}function deleteButtonAccess(){$rootScope.dataAdmin||$rootScope.isAdmin||vm.userIsOwner&&vm.answer.isprivate?vm.deleteButton=!0:vm.deleteButton=!1}function showUrl(){dialog.url(vm.answer.imageurl)}function closeRank(){$state.go("cwrapper")}function closeAnswerDetail(){goBack()}function bizRegDialog(){dialog.bizRegistration(bizRegistration)}function bizRegistration(){$rootScope.isLoggedIn?dialog.bindAccount($rootScope.user.name,vm.answer.name,bindAccount):dialog.getDialog("notLoggedInBiz")}function bindAccount(){$rootScope.DEBUG_MODE&&console.log("Bind business to user account"),answer.updateAnswer(vm.answer.id,["owner"],[$rootScope.user.id]).then(reloadAnswer);var item={};item=vm.answer,item.username=$rootScope.user.first_name+" "+$rootScope.user.last_name,item.email=$rootScope.user.email,useraccnt.adduseraccnt(item).then(function(useracc){mailing.newBizCreated({account:useracc,answer:item}).then(function(data){});for(var hasEmail=!1,i=0;i<$rootScope.useraccnts.length;i++)""!=$rootScope.useraccnts[i].email&&(hasEmail=!0);hasEmail||$rootScope.$emit("showWarning"),$rootScope.$emit("userAccountsLoaded")})}function reloadAnswer(){vm.userIsOwner=!0,getHeader()}function openSpecials(){$state.go("specials")}function editVRows(){}function addRankforAnswer(){$state.go("answerRanksManager")}function getImages(){if(vm.showImageGallery=!0,vm.igdemo)instagram.getImages().then(showImages);else{$rootScope.blobs=[];for(var urls=vm.answer.ig_image_urls.split(";"),i=0;i<urls.length;i++)if(""!=urls[i]){var myObj={};myObj.url=urls[i],myObj.type="Instagram",$rootScope.blobs.push(myObj)}imagelist.getImageList().then(showImages)}}function showImages(){var specialImages=[];vm.specialsList&&(specialImages=vm.specialsList.map(function(special){return special.image})),$rootScope.blobs=$rootScope.blobs.filter(function(blob){return-1==specialImages.indexOf(blob.url)}),vm.igdemo?vm.images=$rootScope.igimages:vm.images=$rootScope.blobs,numImages=vm.images.length,vm.i=0,imageNav()}function imageNav(){vm.i+(numImagesPage-1)<=numImages?vm.e=vm.i+numImagesPage:vm.e=numImages,numImages<=4?(vm.showFwd=!1,vm.showRev=!1):(0==vm.i?vm.showRev=!1:vm.showRev=!0,vm.e==vm.images.length-1?vm.showFwd=!1:vm.showFwd=!0),vm.e>=numImages-1&&(vm.showFwd=!1)}function moreImagesFwd(){vm.showFwd&&(vm.i=vm.i+numImagesPage,imageNav())}function moreImagesRev(){vm.showRev&&(vm.i=vm.i-numImagesPage,imageNav())}function gotoRank(x){$state.go("rankSummary",{index:x.slug})}function gotoCustomRank(x){$rootScope.oCategory=$rootScope.cCategory,$rootScope.oAnswer=vm.answer,$rootScope.isCustomRank=!0,$state.go("rankSummary",{index:x.id})}function goPrev(){var L=answers.length,i=answers.map(function(x){return x.id}).indexOf(vm.answer.id),ni=i-1;ni<0&&(ni=L-1),$rootScope.isLoggedIn&&updateRecords(),$state.go("answerDetail",{index:answers[ni].id})}function goNext(){var L=answers.length,i=answers.map(function(x){return x.id}).indexOf(vm.answer.id),ni=i+1;ni>L-1&&(ni=0),$rootScope.isLoggedIn&&updateRecords(),$state.go("answerDetail",{index:answers[ni].id})}function vrowVoteUp(x){if(!$rootScope.isLoggedIn)return void dialog.loginFacebook();switch(x.dV){case-1:x.dV=1,x.upV++,x.downV--;break;case 0:x.dV=1,x.upV++;break;case 1:x.dV=0,x.upV--}x.delta=x.upV-x.downV,displayVRowVote(x),$rootScope.DEBUG_MODE&&console.log("VRow UpVote")}function vrowVoteDown(x){if(!$rootScope.isLoggedIn)return void dialog.loginFacebook();switch(x.dV){case-1:x.dV=0,x.downV--;break;case 0:x.dV=-1,x.downV++;break;case 1:x.dV=-1,x.upV--,x.downV++}x.delta=x.upV-x.downV,displayVRowVote(x),$rootScope.DEBUG_MODE&&console.log("DownVote")}function displayVRowVote(x){1==x.dV&&(x.upImage="thumbs_up_blue_table.png",x.downImage="thumbs_down_gray_table.png"),0==x.dV&&(x.upImage="thumbs_up_gray_table.png",x.downImage="thumbs_down_gray_table.png"),-1==x.dV&&(x.upImage="thumbs_up_gray_table.png",x.downImage="thumbs_down_blue_table.png")}function loadComments(){commentops.loadComments("answer",cObj).then(function(){$q.all(cObj.comments.map(function(comment){return fbusers.getFBUserById(comment.user)})).then(function(fbUsers){for(var i=0;i<cObj.comments.length;i++)cObj.comments[i].picture=fbUsers[i]?fbUsers[i].picture.data.url:null})})}function postComment(){commentops.postComment("answer",cObj)}function mergeObject(x,y){x.bc=y.bc,x.fc=y.fc,x.freq=y.freq,x.edate=y.edate,x.sdate=y.sdate,x.etime=y.etime,x.etime2=y.etime2,x.stime=y.stime,x.stime2=y.stime2,x.mon=y.mon,x.tue=y.tue,x.wed=y.wed,x.thu=y.thu,x.fri=y.fri,x.sat=y.sat,x.sun=y.sun}function selectPhoto(x){dialog.seePhotos(vm.images,x,vm.answer,vm.userIsOwner)}function addcts(x){var title="",rank=-1,rFound=!1,cat=-1,nh=-1;title=vm.addctsval;for(var i=0;i<$rootScope.content.length;i++)if($rootScope.content[i].title==title){rFound=!0,rank=$rootScope.content[i].id;break}if(console.log("could not find - ",title),rFound)console.log("rank found, posting record"),catans.postRec2(vm.answer.id,rank).then(function(){vm.addctsactive=!1,getAnswerRanks(),vm.dispRanks++});else{console.log("rank not found, will create ghost"),title.indexOf(vm.answer.cityarea)>-1&&(title=title.replace(vm.answer.cityarea,"@Nh"),console.log("category title - ",title));for(var i=0;i<$rootScope.categories.length;i++)if($rootScope.categories[i].category==title){cat=$rootScope.categories[i].id;break}for(var i=0;i<$rootScope.locations.length;i++)if($rootScope.locations[i].nh_name==vm.answer.cityarea){nh=$rootScope.locations[i].id;break}if(cat>-1&&nh>-1){var obj={};obj.cat=cat,obj.nh=nh,obj.isatomic=!0,table.addTable(obj).then(function(tableid){catans.postRec2(vm.answer.id,tableid).then(function(){vm.addctsactive=!1,getAnswerRanks(),vm.dispRanks++})})}else console.log("Error creating ghost rank, cat, nh ",cat,nh)}}function addCatans(x){vm.addctsopts=[];for(var opt="",i=0;i<$rootScope.ctsOptions.length;i++)$rootScope.ctsOptions[i].indexOf("@Nh")>-1?(opt=$rootScope.ctsOptions[i].replace("@Nh",vm.answer.cityarea),vm.addctsopts.push(opt)):vm.addctsopts.push($rootScope.ctsOptions[i]);vm.addctsactive=!0}function votemodeON(){vm.votemode=!0,vm.voteonstyle="background-color:#3277b3;color:#e6e6e6",vm.voteoffstyle="background-color:#e6e6e6;color:black"}function votemodeOFF(){vm.votemode=!1,vm.voteoffstyle="background-color:#3277b3;color:#e6e6e6",vm.voteonstyle="background-color:#e6e6e6;color:black"}function endorseDialog(){dialog.endorse(vm.type),$rootScope.endorseDialogShown=!0}function addvrow(){vrowsByUserCounter<3&&$rootScope.isLoggedIn?(validateNewVrow(),vm.maybeRepeatedVrows.length>0?dialog.maybeRepeatVrows(vm.newop,vm.maybeRepeatedVrows,addvrowexec):addvrowexec()):$rootScope.isLoggedIn?dialog.getDialog("opinionsLimit"):dialog.loginFacebook()}function addvrowexec(){vrows.postRec(vm.newop).then(function(){getVRows($rootScope.canswer.id)})}function selectInstagramImages(){null==InstagramService.access_token()?InstagramService.login():InstagramService.getMyRecentImages().then(function(data){dialog.chooseImgFromIgDlg(data,vm.answer,vm.userIsOwner,vm.navigateTowards)}).catch(function(err){console.log(err)}),$rootScope.$on("instagramLoggedIn",function(evt,args){InstagramService.getMyRecentImages().then(function(data){dialog.chooseImgFromIgDlg(data,vm.answer,vm.userIsOwner,vm.navigateTowards)}).catch(function(err){console.log(err)})})}function navigateTowards(direction){"next"==direction?InstagramService.getNextPage().then(function(data){dialog.chooseImgFromIgDlg(data,vm.answer,vm.userIsOwner,vm.navigateTowards)}).catch(function(err){console.log(err)}):"previous"==direction&&InstagramService.getPreviousPage().then(function(data){dialog.chooseImgFromIgDlg(data,vm.answer,vm.userIsOwner,vm.navigateTowards)}).catch(function(err){console.log(err)})}function showRanks(){vm.dispRanks<=3?vm.dispRanks=vm.answerRanks.length:vm.dispRanks=3}function hideCustomRanks(){vm.hideCustomRanksMsg=!0,$rootScope.hideCustomRankMsg=!0}function hideGetPremium(){vm.hideGetPremiumMsg=!0,$rootScope.hideGetPremiumMsg=!0}function gotoMyBusiness(){$state.go("mybusiness")}function showLocations(){for(var locsIdx=vm.answer.family.split(":").map(Number),locs=[],idx=0,i=0;i<locsIdx.length;i++)(idx=$rootScope.answers.map(function(x){return x.id}).indexOf(locsIdx[i]))>-1&&locs.push($rootScope.answers[idx]);dialog.showLocations(locs)}function backToResults(){updateRecords(),"trends"==$rootScope.previousState?$state.go("trends"):$rootScope.$emit("backToResults")}function share(){vm.linkurl=SERVER_URL+"answer"+vm.answer.id+".html",vm.tweet=vm.answer.name+", endorse your favorite ones at: ";var imageurl=vm.answer.imageurl;dialog.shareOptions(shareFunction,vm.isMobile,vm.linkurl,"Rank-X, "+vm.answer.name+"\n"+imageurl,$scope)}function shareFunction(x){var imageurl=vm.answer.imageurl;switch(x){case"twitter":$rootScope.DEBUG_MODE&&console.log(x),Socialshare.share({provider:"twitter",attrs:{socialshareUrl:vm.linkurl,socialshareText:vm.tweet,socialshareHashtags:"rankxsandiego"}});break;case"facebook":$rootScope.DEBUG_MODE&&console.log(x),FB.ui({method:"feed",link:vm.linkurl,caption:"Rank-X San Diego"});break;case"email":$rootScope.DEBUG_MODE&&console.log(x),Socialshare.share({provider:"email",attrs:{socialshareSubject:"Rank-X, "+vm.answer.name,socialshareBody:vm.linkurl}});break;case"gplus":$rootScope.DEBUG_MODE&&console.log(x),Socialshare.share({provider:"google",attrs:{socialshareUrl:vm.linkurl,socialshareText:vm.answer.name,socialshareMedia:imageurl}});break;case"pinterest":$rootScope.DEBUG_MODE&&console.log(x),Socialshare.share({provider:"pinterest",attrs:{socialshareUrl:vm.linkurl,socialshareText:"Rank-X, "+vm.answer.name,socialshareMedia:imageurl}});break;case"tumblr":$rootScope.DEBUG_MODE&&console.log(x),Socialshare.share({provider:"tumblr",attrs:{socialshareUrl:vm.linkurl,socialshareText:"Rank-X, "+vm.answer.name,socialshareMedia:imageurl}});break;case"reddit":$rootScope.DEBUG_MODE&&console.log(x),Socialshare.share({provider:"reddit",attrs:{socialshareUrl:vm.linkurl,socialshareText:"Rank-X, "+vm.answer.name,socialshareSubreddit:""}})}}function incViews(){var url=(vm.answer.views++,SERVER_URL+"databaseOps/incViews/answer/"+vm.answer.id);$http({method:"POST",url:url,headers:{"X-Dreamfactory-API-Key":void 0,"X-DreamFactory-Session-Token":void 0}})}var vm=this;vm.title="answerDetail";var voteRecordExists=!1,upVi=0,downVi=0,answers=[],recordsUpdated=!1,vrowsByUserCounter=0;vm.numEdits=0;var numImages=0,numImagesPage=0;vm.relativetable=[],vm.catans=[],vm.sm=$rootScope.sm,vm.votemode=!1,vm.dispRanks=3,vm.UpVote=UpVote,vm.DownVote=DownVote,vm.refresh=refresh,vm.goBack=goBack,vm.goPrev=goPrev,vm.goNext=goNext,vm.deleteAnswer=deleteAnswer,vm.flagAnswer=flagAnswer,vm.deleteButton=!1,vm.showUrl=showUrl,vm.closeRank=closeRank,vm.closeAnswerDetail=closeAnswerDetail,vm.rankSel=rankSel,vm.bizRegDialog=bizRegDialog,vm.openSpecials=openSpecials,vm.editVRows=editVRows,vm.getImages=getImages,vm.showsimage=showsimage,vm.gotoRank=gotoRank,vm.vrowVoteUp=vrowVoteUp,vm.vrowVoteDown=vrowVoteDown,vm.loadComments=loadComments,vm.postComment=postComment,vm.selectPhoto=selectPhoto,vm.cmFlag=cmFlag,vm.deleteThisCatans=deleteThisCatans,vm.addRankforAnswer=addRankforAnswer,vm.votemodeON=votemodeON,vm.votemodeOFF=votemodeOFF,vm.user=$rootScope.user,vm.endorseDialog=endorseDialog,vm.selectInstagramImages=selectInstagramImages,vm.showRanks=showRanks,vm.hideCustomRanks=hideCustomRanks,vm.hideGetPremium=hideGetPremium,vm.gotoMyBusiness=gotoMyBusiness,vm.share=share,vm.addvrow=addvrow,vm.moreImagesRev=moreImagesRev,vm.moreImagesFwd=moreImagesFwd,vm.showSpecial=showSpecial,vm.showLocations=showLocations,vm.navigateTowards=navigateTowards,vm.gotoCustomRank=gotoCustomRank,vm.backToResults=backToResults,vm.addCatans=addCatans,vm.addctsactive=!1,vm.addcts=addcts;var cObj={};cObj.commLoaded=!1,cObj.initials="",cObj.bc="",cObj.fc="",cObj.comments=[],cObj.newComment="",vm.cm=cObj,vm.commentAllowed=!0,vm.searchActive=$rootScope.searchActive;var answerFound=!1;vm.dataReady=!1,vm.isMobile=!1,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|ipad|iris|kindle|Android|Silk|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(navigator.userAgent)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(navigator.userAgent.substr(0,4)))&&(vm.isMobile=!0);var updateRecordsListener=$rootScope.$on("$stateChangeStart",function(ev,to,toParams,from,fromParams){"answerDetail"==from.name&&"answerDetail"!=to.name&&!recordsUpdated&&$rootScope.isLoggedIn&&answerFound&&updateRecords()}),refreshImagesListener=$rootScope.$on("refreshImages",function(){"answerDetail"==$state.current.name&&getImages()}),fileUploadedListener=$rootScope.$on("fileUploaded",function(){"answerDetail"==$state.current.name&&getImages()}),answerDataLoadedListener=$rootScope.$on("answerDataLoaded",function(){0==vm.dataReady&&checkAnswerExists()});$scope.$on("$destroy",refreshImagesListener),$scope.$on("$destroy",fileUploadedListener),$scope.$on("$destroy",answerDataLoadedListener),$scope.$on("$destroy",updateRecordsListener),vm.hideCustomRanksMsg=void 0!=$rootScope.hideCustomRankMsg&&$rootScope.hideCustomRankMsg,vm.hideGetPremiumMsg=void 0!=$rootScope.hideGetPremiumMsg&&$rootScope.hideGetPremiumMsg,window.prerenderReady=!1,checkAnswerExists()}angular.module("app").controller("answerDetail",answerDetail),answerDetail.$inject=["flag","$stateParams","$state","answer","dialog","$rootScope","$window","useractivity","htmlops","votes","matchrec","edit","editvote","catans","datetime","commentops","userdata","useraccnt","dataloader","$timeout","$location","vrows","vrowvotes","imagelist","instagram","$scope","table","SERVER_URL","$http","common","$cookies","$q","fbusers","InstagramService","mailing","Socialshare"]}(),function(){"use strict";function useruploadedimages($http,$q,$rootScope,uaf){function getRecords(){var url0=baseURI,p0=$http.get(url0);return $q.all([p0]).then(function(d){return _load(d[0].data.resource),$rootScope.DEBUG_MODE&&console.log("User uploaded images: ",_uuis.length),_uuis},_queryFailed)}function postRecord(item){function querySucceeded(result){var itemx=item;return itemx.id=result.data.resource[0].id,_uuis.push(itemx),uaf.post("postPhoto",["answer","text2"],[itemx.answer,itemx.imageurl]),$rootScope.DEBUG_MODE&&console.log("created uui record"),$rootScope.DEBUG_MODE&&console.log("result",result),result.data}var url=baseURI,resource=[];return resource.push(item),$http.post(url,resource,{headers:{"Content-Type":"multipart/form-data"},body:resource}).then(querySucceeded,_queryFailed)}function deleteRecord(id){function querySucceeded(result){return $rootScope.DEBUG_MODE&&console.log("Deleting uui record was succesful"),result.data}var obj={};obj.resource=[];var data={};data.id=id,obj.resource.push(data);var url=baseURI+"/"+id,i=_uuis.map(function(x){return x.id}).indexOf(id);return i>-1&&_uuis.splice(i,1),$http.delete(url,data,{headers:{"Content-Type":"multipart/form-data"},body:obj}).then(querySucceeded,_queryFailed)}function _load(data){_uuis.length=0,data.forEach(function(x){_uuis.push(x)})}function _queryFailed(error){throw error}var _uuis=[];$rootScope.uuis=_uuis;var baseURI="/api/v2/mysql/_table/useruploadedimages";return{getRecords:getRecords,postRecord:postRecord,deleteRecord:deleteRecord}}angular.module("app").factory("useruploadedimages",useruploadedimages),useruploadedimages.$inject=["$http","$q","$rootScope","uaf"]}(),function(){"use strict";function query($http,$q,$rootScope){function getQueries(forceRefresh){function querySucceeded(result){return _querys=result.data.resource}if(_areQueriesLoaded()&&!forceRefresh)return $q.when(_querys);var url=baseURI;return $http.get(url).then(querySucceeded,_queryFailed)}function postQuery(query,results){function querySucceeded(result){console.log("Creating new query record was succesful")}var obj={};obj.resource=[];var data={};data.query=query,data.results=results,data.timestmp=Date.now(),obj.resource.push(data);var url=baseURI;return $http.post(url,obj,{headers:{"Content-Type":"multipart/form-data"},body:obj}).then(querySucceeded,_queryFailed)}function flushAll(resource){function querySucceeded(result){console.log("Flushing queries db was succesful")}({}).resource=resource,console.log("obj ---",resource);var url=baseURI;return $http.delete(url,resource,{headers:{"Content-Type":"multipart/form-data"},body:resource}).then(querySucceeded,_queryFailed)}function deleteRec(id){function querySucceeded(result){return console.log("Deleting record was succesful"),result.data}var obj={};obj.resource=[];var data={};data.id=id,obj.resource.push(data);var url=baseURI+"/"+id;return $http.delete(url,data,{headers:{"Content-Type":"multipart/form-data"},body:obj}).then(querySucceeded,_queryFailed)}function _areQueriesLoaded(){return _querys.length>0}function _queryFailed(error){throw error}var _querys=[],baseURI="/api/v2/mysql/_table/queries";return{getQueries:getQueries,postQuery:postQuery,flushAll:flushAll,deleteRec:deleteRec}}angular.module("app").factory("query",query),query.$inject=["$http","$q","$rootScope"]}(),function(){"use strict";function codeprice($http,$q,$rootScope){function get(forceRefresh){function codepriceSucceeded(result){return _codeprices=result.data.resource}if(_areQueriesLoaded()&&!forceRefresh)return $q.when(_codeprices);var url=baseURI;return $http.get(url).then(codepriceSucceeded,_codepriceFailed)}function _areQueriesLoaded(){return _codeprices.length>0}function _codepriceFailed(error){throw error}var _codeprices=[],baseURI="/api/v2/mysql/_table/codeprice";return{get:get}}angular.module("app").factory("codeprice",codeprice),codeprice.$inject=["$http","$q","$rootScope"]}(),function(){"use strict";function categorycode($http,$q,$rootScope){function post(item){function querySucceeded(result){return $rootScope.DEBUG_MODE&&console.log("created new category-code paire"),result.data}var url=baseURI,resource=[];return resource.push(item),_categorycodes.push(item),$http.post(url,resource,{headers:{"Content-Type":"multipart/form-data"},body:resource}).then(querySucceeded,_categorycodeFailed)}function get(forceRefresh){function categorycodeSucceeded(result){return _categorycodes=result.data.resource}if(_areQueriesLoaded()&&!forceRefresh)return $q.when(_categorycodes);var url=baseURI;return $http.get(url).then(categorycodeSucceeded,_categorycodeFailed)}function update(rec_id,field,val){function querySucceeded(result){return $rootScope.DEBUG_MODE&&console.log("updating category code succesful"),result.data}var obj={};obj.resource=[];var data={};data.id=rec_id;for(var i=0;i<field.length;i++)switch(field[i]){case"category":data.category=val[i]}obj.resource.push(data);for(var url=baseURI,idx=_categorycodes.map(function(x){return x.id}).indexOf(rec_id),i=0;i<field.length;i++)switch(field[i]){case"category":_categorycodes[idx].category=val[i]}return $http.patch(url,obj,{headers:{"Content-Type":"multipart/form-data"},body:obj}).then(querySucceeded,_categorycodeFailed)}function _areQueriesLoaded(){return _categorycodes.length>0}function _categorycodeFailed(error){throw error}var _categorycodes=[],baseURI="/api/v2/mysql/_table/categorycode";return{get:get,post:post,update:update}}angular.module("app").factory("categorycode",categorycode),categorycode.$inject=["$http","$q","$rootScope"]}();