function calculateAge(e){var t=Date.now()-e.getTime(),n=new Date(t);return Math.abs(n.getUTCFullYear()-1970)}!function(){"use strict";angular.module("app",["color.picker","ngFileUpload","ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","ngMessages","pascalprecht.translate","tmh.dynamicLocale","login","ui.router","ui.bootstrap.modal","mgcrea.ngStrap","720kb.datepicker"])}(),function(){"use strict";function e(e){function t(t,i){for(var r=t.length,l=r*(r-1)/2,c=i.length,d=0,u=0,m=0,g=0,p=0;r>p;p++){n[p]=new Array(r),a[p]=new Array(r);for(var v=0;r>v;v++)n[p][v]=0,a[p][v]=0;s[p]=t[p].id}for(p=0;c>p;p++)d=s.indexOf(i[p].hs),u=s.indexOf(i[p].ls),d>=0&&u>=0&&(i[p].sel==i[p].hs?n[d][u]++:i[p].sel==i[p].ls&&n[u][d]++,a[d][u]++,a[u][d]++);for(m=0,p=0;r>p;p++)for(v=0;r>v;v++)m+=a[p][v];for(g=m/(4*l),p=0;r>p;p++){for(t[p].Rank=0,m=0,v=0;r>v;v++)t[p].Rank=t[p].Rank+n[p][v],m+=a[p][v];t[p].Rank=t[p].Rank/m,g>m&&(t[p].Rank=t[p].Rank*(m/g))}for(var f=0;r>f;f++)for(v=0;r>v;v++)f!=v&&t[v].Rank>=t[f].Rank&&n[f][v]>n[v][f]&&a[f][v]>=g&&(t[f].Rank=t[v].Rank+.01);o=t,e.answersR=o,e.R=n,e.GP=a,e.A=s}e.A=[];var n=[],a=[],s=[],o=[],i={computeRanking:t};return i}angular.module("app").service("rank",e),e.$inject=["$rootScope"]}(),function(){"use strict";function e(e,t,n){function a(t){function a(e){return n.DEBUG_MODE&&console.log("creating match record was succesful"),e.data}var s={};s.resource=[],s.resource.push(t),c.push.apply(c,t);var o=d;return e.post(o,t,{headers:{"Content-Type":"multipart/form-data"},body:s}).then(a,r)}function s(n){function a(e){return c=e.data.resource}if(l()&&!n)return t.when(c);var s=d;return e.get(s).then(a,r)}function o(t){function a(e){n.DEBUG_MODE&&console.log("deleting match records succesful")}for(var s=0;s<c.length;s++)(c[s].ls==t||c[s].hs==t)&&c.splice(s,1);var o=d+"?filter=(ls="+t+") OR (hs="+t+")";return e["delete"](o).then(a,r)}function i(t,a){function s(e){console.log("deleting match records category-hs pair succesful")}function o(e){n.DEBUG_MODE&&console.log("deleting match records category-ls pair succesful")}for(var i=0;i<c.length;i++)(c[i].ls==a||c[i].hs==a)&&c.splice(i,1);var l=d+"?filter=(category="+t+") AND (hs="+a+")";e["delete"](l).then(s,r);var u=d+"?filter=(category="+t+") AND (ls="+a+")";e["delete"](u).then(o,r)}function r(e){throw e}function l(){return c.length>0}var c=[],d="/api/v2/mysql/_table/matchtable",u={GetMatchTable:s,postRec:a,deleteRecordsbyAnswer:o,deleteRecordsbyCatans:i};return u}angular.module("app").factory("matchrec",e),e.$inject=["$http","$q","$rootScope"]}(),function(){"use strict";function e(e,t,n,a,s,o,i,r,l,c,d,u,m,g,p,v,f,h){function b(){d.scrollTo(0,0),m.$emit("showLogo"),m.rankIsActive=!0,m.objNumAct=m.objNum,C(),k(),A(),O(),i.computeRanking(m.canswers,m.cmrecs);for(var e=0;e<q.answers.length;e++)q.answers[e].Rank=e+1;if(P(),q.numcom=void 0==m.cCategory.numcom?0:m.cCategory.numcom,1==m.cCategory.isatomic&&!J)for(var e=0;e<q.answers.length;e++)q.answers[e].Rank!=q.answers[e].catansrank&&void 0!=q.answers[e].catans&&(m.DEBUG_MODE&&console.log("RS-1"),a.updateRec(q.answers[e].catans,["rank"],[q.answers[e].Rank]));if(1==m.cCategory.isatomic&&!J&&q.answers.length!=m.cCategory.answers&&q.answers.length>0){for(var t=q.answers[0].name,n=1;n<q.answers.length;n++)t=t+" "+q.answers[n].name;l.update(m.cCategory.id,["answertags"],[t])}0==q.answers.length&&(q.numAns=0,J||l.update(m.cCategory.id,["views","answers"],[m.cCategory.views+1,m.canswers.length])),1==q.answers.length&&(q.numAns=1,"Short-Phrase"==m.cCategory.type?(q.isShortPhrase=!0,q.title1=q.answers[0].name,q.addinfo1=q.answers[0].addinfo,q.image1=q.title1+"##"+q.title1):(q.isShortPhrase=!1,void 0!=q.answers[0].imageurl&&null!=q.answers[0].imageurl?(q.image1=q.answers[0].imageurl,q.image1ok=!0):q.image1ok=!1),J||l.update(m.cCategory.id,["views","answers","image1url"],[m.cCategory.views+1,m.canswers.length,q.image1])),2==q.answers.length&&(q.numAns=2,"Short-Phrase"==m.cCategory.type?(q.isShortPhrase=!0,q.title1=q.answers[0].name,q.addinfo1=q.answers[0].addinfo,q.image1=q.title1+"##"+q.title1,q.title2=q.answers[1].name,q.addinfo2=q.answers[1].addinfo,q.image2=q.title2+"##"+q.title2):(q.isShortPhrase=!1,void 0!=q.answers[0].imageurl&&null!=q.answers[0].imageurl?(q.image1=q.answers[0].imageurl,q.image1ok=!0):q.image1ok=!1,void 0!=q.answers[1].imageurl&&null!=q.answers[1].imageurl?(q.image2=q.answers[1].imageurl,q.image2ok=!0):q.image2ok=!1),J||l.update(m.cCategory.id,["views","answers","image1url","image2url"],[m.cCategory.views+1,m.canswers.length,q.image1,q.image2])),q.answers.length>2&&(q.numAns=3,"Short-Phrase"==m.cCategory.type?(q.isShortPhrase=!0,q.title1=q.answers[0].name,q.addinfo1=q.answers[0].addinfo,q.image1=q.title1+"##"+q.title1,q.title2=q.answers[1].name,q.addinfo2=q.answers[1].addinfo,q.image2=q.title2+"##"+q.title2,q.title3=q.answers[2].name,q.addinfo3=q.answers[2].addinfo,q.image3=q.title3+"##"+q.title3):(q.isShortPhrase=!1,void 0!=q.answers[0].imageurl&&null!=q.answers[0].imageurl?(q.image1=q.answers[0].imageurl,q.image1ok=!0):q.image1ok=!1,void 0!=q.answers[1].imageurl&&null!=q.answers[1].imageurl?(q.image2=q.answers[1].imageurl,q.image2ok=!0):q.image2ok=!1,void 0!=q.answers[2].imageurl&&null!=q.answers[2].imageurl?(q.image3=q.answers[2].imageurl,q.image3ok=!0):q.image3ok=!1),J||l.update(m.cCategory.id,["views","answers","image1url","image2url","image3url"],[m.cCategory.views+1,m.canswers.length,q.image1,q.image2,q.image3])),(J||H)&&S(),q.isE&&I(),J&&(q.showR=!1),J||q.isE||(q.showR=!0),m.DEBUG_MODE&&console.log("Rank Summary Loaded!")}function w(){m.canswers4rank=[];for(var e=0;e<m.cvotes.length;e++)if(1==m.cvotes[e].vote)for(var t=0;t<m.canswers.length;t++)m.cvotes[e].answer==m.canswers[t].id&&m.canswers4rank.push(m.canswers[t]);q.rankDisabled=m.canswers4rank.length>1?"":"disabled",q.commentAllowed=m.canswers4rank.length>0?!0:!1}function y(){v.loadVotesByUser().then(function(e){m.cvotes=e,w()})}function k(){if(m.canswers4rank=[],m.isLoggedIn){y();for(var e=0;e<m.editvotes.length;e++)if(m.editvotes[e].category==m.cCategory.id){var t=m.editvotes[e];m.ceditvotes.push(t)}m.cmrecs_user=[];for(var e=0;e<m.cmrecs.length;e++)m.cmrecs[e].user==m.user.id&&m.cmrecs_user.push(m.cmrecs[e])}}function x(e){n.go("answerDetail",{index:e.id})}function D(){if(m.isLoggedIn){if(!(m.canswers4rank.length>1))return void e.getDialog("answersFew");n.go("match")}else e.getDialog("notLoggedIn")}function E(){return m.isLoggedIn?Y?void e.getDialog("answersFull"):void("Event"==q.type?(m.eventmode="add",n.go("addEvent")):n.go("addAnswer")):void e.getDialog("notLoggedIn")}function C(){m.cCategory={};for(var e=0;e<m.content.length;e++)if(m.content[e].id==t.index){m.cCategory=m.content[e];break}q.ranking=m.cCategory.title,m.rankIsNearMe&&(q.ranking=q.ranking.replace("in San Diego","close to me")),9521==m.cCategory.id&&(J=!0,q.fnm=!0,q.showR=!1);var n=0;switch(m.cCategory.type){case"Place":n=0;break;case"Person":n=1;break;case"Event":n=2;break;case"Organization":n=3;break;case"Short-Phrase":n=4;break;case"Activity":n=5;break;case"Establishment":n=6;break;case"Thing":n=7;break;case"PersonCust":n=8}var o=m.typeSchema[n].fields;if(m.fields=o,q.fields=m.fields,q.type=m.cCategory.type,q.isE="Event"==q.type?!0:!1,m.NhImplied=!1,m.NhValue="","Establishment"==m.cCategory.type||"Event"==m.cCategory.type)for(var i=m.neighborhoods.concat(m.districts),e=0;e<i.length;e++)if(m.cCategory.title.indexOf(i[e])>-1){m.NhImplied=!0,m.NhValue=i[e];break}if(q.sm)for(var e=0;e<q.fields.length;e++)"cityarea"==q.fields[e].name&&(q.fields[e].isrequired=!1),"upV"==q.fields[e].name&&(q.fields[e].isrequired=!1),"email"==q.fields[e].name&&(q.fields[e].isrequired=!1);m.answers=F,m.canswers=[];var r=[];m.ccatans=[],m.B=[];var l={},c={},d=!0;if(J&&void 0==m.fanswers){for(var e=0;e<j.length;e++)for(var u=j[e],g=0,p=0,v=!1,f={},h=0,b=m.foodranks.cats.split(":").map(Number),w=0;w<b.length;w++)if(u.category==b[w]){if(g=u.answer,p=m.answers.map(function(e){return e.id}).indexOf(g),0>p&&(console.log("idx - ",g,"catansrec - ",u.id,u.answer,u.category),a.deleteRec(u.answer,u.category)),v=!1,r.length>0&&p>0)for(var y=0;y<r.length;y++)if(r[y].id==m.answers[p].id){v=!0,h=y;break}v||(f=m.answers[p],f.upV=u.upV,r.push(f)),v&&(r[h].upV=r[h].upV+u.upV)}m.canswers=r,m.fanswers=r}if(!J)for(var e=0;e<j.length;e++)if(m.cCategory.isatomic){if(j[e].category==m.cCategory.id)for(var k=0;k<F.length;k++)if(j[e].answer==F[k].id){if(c={},c=F[k],c.catans=j[e].id,c.catansrank=j[e].rank,c.upV=j[e].upV,"Event"==q.type){if(l=JSON.parse(F[k].eventstr),N(F[k],l),d=s.eventIsCurrent(c,F[k])){m.canswers.push(c),m.ccatans.push(j[e]),m.B.push(j[e].id);break}break}m.canswers.push(c),m.ccatans.push(j[e]),m.B.push(j[e].id);break}}else for(var x=m.cCategory.catstr.split(":").map(Number),y=0;y<x.length;y++)if(j[e].category==x[y])for(var k=0;k<F.length;k++)if(j[e].answer==F[k].id&&1!=j[e].isdup){if(c={},c=F[k],c.catans=j[e].id,c.catansrank=j[e].rank,c.upV=j[e].upV,"Event"==q.type){if(l=JSON.parse(F[k].eventstr),N(F[k],l),d=s.eventIsCurrent(c,F[k])){m.canswers.push(c),m.ccatans.push(j[e]),m.B.push(j[e].id);break}break}m.canswers.push(c),m.ccatans.push(j[e]),m.B.push(j[e].id);break}J&&m.fanswers&&(m.canswers=m.fanswers),q.answers=m.canswers;for(var D=.017453292519943295,E=Math.cos,C=0,A=m.currentUserLatitude,R=m.currentUserLongitude,M=0,P=0,S=0,e=0;e<q.answers.length;e++)M=q.answers[e].lat,P=q.answers[e].lng,C=.5-E((M-A)*D)/2+E(A*D)*E(M*D)*(1-E((P-R)*D))/2,S=12742*Math.asin(Math.sqrt(C))/1.609,q.answers[e].dist=S.toPrecision(1>S?2:3);q.haveLocation=!0,q.answers.length>0&&(q.haveLocation=isNaN(q.answers[0].dist)?!1:!0);for(var O=new Date,I=O.getDay(),$=!1,w=0;w<q.answers.length;w++){$=!1;for(var e=0;e<m.specials.length;e++)if(q.answers[w].id==m.specials[e].answer&&"weekly"==m.specials[e].freq&&(0==I&&m.specials[e].sun&&($=!0),1==I&&m.specials[e].mon&&($=!0),2==I&&m.specials[e].tue&&($=!0),3==I&&m.specials[e].wed&&($=!0),4==I&&m.specials[e].thu&&($=!0),5==I&&m.specials[e].fri&&($=!0),6==I&&m.specials[e].sat&&($=!0),$)){q.answers[w].sp_bc=m.specials[e].bc,q.answers[w].sp_fc=m.specials[e].fc,q.answers[w].sp_title=m.specials[e].stitle;break}}m.cmrecs=[];for(var e=0;e<W.length;e++)W[e].category==m.cCategory.id&&m.cmrecs.push(W[e]);m.cuseractivity=[];for(var e=0;e<z.length;e++)z[e].category==m.cCategory.id&&m.cuseractivity.push(z[e]);q.numContributors=m.cuseractivity.length,q.isLoading=!1}function A(){Y=m.canswers.length>=30?!0:!1}function R(){m.isLoggedIn?m.cmrecs_user.length>0?(q.selOverall="",q.selPersonal="active",q.numContributors=1,i.computeRanking(m.canswers,m.cmrecs_user)):e.getDialog("noPersonalRank"):e.getDialog("notLoggedIn")}function M(){q.selOverall="active",q.selPersonal="",q.numContributors=m.cuseractivity.length,i.computeRanking(m.canswers,m.cmrecs)}function P(){function e(e,t){return e.Rank-t.Rank}q.answers=q.answers.sort(e),V(),m.canswers=q.answers,q.selRank="active",q.selDistance="",q.selUpV="",q.selDate="",q.showR=!0}function S(){function t(e,t){return e.dist-t.dist}q.haveLocation?(q.answers=q.answers.sort(t),V(),m.canswers=q.answers,q.selRank="",q.selDistance="active",q.selUpV="",q.selDate="",J&&(q.answers=q.answers.slice(0,99))):(m.loadRankWhenCoordsRdy=!0,e.askPermissionToLocate())}function O(){function e(e,t){return t.upV-e.upV}q.answers=q.answers.sort(e),V(),m.canswers=q.answers,q.selRank="",q.selDistance="",q.selUpV="active",q.selDate="",J||q.isE||(q.showR=!1||!q.sm)}function I(){function e(e,t){var n=s.date2number(e.date),a=s.date2number(t.date);return n-a}q.answers=q.answers.sort(e),V(),m.canswers=q.answers,q.selRank="",q.selDistance="",q.selUpV="",q.selDate="active"}function $(){f.loadComments("category",X)}function L(){f.postComment("category",X)}function V(){q.image1="/assets/images/noimage.jpg",q.image2="/assets/images/noimage.jpg",q.image3="/assets/images/noimage.jpg",q.answers[0]&&(q.image1=q.answers[0].imageurl),q.answers[1]&&(q.image2=q.answers[1].imageurl),q.answers[2]&&(q.image3=q.answers[2].imageurl)}function _(){n.go("cwrapper")}function U(){m.addInfoMsgAck=!0,q.addInfoMsgAck=!0}function B(){e.getLocation(T)}function T(){m.$emit("getLocation")}function N(e,t){e.bc=t.bc,e.fc=t.fc,e.freq=t.freq,e.edate=t.edate,e.sdate=t.sdate,e.etime=t.etime,e.etime2=t.etime2,e.stime=t.stime,e.stime2=t.stime2,e.mon=t.mon,e.tue=t.tue,e.wed=t.wed,e.thu=t.thu,e.fri=t.fri,e.sat=t.sat,e.sun=t.sun}function G(t){return m.isLoggedIn?(m.DEBUG_MODE&&console.log("Comment Flagged"),h.flagAnswer("comment-rank",m.cCategory.id,t),void e.getDialog("commentFlagged")):void e.getDialog("notLoggedIn")}var q=this;q.title="rankSummary",q.addAnswerDisabled="",q.answerDetail=x,q.addAnswer=E,q.goRank=D,q.closeRank=_,q.rankOverall=M,q.rankPersonal=R,q.closeAddInfoMsg=U,q.whyNoDistance=B,q.sortByRank=P,q.sortByDistance=S,q.sortByUpV=O,q.sortByDate=I,q.loadComments=$,q.postComment=L,q.cmFlag=G,q.selOverall="active",q.selPersonal="",q.selRank="active",q.selDistance="",q.commLoaded=!1;m.cvotes=[],m.ceditvotes=[],m.cmrecs_user=[];var F=m.answers,j=m.catansrecs,z=m.alluseractivity,W=m.mrecs,Y=!1,K=!1,J=!1,H=!1;q.fnm=!1;var X={};X.commLoaded=!1,X.initials="",X.bc="",X.fc="",X.comments=[],X.newComment="",q.cm=X,q.isLoggedIn=void 0==m.isLoggedIn?!1:m.isLoggedIn,m.userHasRank=!1,m.userActRecId=0;q.addInfoMsgAck=m.addInfoMsgAck?m.addInfoMsgAck:!1,m.$on("$stateChangeSuccess",function(e,t,n,a,s){m.previousState=a.name}),m.$on("updateVoteTable",function(){K||y(),K=!0}),d.innerWidth<512?(q.sm=!0,q.nsm=!1):(q.sm=!1,q.nsm=!0),null!=document.getElementById("SearchInput")&&void 0!=document.getElementById("SearchInput")&&document.getElementById("SearchInput").blur(),b()}angular.module("app").controller("rankSummary",e),e.$inject=["dialog","$stateParams","$state","catans","datetime","answer","rank","$filter","table","vrowvotes","$window","vrows","$rootScope","$modal","editvote","votes","commentops","flag"]}(),function(){"use strict";function e(e,t,n,a,s,o,i,r){function l(){s.$on("$stateChangeSuccess",function(e,t,n,a,o){s.previousState=a.name}),s.$on("$stateChangeStart",function(e,t,n,a,s){"match"==a.name&&M.length>0&&(o.postRec(M),M=[])}),u(),v(),f(),m()}function c(e){if(!s.isLoggedIn)return void t.getDialog("notLoggedIn");var n={};n.user=s.user.id,n.hs=w.answer1.id,n.ls=w.answer2.id,n.category=s.cCategory.id,n.timestmp=Date.now(),1==e&&(n.sel=w.answer1.id),2==e&&(n.sel=w.answer2.id),M.push(n),s.cmrecs_user.push(n),A++,A>=E&&(A=0),P=!0,m()}function d(){A++,A>=E&&(A=0),m()}function u(){x=s.canswers4rank,D=x.length,E=D*(D-1)/2}function m(){if(w.GP=s.cmrecs_user.length,console.log("vm.GP - ",w.GP),w.Tot=E,s.cmrecs_user.length>=E)return t.getDialog(P?"goodJobRankComplete":"rankComplete"),void g();if(R)for(var e=y[C[A]],n=k[C[A]],a=!1,o=0;o<s.cmrecs_user.length;o++)if(s.cmrecs_user[o].hs==x[e].id&&s.cmrecs_user[o].ls==x[n].id){a=!0;break}a&&d(),w.answer1=x[y[C[A]]],w.answer2=x[k[C[A]]],h()}function g(){e.go("rankSummary",{index:w.table.id})}function p(t){1===t?e.go("answerDetail",{index:w.answer1.id}):e.go("answerDetail",{index:w.answer2.id})}function v(){y=[],k=[];for(var e=0;D-1>=e;e++)for(var t=e+1;D-1>=t;t++)y.push(e),k.push(t)}function f(){function e(e){var t,n,a=e.length;if(a)for(;--a;)n=Math.floor(Math.random()*(a+1)),t=e[n],e[n]=e[a],e[a]=t;return e}for(var t=0;E>t;t++)C[t]=t;C=e(C)}function h(){w.fields=s.fields}function b(){e.go("cwrapper")}var w=this;w.title="match",w.header="table"+s.cCategory.id+".header",w.body="table"+s.cCategory.id+".body",w.ranking=s.title;var y=[],k=[],x=[],D=0,E=0,C=[],A=0,R=s.cmrecs_user.length>0,M=[],P=!1;w.table=s.cCategory,w.type=s.cCategory.type,w.answer1,w.answer2,w.selectAnswer=c,w.rankSummary=g,w.skipMatch=d,w.answerDetail=p,w.closeRank=b,l()}angular.module("app").controller("match",e),e.$inject=["$state","dialog","$location","answer","$rootScope","matchrec","$modal","useractivity"]}(),function(){"use strict";function e(e,t,n,a,s,o,i,r){function l(){t.cCategory={};for(var e=0;e<t.content.length;e++)if(t.content[e].id==a.index){t.cCategory=t.content[e];break}p.ranking=t.cCategory.title,t.rankIsActive=!0,t.objNumAct=t.objNum,c(),t.DEBUG_MODE&&console.log("editRanking page Loaded!")}function c(){t.cCategory={};for(var e=0;e<t.content.length;e++)if(t.content[e].id==a.index){t.cCategory=t.content[e];break}p.rankTitle=t.cCategory.title,p.tags=t.cCategory.tags,p.keywords=t.cCategory.keywords,p.type=t.cCategory.type,p.question=t.cCategory.question,p.answertags=t.cCategory.answertags,p.isatomic=t.cCategory.isatomic,p.catstr=t.cCategory.catstr}function d(){n.go("cwrapper")}function u(){var e=JSON.parse(JSON.stringify(t.cCategory)),n=[],a=[];e.title!=p.rankTitle&&(n.push("title"),a.push(p.rankTitle)),e.tags!=p.tags&&(n.push("tags"),a.push(p.tags)),e.keywords!=p.keywords&&(n.push("keywords"),a.push(p.keywords)),e.type!=p.type&&(n.push("type"),a.push(p.type)),e.question!=p.question&&(n.push("question"),a.push(p.question)),e.answertags!=p.answertags&&(n.push("answertags"),a.push(p.answertags)),e.isatomic!=p.isatomic&&(n.push("isatomic"),a.push(p.isatomic)),e.catstr!=p.catstr&&(n.push("catstr"),a.push(p.catstr)),o.update(e.id,n,a),d()}function m(){i.deleteRank(g)}function g(){o.deleteTable(t.cCategory.id),r.deletebyCategory(t.cCategory.id)}var p=this;p.title="editRanking",p.closeRank=d,p.goEdit=u,p.goDelete=m,p.typeList=["Person","Establishment","Place","Activity","Short-Phrase","Organization","Event","Thing","PersonCust"],s.innerWidth<512?(p.sm=!0,p.nsm=!1):(p.sm=!1,p.nsm=!0),l()}angular.module("app").controller("editRanking",e),e.$inject=["$location","$rootScope","$state","$stateParams","$window","table","dialog","catans"]}(),function(){"use strict";function e(e,t,n,a,s){function o(){var o=e.dataLoaded?e.dataLoaded:!1;if(e.isLoggedIn&&!o){void 0==e.cvotes&&t.loadVotesByUser().then(function(t){e.cvotes=t}),void 0==e.editvotes&&n.loadEditVotesTable().then(function(t){e.editvotes=t}),void 0==e.cvrowvotes&&a.loadVrowVotes().then(function(t){e.cvrowvotes=t}),e.thisuseractivity=[];for(var i=0;i<e.alluseractivity.length;i++)e.alluseractivity[i].user==e.user.id&&e.thisuseractivity.push(e.alluseractivity[i]);s.getuseraccnt().then(function(t){if(e.useraccnts=t,e.showWarning=!1,e.useraccnts.length>0){for(var n=!0,a=0;a<e.useraccnts.length;a++)""!=e.useraccnts[a].email&&(n=!1);n?(e.showWarning=!0,e.$emit("showWarning")):e.showWarning=!1}}),e.dataLoaded=!0}}var i={loadVotes:o};return i}angular.module("app").service("userdata",e),e.$inject=["$rootScope","votes","editvote","vrowvotes","useraccnt"]}(),function(){"use strict";function e(e,t,n,a){function s(a){function s(e){return d=e.data.resource}if(l()&&!a)return t.when(d);var o=u+"?filter=(user="+n.user.id+")";return e.get(o).then(s,c)}function o(){function t(e){var t=s;return t.id=e.data.resource[0].id,d.push(t),console.log("User account successfully added."),e.data}console.log("START useraccnt.srvc.js:adduseraccnt");var n=a.getUserObjectFromLocalStorage(),s={};s.user=n.id,s.answer="",s.bizcat="REB",s.status="Non-paying",s.stripeid="dskjflskdjflskjd",s.email=n.email;var o={};o.resource=[],o.resource.push(s);var i=u;return e.post(i,o,{headers:{"Content-Type":"multipart/form-data"},body:o}).then(t,c)}function i(t,a,s){function o(e){return console.log("User account successfully updated."),n.$emit("clear-notification-warning"),e.data}var i={};i.resource=[];var r={};r.id=t;for(var l=0;l<a.length;l++)switch(a[l]){case"bizcat":r.bizcat=s[l];break;case"email":r.email=s[l];break;case"status":r.status=s[l];break;case"stripeid":r.stripeid=s[l]}i.resource.push(r);for(var m=u,g=d.map(function(e){return e.id}).indexOf(t),l=0;l<a.length;l++)switch(a[l]){case"bizcat":d[g].bizcat=s[l];break;case"email":d[g].email=s[l];break;case"status":d[g].status=s[l];break;case"stripeid":d[g].stripeid=s[l]}return e.patch(m,i,{headers:{"Content-Type":"multipart/form-data"},body:i}).then(o,c)}function r(){o()}function l(){return d.length>0}function c(e){throw e}var d=[],u="/api/v2/mysql/_table/useraccnts",m={getuseraccnt:s,adduseraccnt:o,updateuseraccnt:i,setupFreeBillingAccount:r};return m}angular.module("app").factory("useraccnt",e),e.$inject=["$http","$q","$rootScope","login"]}(),function(){"use strict";function e(e,t,n,a,s){function o(t){return e.post("/api/v2/user/session",t).then(function(t){e.defaults.headers.common["X-DreamFactory-Session-Token"]=t.data.session_token,n.session_token=t.data.session_token,a.user=t.data;try{window.localStorage.user=JSON.stringify(t.data)}catch(s){}})}function i(){var e=t.defer(),n=s+"/api/v2/user/session?service=facebook";return e.resolve({url:n}),e.promise}function r(t){function s(t){console.log("oauth results",t),e.defaults.headers.common["X-DreamFactory-Session-Token"]=t.data.session_token,n.session_token=t.data.session_token,a.user=t.data;try{window.localStorage.user=JSON.stringify(t.data)}catch(s){}}return e.post("/api/v2/user/session?oauth_callback=true&service=facebook&"+t).then(s,c)}function l(){return e["delete"]("/api/v2/user/session").then(function(t){delete e.defaults.headers.common["X-DreamFactory-Session-Token"],n.remove("session_token"),delete a.user,a.isLoggedIn=!1;try{window.localStorage.removeItem("user")}catch(s){}})}function c(e){throw console.log("error",e),e}function d(t){return console.log("options",t),e.post("/api/v2/user/register?login=true",t).then(function(e){console.log("register result",e)},function(e){console.log("error",e)})}function u(){var e={};try{var t=JSON.parse(localStorage.getItem("user"));e.email=t.email,document.write(t.surname+", "+t.firstname)}catch(n){}return console.log("login.svc.js:getUserObjectFromLocalStorage"),console.log("your user object looks like this: "),console.log(e),e}function m(){var t=new Object;t.email="10154674551822270+facebook@facebook.com",t.first_name="Sandon",t.host="bitnami-dreamfactory-df88",t.id=29,t.is_sys_admin=!1,t.last_login_date="2016-12-13 21:04:47",t.last_name="Jurowski",t.name="Sandon Jurowski",t.role="rank-user",t.role_id=1,t.session_id="eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJzdWIiOjI5LCJ1c2VyX2lkIjoyOSwiZW1haWwiOiIxMDE1NDY3NDU1MTgyMjI3MCtmYWNlYm9va0BmYWNlYm9vay5jb20iLCJmb3JldmVyIjpmYWxzZSwiaXNzIjoiaHR0cHM6XC9cL2FwaS5yYW5rLXguY29tXC9hcGlcL3YyXC91c2VyXC9zZXNzaW9uIiwiaWF0IjoxNDgxNjYzMDg3LCJleHAiOjE0ODE2NjY2ODcsIm5iZiI6MTQ4MTY2MzA4NywianRpIjoiYWQ2M2Q0OTI1MDRmNTJiYjBkMWZiZjJkNzAxMjQzNDMifQ.T-3B-jnz4d2Q2Q5rfN1ePF7ujin982gzPYbRwhLo9Uc",t.session_token="eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJzdWIiOjI5LCJ1c2VyX2lkIjoyOSwiZW1haWwiOiIxMDE1NDY3NDU1MTgyMjI3MCtmYWNlYm9va0BmYWNlYm9vay5jb20iLCJmb3JldmVyIjpmYWxzZSwiaXNzIjoiaHR0cHM6XC9cL2FwaS5yYW5rLXguY29tXC9hcGlcL3YyXC91c2VyXC9zZXNzaW9uIiwiaWF0IjoxNDgxNjYzMDg3LCJleHAiOjE0ODE2NjY2ODcsIm5iZiI6MTQ4MTY2MzA4NywianRpIjoiYWQ2M2Q0OTI1MDRmNTJiYjBkMWZiZjJkNzAxMjQzNDMifQ.T-3B-jnz4d2Q2Q5rfN1ePF7ujin982gzPYbRwhLo9Uc",console.log("oauth fake setting",t),e.defaults.headers.common["X-DreamFactory-Session-Token"]=t.session_token,n.session_token=t.session_token,a.user=t;try{return window.localStorage.user=JSON.stringify(t),{email:t.email,first_name:t.first_name,host:t.host,id:t.id,is_sys_admin:t.is_sys_admin,last_login_date:t.last_login_date,last_name:t.last_name,name:t.name,role:t.role,role_id:t.role_id,session_id:t.session_id,session_token:t.session_token}}catch(s){}}var g={initiate:o,loginWithFacebook:i,oauthWithFacebook:r,register:d,logout:l,getUserObjectFromLocalStorage:u,setFakeLocalUser:m};return g}angular.module("app").factory("login",e),e.$inject=["$http","$q","$cookies","$rootScope","INSTANCE_URL"]}(),function(){"use strict";angular.module("login",["ngResource","ngCookies","ui.router"]).run(["$rootScope",function(e){try{e.user=JSON.parse(window.localStorage.user),e.user&&(e.isLoggedIn=!0)}catch(t){}}]).config(function(){})}(),function(){"use strict";function e(e,t,n,a){function s(e){return e.url.indexOf("/api/v2")>-1&&(e.url=a+e.url),"post"===e.method.toLowerCase()&&e.url.indexOf("/api/v2/user/session")>-1&&delete e.headers["X-DreamFactory-Session-Token"],e}function o(n){return console.log("result",n),302==n.status?(console.log("result",n),e.path("/login"),t.reject(n)):((401===n.status||403===n.status&&n.data.error.message.indexOf("token")>-1)&&e.path("/login"),t.reject(n))}var i={request:s,responseError:o};return i}angular.module("login").factory("httpInterceptor",e),e.$inject=["$location","$q","$injector","INSTANCE_URL"]}(),function(){"use strict";function e(e,t,n){function a(){t.isLoggedIn=!1}function s(){console.log("register",s),n.register({email:i.username,password:i.password,first_name:i.firstName||"Address",last_name:i.lastName||"Book"}).then(function(){e.path("/bizlogin")},function(e){i.message=e.Message,console.log("Error: ",e)})}function o(){e.path("/bizlogin")}var i=this;i.title="register",i.username="",i.password="",i.confirm="",i.firstName="",i.lastName="",i.message="",i.register=s,i.signIn=o,a()}angular.module("login").controller("register",e),e.$inject=["$location","$rootScope","login"]}(),function(){"use strict";function e(e,t,n,a,s,o){function i(){var t=location.search,s=t.lastIndexOf("?");s>=0&&(t=t.substr(s+1)),t&&(m.isProgressing=!0,a.oauthWithFacebook(t).then(function(t){n.isLoggedIn=!0,console.log("isLoggedIn",n.isLoggedIn),e.path("/"),o.go("cwrapper",{},{location:"replace"})},function(){m.isProgressing=!1})),console.log("vm.code",m.code),n.isLoggedIn=!1}function r(){console.log("submit"),a.initiate({email:m.username,password:m.password}).then(function(){n.isLoggedIn=!0,console.log("isLoggedIn",n.isLoggedIn),e.path("/")})}function l(){a.loginWithFacebook().then(function(e){console.log("result @loginWithFacebook - ",e),t.location=e.url})}function c(){e.path("/register")}function d(){o.go("cwrapper")}function u(){s.getDialog("whyFacebook")}var m=this;m.title="login",m.username="",m.password="",m.code="",m.isProgressing=!1,m.submit=r,m.register=c,m.redirectForFacebook=l,m.whyFacebookDialog=u,m.goBack=d,"localhost"==window.location.hostname&&(console.log("server is: "+window.location.hostname),console.log("let's fake your user as an FB login"),a.setFakeLocalUser()),n.isLoggedIn?o.go("cwrapper"):i()}angular.module("login").controller("login",e),e.$inject=["$location","$window","$rootScope","login","dialog","$state"]}(),function(){"use strict";function e(e,t,n,a,s,o,i){function r(){var e=location.search,t=e.lastIndexOf("?");t>=0&&(e=e.substr(t+1)),e&&(c.isProgressing=!0,a.oauthWithFacebook(e).then(function(e){n.isLoggedIn=!0,console.log("isLoggedIn",n.isLoggedIn),i.go("cwrapper",{},{location:"replace"})},function(){c.isProgressing=!1})),console.log("vm.code bizlogin --",c.code),n.isLoggedIn=!1}function l(){console.log("bizlogin - submit"),a.initiate({email:c.username,password:c.password}).then(function(){n.isLoggedIn=!0,console.log("isLoggedIn",n.isLoggedIn),i.go("cwrapper",{},{location:"replace"})})}var c=this;c.title="bizlogin",c.username="",c.password="",c.code="",c.isProgressing=!1,c.submit=l,r()}angular.module("login").controller("bizlogin",e),e.$inject=["$location","$window","$rootScope","login","dialog","userDetail","$state"]}(),angular.module("app").directive("userDetailModal",["$rootScope","userDetail","dialog",function(e,t,n){"use strict";return{restrict:"E",templateUrl:"app/login/partials/add-user-detail.html",link:function(a,s,o,i){a.maxDate=moment().format("YYYY-MM-DD"),e.openUserDetailModal=function(){e.user&&(e.user.gender="Male",e.user.birth_date=""),openModal("#addUserDetailModal")},e.addUserDetail=function(){t.addUserDetail().then(function(n){t.getUserDetail().then(function(t){if(0==Object.keys(t).length)e.openUserDetailModal();else{e.user.age=calculateAge(new Date(t[0].birth_date)),e.user.gender=t[0].gender,e.user.birth_date=t[0].birth_date;try{window.localStorage.user=JSON.stringify(e.user)}catch(n){}}}),closeModal("#addUserDetailModal")})},e.whyThisInfoDialog=function(){n.getDialog("whyUserData")},e.user&&(e.user.birth_date&&e.user.gender||e.openUserDetailModal())}}}]),function(){"use strict";function e(e,t,n){function a(n){function a(e){return i=e.data.resource}if(s()&&!n)return t.when(i);var l=r;return e.get(l).then(a,o)}function s(){return i.length>0}function o(e){throw e}var i=[],r="/api/v2/mysql/_table/cities",l={getCities:a};return l}angular.module("app").factory("city",e),e.$inject=["$http","$q","$rootScope"]}(),angular.module("app").directive("citySelectionModal",["$rootScope",function(e){"use strict";return{restrict:"E",templateUrl:"app/layout/Partials/city-selection.html",link:function(t,n,a,s){e.selectedCity=JSON.parse(window.localStorage.selectedCity)}}}]),function(){"use strict";function e(e,t,n,a,s,o,i,r,l,c,d){function u(){n.showWarning&&C(),E(),S.coordsRdy=n.coordsRdy,n.DEBUG_MODE&&console.log("Navbar Loaded!")}function m(){s.go("mybiz")}function g(){s.go("about")}function p(){s.go("fileuploadtest")}function v(){s.go("admin")}function f(){n.fbmode=!0,s.go("cwrapper",{},{reload:!0})}function h(){n.fbmode=!1,s.go("cwrapper",{},{reload:!0}),n.$emit("mainView")}function b(){s.go("customer")}function w(){e.path("/login")}function y(){a.logout().then(function(){S.user="",S.isLoggedIn=!1,s.go("cwrapper",{},{location:"replace"})})}function k(){openModal("#selectCityModal")}function x(e){n.DEBUG_MODE&&console.log("position.coords.latitude - ",e.coords.latitude),n.DEBUG_MODE&&console.log("position.coords.longitude - ",e.coords.longitude),n.currentUserLatitude=e.coords.latitude,n.currentUserLongitude=e.coords.longitude,i.put("currentUserLatitude",n.currentUserLatitude),i.put("currentUserLongitude",n.currentUserLongitude),n.coordsRdy=!0,R(),n.loadFbnWhenCoordsRdy&&s.go("rankSummary",{index:9521}),n.isLoggedIn&&(n.user.latitude=n.currentUserLatitude,n.user.longitude=n.currentUserLongitude,n.DEBUG_MODE&&console.log("Geo Location is set for logged in user.")),n.DEBUG_MODE&&console.log("Geo Location is set for user."),"rankSummary"==s.current.name&&s.reload()}function D(){n.DEBUG_MODE&&console.log("@autoDetectCity"),geolocator.locate(O,function(e,t){e?(n.DEBUG_MODE&&console.log("Error getting geolocation - ERROR("+e.code+"): "+e.message),c.getDialog("errorGettingGeolocation")):(n.DEBUG_MODE&&console.log(t),x(t))})}function E(){geolocator.config({language:"en",google:{version:"3",key:l}}),O={enableHighAccuracy:!0,timeout:1e4,maximumWait:1e4,maximumAge:0,desiredAccuracy:30,fallbackToIP:!0}}function C(){S.warning=!0}function A(){S.warning=!1}function R(){S.coordsRdy=!0}function M(){var e=n.answers.map(function(e){return e.id}).indexOf(n.useraccnts[0].answer);c.askEmail(n.answers[e].name)}function P(){c.askPermissionToLocate()}var S=this;S.title="navbar",S.user=n.user,S.isLoggedIn=n.isLoggedIn?n.isLoggedIn:!1,S.logout=y,S.goToLogin=w,S.gotoAbout=g,S.gotomybiz=m,S.gotoFeedback=f,S.gotoHome=h,S.gotoAdmin=v,S.gotoFileUpload=p,S.gotoCustomer=b,S.openCitySelection=k,S.goWarning=M,S.goCoords=P,void 0==n.coordsRdy&&(n.coordsRdy=!1),n.loadFbnWhenCoordsRdy=!1;var O={};S.warning=!1,u(),n.$on("getLocation",function(e){D()}),n.$on("coordsRdy",function(e){R()}),n.$on("showWarning",function(e){console.log("rx showWarning"),C()}),n.$on("hideWarning",function(e){console.log("rx clearWarning"),A()}),n.$on("useAddress",function(e,t){var a={};a.location=t.address,a.lat=0,a.lng=0,n.coordForUSer=!0,d.getLocationGPS(a)}),n.getCurrentPositionOfUser=function(){geolocator.locate(O,function(e,t){e?(n.DEBUG_MODE&&console.log("Error getting geolocation - ERROR("+e.code+"): "+e.message),c.getDialog("errorGettingGeolocation")):(n.DEBUG_MODE&&console.log(t),x(t))})}}angular.module("app").controller("navbar",e),e.$inject=["$location","$translate","$rootScope","login","$state","city","$cookieStore","$http","GOOGLE_API_KEY","dialog","getgps"]}(),function(){"use strict";function e(e,t,n,a){function s(){console.log("mybiz page Loaded!")}function o(){console.log("mybiz.ctrl.js calling useraccnt.setupFreeBillingAccount()")}function i(){t.go("cwrapper")}var r=this;r.title="mybiz",r.goBack=i,r.setupFreeBillingAccount=o,s()}angular.module("app").controller("mybiz",e),e.$inject=["$location","$state","$window","useraccnt"],console.write}(),function(){"use strict";function e(e,t,n,a,s,o,i,r,l,c,d,u,m,g,p,v,f,h,b,w,y,k){function x(){
t.DEBUG_MODE=i,void 0==t.dataIsLoaded&&(A.isLoading=!0,D()),t.DEBUG_MODE&&console.log("Layout Loaded!")}function D(){t.neighborhoods=["Downtown","La Jolla","Pacific Beach","Hillcrest","University Heights","Old Town","Del Mar","Ocean Beach","North Park","Mission Hills","Barrio Logan","City Heights","Clairemont","La Mesa","Point Loma","South Park","Scripps Ranch","Mission Beach","Mission Valley","Kensington","Cardiff by the Sea","Coronado","Leucadia","Oceanside","National City","Rancho Santa Fe","Solana Beach","Poway","El Cajon","Escondido","Carlsbad","San Ysidro","Otay Mesa","Linda Vista","Chula Vista","Encinitas","Golden Hills","Spring Valley","Rancho San Diego","Mira Mesa","Torrey Pines","Carmel Valley","Miramar","Kearny Mesa","Bankers Hill","Rancho Penasquitos","Sorrento Valley","Tierra Santa","Logan Heights","Serra Mesa","Normal Heights","Talmadge","Bird Rock","South San Diego","North City","San Carlos","Del Cerro","Grantville"],t.districts=["Columbia","Core","Cortez Hill","East Village","Gaslamp Quarter","Horton Plaza","Little Italy","Marina","Seaport Village"],s.get("../../../assets/fields.json").success(function(e){t.typeSchema=e}),s.get("../../../assets/dialogs.json").success(function(e){t.dialogs=e}),s.get("../../../assets/foodranks.json").success(function(e){t.foodranks=e});var e=l.getAnswers(),n=c.getTables(),i=d.getSpecials(),u=p.GetMatchTable(),g=v.getEdits(),k=f.getAllUserActivity(),x=y.getAllcatans(),D=h.getAllvrows(),A=b.getheadlines(),R=w.getcblocks(),M=o.getpvisits(),P=r.getrankofday(),S=m.getactions();return a.all([e,n,i,u,g,k,x,D,A,R,M,P,S]).then(function(e){t.answers=e[0],t.content=e[1],t.specials=e[2],t.mrecs=e[3],t.edits=e[4],t.alluseractivity=e[5],t.catansrecs=e[6],t.cvrows=e[7],t.headlines=e[8],t.cblocks=e[9],t.pvisits=e[10],t.rankofday=e[11],t.uafs=e[12],C(),E()})}function E(){A.isLoading=!1,t.dataIsLoaded=!0}function C(){function e(e){return 10>e?e:e}var n=new Date,a=n.getTimezoneOffset();n.setMinutes(n.getMinutes()-a);for(var s=e(n.getMonth()+1)+"/"+e(n.getDate())+"/"+n.getFullYear(),i=!0,r={},l=0;l<t.pvisits.length;l++)if(t.pvisits[l].date==s){i=!1,r=t.pvisits[l];break}i?o.postRec(s):o.patchRec(r.id,r.nvisits+1),t.dateToday=s,t.dateTodayNum=u.date2number(s)}var A=this;A.title="layout",A.header="",A.veilMsg="Loading San Diego's best...",A.hidelogo=!1,t.$on("refreshRanks",function(){"cwrapper"==k.current.name&&(A.hidelogo=t.hidelogo)}),t.$on("showLogo",function(){("rankSummary"==k.current.name||"answerDetail"==k.current.name)&&(A.hidelogo=!1)}),x(),n.innerWidth<512?(A.logoimage="/assets/images/rankxlogosd_sm.png",t.sm=!0,A.sm=!0):(A.logoimage="/assets/images/rankxlogosd.png",t.sm=!1,A.sm=!1),t.selectCity=function(e){t.selectedCity=e,window.localStorage.selectedCity=JSON.stringify(t.selectedCity),closeModal("#selectCityModal")}}angular.module("app").controller("layout",e),e.$inject=["$location","$rootScope","$window","$q","$http","pvisits","DEBUG_MODE","rankofday","answer","table","special","datetime","uaf","userdata","matchrec","edit","useractivity","vrows","headline","cblock","catans","$state"]}(),function(){"use strict";function e(e,t,n){function a(){console.log("feedback page Loaded!")}function s(){n.go("cwrapper")}var o=this;o.title="feedback",o.goBack=s,a()}angular.module("app").controller("feedback",e),e.$inject=["$location","$rootScope","$state"]}(),function(){"use strict";function e(e,t,n,a,s,o,i,r,l,c,d){function u(){E(),e.DEBUG_MODE&&console.log("activate cwrapper!"),M.isNh=e.isNh,M.querybc=M.isNh?"#428bca":"#f9f9f9",M.isNhRdy=e.isNhRdy,M.cnh=e.cnh,M.isNh&&(M.searchScope=M.isNhRdy?e.cnh:"Neighborhood"),M.isCity=e.isCity,M.isCity&&(M.searchScope="all San Diego"),M.nhs=e.neighborhoods.concat(e.districts),M.searchActive=e.searchActive,M.isAdmin=e.isAdmin,M.selEditRank=e.editMode?"active":"none",M.selViewRank=e.editMode?"none":"active",e.cCategory=void 0}function m(){e.DEBUG_MODE&&console.log("init cwrapper!"),e.isAdmin=!1,M.isAdmin=!1,f(1),M.cnh="Select Neighborhood",e.cnh=M.cnh,M.isNhRdy=!1,e.isNhRdy=!1,g(),p(),E(),e.cwrapperLoaded=!0,e.cCategory=void 0,d.loadVotes()}function g(){M.searchArray=[],M.empty=[],M.cTags={},e.searchStr=[];for(var t=0;t<e.content.length;t++)e.searchStr[t]=e.content[t].tags+" "+e.content[t].title+" "+e.content[t].answertags;e.cityranks=["city","lifestyle","food","politics","services","social","beauty","sports","personalities","technology","dating","health"],e.nhranks=["neighborhood","lifestyle","food","services","social","beauty","health"],M.nhs=e.neighborhoods.concat(e.districts),d.loadVotes()}function p(){e.estAnswers=[],e.estNames=[],e.pplAnswers=[],e.pplNames=[];for(var t=0;t<e.answers.length;t++)"Establishment"==e.answers[t].type&&(e.estNames.push(e.answers[t].name),e.estAnswers.push(e.answers[t])),"Person"==e.answers[t].type&&(e.pplNames.push(e.answers[t].name),e.pplAnswers.push(e.answers[t]))}function v(){e.inputVal=M.val,e.inputVal.length>0?(e.searchActive=!0,M.hidelogo=!0,e.hidelogo=!0):(e.searchActive=!1,M.hidelogo=!1,e.hidelogo=!1),M.searchActive=e.searchActive,c.scroll(0,0),e.$emit("refreshRanks")}function f(t){1==t&&(M.isNh=!1,M.isCity=!0,e.isNh=!1,e.isCity=!0,M.val="",e.inputVal="",e.searchActive=!1,e.$emit("loadNh"),M.searchScope="all San Diego",M.ranks=e.cityranks,M.querybc="#f9f9f9"),2==t&&(M.isNh=!0,M.isCity=!1,e.isNh=!0,e.isCity=!1,M.val="",e.inputVal="",e.searchActive=!1,e.isNhRdy&&e.$emit("loadNh"),M.searchScope="Neighborhood",M.ranks=e.nhranks,M.querybc="#428bca"),M.searchActive=e.searchActive}function h(t){e.cnh=t,M.cnh=t,M.isNhRdy=!0,e.isNhRdy=M.isNhRdy,e.$emit("loadNh"),M.searchScope=t,M.val="",e.inputVal="",$("#nhdropdown").dropdown("toggle")}function b(){e.coordsRdy?t.go("rankSummary",{index:9521}):(e.loadFbnWhenCoordsRdy=!0,r.askPermissionToLocate())}function w(){for(var n=0,a=0;a<e.content.length;a++)if(e.content[a].title.indexOf(e.rankofday[0].intros)>-1){n=e.content[a].id;break}t.go("rankSummary",{index:n})}function y(){t.go("rankSummary",{index:6949})}function k(){e.editMode=!0,M.selEditRank="active",M.selViewRank=""}function x(){e.editMode=!1,M.selEditRank="",M.selViewRank="active"}function D(){e.$emit("applyRule")}function E(){M.feeds=e.uafs,M.fres=6,M.ftext="see more"}function C(){return 6==M.fres?(M.fres=20,void(M.ftext="see less")):20==M.fres?(M.fres=6,void(M.ftext="see more")):void 0}function A(){console.log("refreshFeed"),l.getactions().then(function(t){e.uafs=t,E()})}function R(){e.fbmode=!1,M.fbm=e.fbmode}var M=this;M.title="cwrapper",M.switchScope=f,M.refreshRanks=v,M.viewRank=x,M.editRank=k,M.applyRule=D,M.foodNearMe=b,M.events=y,M.selfimprove=w,M.refreshFeed=A,M.selnh=h,M.goHome=R,M.seeMoreFeed=C,M.fres=6,M.ftext="see more",e.editMode=!1,M.content=[],M.emptyspace="",M.fbm=e.fbmode?!0:!1,e.searchActive=!1,M.searchActive=e.searchActive,e.$on("mainView",function(e){"cwrapper"==t.current.name&&f(1)}),e.cwrapperLoaded?u():m()}angular.module("app").controller("cwrapper",e),e.$inject=["$rootScope","$state","$http","$stateParams","$scope","query","table","dialog","uaf","$window","userdata"]}(),function(){"use strict";function e(e,t,n,a){function s(){console.log("About page Loaded!")}function o(){n.go("cwrapper")}var i=this;i.title="about",i.goBack=o,a.innerWidth<512?(i.logoimage="/assets/images/logogray.png",i.sm=!0):(i.logoimage="/assets/images/logogray.png",i.sm=!1),s()}angular.module("app").controller("about",e),e.$inject=["$location","$rootScope","$state","$window"]}(),function(){"use strict";function e(e,t,n){function a(n){function a(e){return p=e.data.resource}if(c()&&!n)return t.when(p);var s=f;return e.get(s).then(a,m)}function s(n,a){function s(e){return g=e.data}if(u(n)&&!a)return t.when(g);var o=f+"/"+n;return e.get(o).then(s,m)}function o(n,a){function s(e){return v=e.data.resource}if(d()&&!a)return t.when(v);var o=f+"/?filter=answer="+n;return e.get(o).then(s,m)}function i(t){function n(e){var n=t;return n.id=e.data.resource[0].id,p.length>0&&p.push(n),v.length>0&&v.push(n),console.log("result",e),e.data}var a=f,s=[];return s.push(t),e.post(a,s,{headers:{"Content-Type":"multipart/form-data"},body:s}).then(n,m)}function r(t){function n(e){return console.log("updating special succesful"),e.data}var a={};a.resource=[],a.resource.push(t);var s=f;if(p.length>0)for(var o=0;o<p.length;o++)p[o].id==t.id&&(p[o]=t);if(v.length>0)for(var o=0;o<v.length;o++)v[o].id==t.id&&(v[o]=t);return e.patch(s,a,{headers:{"Content-Type":"multipart/form-data"},body:a}).then(n,m)}function l(t){function n(e){return console.log("Deleting special was succesful"),e.data}var a={};a.resource=[];var s={};s.id=t,a.resource.push(s);var o=f+"/"+t;if(p.length>0){var i=p.map(function(e){return e.id}).indexOf(t);i>-1&&p.splice(i,1)}if(v.length>0){var i=v.map(function(e){return e.id}).indexOf(t);i>-1&&v.splice(i,1)}return e["delete"](o,s,{headers:{"Content-Type":"multipart/form-data"},body:a}).then(n,m)}function c(){return p.length>0}function d(){return v.length>0}function u(e){return g&&g.id==e}function m(e){throw e}var g,p=[],v=[],f="/api/v2/mysql/_table/specials",h={getSpecials:a,getSpecial:s,addSpecial:i,updateSpecial:r,deleteSpecial:l,getSpecialsbyAnswer:o};return h}angular.module("app").factory("special",e),e.$inject=["$http","$q","$rootScope"]}(),function(){"use strict";function e(e){function t(e){if("onetime"==e.freq){n(e,"stime"),n(e,"etime");var t=new Date(e.sdate),a=t.toString();e.sdate=a.substring(0,15),t=new Date(e.edate),a=t.toString(),e.edate=a.substring(0,15)}"weekly"==e.freq&&(n(e,"stime2"),n(e,"etime2"))}function n(e,t){var n="";switch(t){case"stime":n=e.stime;break;case"etime":n=e.etime;break;case"stime2":n=e.stime2;break;case"etime2":n=e.etime2}if(null!=n&&void 0!=n&&(n.indexOf("00:00")>-1||n.indexOf("30:00")>-1)){n=n.replace("00:00","00"),n=n.replace("30:00","30");var a=parseInt(n.substring(0,2))<12;if(n+=a?" AM":" PM",!a){var s=parseInt(n.substring(0,2))-12,o="";o=10>s?"0"+s.toString():s.toString(),n=n.replace(n.substring(0,2),o)}}switch(t){case"stime":e.stime=n;break;case"etime":e.etime=n;break;case"stime2":e.stime2=n;break;case"etime2":e.etime2=n}}function a(e){var t=new Date(e),n=t.getFullYear().toString()+(t.getMonth()+1<10?"0"+(t.getMonth()+1).toString():(t.getMonth()+1).toString())+(t.getDate()<10?"0"+t.getDate().toString():t.getDate().toString());return Number(n)}function s(t){var n=a(t);return n-e.dateTodayNum>=0}function o(t,n){var s=0,o=!1,i=0,r=!1;if(void 0!=n.edate&&""!=n.edate&&(s=a(n.edate.slice(4)),o=!0),i=a(n.sdate.slice(4)),o)if(s>=e.dateTodayNum)if(r=!0,i>=e.dateTodayNum)t.date=n.sdate.slice(4);else{var l=new Date(e.dateToday),c=l.toString();t.date=c.substring(0,15).slice(4)}else r=!1,t.date=n.edate.slice(4);else i>=e.dateTodayNum?(r=!0,t.date=n.sdate.slice(4)):(r=!1,t.date=n.sdate.slice(4));return r}var i={formatdatetime:t,formatTime:n,date2number:a,dateIsCurrent:s,eventIsCurrent:o};return i}angular.module("app").service("datetime",e),e.$inject=["$rootScope"]}(),function(){"use strict";function e(e,t,n,a,s){function o(){s.getSpecialsbyAnswer(t.canswer.id).then(function(e){t.specials=e,i()}),console.log("Specials Page loaded!")}function i(){d.specialsList=t.specials}function r(){t.specialmode="add",n.go("editspecial")}function l(e){t.cspecial=e,t.specialmode="edit",n.go("editspecial")}function c(){n.go("answerDetail",{index:t.canswer.id})}var d=this;d.title="specials",d.addSpecial=r,d.selSpecial=l,d.closeRank=c,d.header=t.canswer.name,d.specialsList=[],o()}angular.module("app").controller("specials",e),e.$inject=["$location","$rootScope","$state","dialog","special"]}(),function(){"use strict";function e(e,t,n){function a(){console.log("photogallery page Loaded!")}var s=this;s.title="photogallery",a()}angular.module("app").controller("photogallery",e),e.$inject=["$location","$rootScope","$state"]}(),function(){"use strict";function e(e,t,n){function a(){console.log("mainphoto page Loaded!")}var s=this;s.title="mainphoto",a()}angular.module("app").controller("mainphoto",e),e.$inject=["$location","$rootScope","$state"]}(),function(){"use strict";function e(e,t,n,a,s,o){function i(){y.vrows=t.cansvrows,r(),console.log("editvrows Page loaded!")}function r(){function e(e,t){return e.gnum-t.gnum}if(y.vrows=[],t.cansvrows.length>0){y.vrows=t.cansvrows.sort(e),y.vrows[0].shdr=!0;for(var n=1;n<y.vrows.length;n++)y.vrows[n].shdr=y.vrows[n].gnum==y.vrows[n-1].gnum?!1:!0;y.vrows[y.vrows.length-1].saddr=!0;for(var n=0;n<y.vrows.length-1;n++)y.vrows[n].saddr=y.vrows[n].gnum!=y.vrows[n+1].gnum?!0:!1}}function l(){n.go("answerDetail",{index:t.canswer.id})}function c(e){t.cansvrows=[];for(var n=0;n<t.cvrows.length;n++)t.cvrows[n].answer==e&&t.cansvrows.push(t.cvrows[n]);r()}function d(e){a.addVRow(e,u)}function u(e,n){var a=!1;"-"==e.title&&(a=!0);var o=JSON.parse(JSON.stringify(e));if(o.id=void 0,o.$$hashKey=void 0,o.upV=0,o.downV=0,o.title=n,a){var i=s.updateRec(e.id,["title"],[n]);i.then(function(){c(t.canswer.id)})}else{var r=s.postRec(o);r.then(function(){c(t.canswer.id)})}}function m(e){a.deleteVRow(e,g)}function g(e){var n=s.deleteVrow(e.id);o.deleteVrowVotesbyVrow(e.id),n.then(function(){c(t.canswer.id)})}function p(){var e=y.vrows[y.vrows.length-1];a.addVRowGroup(e,v)}function v(e,n){if(y.vrows.length>0){var a=JSON.parse(JSON.stringify(e));a.id=void 0,a.$$hashKey=void 0,a.upV=0,a.downV=0,a.title="-",a.gnum=y.vrows[y.vrows.length-1].gnum+1,a.gtitle=n}else a={},a.answer=t.canswer.id,a.gnum=0,a.gtitle=n,a.title="-",a.upV=0,a.downV=0;var o=s.postRec(a);o.then(function(){c(t.canswer.id)})}function f(e){a.editVRowGroup(e,h,b)}function h(e,n){var a=!1;if(e.gtitle!=n&&(a=!0),a){for(var o=0;o<t.cansvrows.length;o++)t.cansvrows[o].gnum==e.gnum&&(t.cansvrows[o].gtitle=n,s.updateRec(t.cansvrows[o].id,["gtitle"],[n]));c(t.canswer.id)}}function b(e){a.deleteVRowGroup(e,w)}function w(e){var n=s.deleteVrowByGroup(e.gnum,e.answer);n.then(function(){console.log("$rootScope.cvrows - ",t.cvrows),c(t.canswer.id)})}var y=this;y.title="editvrows";y.header="Edit Vote Rows for "+t.canswer.name,y.editvrowsList=[],y.vrows=[],y.addVRowDiag=d,y.addVRowGroupDiag=p,y.deleteVRowDiag=m,y.editVRowGroupDiag=f,y.closeRank=l,i()}angular.module("app").controller("editvrows",e),e.$inject=["$location","$rootScope","$state","dialog","vrows","vrowvotes"]}(),function(){"use strict";function e(e,t,n,a,s,o){function i(){"edit"==t.specialmode&&(v.sp=JSON.parse(JSON.stringify(t.cspecial)),o.formatdatetime(v.sp),v.isEdit=!0,"onetime"==v.sp.freq&&l(1),"weekly"==v.sp.freq&&l(2),v.sp.bc=v.sp.bc,v.sp.fc=v.sp.fc,v.imageURL=void 0!=v.sp.image?v.sp.image:"../../../assets/images/noimage.jpg"),"add"==t.specialmode&&(v["char"]=25,v.sp.fc="hsl(0, 100%, 0%)",v.sp.bc="hsl(0, 0%, 100%)",l(1),v.imageURL="../../../assets/images/noimage.jpg"),g(),console.log("editspecial page Loaded!")}function r(){v["char"]=25-v.sp.stitle.length}function l(e){1==e&&(v.weekly=!1,v.onetime=!0,v.sp.freq="onetime"),2==e&&(v.weekly=!0,v.onetime=!1,v.sp.freq="weekly")}function c(){f=v.sp,f.name=t.canswer.name,f.answer=t.canswer.id,f.image=v.imageURL,f.freq=v.onetime?"onetime":"weekly",a.createSpecialPreview(f,d)}function d(){0==v.isEdit?("onetime"==v.sp.freq&&(f.stime2=null,f.etime2=null),"weekly"==v.sp.freq&&(f.stime=null,f.sdate=null,f.etime=null,f.edate=null),s.addSpecial(f).then()):s.updateSpecial(f),n.go("specials")}function u(){s.deleteSpecial(v.sp.id),n.go("specials")}function m(){n.go("specials")}function g(){v.timeDD=["7:00 AM","7:30 AM","8:00 AM","8:30 AM","9:00 AM","9:30 AM","10:00 AM","10:30 AM","11:00 AM","11:30 AM","12:00 PM","12:30 PM","1:00 PM","1:30 PM","2:00 PM","2:30 PM","3:00 PM","3:30 PM","4:00 PM","4:30 PM","5:00 PM","5:30 PM","6:00 PM","6:30 PM","7:00 PM","7:30 PM","8:00 PM","8:30 PM","9:00 PM","9:30 PM","10:00 PM","10:30 PM","11:00 PM","11:30 PM","12:00 AM","12:30 AM","1:00 AM","1:30 AM","2:00 AM","2:30 AM","3:00 AM","3:30 AM","4:00 AM","4:30 AM","5:00 AM","5:30 AM","6:00 AM","6:30 AM"]}function p(){n.go("answerDetail",{index:t.canswer.id})}var v=this;v.title="editspecial",v.sp={};var f={};v.displayCharLength=r,v.frequencySel=l,v.showPreview=c,v.deleteSpecial=u,v.goBack=m,v.closeRank=p,v.header=t.canswer.name,v.isEdit=!1,v.userIsOwner=t.userIsOwner,t.$on("fileUploaded",function(e,t){console.log("Received fileUploaded",t),console.log("$state.current.name - ",n.current.name),"editspecial"==n.current.name&&(console.log("loaded date to vm.imageURL"),v.imageURL=t)}),i()}angular.module("app").controller("editspecial",e),e.$inject=["$location","$rootScope","$state","dialog","special","datetime"]}(),function(){"use strict";function e(e,t,n,a,s,o){function i(){a.getAnswerbyCustomer(t.cust.id).then(function(e){t.custans=e.resource,console.log("Customer-Answer records: ",t.custans),r()}),console.log("customer page Loaded!")}function r(){g.answers=t.custans}function l(e){t.cust.canswer=e.id,console.log("current answer ",e.id,e.name)}function c(){void 0==t.cust.canswer?s.getDialog("selectBusiness"):n.go("mainphoto")}function d(){void 0==t.cust.canswer?s.getDialog("selectBusiness"):n.go("specials")}function u(){void 0==t.cust.canswer?s.getDialog("selectBusiness"):n.go("photogallery")}function m(){n.go("content")}var g=this;g.title="customer",g.selMainPhoto="active",g.selSpecials="",g.selPhotoGallery="",g.goBack=m,g.loadMainPhoto=c,g.loadSpecials=d,g.loadPhotoGallery=u,g.selAnswer=l,t.cust={},t.cust.id=1,i()}angular.module("app").controller("customer",e),e.$inject=["$location","$rootScope","$state","answer","dialog","special"]}(),function(){"use strict";function e(e,t,n){function a(a){if(r()&&!a)return t.when(c);var s=d+"?offset=0",o=d+"?offset=1000",i=d+"?offset=2000",u=d+"?offset=3000",m=d+"?offset=4000",g=d+"?offset=5000",p=d+"?offset=6000",v=e.get(s),f=e.get(o),h=e.get(i),b=e.get(u),w=e.get(m),y=e.get(g),k=e.get(p);return t.all([v,f,h,b,w,y,k]).then(function(e){return c=e[0].data.resource.concat(e[1].data.resource,e[2].data.resource,e[3].data.resource,e[4].data.resource,e[5].data.resource,e[6].data.resource),n.DEBUG_MODE&&console.log("tables length: ",c.length),c},l)}function s(t){function a(e){var a=t;return a.id=e.data.resource[0].id,c.push(a),n.DEBUG_MODE&&console.log("result",e),e.data}t.isatomic=!0;var s=d,o=[];return o.push(t),e.post(s,o,{headers:{"Content-Type":"multipart/form-data"},body:o}).then(a,l)}function o(t){function a(e){return n.DEBUG_MODE&&console.log("Deleting table was succesful"),e.data}var s={};s.resource=[];var o={};o.id=t,s.resource.push(o);var i=d+"/"+t,r=c.map(function(e){return e.id}).indexOf(t);return r>-1&&c.splice(r,1),e["delete"](i,o,{headers:{"Content-Type":"multipart/form-data"},body:s}).then(a,l)}function i(t,a,s){function o(e){return n.DEBUG_MODE&&console.log("updating ranking record succesful"),e.data}var i={};i.resource=[];var r={};r.id=t;for(var c=0;c<a.length;c++)switch(a[c]){case"views":r.views=s[c];break;case"answers":r.answers=s[c];break;case"title":r.title=s[c];break;case"tags":r.tags=s[c];break;case"keywords":r.keywords=s[c];break;case"type":r.type=s[c];break;case"question":r.question=s[c];break;case"image1url":r.image1url=s[c];break;case"image2url":r.image2url=s[c];break;case"image3url":r.image3url=s[c];break;case"answertags":r.answertags=s[c];break;case"isatomic":r.isatomic=s[c];break;case"catstr":r.catstr=s[c];break;case"numcom":r.numcom=s[c]}i.resource.push(r);for(var u=d,m=0,c=0;c<n.content.length;c++)if(n.content[c].id==t){m=c;break}for(var c=0;c<a.length;c++)switch(a[c]){case"answers":n.content[m].answers=s[c];break;case"views":n.content[m].views=s[c];break;case"title":n.content[m].title=s[c];break;case"tags":n.content[m].tags=s[c];break;case"keywords":n.content[m].keywords=s[c];break;case"type":n.content[m].type=s[c];break;case"question":n.content[m].question=s[c];break;case"image1url":n.content[m].image1url=s[c];break;case"image2url":n.content[m].image2url=s[c];break;case"image3url":n.content[m].image3url=s[c];break;case"answertags":n.content[m].answertags=s[c];break;case"isatomic":n.content[m].isatomic=s[c];break;case"catstr":n.content[m].catstr=s[c];break;case"numcom":n.content[m].numcom=s[c]}return e.patch(u,i,{headers:{"Content-Type":"multipart/form-data"},body:i}).then(o,l)}function r(){return c.length>0}function l(e){throw e}var c=[],d="/api/v2/mysql/_table/ranking",u={getTables:a,update:i,addTable:s,deleteTable:o};return u}angular.module("app").factory("table",e),e.$inject=["$http","$q","$rootScope"]}(),function(){"use strict";function e(e,t,n){function a(t){function n(e){return 10>e?e:e}function a(e){return o=e.data.resource}var r=new Date,l=r.getTimezoneOffset();r.setMinutes(r.getMinutes()-l);var c=n(r.getMonth()+1)+"/"+n(r.getDate())+"/"+r.getFullYear(),d=i+"/?filter=date="+c;return e.get(d).then(a,s)}function s(e){throw e}var o=[],i="/api/v2/mysql/_table/rankofday",r={getrankofday:a};return r}angular.module("app").factory("rankofday",e),e.$inject=["$http","$q","$rootScope"]}(),function(){"use strict";function e(e,t,n){function a(n){function a(e){return c=e.data.resource}if(r()&&!n)return t.when(c);var s=d;return e.get(s).then(a,l)}function s(t){function a(e){var t=e.data.resource[0].id;return c[c.length-1].id=t,n.DEBUG_MODE&&console.log("creating pvisits record was succesful"),e.data}var s={};s.date=t,s.nvisits=1;var o={};o.resource=[],o.resource.push(s),c.push(s);var i=d;return e.post(i,o,{headers:{"Content-Type":"multipart/form-data"},body:o}).then(a,l)}function o(t,a){function s(e){return n.DEBUG_MODE&&console.log("Updating pvisits record was succesful"),e.data}var o={};o.resource=[];var i={};i.id=t,i.nvisits=a,o.resource.push(i);var r=d;return e.patch(r,o,{headers:{"Content-Type":"multipart/form-data"},body:o}).then(s,l)}function i(t){function a(e){return n.DEBUG_MODE&&console.log("Deleting user activity record was succesful"),e.data}for(var s=0;s<c.length;s++)c[s].id==t&&c.splice(s,1);var o=d+"/"+t;return e["delete"](o).then(a,l)}function r(){return c.length>0}function l(e){throw e}var c=[],d="/api/v2/mysql/_table/pvisits",u={getpvisits:a,postRec:s,patchRec:o,deleteRec:i};return u}angular.module("app").factory("pvisits",e),e.$inject=["$http","$q","$rootScope"]}(),function(){"use strict";function e(e,t,n){function a(n){if(i()&&!n)return t.when(l);var a=c+"?offset=0",s=e.get(a);return t.all([s]).then(function(e){return l=e[0].data.resource},r)}function s(t){function n(e){var n=t;return n.id=e.data.resource[0].id,l.push(n),console.log("result",e),e.data}var a=c,s=[];return s.push(t),e.post(a,s,{headers:{"Content-Type":"multipart/form-data"},body:s}).then(n,r)}function o(t,a,s){function o(e){return console.log("updating headlines succesful"),e.data}var i={};i.resource=[];var d={};d.id=t;for(var u=0;u<a.length;u++)switch(a[u]){case"city":d.city=s[u];break;case"nh":d.nh=s[u];break;case"title":d.title=s[u];break;case"filter":d.filter=s[u];break;case"bc":d.bc=s[u];break;case"fc":d.fc=s[u]}i.resource.push(d);for(var m=c,g=l.map(function(e){return e.id}).indexOf(t),u=0;u<a.length;u++)switch(a[u]){case"city":n.content[g].city=s[u];break;case"nh":n.content[g].nh=s[u];break;case"title":n.content[g].title=s[u];break;case"filter":n.content[g].filter=s[u];break;case"bc":n.content[g].bc=s[u];break;case"fc":n.content[g].fc=s[u]}return e.patch(m,i,{headers:{"Content-Type":"multipart/form-data"},body:i}).then(o,r)}function i(){return l.length>0}function r(e){throw e}var l=[],c="/api/v2/mysql/_table/headlines",d={getheadlines:a,addheadline:s,update:o};return d}angular.module("app").factory("headline",e),e.$inject=["$http","$q","$rootScope"]}(),function(){"use strict";function e(e,t,n){function a(n){if(r()&&!n)return t.when(c);var a=d+"?offset=0",s=e.get(a);return t.all([s]).then(function(e){return c=e[0].data.resource},l)}function s(t){function n(e){var n=t;return n.id=e.data.resource[0].id,c.push(n),console.log("adding cblock succesful",e),e.data}var a=d,s=[];return s.push(t),e.post(a,s,{headers:{"Content-Type":"multipart/form-data"},body:s}).then(n,l)}function o(t,n,a){function s(e){return console.log("updating cblocks succesful"),e.data}var o={};o.resource=[];var i={};i.id=t;for(var r=0;r<n.length;r++)switch(n[r]){case"catstr":i.catstr=a[r]}o.resource.push(i);for(var u=d,m=c.map(function(e){return e.id}).indexOf(t),r=0;r<n.length;r++)switch(n[r]){case"catstr":c[m].catstr=a[r]}return e.patch(u,o,{headers:{"Content-Type":"multipart/form-data"},body:o}).then(s,l)}function i(t){function n(e){return console.log("Deleting cblock was succesful"),e.data}var a={};a.resource=[];var s={};s.id=t,a.resource.push(s);var o=d+"/"+t,i=c.map(function(e){return e.id}).indexOf(t);return i>-1&&c.splice(i,1),e["delete"](o,s,{headers:{"Content-Type":"multipart/form-data"},body:a}).then(n,l)}function r(){return c.length>0}function l(e){throw e}var c=[],d="/api/v2/mysql/_table/cblocks",u={getcblocks:a,addcblock:s,update:o,deleteRec:i};return u}angular.module("app").factory("cblock",e),e.$inject=["$http","$q","$rootScope"]}(),function(){"use strict";angular.module("app").filter("orderObjectBy",function(){return function(e,t,n){var a=[];return angular.forEach(e,function(e){a.push(e)}),a.sort(function(e,n){return e[t]>n[t]?1:-1}),n&&a.reverse(),a}}).filter("objectLength",function(){return function(e){return e?Object.keys(e).length:0}}).filter("searchObject",function(){return function(e,t,n){function a(e,t){return e=(""+e).toLowerCase(),t=(""+t).toLowerCase(),-1!==e.indexOf(t)}if(!e)return null;var s=[];if(!t){for(var o=Object.keys(e),i=0,r=o.length;r>i;i++)s.push(e[o[i]]);return s}return angular.forEach(e,function(e){if(n&&""!=n)e[n]&&a(e[n],t)&&s.push(e);else for(var o=Object.keys(e),i=0,r=o.length;r>i;i++)if(a(e[o[i]],t)){s.push(e);break}}),s}})}(),angular.module("app").directive("contentBlock",["$rootScope","$state",function(e,t){"use strict";return{templateUrl:"app/content/partials/content-block.html",transclude:!0,scope:{modType:"@type",isDynamic:"=dynamic",isRoW:"=rankofweek",updateView:"&updateView"},controller:["$scope","query","$http","answer","table","catans","$timeout","vrows",function(t,n,a,s,o,i,r,l){function c(){g.hideme=!1;var t="",n="",a=!1;g.nm=!1;var s={},o="",i="",r={};if(void 0!=e.inputVal&&g.isDynamic){var l=!1,c=e.inputVal;if(c.indexOf("near me")>-1||c.indexOf("near")>-1||c.indexOf("close")>-1||c.indexOf("close to")>-1||c.indexOf("close to me")>-1?(a=!0,c=c.replace("near me","in San Diego"),c=c.replace("near","in San Diego"),c=c.replace("close to me","in San Diego"),c=c.replace("close to","in San Diego"),c=c.replace("close","in San Diego")):a=!1,e.isNh&&(c=c+" "+e.cnh),g.results=[],g.results_nm=[],c.length>=3){for(var d=c.split(" "),u=0;u<e.content.length;u++){n=e.searchStr[u],s=e.content[u];for(var m=!0,v=0;v<d.length;v++)o=d[v].charAt(0).toUpperCase()+d[v].slice(1),i=d[v].charAt(0).toLowerCase()+d[v].slice(1),m=m&&(n.indexOf(d[v])>-1||n.indexOf(d[v].toUpperCase())>-1||n.indexOf(o)>-1||n.indexOf(i)>-1);m&&(a?s.title.indexOf("in San Diego")>-1&&g.results.push(e.content[u]):g.results.push(e.content[u]))}for(var v=0;v<g.results.length;v++)t=g.results[v].title,t.indexOf("in San Diego")>-1&&0==g.results[v].isatomic&&(r=JSON.parse(JSON.stringify(g.results[v])),r.title=r.title.replace("in San Diego","close to me"),g.results_nm.push(r),g.nm=!0);g.resLT6=g.results.length<6?!0:!1,l=c.length>=p?!0:!1,p=c.length}else g.results=[]}}function d(){g.image1="/assets/images/noimage.jpg",g.image2="/assets/images/noimage.jpg",g.image3="/assets/images/noimage.jpg";for(var t=0;t<e.headlines.length;t++)if(e.headlines[t].type==g.modType){g.bgc=e.headlines[t].bc,g.fc=e.headlines[t].fc,g.headline=e.headlines[t].title;break}e.DEBUG_MODE&&console.log("rankofday - ",e.rankofday[0]);var n="",a="";e.isCity&&(n=e.rankofday[0].main),e.isNh&&(n=e.rankofday[0].nh+" "+e.cnh),g.results=[];var s=n.split(" ");e.DEBUG_MODE&&console.log("valTags _ ",s);for(var o=0;o<e.content.length;o++){var i=!0;a=e.content[o].title;for(var r=0;r<s.length;r++){var l=s[r].charAt(0).toUpperCase()+s[r].slice(1),c=s[r].charAt(0).toLowerCase()+s[r].slice(1);i=i&&(a.indexOf(s[r])>-1||a.indexOf(s[r].toUpperCase())>-1||a.indexOf(l)>-1||a.indexOf(c)>-1)}if(i){g.results.push(e.content[o]);break}}g.results.length>0&&void 0!=g.results[0]&&(void 0!=g.results[0].image1url&&(g.image1=g.results[0].image1url),void 0!=g.results[0].image2url&&(g.image2=g.results[0].image2url),void 0!=g.results[0].image3url&&(g.image3=g.results[0].image3url)),g.resLT6=g.results.length<=6?!0:!1;var d=void 0!=g.results[0];g.updateView(d),g.hideme=d?!1:!0}function u(){var t="",n=[];g.results=[];for(var a=!1,s=0;s<e.headlines.length;s++)if(e.headlines[s].type==g.modType){g.bgc=e.headlines[s].bc,g.fc=e.headlines[s].fc,g.headline=e.headlines[s].title,e.isNh&&"rxfeedback"!=e.headlines[s].type&&"rxsuggestion"!=e.headlines[s].type&&(g.headline=g.headline+" - "+e.cnh);break}for(var s=0;s<e.cblocks.length;s++){if("city"==e.cblocks[s].scope&&e.isCity&&e.cblocks[s].type==g.modType){t=e.cblocks[s].catstr,n=t.split(":");for(var o=0;o<n.length;o++)g.results.push(e.content[n[o]]);a=!0;break}if("nh"==e.cblocks[s].scope&&e.isNh&&e.cblocks[s].type==g.modType&&e.cblocks[s].scopename==e.cnh){t=e.cblocks[s].catstr,n=t.split(":");for(var o=0;o<n.length;o++)g.results.push(e.content[n[o]]);a=!0;break}if("rx"==e.cblocks[s].scope&&e.cblocks[s].type==g.modType&&"RankX"==e.cblocks[s].scopename){t=e.cblocks[s].catstr,n=t.split(":");for(var o=0;o<n.length;o++)g.results.push(e.content[n[o]]);a=!0;break}}g.resLT6=g.results.length<=6?!0:!1;var i=void 0!=g.results[0];g.updateView(a&&i),g.hideme=a&&i?!1:!0}function m(){console.log("apply Rule")}var g=t;g.title="mycontent",g.results=[],g.results_nm=[],g.loadContent=u,g.maxRes="query"==g.modType?4e3:6,g.btext="see more";var p=0;g.isDynamic||("rankofweek"==g.modType?d():u()),e.$on("refreshRanks",function(t){g.input=e.inputVal,"query"==g.modType&&c()}),e.$on("loadNh",function(e){"rankofweek"==g.modType?d():u()}),e.$on("applyRule",function(e){m()})}],link:function(n){n.rankSel=function(n,a){e.rankIsNearMe=a?!0:!1,e.editMode?t.go("editRanking",{index:n.id}):t.go("rankSummary",{index:n.id})},n.seeMore=function(e,t){6==n.maxRes?(n.btext="see less",n.maxRes=100):(n.btext="see more",n.maxRes=6)},n.updateView=function(e){n.hideme=e?!1:!0}}}}]),angular.module("app").directive("fileModel",["$parse",function(e){"use strict";return{restrict:"A",link:function(t,n,a){var s=e(a.fileModel),o=s.assign;n.bind("change",function(){t.$apply(function(){o(t,n[0].files[0])})})}}}]),function(){"use strict";function e(e,t,n,a){function s(a){function s(e){return d=e.data.resource}if(l()&&!a)return t.when(d);var o=u+"?filter=user="+n.user.id;return e.get(o).then(s,c)}function o(t,s){function o(e){var t=r;return t.id=e.data.resource[0].id,d.push(t),n.cvrowvotes.push(t),1==r.val&&a.post("upVotedVrow",["answer","vrow"],[r.answer,t.vrow]),-1==r.val&&a.post("downVotedVrow",["answer","vrow"],[r.answer,t.vrow]),n.DEBUG_MODE&&console.log("Creating new vrowvoting record was succesful"),e.data}var i={};i.resource=[];var r={};r.user=n.user.id,r.answer=n.canswer.id,r.vrow=t,r.val=s,r.timestmp=Date.now(),i.resource.push(r);var l=u;return e.post(l,i,{headers:{"Content-Type":"multipart/form-data"},body:i}).then(o,c)}function i(t,a){function s(e){return n.DEBUG_MODE&&console.log("Updating vrow vote record was succesful"),e.data}var o={};o.resource=[];var i={};i.id=t,i.val=a,i.timestmp=Date.now(),o.resource.push(i);var r=u,l=d.map(function(e){return e.id}).indexOf(t);return d[l].vote=a,d[l].timestmp=i.timestmp,e.patch(r,o,{headers:{"Content-Type":"multipart/form-data"},body:o}).then(s,c)}function r(t){function a(e){return n.DEBUG_MODE&&console.log("Deleting vrow votes records was succesful"),e.data}for(var s=0;s<d.length;s++)d[s].vrow==t&&d.splice(s,1);var o=u+"?filter=vrow="+t;return e["delete"](o).then(a,c)}function l(e){return d.length>0}function c(e){throw e}var d=[],u="/api/v2/mysql/_table/vrowvotes",m={loadVrowVotes:s,patchRec:i,postRec:o,deleteVrowVotesbyVrow:r};return m}angular.module("app").factory("vrowvotes",e),e.$inject=["$http","$q","$rootScope","uaf"]}(),function(){"use strict";function e(e,t,n,a){function s(a){if(m()&&!a)return t.when(p);var s=v+"?offset=0",o=v+"?offset=1000",i=v+"?offset=2000",r=v+"?offset=3000",l=v+"?offset=4000",c=v+"?offset=5000",d=v+"?offset=6000",u=v+"?offset=7000",f=e.get(s),h=e.get(o),b=e.get(i),w=e.get(r),y=e.get(l),k=e.get(c),x=e.get(d),D=e.get(u);

return t.all([f,h,b,w,y,k,x,D]).then(function(e){return p=e[0].data.resource.concat(e[1].data.resource,e[2].data.resource,e[3].data.resource,e[4].data.resource,e[5].data.resource,e[6].data.resource,e[7].data.resource),n.DEBUG_MODE&&console.log("No. Vrows: ",p.length),p},g)}function o(e){var t=[],a={},s=[];if(n.cCategory.tags.indexOf("food")>-1||n.cCategory.tags.indexOf("services")>-1||n.cCategory.tags.indexOf("health")>-1||n.cCategory.tags.indexOf("beauty")>-1||n.cCategory.tags.indexOf("food")>-1||n.cCategory.title.indexOf("food")>-1||n.cCategory.title.indexOf("restaurants")>-1||n.cCategory.title.indexOf("Bars")>-1||n.cCategory.title.indexOf("bars")>-1||n.cCategory.title.indexOf("pubs")>-1||n.cCategory.title.indexOf("Yoga")>-1||n.cCategory.title.indexOf("Pilates")>-1||n.cCategory.title.indexOf("yoga")>-1||n.cCategory.title.indexOf("pilates")>-1||n.cCategory.title.indexOf("schools")>-1||n.cCategory.title.indexOf("Gyms")>-1||n.cCategory.title.indexOf("gyms")>-1||n.cCategory.title.indexOf("Nightclubs")>-1||"PersonCust"==e.type||"Establishment"==e.type){t=["Quality of Service","Friendliness of Staff","Promptness of Service","Value for the Money"],(n.cCategory.tags.indexOf("food")>-1||n.cCategory.title.indexOf("food")>-1||n.cCategory.title.indexOf("restaurants")>-1)&&(t=["Quality of Food and Drinks","Friendliness of Staff","Promptness of Service","Value for the Money"]),(n.cCategory.title.indexOf("Bars")>-1||n.cCategory.title.indexOf("bars")>-1||n.cCategory.title.indexOf("pubs")>-1)&&(t=["Quality of Drinks","Friendliness of Staff","Promptness of Service","Value for the Money"]),(n.cCategory.title.indexOf("Gyms")>-1||n.cCategory.title.indexOf("gyms")>-1)&&(t=["Equipment & Facilities","Friendliness of Staff","Environment","Value for the Money"]),(n.cCategory.title.indexOf("Yoga")>-1||n.cCategory.title.indexOf("Pilates")>-1||n.cCategory.title.indexOf("yoga")>-1||n.cCategory.title.indexOf("pilates")>-1||n.cCategory.title.indexOf("schools")>-1||n.cCategory.title.indexOf("MMA")>-1)&&(t=["Quality of Instructors","Friendliness of Staff","Class Environment","Value for the Money"]),(n.cCategory.title.indexOf("Apartments")>-1||n.cCategory.title.indexOf("apartments")>-1)&&(t=["Location","Floor Layout","Facilities","Value for the Money"]),(n.cCategory.title.indexOf("shop")>-1||n.cCategory.title.indexOf("store")>-1)&&(t=["Assortment of Products","Friendliness of Staff","Value for the Money"]),(n.cCategory.title.indexOf("Tattoo")>-1||n.cCategory.title.indexOf("tattoo")>-1)&&(t=["Quality of Service","Friendliness of Staff","Promptness of Service","Value for the Money"]),(n.cCategory.title.indexOf("Nightclubs")>-1||n.cCategory.title.indexOf("music")>-1||n.cCategory.title.indexOf("dancing")>-1)&&(t=[" Quality of Music","Environment","Friendliness of Staff","Value for the Money"]),"PersonCust"==e.type&&(t=[" Quality of Service","Friendliness","Value for the Money"]);for(var o=0;o<t.length;o++)a={},a.gnum=1,a.gtitle="General",a.title=t[o],a.upV=0,a.downV=0,a.answer=e.id,s.push(a);r(s)}}function i(t){function n(e){var t=a;return t.id=e.data.resource[0].id,p.push(t),e.data}var a=t;a.upV=0,a.downV=0,a.timestmp=Date.now();var s={};s.resource=[],s.resource.push(a);var o=v;return e.post(o,s,{headers:{"Content-Type":"multipart/form-data"},body:s}).then(n,g)}function r(t){function n(e){for(var t=p.length-1,n=e.data.resource.length-1;n>=0;n--)p[t].id=e.data.resource[n].id,t--;return e.data}var a={};a.resource=[],a.resource.push(t),p.push.apply(p,t);var s=v;return e.post(s,t,{headers:{"Content-Type":"multipart/form-data"},body:a}).then(n,g)}function l(t){function s(e){for(var t=0;t<e.data.resource.length;t++)a.deleteVrowVotesbyVrow(e.data.resource[t].id);return n.DEBUG_MODE&&console.log("Deleting vrows records for answer was succesful"),e.data}for(var o=0;o<p.length;o++)p[o].answer==t&&p.splice(o,1);var i=v+"?filter=answer="+t;return e["delete"](i).then(s,g)}function c(t,s){function o(e){for(var t=0;t<e.data.resource.length;t++)a.deleteVrowVotesbyVrow(e.data.resource[t].id);return n.DEBUG_MODE&&console.log("Deleting vrows records for group was succesful"),e.data}for(var i=p.length-1;i>=0;i--)p[i].gnum==t&&p.splice(i,1);var r=v+"?filter=(gnum="+t+") AND (answer="+s+")";return e["delete"](r).then(o,g)}function d(t){function s(e){for(var t=0;t<e.data.resource.length;t++)a.deleteVrowVotesbyVrow(e.data.resource[t].id);return n.DEBUG_MODE&&console.log("Deleting vrow was succesful"),e.data}var o={};o.resource=[];var i={};i.id=t,o.resource.push(i);var r=v+"/"+t,l=p.map(function(e){return e.id}).indexOf(t);return l>-1&&p.splice(l,1),e["delete"](r,i,{headers:{"Content-Type":"multipart/form-data"},body:o}).then(s,g)}function u(t,a,s){function o(e){return n.DEBUG_MODE&&console.log("updating vrows record succesful"),e.data}var i={};i.resource=[];var r={};r.id=t;for(var l=0;l<a.length;l++)switch(a[l]){case"upV":r.upV=s[l];break;case"downV":r.downV=s[l];break;case"title":r.title=s[l];break;case"gnum":r.gnum=s[l];break;case"gtitle":r.gtitle=s[l]}i.resource.push(r);for(var c=v,d=p.map(function(e){return e.id}).indexOf(t),l=0;l<a.length;l++)switch(a[l]){case"upV":n.cvrows[d].upV=s[l];break;case"downV":n.cvrows[d].downV=s[l];break;case"title":n.cvrows[d].title=s[l];break;case"gnum":n.cvrows[d].gnum=s[l];break;case"gtitle":n.cvrows[d].gtitle=s[l]}return e.patch(c,i,{headers:{"Content-Type":"multipart/form-data"},body:i}).then(o,g)}function m(){return p.length>0}function g(e){throw e}var p=[],v="/api/v2/mysql/_table/vrows",f={getAllvrows:s,postRec:i,postRec2:r,deleteVrowByAnswer:l,deleteVrow:d,updateRec:u,deleteVrowByGroup:c,postVrows4Answer:o};return f}angular.module("app").factory("vrows",e),e.$inject=["$http","$q","$rootScope","vrowvotes"]}(),function(){"use strict";function e(e,t,n,a){function s(a){function s(e){return m=e.data.resource}if(d()&&!a)return t.when(m);var o=g+"/?filter=user="+n.user.id;return e.get(o).then(s,u)}function o(t){function n(e){return m=e.data.resource}var a=g;return e.get(a).then(n,u)}function i(t,s,o,i){function r(e){var t=c;return t.id=e.data.resource[0].id,m.push(t),1==c.vote&&a.post("upVoted",["answer","category"],[s,o]),-1==c.vote&&a.post("downVoted",["answer","category"],[s,o]),n.$emit("updateVoteTable"),console.log("Creating new voting record was succesful"),e.data}var l={};l.resource=[];var c={};c.user=n.user.id,c.catans=t,c.answer=s,c.vote=i,c.timestmp=Date.now(),l.resource.push(c);var d=g;return e.post(d,l,{headers:{"Content-Type":"multipart/form-data"},body:l}).then(r,u)}function r(t,a){function s(e){return n.DEBUG_MODE&&console.log("Updating vote record was succesful"),e.data}var o={};o.resource=[];var i={};i.id=t,i.vote=a,i.timestmp=Date.now(),o.resource.push(i);var r=g,l=m.map(function(e){return e.id}).indexOf(t);return m[l].vote=a,m[l].timestmp=i.timestmp,e.patch(r,o,{headers:{"Content-Type":"multipart/form-data"},body:o}).then(s,u)}function l(t){function a(e){return n.DEBUG_MODE&&console.log("Deleting vote records by Catans was succesful"),e.data}for(var s=0;s<m.length;s++)m[s].catans==t&&m.splice(s,1);var o=g+"/?filter=catans="+t;return e["delete"](o).then(a,u)}function c(t){function a(e){return n.DEBUG_MODE&&console.log("Deleting vote record was succesful"),e.data}for(var s=0;s<m.length;s++)m[s].id==t&&m.splice(s,1);var o=g+"/"+t;return e["delete"](o).then(a,u)}function d(e){return m.length>0}function u(e){throw e}var m=[],g="/api/v2/mysql/_table/votetable",p={loadVotesByUser:s,loadAllVotes:o,patchRec:r,postRec:i,deleteVotesbyCatans:l,deleteRec:c};return p}angular.module("app").factory("votes",e),e.$inject=["$http","$q","$rootScope","uaf"]}(),function(){"use strict";function e(e,t,n){function a(n){function a(e){return c=e.data.resource}if(r()&&!n)return t.when(c);var s=d;return e.get(s).then(a,l)}function s(t){function a(e){var t=s;return t.id=e.data.resource[0].id,c.push(t),n.thisuseractivity.push(t),n.DEBUG_MODE&&console.log("creating useractivity record was succesful"),e.data}var s={};s.user=n.user.id,s.category=t,s.votes=1,s.timestmp=Date.now();var o={};o.resource=[],o.resource.push(s);var i=d;return e.post(i,o,{headers:{"Content-Type":"multipart/form-data"},body:o}).then(a,l)}function o(t,a){function s(e){return n.DEBUG_MODE&&console.log("Updating useractivity record was succesful"),e.data}var o={};o.resource=[];var i={};i.id=t,i.user=n.user.id,i.votes=a,i.timestmp=Date.now(),o.resource.push(i);var r=d,u=c.map(function(e){return e.id}).indexOf(t);return c[u].votes=a,e.patch(r,o,{headers:{"Content-Type":"multipart/form-data"},body:o}).then(s,l)}function i(t){function a(e){return n.DEBUG_MODE&&console.log("Deleting user activity record was succesful"),e.data}var s=c.map(function(e){return e.id}).indexOf(t);s>-1&&c.splice(s,1);var o=d+"/"+t;return e["delete"](o).then(a,l)}function r(){return c.length>0}function l(e){throw e}var c=[],d="/api/v2/mysql/_table/useractivity",u={getAllUserActivity:a,postRec:s,patchRec:o,deleteRec:i};return u}angular.module("app").factory("useractivity",e),e.$inject=["$http","$q","$rootScope"]}(),function(){"use strict";function e(e,t,n){function a(a){var s=c+"?limit=100&order=id%20DESC",o=e.get(s);return t.all([o]).then(function(e){return l=e[0].data.resource.concat(),n.DEBUG_MODE&&console.log("No. user actions: ",l.length),l},r)}function s(t,a,s){function o(e){var t=m;return t.id=e.data.resource[0].id,l.push(t),n.DEBUG_MODE&&console.log("Posted user activity feed"),e.data}var d=c,u={};u.bc="",u.fc="";var m={},g=0;m.userid=n.user.id,m.action=t,m.initials=n.user.name.replace(/[^A-Z]/g,""),i(n.user.id,u),m.fc=u.fc,m.bc=u.bc;for(var p=0;p<a.length;p++)switch(a[p]){case"answer":m.answer=s[p],g=n.answers.map(function(e){return e.id}).indexOf(m.answer),m.text1=n.answers[g].name;break;case"category":m.category=s[p],g=n.content.map(function(e){return e.id}).indexOf(m.category),m.text2=n.content[g].title;break;case"comment":m.comment=s[p];break;case"edit":m.edit=s[p],g=n.edits.map(function(e){return e.id}).indexOf(m.edit),m.text2=n.edits[g].field;break;case"vrow":m.vrow=s[p],g=n.cvrows.map(function(e){return e.id}).indexOf(m.vrow),m.text2=n.cvrows[g].title;break;case"text1":m.text1=s[p];break;case"text2":m.text2=s[p]}var v=[];return v.push(m),e.post(d,v,{headers:{"Content-Type":"multipart/form-data"},body:v}).then(o,r)}function o(t){function a(e){return n.DEBUG_MODE&&console.log("Deleting user activity feed was succesful"),e.data}var s={};s.resource=[];var o={};o.id=t,s.resource.push(o);var i=c+"/"+t,d=l.map(function(e){return e.id}).indexOf(t);return d>-1&&l.splice(d,1),e["delete"](i,o,{headers:{"Content-Type":"multipart/form-data"},body:s}).then(a,r)}function i(e,t){switch(e%10){case 0:t.bc="#b3b3b3",t.fc="black";break;case 1:t.bc="#666666",t.fc="white";break;case 2:t.bc="#006bb3",t.fc="white";break;case 3:t.bc="#009933",t.fc="white";break;case 4:t.bc="#cc0000",t.fc="white";break;case 5:t.bc="#538cc6",t.fc="black";break;case 6:t.bc="#b36b00",t.fc="white";break;case 7:t.bc="#999966",t.fc="black";break;case 8:t.bc="#4d0099",t.fc="white";break;case 9:t.bc="#009999",t.fc="black"}}function r(e){throw e}var l=[],c="/api/v2/mysql/_table/useractivityfeed",d={getactions:a,post:s,deletebyId:o};return d}angular.module("app").factory("uaf",e),e.$inject=["$http","$q","$rootScope"]}(),function(){"use strict";function e(e,t){function n(n){function a(e){return r=e.data.resource}if(s()&&!n)return t.when(r);var i=l;return e.get(i).then(a,o)}function a(t,n){function a(e){return i=e.data}var s=l+"/?fields=field&filter=tableid="+t;return e.get(s).then(a,o)}function s(){return r.length>0}function o(e){throw e}var i,r=[],l="/api/v2/mysql/_table/tablefield",c={getAllTableFields:n,getTableFields:a};return c}angular.module("app").factory("tablefield",e),e.$inject=["$http","$q"]}(),function(){"use strict";function e(e,t){function n(){function n(e){var n=new X2JS,a=n.xml_str2json(e.data);t.blobs=a.EnumerationResults.Blobs.Blob,t.DEBUG_MODE&&console.log("query succeded")}function a(e){t.DEBUG_MODE&&console.log("image query failed")}var s="https://rankx.blob.core.windows.net/sandiego?restype=container&comp=list&prefix="+t.canswer.id+"/&sv=2015-04-05&ss=bfqt&srt=sco&sp=rwdlacup&se=2018-08-30T01:15:12Z&st=2016-08-29T17:15:12Z&spr=https,http&sig=PpyWE0X%2Fpz9SuRje5GtHh44WaWIii0GBU9PbIcDIka8%3D";return e.get(s).then(n,a)}function a(n){function a(e){t.$emit("refreshImages"),t.DEBUG_MODE&&console.log("Blob image deleted succesfully")}function s(e){t.DEBUG_MODE&&console.log("Blob image delete failed")}var o="https://rankx.blob.core.windows.net/sandiego/"+n+"?sv=2015-04-05&ss=bfqt&srt=sco&sp=rwdlacup&se=2018-08-30T01:15:12Z&st=2016-08-29T17:15:12Z&spr=https,http&sig=PpyWE0X%2Fpz9SuRje5GtHh44WaWIii0GBU9PbIcDIka8%3D";return e["delete"](o).then(a,s)}var s={getImageList:n,deleteBlob:a};return s}angular.module("app").factory("imagelist",e),e.$inject=["$http","$rootScope"]}(),function(){"use strict";function e(e,t){function n(e,n,i){function r(e){return t.DEBUG_MODE&&console.log("query succeded"),o=e,s(o)}function l(e){t.DEBUG_MODE&&console.log("image query failed")}var c=a(e,n,i);return c.then(r,l)}function a(n,a,s){var o="",i="https://www.googleapis.com/customsearch/v1?",r="&cx=000139851817949790257%3Aqwkdgi2q2ew",l="&key=AIzaSyBr143lDEROCrUWdKvqPQmhQ5BoFo13oSE",c="&num=10&searchType=image&fileType=jpg%2C+png%2C+bmp&imgType=photo&imgSize=large&filter=1",d="",u="",m="",g="",p="";t.cCategory&&(p=t.cCategory.keywords);for(var v=[],f=0;f<n.length;f++)"edit"==s?v[f]=n[f].cval:"add"==s&&(v[f]=n[f].val);switch(1==n.length&&v[0]&&(d=v[0]),2==n.length&&(v[0]&&(d=v[0]),v[1]&&(u=v[1])),3==n.length&&(v[0]&&(d=v[0]),v[1]&&(u=v[1]),v[2]&&(m=v[2])),n.length>3&&(v[0]&&(d=v[0]),v[1]&&(u=v[1]),v[2]&&(m=v[2]),v[3]&&(g=v[3])),a){case 1:o="q="+d+" "+u+" "+p;break;case 2:o="q="+d+" "+p;break;case 3:o="q="+d+" "+p;break;case 4:o="q="+d+" "+u+" "+p}var h=i+o+r+c+l;return e.get(h)}function s(e){for(var t=[],n=!1,a=!1,s=0,o=0,r=0,l=0;i>l;l++)if(n=!1,a=!1,o=e.data.items[l].image.height,r=e.data.items[l].image.width,r>o&&1.8>r/o&&(n=!0),s=e.data.items[l].link.length,("g"==e.data.items[l].link[s-1]||"p"==e.data.items[l].link[s-1])&&(a=!0),n&&a){var c=e.data.items[l].link;t.push(c)}return t}var o=[],i=10,r={imageSearch:a,getImageLinks:n,filterImageResults:s};return r}angular.module("app").factory("image",e),e.$inject=["$http","$rootScope"]}(),function(){"use strict";function e(e){function t(e,t){var n="",a="";if("weekly"==e.freq){var s="Every: "+(e.mon?" - Monday":"")+(e.tue?" - Tuesday":"")+(e.wed?" - Wednesday":"")+(e.thu?" - Thursday":"")+(e.fri?" - Friday":"")+(e.sat?" - Saturday":"")+(e.sun?" - Sunday":"");if(a=s+"<br>From: "+e.stime2+" to "+e.etime2,t&&s.length>45){for(var o=0,i="",r=0;r<a.length;r++)if("-"==a[r]&&45>r&&(o=r),"-"==a[r]&&r>45){i=a.substring(0,o)+"<br>"+a.substring(o);break}a=i}}if("onetime"==e.freq){var l=e.sdate==e.edate;a=l?e.sdate+" from "+e.stime+" to "+e.etime:"Starts: "+e.sdate+" at "+e.stime+"<br>Ends: "+e.edate+" at "+e.etime}var c=0,d="";if(void 0==e.details&&(e.details=""),t&&e.details.length>45)for(var r=0;r<e.details.length;r++)c>42&&" "==e.details[r]&&(d+="<br>",c=0),d+=e.details[r],c++;else d=e.details;return n='<div class="text-center"><h3>'+e.stitle+"</h3><p>"+a+"</p><p>"+d+"</p></div>"}function n(e,t){var n="",a="";if("weekly"==e.freq&&(a="Every: "+(e.mon?" - Monday":"")+(e.tue?" - Tuesday":"")+(e.wed?" - Wednesday":"")+(e.thu?" - Thursday":"")+(e.fri?" - Friday":"")+(e.sat?" - Saturday":"")+(e.sun?" - Sunday":"")+"<br>From: "+e.stime2+" to "+e.etime2),"onetime"==e.freq){var s=e.sdate==e.edate;a=s?e.sdate+" from "+e.stime+" to "+e.etime:(void 0==e.edate?"":"Starts: ")+e.sdate+" at "+e.stime+(void 0==e.edate?"":"<br>Ends: "+e.edate+" at "+e.etime)}var o=0,i="";if(void 0==e.addinfo&&(e.addinfo=""),t&&e.addinfo.length>45)for(var r=0;r<e.addinfo.length;r++)o>42&&" "==e.addinfo[r]&&(i+="<br>",o=0),i+=e.addinfo[r],o++;return n="<p><strong>"+e.name+"</strong></p><p><strong>"+(void 0!=e.location?" @ "+e.location:"")+"</strong></p>"+(void 0!=e.cityarea?"<p>in "+e.cityarea+"</p>":"")+"<p>"+a+"</p>"+(void 0!=e.addinfo?"<p>"+i+"</p>":"")+(void 0!=e.website?'<p>For more information: <a href="'+e.website+'">'+e.website+"</a></p>":"")+"</div>"}var a={specialHtml:t,eventHtml:n};return a}angular.module("app").service("htmlops",e),e.$inject=["$rootScope"]}(),function(){"use strict";function e(e,t,n,a,s){function o(a){delete t.defaults.headers.common["X-Dreamfactory-API-Key"],delete t.defaults.headers.common["X-DreamFactory-Session-Token"];var o="https://en.wikipedia.org/w/api.php?action=query&format=json&origin=*&prop=extracts&list=&meta=&continue=&titles="+a;return t.post(o,{},{headers:{"Content-Type":"multipart/form-data"}}).then(function(a){var o=JSON.stringify(a.data.query.pages),i=o.slice(o.indexOf("<p><b>"),o.indexOf("<h2>"));i=i.replace(/<p>/g,""),i=i.replace(/<\/p>/g,""),i=i.replace(/<i>/g,""),i=i.replace(/<\/i>/g,""),i=i.replace(/<small>/g,""),i=i.replace(/<\/small>/g,""),i=i.replace(/<span title\=\\"Representation in the International Phonetic Alphabet \(IPA\)\\">/g,""),i=i.replace(/<\/span>/g,""),i=i.replace(/<b>/g,""),i=i.replace(/<\/b>/g,""),i=i.replace(/.\\n\\n/g,"."),i=i.replace(/.\\n/g,"."),i=i.replace(/<(?:.|\n)*?>/gm,""),e.DEBUG_MODE&&console.log("1. wiki results res - ",i),t.defaults.headers.common["X-Dreamfactory-API-Key"]=n,t.defaults.headers.common["X-DreamFactory-Session-Token"]=s.session_token,e.$emit("wikiReady",i)})}var i={getWiki:o};return i}angular.module("app").service("getwiki",e),e.$inject=["$rootScope","$http","APP_API_KEY","GOOGLE_API_KEY","$cookies"]}(),function(){"use strict";function e(e,t,n,a,s,o){function i(i){delete t.defaults.headers.common["X-Dreamfactory-API-Key"],delete t.defaults.headers.common["X-DreamFactory-Session-Token"];var r="";r=i.location.indexOf("San Diego")<0?i.location+" San Diego, CA":i.location;var l="https://maps.googleapis.com/maps/api/geocode/json?address="+r+"&key="+a;return t.get(l,{},{headers:{"Content-Type":"multipart/form-data"}}).then(function(a){i.location=a.data.results[0].formatted_address,i.lat=a.data.results[0].geometry.location.lat,i.lng=a.data.results[0].geometry.location.lng,t.defaults.headers.common["X-Dreamfactory-API-Key"]=n,t.defaults.headers.common["X-DreamFactory-Session-Token"]=s.session_token;var r=void 0!=i.location&&null!=i.location&&void 0!=i.lat&&null!=i.lat&&void 0!=i.lng&&null!=i.lng;r&&(e.coordForUSer?(e.currentUserLatitude=i.lat,e.currentUserLongitude=i.lng,e.coordForUSer=!1,e.coordsRdy=!0,e.$emit("coordsRdy"),e.loadFbnWhenCoordsRdy&&o.go("rankSummary",{index:9521}),e.loadRankWhenCoordsRdy&&o.reload()):e.$emit("answerGPSready"))})}var r={getLocationGPS:i};return r}angular.module("app").service("getgps",e),e.$inject=["$rootScope","$http","APP_API_KEY","GOOGLE_API_KEY","$cookies","$state"]}(),function(){"use strict";function e(e,t,n){function a(t,a,s){function i(e){return console.log("creating flag answer record was succesful"),e.data}var l={};l.user=n.user.id,l.number=a,l.type=t,l.flag=s,l.timestmp=Date.now();var c={};c.resource=[],c.resource.push(l);var d=r;return e.post(d,c,{headers:{"Content-Type":"multipart/form-data"},body:c}).then(i,o)}function s(){function t(e){return i=e.data.resource}var n=r;return e.get(n).then(t,o)}function o(e){throw e}var i=[],r="/api/v2/mysql/_table/flagtable",l={flagAnswer:a,getFlags:s};return l}angular.module("app").factory("flag",e),e.$inject=["$http","$q","$rootScope"]}(),function(){"use strict";function e(e,t,n){this.uploadFileToUrl=function(t,n){delete e.defaults.headers.common["X-Dreamfactory-API-Key"],delete e.defaults.headers.common["X-DreamFactory-Session-Token"],delete e.defaults.headers.common.Accept,delete e.defaults.headers.common["Accept-Language"],delete e.defaults.headers.common["Accept-Encoding"],delete e.defaults.headers.common.Referer,delete e.defaults.headers.common.origin,delete e.defaults.headers.common.Connection;var a="XvsnVKjNv25OVh37Z6UviHjw0DCfo0V5XTXpxqktR9PxHBw==",s="https://rankx.file.core.windows.net/sandiego/est/"+t.name,o=(new Date).toUTCString();console.log("date in UTC format --- ",o);var i="x-ms-date:"+o+"\nx-ms-version:2015-02-21",r="/sandiego/est/"+t.name,l="PUT\n\nmultipart/form-data\n\n"+i+r;console.log("StringToSign",l);var c=CryptoJS.enc.Base64.parse(a),d=CryptoJS.enc.Utf8.stringify(c.words),u=CryptoJS.enc.Utf8.parse(l),m=CryptoJS.HmacSHA256(u.sigBytes,d),g=CryptoJS.enc.Base64.stringify(m);return console.log("signature---",g),e.put(s,t,{headers:{"Content-Type":"multipart/form-data","x-ms-date":o,"x-ms-version":"2015-02-21",Authorization:"SharedKey rankx:"+g}}).success(function(e){console.log("Uploading file was succesful")}).error(function(e){console.log("There was a problem uploading your file")})}}angular.module("app").service("fileupload",e),e.$inject=["$http","$cookies","APP_API_KEY"]}(),function(){"use strict";function e(e,t){function n(t){function n(e){return console.log("result",e),e.data}console.log("file",t);var a=o+"/"+t.name;return e.post(a,t,{headers:{"Content-Type":"multipart/form-data"}}).then(n,s)}function a(n){function a(e){return e.data}var i=o+"/"+encodeURIComponent(n);return e.get(i,{params:{api_key:t}}).then(a,s)}function s(e){throw console.log("Error: ",e),e}var o="/api/v2/files/images",i={uploadFile:n,getFile:a};return i}angular.module("app").factory("file",e),e.$inject=["$http","APP_API_KEY"]}(),function(){"use strict";function e(e,t,n,a,s){function o(a){if(u()&&!a)return t.when(v);var s=f+"?offset=0",o=f+"?offset=1000",i=e.get(s),r=e.get(o);return t.all([i,r]).then(function(e){return v=e[0].data.resource.concat(e[1].data.resource),n.DEBUG_MODE&&console.log("No. events: ",v.length),v},g)}function i(n,a){function s(e){return p=e.data}if(m(n)&&!a)return t.when(p);var o=f+"/"+n;return e.get(o).then(s,g)}function r(t){function n(e){var n=t;return n.id=e.data.resource[0].id,v.push(n),e.data}var a=f,s=[];return s.push(t),e.post(a,s,{headers:{"Content-Type":"multipart/form-data"},body:s}).then(n,g)}function l(t,a,s){function o(e){return n.DEBUG_MODE&&console.log("updating event succesful"),e.data}var i={};i.resource=[];var r={};r.id=t;for(var l=0;l<a.length;l++)switch(a[l]){case"name":r.name=s[l];break;case"addinfo":r.addinfo=s[l];break;case"cityarea":r.cityarea=s[l];break;case"location":r.location=s[l];break;case"image":r.imageurl=s[l];break;case"views":r.views=s[l];break;case"owner":r.owner=s[l];break;case"website":r.website=s[l]}i.resource.push(r);for(var c=f,d=v.map(function(e){return e.id}).indexOf(t),l=0;l<a.length;l++)switch(a[l]){case"name":n.events[d].name=s[l];break;case"addinfo":n.events[d].addinfo=s[l];break;case"cityarea":n.events[d].cityarea=s[l];break;case"location":n.events[d].location=s[l];break;case"image":n.events[d].imageurl=s[l];break;case"views":n.events[d].views=s[l];break;case"lat":n.events[d].lat=s[l];break;case"lng":n.events[d].lng=s[l];break;case"owner":n.events[d].owner=s[l];break;case"phone":n.events[d].phone=s[l];break;case"website":n.events[d].website=s[l];break;case"email":n.events[d].email=s[l];break;case"strhours":n.events[d].strhours=s[l]}return e.patch(c,i,{headers:{"Content-Type":"multipart/form-data"},body:i}).then(o,g)}function c(t,a){function s(e){return n.DEBUG_MODE&&console.log(" event flagged succesful"),e.data}var o={};o.resource=[];var i={};i.id=t,i.flag=a,o.resource.push(i);var r=f;return e.patch(r,o,{headers:{"Content-Type":"multipart/form-data"},body:o}).then(s,g)}function d(t){function a(e){return n.DEBUG_MODE&&console.log("Deleting event was succesful"),e.data}var s={};s.resource=[];var o={};o.id=t,s.resource.push(o);var i=f+"/"+t,r=v.map(function(e){return e.id}).indexOf(t);return r>-1&&v.splice(r,1),e["delete"](i,o,{headers:{"Content-Type":"multipart/form-data"},body:s}).then(a,g)}function u(){return v.length>0}function m(e){return p&&p.id==e}function g(e){throw e}var p,v=[],f="/api/v2/mysql/_table/events",h={getevents:o,getevent:i,addevent:r,update:l,deleteEvent:d,flagEvent:c};return h}angular.module("app").factory("event",e),e.$inject=["$http","$q","$rootScope","catans","vrows"]}(),function(){"use strict";function e(e,t,n,a){function s(a){function s(e){return u=e.data.resource}if(c()&&!a)return t.when(u);var o=m+"/_table/editvotetable/?filter=user="+n.user.id;return e.get(o).then(s,d)}function o(t){function s(e){for(var s={},o=0;o<e.data.resource.length;o++)s=t[o],s.id=e.data.resource[o].id,u.push(s),n.ceditvotes.push(s),1==s.vote&&a.post("upVotedEdit",["answer","edit"],[s.answer,s.edit]),-1==s.vote&&a.post("downVotedEdit",["answer","edit"],[s.answer,s.edit]);return n.DEBUG_MODE&&console.log("Creating new voting record for edit was succesful"),e.data}var o={};o.resource=[],o.resource.push(t);var i=m+"/_table/editvotetable";return e.post(i,t,{headers:{"Content-Type":"multipart/form-data"},body:t}).then(s,d)}function i(t,a){function s(e){return n.DEBUG_MODE&&console.log("Updating vote record for edit was succesful"),e.data}var o={};o.resource=[];var i={};i.id=t,i.vote=a,i.timestmp=Date.now(),o.resource.push(i);var r=m+"/_table/editvotetable",l=u.map(function(e){return e.id}).indexOf(t);return u[l].vote=a,u[l].timestmp=i.timestmp,e.patch(r,o,{headers:{"Content-Type":"multipart/form-data"},body:o}).then(s,d)}function r(t){function a(e){return n.DEBUG_MODE&&console.log("Deleting edit vote records for answer was succesful"),e.data}for(var s=0;s<u.length;s++)u[s].answer==t&&u.splice(s,1);var o=m+"/_table/editvotetable?filter=answer="+t;return e["delete"](o).then(a,d)}function l(t){function a(e){return n.DEBUG_MODE&&console.log("Deleting edit vote records for answer was succesful"),e.data}for(var s=0;s<u.length;s++)u[s].edit==t&&u.splice(s,1);var o=m+"/_table/editvotetable?filter=edit="+t;return e["delete"](o).then(a,d)}function c(e){return u.length>0}function d(e){throw e}var u=[],m="/api/v2/mysql",g={loadEditVotesTable:s,patchEditVoteRec:i,postEditVoteRec:o,deleteEditVotes:l,deleteEditVotesbyAnswer:r};return g}angular.module("app").factory("editvote",e),e.$inject=["$http","$q","$rootScope","uaf"]}(),function(){"use strict";function e(e,t,n,a){function s(n){function a(e){return u=e.data.resource}if(c()&&!n)return t.when(u);var s=m;return e.get(s).then(a,d)}function o(t){function s(e){var s=t;return s.id=e.data.resource[0].id,u.push(s),a.post("editA",["answer","edit"],[s.answer,s.id]),n.DEBUG_MODE&&console.log("Adding new Edit succesful",e),e.data}var o=m,i=[];return i.push(t),e.post(o,i,{headers:{"Content-Type":"multipart/form-data"},body:i}).then(s,d)}function i(t,a,s){function o(e){return n.DEBUG_MODE&&console.log("updating edit vote counts succesful"),e.data}var i={};i.resource=[];var r={};r.id=t,r.upV=a,r.downV=s,i.resource.push(r);var l=m;return e.patch(l,i,{headers:{"Content-Type":"multipart/form-data"},body:i}).then(o,d)}function r(t){function a(e){return n.DEBUG_MODE&&console.log("Deleting edit was succesful"),e.data}var s={};s.resource=[];var o={};o.id=t,s.resource.push(o);var i=m+"/"+t,r=u.map(function(e){return e.id}).indexOf(t);return r>-1&&u.splice(r,1),e["delete"](i,o,{headers:{"Content-Type":"multipart/form-data"},body:s}).then(a,d)}function l(t){function a(e){return n.DEBUG_MODE&&console.log("Deleting edits for answer was succesful"),e.data}for(var s=0;s<u.length;s++)u[s].answer==t&&u.splice(s,1);var o=m+"?filter=answer="+t;return e["delete"](o).then(a,d)}function c(){return u.length>0}function d(e){throw e}var u=[],m="/api/v2/mysql/_table/edittable",g={getEdits:s,addEdit:o,updateEdit:i,deleteEdit:r,deleteEditbyAnswer:l};return g}angular.module("app").factory("edit",e),e.$inject=["$http","$q","$rootScope","uaf"]}(),function(){"use strict";function e(e,t,n,a,s){function o(e,t){BootstrapDialog.show({type:BootstrapDialog.TYPE_PRIMARY,title:e,message:t,buttons:[{id:"btn-ok",label:"OK",cssClass:"btn-primary",autospin:!1,action:function(e){e.close()}}]})}function i(e){var n=t.dialogs["dialog."+e+".title"],a=t.dialogs["dialog."+e+".text"];o(n,a)}function r(e,t,n){var a="",s="",o="",i="";a="Please Confirm",o="Cancel",i="Confirm","image"==t&&(s="You want to change the image of <strong><em>"+e.name+"</em></strong> to this one: </br><img src="+e.imageURL+' class="thumbnail" style="width:60%; max-height:150px">'),"field"==t&&"addinfo"!=e.field&&(s='You want to change the <strong class="capitalize"><em>'+e.field+"</em></strong> of <strong><em>"+e.name+"</em></strong> to <strong><em>"+e.nval+"</em></strong>."),"field"==t&&"addinfo"==e.field&&(s="You want to change the information of <strong><em>"+e.name+"</em></strong> to: <br><br>"+e.nval+"</br>."),BootstrapDialog.confirm({type:BootstrapDialog.TYPE_PRIMARY,title:a,message:s,closable:!0,draggable:!0,btnCancelLabel:o,btnOKLabel:i,btnOKClass:"btn-primary",btnCancelAction:function(e){e.close()},callback:function(t){t&&n(e)}})}function l(e,n,a){for(var s="",o="",i="",r=("table"+t.cCategory.id+".header",0);r<t.fields.length;r++){switch(t.fields[r].name){case"name":i='<strong class="capitalize">Name</strong>: '+e.name+"</br>";break;case"location":i=e.location?'<strong class="capitalize">Location</strong>: '+e.location+"</br>":"<strong>Location</strong>: </br>";break;case"cityarea":i='<strong class="capitalize">City Area</strong>: '+e.cityarea+"</br>";break;case"addinfo":i=e.addinfo?'<strong class="capitalize">Additional Info</strong>: '+e.addinfo+"</br>":"<strong>Additional Info</strong>: </br>";break;case"phone":i=e.phone?'<strong class="capitalize">Phone</strong>: '+e.phone+"</br>":"<strong>Phone</strong>: </br>";break;case"website":i=e.website?'<strong class="capitalize">Website</strong>: '+e.website+"</br>":"<strong>Website</strong>: </br>";break;case"email":i=e.email?'<strong class="capitalize">Email</strong>: '+e.email+"</br>":"<strong>Email</strong>: </br>"}s+=i}c(e,o,s,n,a)}function c(e,n,a,s,o){var i="",r="",l="",c="";i="Please Confirm",l="Cancel",c="Confirm",r="You want to add the following answer to <strong>"+t.cCategory.title+"</strong>. </br></br>"+a+"</br>With the following image:<img src="+s+' class="thumbnail" style="width:60%; max-height:150px">',BootstrapDialog.confirm({type:BootstrapDialog.TYPE_PRIMARY,title:i,message:r,closable:!0,draggable:!0,btnCancelLabel:l,btnOKLabel:c,btnOKClass:"btn-primary",btnCancelAction:function(e){e.close()},callback:function(t){t&&o(e)}})}function d(e,t,n,a){var s="",o="";"approve"==n&&"addinfo"!=e.field&&(s="Changed Approved",o="Congrats! With your vote, the change of <strong>"+e.field+"</strong> of <strong>"+e.name+"</strong> to <strong>"+e.nval+"</strong> gets approved."),"approve"==n&&"addinfo"==e.field&&(s="Changed Approved",o="Congrats! With your vote, the information of <strong>"+e.name+"</strong> to <br><br>"+e.nval+"</br> gets approved."),"reject"==n&&(s="Changed Rejected",o="Congrats! With your vote, the change of <strong>"+e.field+"</strong> of <strong>"+e.name+"</strong> to <strong>"+e.nval+"</strong> has been rejected."),BootstrapDialog.show({type:BootstrapDialog.TYPE_PRIMARY,title:s,message:o,buttons:[{id:"btn-ok",label:"OK",cssClass:"btn-primary",autospin:!1,action:function(e,s){a(t,n),e.close()}}]})}function u(e){var t="",n="";"editAnswer"==e&&(n="Information Edits",t="Use edits to correct, add or update information in a profile. All edits need to be accepted by other users before they are approved. </br></br>An edit or change becomes approved when the number of people that agree exceeds the number of people that disagree by 3. </br></br>An edit or change gets rejected when the number of people that disagree exceeds those that agree by 3. </br></br> Only one edit per field at a time is allowed. Make sure you vote on the edits you agree or disagree."),"addAnswer"==e&&(n="Add a new answer",t="1. Fill out the form. The fields marked with ** are required. All other fields are not required but recommended. <br/><br/>2. Click the 'Get Images' button. <br/><br/>3. Use '>>' and '<<' buttons to browse through the images. You can 'Get More Images' button to load more images.<br/><br/>4. When the image you want shows in the image box, click the button 'Add' to add the new answer to the list.<br/><br/>NOTE: Not all images will correspond to your answer. Entering all fields will help with the image results."),
"shortPhrase"==e&&(n="Add an Answer",t="Fill out the form. The fields marked with ** are required. <br/><br/> - The <strong>Title</strong> is the main idea of your answer. <br/><br/> - In the <strong>Details</strong> box, write additional details about your answer. You can also write arguments on why it should be included in this list.<br/><br/>For example: <br/><br/>In the rank <strong><em>Reasons why dogs are awesome</em></strong> you can add following answer: <br/><br/><strong>Title:</strong> They enjoy the simple things in life <br/><br/><strong>Details:</strong> Dogs dont need much to be happy, they are happy with simple things like a belly rub, a walk around the block, playing in the snow or going for a drive."),BootstrapDialog.show({type:BootstrapDialog.TYPE_PRIMARY,title:n,message:t,buttons:[{id:"btn-ok",label:"OK",cssClass:"btn-primary",autospin:!1,action:function(e){e.close()}}]})}function m(e){BootstrapDialog.show({type:BootstrapDialog.TYPE_PRIMARY,title:"Image URL",message:e,buttons:[{id:"btn-ok",label:"OK",cssClass:"btn-primary",autospin:!1,action:function(e){e.close()}}]})}function g(e,n,a,s){for(var o="",i="",r="",l="",c=0;c<t.fields.length;c++){switch(t.fields[c].name){case"name":r='<strong class="capitalize">Name</strong>: '+e.name+"</br>",l='<strong class="capitalize">Name</strong>: '+n.name+"</br>";break;case"location":r=e.location?'<strong class="capitalize">Location</strong>: '+e.location+"</br>":"<strong>Location</strong>: </br>",l=n.location?'<strong class="capitalize">Location</strong>: '+n.location+"</br>":"<strong>Location</strong>: </br>";break;case"cityarea":r='<strong class="capitalize">City Area</strong>: '+e.cityarea+"</br>",l='<strong class="capitalize">City Area</strong>: '+n.cityarea+"</br>";break;case"addinfo":r=e.addinfo?'<strong class="capitalize">Additional Infob</strong>: '+e.addinfo+"</br>":"<strong>Additional Info</strong>: </br>",l=n.addinfo?'<strong class="capitalize">Additional Infob</strong>: '+n.addinfo+"</br>":"<strong>Additional Info</strong>: </br>";break;case"phone":r=e.phone?'<strong class="capitalize">Phoneb</strong>: '+e.phone+"</br>":"<strong>Phone</strong>: </br>",l=n.phone?'<strong class="capitalize">Phoneb</strong>: '+n.phone+"</br>":"<strong>Phone</strong>: </br>";break;case"website":r=e.website?'<strong class="capitalize">Websiteb</strong>: '+e.website+"</br>":"<strong>Website</strong>: </br>",l=n.website?'<strong class="capitalize">Websiteb</strong>: '+n.website+"</br>":"<strong>Website</strong>: </br>";break;case"email":r=e.email?'<strong class="capitalize">Emailb</strong>: '+e.email+"</br>":"<strong>Email</strong>: </br>",l=n.email?'<strong class="capitalize">Emailb</strong>: '+n.email+"</br>":"<strong>Email</strong>: </br>"}o+=r,i+=l}p(e,o,n,i,a,s)}function p(e,n,a,s,o,i){var r="",l="",c="",d="";r="Just checking",c="No, they are different",d="Yeah, same",l="Are these the same "+t.cCategory.type+'? </br></br><div class="row"><div class="col-sm-6">'+n+"</br><img src="+e.imageurl+' class="thumbnail" style="width:60%; max-height:150px"></div><div class="col-sm-6">'+s+"</br><img src="+a.imageurl+' class="thumbnail" style="width:60%; max-height:150px"></div></div>',BootstrapDialog.confirm({type:BootstrapDialog.TYPE_PRIMARY,title:r,message:l,closable:!0,draggable:!0,btnCancelLabel:c,btnOKLabel:d,btnOKClass:"btn-primary",btnCancelAction:function(e){e.close()},callback:function(t){t?i():o(e)}})}function v(e,n){var a="",s="",o="",i="";a="Scope of Delete",o="Just in the category: "+t.cCategory.title,i="Everywhere",s="Choose scope to delete:",BootstrapDialog.confirm({type:BootstrapDialog.TYPE_DANGER,title:a,message:s,closable:!0,draggable:!0,btnCancelLabel:o,btnOKLabel:i,btnOKClass:"btn-primary",btnCancelAction:function(e){e.close()},callback:function(t){t?n():e()}})}function f(e,t){var n="",a="",s="",o="",i="";if(n="Special Preview",s="Back",o="Save Special","weekly"==e.freq&&(i="Every: "+(e.mon?" - Monday":"")+(e.tue?" - Tuesday":"")+(e.wed?" - Wednesday":"")+(e.thu?" - Thursday":"")+(e.fri?" - Friday":"")+(e.sat?" - Saturday":"")+(e.sun?" - Sunday":"")+"<br>From: "+e.stime2+" to "+e.etime2),"onetime"==e.freq){var r=e.sdate==e.edate;i=r?e.sdate+" from "+e.stime+" to "+e.etime:"Starts: "+e.sdate+" at "+e.stime+"<br>Ends: "+e.edate+" at "+e.etime}a='This is how this special will look: </br></br>In the ranking summary:<br><table class="table table-hover cursor "><thead><tr><th>Rank</th><th>Name</th><th>Distance</th><th>Specials</th></tr></thead><tbody><tr><td>1</td><td>'+e.name+'</td><td>1.5</td><td style="background-color:'+e.bc+";color:"+e.fc+';">'+e.stitle+'<td></tr></tbody></table><br>Inside your business profile:<br><br><div style="background-color:'+e.bc+";color:"+e.fc+';"><p><strong>'+e.stitle+" @ "+e.name+"</strong></p><p>"+i+"</p><p>"+e.details+"</p></div></br>With the following image:<img src="+e.image+' class="thumbnail" style="width:70%; max-height:150px">',BootstrapDialog.confirm({type:BootstrapDialog.TYPE_PRIMARY,title:n,message:a,closable:!0,draggable:!0,btnCancelLabel:s,btnOKLabel:o,btnOKClass:"btn-primary",btnCancelAction:function(e){e.close()},callback:function(e){e&&t()}})}function h(e){var t="",n="",a="",s="";t="Confirm Delete",a="Cancel",s="Delete",n="Just confirming, do you want to delete?",BootstrapDialog.confirm({type:BootstrapDialog.TYPE_DANGER,title:t,message:n,closable:!0,draggable:!0,btnCancelLabel:a,btnOKLabel:s,btnOKClass:"btn-primary",btnCancelAction:function(e){e.close()},callback:function(t){t&&e()}})}function b(e){var t="",n="",a="",s="";t="Share Location",a="Not Now",s="Ok",n="Please allow browser share location so we can calculate distance to the best places.",BootstrapDialog.confirm({type:BootstrapDialog.TYPE_PRIMARY,title:t,message:n,closable:!0,draggable:!0,btnCancelLabel:a,btnOKLabel:s,btnOKClass:"btn-primary",btnCancelAction:function(e){e.close()},callback:function(t){t&&e()}})}function w(e){var t="",n="",a="",s="";t="Do you own this business?",a="Cancel",s="Bind",n="If you own or represent this business, please bind to your account so only you can change or edit its information.<br><br><strong>* Name of Business</strong><br><strong>* Address</strong><br><strong>* Phone Number</strong><br><strong>* Main Photo</strong><br><strong>* Hours</strong><br><br>Binding this business to your account is free.",BootstrapDialog.confirm({type:BootstrapDialog.TYPE_PRIMARY,title:t,message:n,closable:!0,draggable:!0,btnCancelLabel:a,btnOKLabel:s,btnOKClass:"btn-primary",btnCancelAction:function(e){e.close()},callback:function(t){t&&e()}})}function y(e,t,n){var a="",s="",o="",i="";a="Confirmation",o="Cancel",i="Yes, bind this business to my account",s="<br><strong>Note:</strong> Claiming to have false authority over a business is against the law.<br><br>Please confirm:<br><br>You, <strong>"+e+"</strong>, have the authority to represent <strong>"+t+"</strong>.",BootstrapDialog.confirm({type:BootstrapDialog.TYPE_PRIMARY,title:a,message:s,closable:!0,draggable:!0,btnCancelLabel:o,btnOKLabel:i,btnOKClass:"btn-primary",btnCancelAction:function(e){e.close()},callback:function(e){e&&n()}})}function k(e,t){var n="",a="",s="",o="";n="Enter Data",s="Cancel",o="Add",a="<br> Enter new vote row to be added in Group: <strong>"+e.gtitle+'</strong><br><br>Vote Row Name:<input class="form-control" type="text" placeholder="Enter Vote Row Name"><br><br>',BootstrapDialog.show({type:BootstrapDialog.TYPE_PRIMARY,title:n,message:a,closable:!0,draggable:!0,buttons:[{label:"Cancel",action:function(e){e.close()}},{label:"OK",action:function(n,a){var s=n.getModalBody().find("input").val();a&&t(e,s),n.close()}}]})}function x(e,t){var n="",a="",s="",o="";n="Please Confirm",s="Cancel",o="Yes, Delete",a="<br>Please confirm, you want to delete vote row <strong>"+e.title+"</strong> from <strong>"+e.gtitle+"</strong>.<br><br><strong>Note:</strong> All vote records will be lost",BootstrapDialog.confirm({type:BootstrapDialog.TYPE_DANGER,title:n,message:a,closable:!0,draggable:!0,btnCancelLabel:s,btnOKLabel:o,btnOKClass:"btn-default",btnCancelAction:function(e){e.close()},callback:function(n){n&&t(e)}})}function D(e,t){var n="",a="",s="",o="";n="Enter Data",s="Cancel",o="Add",a='<br>Enter name of Vote Group you want to create: <br><br>Group Name:<input class="form-control" type="text" placeholder="Enter Vote Row Group Name"><br><br>',BootstrapDialog.show({type:BootstrapDialog.TYPE_PRIMARY,title:n,message:a,closable:!0,draggable:!0,buttons:[{label:"Cancel",action:function(e){e.close()}},{label:"OK",action:function(n,a){var s=n.getModalBody().find("input").val();a&&t(e,s),n.close()}}]})}function E(e,t,n){var a="",s="",o="",i="";a="Enter Data",o="Cancel",i="Edit",s='<br>Enter new name of Vote Group: <br><br>Group Name:<input class="form-control" type="text" placeholder="'+e.gtitle+'"><br><br>',BootstrapDialog.show({type:BootstrapDialog.TYPE_PRIMARY,title:a,message:s,closable:!0,draggable:!0,buttons:[{label:"Cancel",action:function(e){e.close()}},{label:"Edit",action:function(n,a){var s=n.getModalBody().find("input").val();a&&t(e,s),n.close()}},{label:"Delete",action:function(t,a){a&&n(e),t.close()}}]})}function C(e,t){var n="",a="",s="",o="";n="Please Confirm",s="Cancel",o="Yes, Delete",a="<br>Please confirm, you want to delete the vote group <strong>"+e.gtitle+"</strong> and all the items within it.<br><br><strong>Note:</strong> All vote records for all items will be lost",BootstrapDialog.confirm({type:BootstrapDialog.TYPE_DANGER,title:n,message:a,closable:!0,draggable:!0,btnCancelLabel:s,btnOKLabel:o,btnOKClass:"btn-default",btnCancelAction:function(e){e.close()},callback:function(n){n&&t(e)}})}function A(e,n){for(var a="",s="",o=0;o<t.fields.length;o++){switch(t.fields[o].name){case"name":s='<strong class="capitalize">Name</strong>: '+e.name+"</br>";break;case"location":s=e.location?'<strong class="capitalize">Location</strong>: '+e.location+"</br>":"<strong>Location</strong>: </br>";break;case"cityarea":s='<strong class="capitalize">City Area</strong>: '+e.cityarea+"</br>";break;case"addinfo":s=e.addinfo?'<strong class="capitalize">Additional Info</strong>: '+e.addinfo+"</br>":"<strong>Additional Info</strong>: </br>";break;case"website":s=e.website?'<strong class="capitalize">Website</strong>: '+e.website+"</br>":"<strong>Website</strong>: </br>";break;case"date":s=e.date?'<strong class="capitalize">Date</strong>: '+e.sdate+"</br>":"<strong>Date</strong>: </br>"}a+=s}var i="",r="";if("weekly"==e.freq&&(r="Every: "+(e.mon?" - Monday":"")+(e.tue?" - Tuesday":"")+(e.wed?" - Wednesday":"")+(e.thu?" - Thursday":"")+(e.fri?" - Friday":"")+(e.sat?" - Saturday":"")+(e.sun?" - Sunday":"")+"<br>From: "+e.stime2+" to "+e.etime2),"onetime"==e.freq){var l=e.sdate==e.edate;r=l?e.sdate+" from "+e.stime+" to "+e.etime:(void 0==e.edate?"":"Starts: ")+e.sdate+" at "+e.stime+(void 0==e.edate?"":"<br>Ends: "+e.edate+" at "+e.etime)}i='<div style="background-color:'+e.bc+";color:"+e.fc+';"><p><strong>'+e.name+(void 0!=e.location?" @ "+e.location:"")+"</strong></p>"+(void 0!=e.cityarea?"<p>in "+e.cityarea+"</p>":"")+"<p>"+r+"</p>"+(void 0!=e.addinfo?"<p>"+e.addinfo+"</p>":"")+(void 0!=e.website?'<p>For more information: <a href="'+e.website+'">'+e.website+"</a></p>":"")+"</div>",R(e,a,i,e.imageurl,n)}function R(e,n,a,s,o){var i="",r="",l="",c="";i="Please Confirm",l="Cancel",c="Confirm",r="You want to add the following event to <strong>"+t.cCategory.title+"</strong>. </br><p></p>"+a+"</br>With the following image:<img src="+s+' class="thumbnail" style="width:60%; max-height:150px">',BootstrapDialog.confirm({type:BootstrapDialog.TYPE_PRIMARY,title:i,message:r,closable:!0,draggable:!0,btnCancelLabel:l,btnOKLabel:c,btnOKClass:"btn-primary",btnCancelAction:function(e){e.close()},callback:function(t){t&&o(e)}})}function M(){var e="",n="",a="",s="No, I don't approve",o="Yes, locate me";e="Please Confirm",n='<div class="text-left">Is it ok if we locate your position?</div><br><div class="row"><div class="container col-xs-12"><div class="text-left" style="color:blue">Option 1</div><div class="text-center" style="border:2px"><button class="btn btn-success" id="useGeo">Yes, locate me with my IP</button></div><br><div class="text-left" style="color:blue">Option 2 <small>(recommended for accuracy)</small></div><br><p>Yes, use this address as my current location</p><div class="input-group"><input id="address" type="text" class="form-control" placeholder="Enter address"><span class="input-group-btn text-right"><button class="btn btn-success" type="button" id="gobutton">Go</button></span></div><br><br></div><div class="container col-xs-12"><div class="text-center" style="border:2px"><button class="btn btn-default" id="noapprove">No, I don\'t approve</button></div></div></div>',a='<div class="loading-pulse"></div><p>Just a moment, finding your location...</p>',BootstrapDialog.show({type:BootstrapDialog.TYPE_PRIMARY,title:e,message:function(e){var s=$(n);return s.find("#useGeo").click({},function(){var n=e;t.$emit("getLocation"),n.enableButtons(!1),n.setClosable(!1),n.getModalBody().html(a),n.setTitle("Please wait"),setTimeout(function(){n.close()},1e4)}),s.find("#gobutton").click({},function(){var n=s.find("input").val(),a=e;t.$emit("useAddress",{address:n}),a.close()}),s.find("#noapprove").click({},function(){var t=e;t.close()}),s},closable:!0,draggable:!0,btnCancelLabel:s,btnOKLabel:o,btnOKClass:"btn-success",btnCancelClass:"btn-warning",btnCancelAction:function(e){e.close()}})}function P(e){var a="",s="",o="No, I don't approve",i="Yes, locate me";a="Missing info",s='<div class="text-left">Let\'s stay in touch. Please provide us an email address where we can keep you updated on everything related to the <strong>'+e+'</strong> account.</div><br><div class="input-group"><input id="email" type="text" class="form-control" placeholder="Enter email address"><span class="input-group-btn text-right"><button class="btn btn-primary" type="button" id="gobutton">Submit</button></span></div><br>',BootstrapDialog.show({type:BootstrapDialog.TYPE_PRIMARY,title:a,message:function(e){var a=$(s);return a.find("#gobutton").click({},function(){var s=a.find("input").val(),o=e;t.showWarning=!1,n.updateuseraccnt(t.useraccnts[0].id,["email"],[s]),o.close(),t.$emit("hideWarning")}),a},closable:!0,draggable:!0,btnCancelLabel:o,btnOKLabel:i,btnOKClass:"btn-success",btnCancelClass:"btn-warning",btnCancelAction:function(e){e.close()}})}function S(e,n,a,s){var o="",i="",r="No, I don't approve",l="Yes, locate me",c=n,d=e.length,u="";u=(t.sm,"width:100%;height:auto"),o="Photos - "+a.name;var m="",g="",p="",v="";s?(m='<div class="row"><div class="text-left col-xs-3 col-md-4"><button class="btn btn-default pull-left" id="prevbutton">&lt;&lt</button></div><div class="text-middle col-xs-5 col-md-4"><button class="btn btn-default" id="makeprimary">Make Main Photo</button></div><div class="text-right col-xs-4 col-md-4"><button class="btn btn-default pull-right" id="nextbutton">&gt;&gt</button></div></div>',v='<div class="text-right"><button type="button" class="btn btn-default pull-right" style="vertical-align:middle;" id="trashbutton"><span class="glyphicon glyphicon-trash" style="padding-top:0px;padding-bottom:0px;" aria-hidden="true"></span></button></div><br/>'):(m='<div class="row"><div class="text-left col-xs-6"><button class="btn btn-default pull-left" id="prevbutton">&lt;&lt</button></div><div class="text-right col-xs-6"><button class="btn btn-default pull-right" id="nextbutton">&gt;&gt</button></div></div>',v="<br/><br/>"),g='<br><div class="text-center"><img id="image" class="displayed" src="https://rankx.blob.core.windows.net/sandiego/',p='" style="'+u+'"></div><br/>',i=m+g+e[c].Name+p+v,BootstrapDialog.show({type:BootstrapDialog.TYPE_PRIMARY,title:o,message:function(t){var n=$(i),s=t;return n.find("#prevbutton").click({},function(){c-=1,0>c&&(c=d-1),console.log("prev"),n.find("#image").attr("src","https://rankx.blob.core.windows.net/sandiego/"+e[c].Name)}),n.find("#nextbutton").click({},function(){c+=1,c>=d&&(c=0),n.find("#image").attr("src","https://rankx.blob.core.windows.net/sandiego/"+e[c].Name)}),n.find("#trashbutton").click({},function(){O(e,c),s.close()}),n.find("#makeprimary").click({},function(){I(e,c,a),s.close()}),n},closable:!0,draggable:!0,btnCancelLabel:r,btnOKLabel:l,btnOKClass:"btn-success",btnCancelClass:"btn-warning",btnCancelAction:function(e){e.close()}})}function O(e,t){var n="",s="",o="",i="";n="Please Confirm",o="Cancel",i="Yes, Delete",s='<br>Please confirm, you want to delete this photo: <br/><img id="image" class="displayed" src="https://rankx.blob.core.windows.net/sandiego/'+e[t].Name+'" style="width:100%;height:auto"><br><br>',BootstrapDialog.confirm({type:BootstrapDialog.TYPE_DANGER,title:n,message:s,closable:!0,draggable:!0,btnCancelLabel:o,btnOKLabel:i,btnOKClass:"btn-default",btnCancelAction:function(e){e.close()},callback:function(n){n&&a.deleteBlob(e[t].Name)}})}function I(e,t,n){var a="",o="",i="",r="";a="Please Confirm",i="Cancel",r="Yes, make primary",o='<br>Please confirm, you want to make this the primary photo: <br/><img id="image" class="displayed" src="https://rankx.blob.core.windows.net/sandiego/'+e[t].Name+'" style="width:100%;height:auto"><br><br>',BootstrapDialog.confirm({type:BootstrapDialog.TYPE_PRIMARY,title:a,message:o,closable:!0,draggable:!0,btnCancelLabel:i,btnOKLabel:r,btnOKClass:"btn-default",btnCancelAction:function(e){e.close()},callback:function(a){if(a){var o="https://rankx.blob.core.windows.net/sandiego/"+e[t].Name;s.updateAnswer(n.id,["image"],[o])}}})}var L={editConfirm:r,getDialog:i,showDialog:o,howItWorks:u,addAnswer:l,showAddAnswer:c,editChangeEffective:d,checkSameAnswer:g,showSameAnswer:p,deleteType:v,deleteRank:h,getLocation:b,url:m,createSpecialPreview:f,bizRegistration:w,bindAccount:y,addVRow:k,deleteVRow:x,addVRowGroup:D,editVRowGroup:E,deleteVRowGroup:C,showAddEvent:R,createEventPreview:A,askPermissionToLocate:M,askEmail:P,seePhotos:S};return L}angular.module("app").factory("dialog",e),e.$inject=["$q","$rootScope","useraccnt","imagelist","answer"]}(),function(){"use strict";function e(e,t,n,a,s){function o(t,n){n.commLoaded||(n.commLoaded=!0,e.isLoggedIn&&(n.initials=e.user.name.replace(/[^A-Z]/g,""),r(e.user.id,c),n.bc=c.bc,n.fc=c.fc),"answer"==t&&s.getcomments().then(function(e){n.comments=e;for(var t=0;t<n.comments.length;t++){n.comments[t].initials=n.comments[t].username.replace(/[^A-Z]/g,"");var a=new Date,s=a.getTimezoneOffset(),o=new Date(n.comments[t].timestmp);o.setMinutes(o.getMinutes()-s),n.comments[t].date=o.toLocaleDateString()+" "+o.toLocaleTimeString(),r(n.comments[t].user,c),n.comments[t].bc=c.bc,n.comments[t].fc=c.fc}}),"category"==t&&a.getcomments().then(function(e){n.comments=e;for(var t=0;t<n.comments.length;t++){n.comments[t].initials=n.comments[t].username.replace(/[^A-Z]/g,"");var a=new Date,s=a.getTimezoneOffset(),o=new Date(n.comments[t].timestmp);o.setMinutes(o.getMinutes()-s),n.comments[t].date=o.toLocaleDateString()+" "+o.toLocaleTimeString(),r(n.comments[t].user,c),n.comments[t].bc=c.bc,n.comments[t].fc=c.fc}}))}function i(o,i){var l={};l.body=i.newComment,l.username=e.user.name,l.user=e.user.id,l.timestmp=Date.now(),i.newComment="","category"==o&&(l.category=e.cCategory.id,a.addcomment(l).then(function(){l.initials=e.user.name.replace(/[^A-Z]/g,""),r(e.user.id,c),l.fc=c.fc,l.bc=c.bc,l.date="Just now",i.comments.push(l),t.update(e.cCategory.id,["numcom"],[i.comments.length])})),"answer"==o&&(l.answer=e.canswer.id,s.addcomment(l).then(function(){l.initials=e.user.name.replace(/[^A-Z]/g,""),r(e.user.id,c),l.fc=c.fc,l.bc=c.bc,l.date="Just now",i.comments.push(l),n.updateAnswer(e.canswer.id,["numcom"],[i.comments.length])}))}function r(e,t){switch(e%10){case 0:t.bc="#b3b3b3",t.fc="black";break;case 1:t.bc="#666666",t.fc="white";break;case 2:t.bc="#006bb3",t.fc="white";break;case 3:t.bc="#009933",t.fc="white";break;case 4:t.bc="#cc0000",t.fc="white";break;case 5:t.bc="#538cc6",t.fc="black";break;case 6:t.bc="#b36b00",t.fc="white";break;case 7:t.bc="#999966",t.fc="black";break;case 8:t.bc="#4d0099",t.fc="white";break;case 9:t.bc="#009999",t.fc="black"}}var l={loadComments:o,postComment:i,getIconColors:r},c={};return c.bc="",c.fc="",l}angular.module("app").service("commentops",e),e.$inject=["$rootScope","table","answer","comment","comment2"]}(),function(){"use strict";function e(e,t,n,a){function s(a){function s(e){return u=e.data.resource}if(c()&&!a)return t.when(u);var o=m+"/?filter=answer="+n.canswer.id;return e.get(o).then(s,d)}function o(t){function s(e){var s=t;return s.id=e.data.resource[0].id,a.post("commentA",["answer"],[t.answer]),n.DEBUG_MODE&&console.log("Adding new comment succesful",e),e.data}var o=m,i=[];return i.push(t),e.post(o,i,{headers:{"Content-Type":"multipart/form-data"},body:i}).then(s,d)}function i(t,a,s){function o(e){return n.DEBUG_MODE&&console.log("updating comment vote counts succesful"),e.data}var i={};i.resource=[];var r={};r.id=t,r.upV=a,r.downV=s,i.resource.push(r);var l=m;return e.patch(l,i,{headers:{"Content-Type":"multipart/form-data"},body:i}).then(o,d)}function r(t){function a(e){return n.DEBUG_MODE&&console.log("Deleting comment was succesful"),e.data}var s={};s.resource=[];var o={};o.id=t,s.resource.push(o);var i=m+"/"+t,r=u.map(function(e){return e.id}).indexOf(t);return r>-1&&u.splice(r,1),e["delete"](i,o,{headers:{"Content-Type":"multipart/form-data"},body:s}).then(a,d)}function l(t){function a(e){return n.DEBUG_MODE&&console.log("Deleting comments for answer was succesful"),e.data}for(var s=0;s<u.length;s++)u[s].user==t&&u.splice(s,1);var o=m+"?filter=user="+t;return e["delete"](o).then(a,d)}function c(){return!1}function d(e){throw e}var u=[],m="/api/v2/mysql/_table/comments2",g={getcomments:s,addcomment:o,updatecomment:i,deletecomment:r,deletecommentsbyuser:l};return g}angular.module("app").factory("comment2",e),e.$inject=["$http","$q","$rootScope","uaf"]}(),function(){"use strict";function e(e,t,n,a){function s(a){function s(e){return u=e.data.resource}if(c()&&!a)return t.when(u);var o=m+"/?filter=category="+n.cCategory.id;return e.get(o).then(s,d)}function o(t){function s(e){var s=t;return s.id=e.data.resource[0].id,a.post("commentR",["category"],[t.category]),n.DEBUG_MODE&&console.log("Adding new comment succesful",e),e.data}var o=m,i=[];return i.push(t),e.post(o,i,{headers:{"Content-Type":"multipart/form-data"},body:i}).then(s,d)}function i(t,a,s){function o(e){return n.DEBUG_MODE&&console.log("updating comment vote counts succesful"),e.data}var i={};i.resource=[];var r={};r.id=t,r.upV=a,r.downV=s,i.resource.push(r);var l=m;return e.patch(l,i,{headers:{"Content-Type":"multipart/form-data"},body:i}).then(o,d)}function r(t){function a(e){return n.DEBUG_MODE&&console.log("Deleting comment was succesful"),e.data}var s={};s.resource=[];var o={};o.id=t,s.resource.push(o);var i=m+"/"+t,r=u.map(function(e){return e.id}).indexOf(t);return r>-1&&u.splice(r,1),e["delete"](i,o,{headers:{"Content-Type":"multipart/form-data"},body:s}).then(a,d)}function l(t){function a(e){return n.DEBUG_MODE&&console.log("Deleting comments for answer was succesful"),e.data}for(var s=0;s<u.length;s++)u[s].user==t&&u.splice(s,1);var o=m+"?filter=user="+t;return e["delete"](o).then(a,d)}function c(){return!1}function d(e){throw e}var u=[],m="/api/v2/mysql/_table/comments",g={getcomments:s,addcomment:o,updatecomment:i,deletecomment:r,deletecommentsbyuser:l};return g}angular.module("app").factory("comment",e),e.$inject=["$http","$q","$rootScope","uaf"]}(),function(){"use strict";function e(e,t,n,a){function s(a){if(u()&&!a)return t.when(g);var s=p+"?offset=0",o=p+"?offset=1000",i=p+"?offset=2000",r=e.get(s),l=e.get(o),c=e.get(i);return t.all([r,l,c]).then(function(e){return g=e[0].data.resource.concat(e[1].data.resource,e[2].data.resource),n.DEBUG_MODE&&console.log("No. Cat-Ans: ",g.length),g},m)}function o(t){function a(e){var t=e.data.resource[0].id;return g[g.length-1].id=t,n.DEBUG_MODE&&console.log("creating catans record was succesful"),e.data}var s={};s.answer=t,s.category=n.cCategory.id,s.upV=0,s.downV=0,s.user=n.user.id,s.timestmp=Date.now();var o={};o.resource=[],o.resource.push(s),g.push(s);var i=p;return e.post(i,o,{headers:{"Content-Type":"multipart/form-data"},body:o}).then(a,m)}function i(t,a){function s(e){return n.DEBUG_MODE&&console.log("creating catans record was succesful"),e.data}var o={};o.answer=t,o.category=a,o.upV=0,o.downV=0,o.user=n.user.id,o.timestmp=Date.now();var i={};i.resource=[],i.resource.push(o),g.push(o);var r=p;return e.post(r,i,{headers:{"Content-Type":"multipart/form-data"},body:i}).then(s,m)}function r(t){function s(e){for(var t=0;t<e.data.resource.length;t++)a.deleteVotesbyCatans(e.data.resource[t].id);return n.DEBUG_MODE&&console.log("Deleting catans records was succesful"),e.data}for(var o=0;o<g.length;o++)g[o].answer==t&&g.splice(o,1);var i=p+"?filter=answer="+t;return e["delete"](i).then(s,m)}function l(t,s){function o(e){for(var t=0;t<e.data.resource.length;t++)a.deleteVotesbyCatans(e.data.resource[t].id);return n.DEBUG_MODE&&console.log("Deleting catans records by answer and category was succesful"),e.data}for(var i=0;i<g.length;i++)g[i].answer==t&&g[i].category==s&&g.splice(i,1);var r=p+"?filter=(answer="+t+") AND (category="+s+")";return e["delete"](r).then(o,m)}function c(t){function s(e){for(var t=0;t<e.data.resource.length;t++)a.deleteVotesbyCatans(e.data.resource[t].id);return n.DEBUG_MODE&&console.log("Deleting catans records by category was succesful"),e.data}for(var o=0;o<g.length;o++)g[o].category==t&&g.splice(o,1);var i=p+"?filter=category="+t;return e["delete"](i).then(s,m)}function d(t,a,s){function o(e){return n.DEBUG_MODE&&console.log("updating catans record succesful"),e.data}var i={};i.resource=[];var r={};r.id=t;for(var l=0;l<a.length;l++)switch(a[l]){case"upV":r.upV=s[l];break;case"downV":r.downV=s[l];break;case"rank":r.rank=s[l];break;case"answer":r.answer=s[l];break;case"isdup":r.isdup=s[l]}i.resource.push(r);for(var c=p,d=g.map(function(e){return e.id}).indexOf(t),l=0;l<a.length;l++)switch(a[l]){case"upV":n.catansrecs[d].upV=s[l];break;case"downV":n.catansrecs[d].downV=s[l];break;case"rank":n.catansrecs[d].rank=s[l];break;case"answer":n.catansrecs[d].answer=s[l];break;case"isdup":n.catansrecs[d].isdup=s[l]}return e.patch(c,i,{headers:{"Content-Type":"multipart/form-data"},body:i}).then(o,m)}function u(){return g.length>0}function m(e){throw e}var g=[],p="/api/v2/mysql/_table/catans",v={getAllcatans:s,postRec:o,postRec2:i,deleteRec:l,deleteAnswer:r,updateRec:d,deletebyCategory:c};return v}angular.module("app").factory("catans",e),e.$inject=["$http","$q","$rootScope","votes"]}(),function(){"use strict";function e(e,t,n,a,s,o){function i(a){if(p()&&!a)return t.when(b);var s=w+"?offset=0",o=w+"?offset=1000",i=w+"?offset=2000",r=e.get(s),l=e.get(o),c=e.get(i);return t.all([r,l,c]).then(function(e){return b=e[0].data.resource.concat(e[1].data.resource,e[2].data.resource),n.DEBUG_MODE&&console.log("No. Answers: ",b.length),b},f)}function r(n,a){function s(e){return h=e.data}if(v(n)&&!a)return t.when(h);var o=w+"/"+n;return e.get(o).then(s,f)}function l(t){function n(e){return e.data}var a=w+"/?filter=customer="+t;return e.get(a).then(n,f)}function c(t){function i(e){var i=t;return i.id=e.data.resource[0].id,b.push(i),"Establishment"==i.type&&(n.estNames.push(i.name),n.estAnswers.push(i)),"Person"==i.type&&(n.pplNames.push(i.name),n.pplAnswers.push(i)),a.postRec(i.id),s.postVrows4Answer(i),o.post("addedAnswer",["answer","category"],[i.id,n.cCategory.id]),n.DEBUG_MODE&&console.log("created catans for a new answer"),n.DEBUG_MODE&&console.log("result",e),e.data}var r=w,l=[];return l.push(t),e.post(r,l,{headers:{"Content-Type":"multipart/form-data"},body:l}).then(i,f)}function d(t,i){function r(e){var r=t;r.id=e.data.resource[0].id,b.push(r),"Establishment"==r.type&&(n.estNames.push(r.name),n.estAnswers.push(r)),"Person"==r.type&&(n.pplNames.push(r.name),n.pplAnswers.push(r)),o.post("addedAnswer",["answer","category"],[r.id,i[0]]);for(var l=0;l<i.length;l++)a.postRec2(r.id,i[l]);return s.postVrows4Answer(r),n.DEBUG_MODE&&console.log("created "+i.length+"catans records for the new answer"),n.DEBUG_MODE&&console.log("result",e),e.data}var l=w,c=[];return c.push(t),e.post(l,c,{headers:{"Content-Type":"multipart/form-data"},body:c}).then(r,f)}function u(t,a,s){function i(e){return"owner"==a[0]&&o.post("binded",["answer"],[t]),n.DEBUG_MODE&&console.log("updating answer succesful"),e.data}var r={};r.resource=[];var l={};l.id=t;for(var c=0;c<a.length;c++)switch(a[c]){case"name":l.name=s[c];break;case"addinfo":l.addinfo=s[c];break;case"cityarea":l.cityarea=s[c];break;case"location":l.location=s[c];break;case"image":l.imageurl=s[c];break;case"views":l.views=s[c];break;case"lat":l.lat=s[c];break;case"lng":l.lng=s[c];break;case"owner":l.owner=s[c];break;case"phone":l.phone=s[c];break;case"website":l.website=s[c];break;case"email":l.email=s[c];break;case"strhours":l.strhours=s[c];break;case"eventstr":l.eventstr=s[c];break;case"numcom":l.numcom=s[c]}r.resource.push(l);for(var d=w,u=b.map(function(e){return e.id}).indexOf(t),c=0;c<a.length;c++)switch(a[c]){case"name":n.answers[u].name=s[c];break;case"addinfo":n.answers[u].addinfo=s[c];break;case"cityarea":n.answers[u].cityarea=s[c];break;case"location":n.answers[u].location=s[c];break;case"image":n.answers[u].imageurl=s[c];break;case"views":n.answers[u].views=s[c];break;case"lat":n.answers[u].lat=s[c];break;case"lng":n.answers[u].lng=s[c];break;case"owner":n.answers[u].owner=s[c];break;case"phone":n.answers[u].phone=s[c];break;case"website":n.answers[u].website=s[c];break;case"email":n.answers[u].email=s[c];break;case"strhours":n.answers[u].strhours=s[c];break;case"eventstr":n.answers[u].eventstr=s[c];break;case"numcom":n.answers[u].numcom=s[c]}return e.patch(d,r,{headers:{"Content-Type":"multipart/form-data"},body:r}).then(i,f)}function m(t,a){function s(e){return n.DEBUG_MODE&&console.log(" answer flagged succesful"),e.data}var o={};o.resource=[];var i={};i.id=t,i.flag=a,o.resource.push(i);var r=w;return e.patch(r,o,{headers:{"Content-Type":"multipart/form-data"},body:o}).then(s,f)}function g(t){function a(e){return n.DEBUG_MODE&&console.log("Deleting answer was succesful"),e.data}var s={};s.resource=[];var o={};o.id=t,s.resource.push(o);var i=w+"/"+t,r=b.map(function(e){return e.id}).indexOf(t);return r>-1&&b.splice(r,1),e["delete"](i,o,{headers:{"Content-Type":"multipart/form-data"},body:s}).then(a,f)}function p(){return b.length>0}function v(e){return h&&h.id==e}function f(e){throw e}var h,b=[],w="/api/v2/mysql/_table/answers",y={getAnswers:i,getAnswer:r,addAnswer:c,addAnswer2:d,updateAnswer:u,deleteAnswer:g,flagAnswer:m,getAnswerbyCustomer:l};return y}angular.module("app").factory("answer",e),e.$inject=["$http","$q","$rootScope","catans","vrows","uaf"]}(),angular.module("app").directive("blobUpload",["$rootScope","$state",function(e,t){"use strict";return{templateUrl:"app/answer/Partials/blobupload.html",transclude:!0,scope:{},controller:["$scope","Upload","$timeout","$http","$rootScope",function(e,t,n,a,s){function o(t){e.errorMsg=t}o(""),e.uploadFiles=function(n,a){if(e.f=n,e.errFile=a&&a[0],null==n)if(console.log("file is null"),void 0!=e.errFile){var i="Uploading failed for "+e.errFile.name+", "+e.errFile.$error+" exceeds "+e.errFile.$errorParam;o(i)}else o("");else{var r="https://rankx.blob.core.windows.net/sandiego/"+s.canswer.id+"/"+n.name+"?sv=2015-04-05&ss=bfqt&srt=sco&sp=rwdlacup&se=2018-08-30T01:15:12Z&st=2016-08-29T17:15:12Z&spr=https,http&sig=PpyWE0X%2Fpz9SuRje5GtHh44WaWIii0GBU9PbIcDIka8%3D",l=new FileReader;l.readAsArrayBuffer(n),l.onload=function(a){t.http({url:r,method:"PUT",headers:{"x-ms-blob-type":"BlockBlob","x-ms-blob-content-type":n.type},data:a.target.result}).then(function(t){t.status>0&&(e.errorMsg=t.status+": "+t.data);var a="https://rankx.blob.core.windows.net/sandiego/"+s.canswer.id+"/"+n.name;console.log("emitted fileUploaded!!"),s.$emit("fileUploaded",a)},null,function(e){
n.progress=Math.min(100,parseInt(100*e.loaded/e.total))})}}}}]}}]),function(){"use strict";function e(e,t,n,a,s,o,i,r,l,c,d,u,m,g){function p(){v(),z.userIsOwner&&"Establishment"==z.type&&T(),z.access=z.userIsOwner&&z.answer.isactive,f(z.answer.id),s.DEBUG_MODE&&console.log("Edit Answer Activated!")}function v(){for(var e=0;e<s.fields.length;e++){switch(Y={},Y.field=s.fields[e].name,Y.onlybyowner=s.fields[e].onlybyowner,s.fields[e].name){case"name":Y.cval=z.answer.name;break;case"cityarea":Y.cval=z.answer.cityarea;break;case"location":Y.cval=z.answer.location;break;case"addinfo":Y.cval=z.answer.addinfo;break;case"phone":Y.cval=z.answer.phone;break;case"website":Y.cval=z.answer.website;break;case"email":Y.cval=z.answer.email}Y.val="",Y.label=s.fields[e].label,Y.opts="cityarea"==Y.field?"c for c in vm.neighborhoods":"c for c in vm.emptyarray",z.fields.push(Y)}for(var e=0;e<z.fields.length;e++)z.fields[e].val=z.fields[e].cval}function f(e){z.edits=[],K=[],J=[];for(var t={},n=0;n<s.edits.length;n++)if(s.edits[n].answer==e){switch(t=s.edits[n],t.vote=0,t.idx=n,t.agree="",t.disagree="",s.fields[0].name){case"name":t.name=z.answer.name}z.edits.push(t),K.push(s.edits[n].upV),J.push(s.edits[n].downV)}y(z.answer.id)}function h(t){if(!s.isLoggedIn)return void e.getDialog("notLoggedIn");for(var n=!1,a=0;a<z.edits.length;a++)if(z.edits[a].field==t.field){n=!0;break}if(n)return void e.getDialog("editFieldExists");var o={};switch(o.field=t.field,o.nval=t.val,o.cval||(o.cval=""),o.answer=z.answer.id,o.upV=0,o.downV=0,o.imageURL="",o.display="none",s.fields[0].name){case"name":o.name=z.answer.name}o.user=s.user.id,o.username=s.user.name,o.timestmp=Date.now(),s.userIsOwner?e.editConfirm(o,"field",j):e.editConfirm(o,"field",O)}function b(){if(console.log("@editImate"),!s.isLoggedIn)return void e.getDialog("notLoggedIn");for(var t=!1,n=0;n<z.edits.length;n++)if("image"==z.edits[n].field){t=!0;break}if(t)return void e.getDialog("editFieldExists");var a=c.getImageLinks(z.fields,oe,"edit");a.then(L,V)}function w(){s.DEBUG_MODE&&console.log("@selectImage");var t={};switch(t.field="image",t.cval=z.answer.imageurl,t.nval="",t.imageURL=s.userIsOwner?s.blobimage:z.imageURL,t.display="inline",t.answer=z.answer.id,t.upV=0,t.downV=0,s.fields[0].name){case"name":t.name=z.answer.name}t.user=s.user.id,t.username=s.user.name,t.timestmp=Date.now(),s.userIsOwner?e.editConfirm(t,"image",j):e.editConfirm(t,"image",I),console.log("$rootScope.userIsOwner - ",s.userIsOwner)}function y(e){for(var t={},n=0;n<s.editvotes.length;n++)s.editvotes[n].answer==e&&(t=s.editvotes[n],H.push(t));for(n=0;n<z.edits.length;n++)for(var a=0;a<H.length;a++)z.edits[n].id==H[a].edit&&(z.edits[n].vote=H[a].vote);D()}function k(t,n){if(s.isAdmin)return void e.editChangeEffective(z.edits[n],n,"approve",A);if(!s.isLoggedIn)return void e.getDialog("notLoggedIn");switch(t.vote){case 1:z.edits[n].vote=0,z.edits[n].upV--;break;case 0:z.edits[n].vote=1,z.edits[n].upV++;break;case-1:z.edits[n].vote=1,z.edits[n].upV++,z.edits[n].downV--}E(n),D()}function x(t,n){if(s.isAdmin)return void e.editChangeEffective(z.edits[n],n,"reject",A);if(!s.isLoggedIn)return void e.getDialog("notLoggedIn");switch(t.vote){case 1:z.edits[n].vote=-1,z.edits[n].upV--,z.edits[n].downV++;break;case 0:z.edits[n].vote=-1,z.edits[n].downV++;break;case-1:z.edits[n].vote=0,z.edits[n].downV--}E(n),D()}function D(){for(var e=0;e<z.edits.length;e++)switch(z.edits[e].vote){case 1:z.edits[e].agree="active",z.edits[e].disagree="";break;case 0:z.edits[e].agree="",z.edits[e].disagree="";break;case-1:z.edits[e].agree="",z.edits[e].disagree="active"}}function E(t){if(z.edits[t].upV>z.edits[t].downV){if(z.edits[t].upV-z.edits[t].downV>=Q)return void e.editChangeEffective(z.edits[t],t,"approve",A)}else if(z.edits[t].downV>z.edits[t].upV&&z.edits[t].downV-z.edits[t].upV>=Z)return void e.editChangeEffective(z.edits[t],t,"reject",A)}function C(){s.DEBUG_MODE&&console.log("updateRecords @ editAnswer");for(var e=!1,t=[],n={},a=0;a<z.edits.length;a++){e=!1;for(var o=0;o<H.length;o++)if(z.edits[a].id==H[o].edit){e=!0;break}e?r.patchEditVoteRec(H[o].id,z.edits[a].vote):0!=z.edits[a].vote&&(n={},n.edit=z.edits[a].id,n.user=s.user.id,n.category=s.cCategory.id,n.answer=z.edits[a].answer,n.vote=z.edits[a].vote,n.timestmp=Date.now(),t.push(n)),(z.edits[a].upV!=K[a]||z.edits[a].downV!=J[a])&&i.updateEdit(z.edits[a].id,z.edits[a].upV,z.edits[a].downV)}t.length>0&&(r.postEditVoteRec(t),t=[]),X=!0}function A(e,t){"approve"==t&&(R(e),ne||$()),"reject"==t&&P(e)}function R(e){if(s.DEBUG_MODE&&console.log("Edit has been approved"),"image"==z.edits[e].field)s.DEBUG_MODE&&console.log("EA-3"),l.updateAnswer(z.edits[e].answer,[z.edits[e].field],[z.edits[e].imageURL]);else if("location"==z.edits[e].field){if(void 0!=z.edits[e].nval&&""!=z.edits[e].nval&&null!=z.edits[e].nval){ne=!0,z.answer.location=z.edits[e].nval;var t=d.getLocationGPS(z.answer);t.then(function(){})}}else s.DEBUG_MODE&&console.log("EA-2"),l.updateAnswer(z.edits[e].answer,[z.edits[e].field],[z.edits[e].nval]);ee=!0,te=e}function M(){ae||(ae=!0,s.DEBUG_MODE&&console.log("EA-1"),l.updateAnswer(z.answer.id,["location","lat","lng"],[z.answer.location,z.answer.lat,z.answer.lng]).then($))}function P(e){s.DEBUG_MODE&&console.log("Edit has been discarded"),i.deleteEdit(z.edits[e].id),r.deleteEditVotes(z.edits[e].id),s.edits.splice(z.edits[e].idx,1),z.edits.splice(e,1)}function S(){e.howItWorks("editAnswer")}function O(e){C(),X=!1;var t=i.addEdit(e);s.DEBUG_MODE&&console.log("creating edit"),t.then(function(){f(z.answer.id)})}function I(e){C(),X=!1;var t=i.addEdit(e);t.then(function(){f(z.answer.id),z.imageURL=z.answer.imageurl,z.imagefunctions="none"})}function $(){ee&&(i.deleteEdit(z.edits[te].id),r.deleteEditVotes(z.edits[te].id),s.edits.splice(z.edits[te].idx,1),z.edits.splice(te,1)),n.go("answerDetail",{index:z.answer.id})}function L(e){se=se.concat(e),z.numLinks=se.length,oe++,(z.numLinks>10||oe>4)&&(z.searchDisabled="disabled"),oe>1&&(z.imageCommand="Load More Images"),z.linkIdx=0,z.imageURL=se[z.linkIdx],z.numLinks>0&&(z.imagefunctions="inline")}function V(){s.DEBUG_MODE&&console.log("query failed, dont give up")}function _(){z.linkIdx++,z.linkIdx>=z.numLinks&&(z.linkIdx=0),z.imageURL=se[z.linkIdx]}function U(){z.linkIdx--,z.linkIdx<0&&(z.linkIdx=z.numLinks-1),z.imageURL=se[z.linkIdx]}function B(){$()}function T(){if(z.timeDD=["7:00 AM","7:30 AM","8:00 AM","8:30 AM","9:00 AM","9:30 AM","10:00 AM","10:30 AM","11:00 AM","11:30 AM","12:00 PM","12:30 PM","1:00 PM","1:30 PM","2:00 PM","2:30 PM","3:00 PM","3:30 PM","4:00 PM","4:30 PM","5:00 PM","5:30 PM","6:00 PM","6:30 PM","7:00 PM","7:30 PM","8:00 PM","8:30 PM","9:00 PM","9:30 PM","10:00 PM","10:30 PM","11:00 PM","11:30 PM","12:00 AM","12:30 AM","1:00 AM","1:30 AM","2:00 AM","2:30 AM","3:00 AM","3:30 AM","4:00 AM","4:30 AM","5:00 AM","5:30 AM","6:00 AM","6:30 AM"],z.openOptions=["OPEN","CLOSED"],void 0==z.answer.strhours||null==z.answer.strhours||0==z.answer.strhours.length){var e='[{"day":"MON","opn":"OPEN","st":"8:00 AM","ct":"5:00 PM"},{"day":"TUE","opn":"OPEN","st":"8:00 AM","ct":"5:00 PM"},{"day":"WED","opn":"OPEN","st":"8:00 AM","ct":"5:00 PM"},{"day":"THU","opn":"OPEN","st":"8:00 AM","ct":"5:00 PM"},{"day":"FRI","opn":"OPEN","st":"8:00 AM","ct":"5:00 PM"},{"day":"SAT","opn":"OPEN","st":"8:00 AM","ct":"5:00 PM"},{"day":"SUN","opn":"OPEN","st":"8:00 AM","ct":"5:00 PM"}]';z.openhours=JSON.parse(e)}else z.openhours=JSON.parse(z.answer.strhours)}function N(){z.updateHoursEn=""}function G(){for(var e=[],t={},n=0;n<z.openhours.length;n++)t={},t.day=z.openhours[n].day,t.opn=z.openhours[n].opn,t.st=z.openhours[n].st,t.ct=z.openhours[n].ct,e.push(t);var a=JSON.stringify(e);s.DEBUG_MODE&&console.log("EA-4"),l.updateAnswer(z.answer.id,["strhours"],[a]),z.updateHoursEn="disabled"}function q(){for(var e="",t=0;t<z.fields.length;t++)"name"==z.fields[t].field&&(e=z.fields[t].val);e.length>0&&m.getWiki(e)}function F(e){console.log("Load Wiki!!",e);for(var t=0;t<z.fields.length;t++)"addinfo"==z.fields[t].field&&(z.fields[t].val=e)}function j(e){if(s.DEBUG_MODE&&console.log("Direct Edit Executed"),s.DEBUG_MODE&&console.log("edit - ",e),"image"==e.field)s.DEBUG_MODE&&console.log("R1"),z.imageURL=s.blobimage,l.updateAnswer(e.answer,["image"],[e.imageURL]),n.go("editAnswer",{},{reload:!0});else if("location"==e.field){if(s.DEBUG_MODE&&console.log("R2"),void 0!=e.nval&&""!=e.nval&&null!=e.nval){z.answer.location=e.nval;var t=d.getLocationGPS(z.answer);t.then(function(){})}}else s.DEBUG_MODE&&console.log("R3"),l.updateAnswer(e.answer,[e.field],[e.nval]);s.cmd1exe=!1}var z=this;if(z.title="editAnswer",z.answer={},z.showHowItWorksDialog=S,z.editField=h,z.editAgree=k,z.editImage=b,z.selectImage=w,z.viewPrev=U,z.viewNext=_,z.closeRank=B,z.editDisagree=x,z.answerDetail=$,z.hoursChanged=N,z.updateHours=G,z.getWiki=q,z.ranking=s.title,z.userIsOwner=s.userIsOwner,t.index){var W=s.answers.map(function(e){return e.id}).indexOf(+t.index);z.answer=s.answers[W]}z.type=z.answer.type,z.imageURL=z.answer.imageurl,z.fields=[];var Y={};z.edits=[];var K=[],J=[],H=[],X=!1,Q=1,Z=1,ee=!1,te=0,ne=!1,ae=!1,se=[];z.linkIdx=0,z.numLinks=0,z.imageCommand="Change Image";var oe=3;z.imagefunctions="none",z.emptyarray=[],z.updateHoursEn="disabled",z.neighborhoods=s.neighborhoods.concat(s.districts),s.$on("$stateChangeSuccess",function(e,t,n,a,o){s.previousState=a.name}),s.$on("$stateChangeStart",function(e,t,n,a,s){"editAnswer"==a.name&&(X||C())}),s.$on("fileUploaded",function(e,t){s.cmd1exe=s.cmd1exe?s.cmd1exe:!1,"editAnswer"!=n.current.name||s.cmd1exe||(s.cmd1exe=!0,s.blobimage=t,w())}),s.$on("answerGPSready",function(){"editAnswer"!=n.current.name||ae||M()}),s.$on("wikiReady",function(e,t){"editAnswer"==n.current.name&&F(t)}),u.innerWidth<512?(z.sm=!0,z.nsm=!1):(z.sm=!1,z.nsm=!0),p()}angular.module("app").controller("editAnswer",e),e.$inject=["dialog","$stateParams","$state","answers","$rootScope","$modal","edit","editvote","answer","image","getgps","$window","getwiki","$http"]}(),function(){"use strict";function e(e,t,n,a,s,o,i,r,l,c,d,u,m,g,p,v,f,h,b,w,y,k){function x(){if(D(),we.modeIsImage=void 0==o.modeIsImage?!0:o.modeIsImage,we.modeIsImage?he():be(),"answerDetail"!=o.previousState&&i.scrollTo(0,0),we.showImageGallery=!1,o.$emit("showLogo"),E(),L(we.answer.id),J(),"Establishment"==we.type&&R(),"Establishment"!=we.type&&"Event"!=we.type,1,"Establishment"==we.type&&z(we.answer.id),("Establishment"==we.type||"PersonCust"==we.type)&&Y(we.answer.id),j(),o.cvotes?O():(o.cvotes=[],o.ceditvotes=[]),"Event"==we.type){var e=JSON.parse(we.answer.eventstr);pe(we.answer,e),we.ehtml=l.eventHtml(we.answer,we.sm),we.estyle="background-color:"+we.answer.bc+";color:"+we.answer.fc+";white-space:pre;"}we.access=!1,o.isLoggedIn&&o.user.id==we.answer.owner?(we.userIsOwner=!0,we.answer.isactive&&(we.access=!0)):we.userIsOwner=!1,o.userIsOwner=we.userIsOwner,we.numcom=void 0==we.answer.numcom?0:we.answer.numcom,we.showNextnPrev=De.length>1?!0:!1;var t=we.answer.views+1;a.updateAnswer(we.answer.id,["views"],[t]),o.DEBUG_MODE&&console.log("Answer details loaded")}function D(){if(!o.fields){var e=0;switch(we.answer.type){case"Place":e=0;break;case"Person":e=1;break;case"Event":e=2;break;case"Organization":e=3;break;case"Short-Phrase":e=4;break;case"Activity":e=5;break;case"Establishment":e=6;break;case"Thing":e=7;break;case"PersonCust":e=8}var t=o.typeSchema[e].fields;o.fields=t}}function E(){we.answer.hasOwner=void 0==we.answer.owner||null==we.answer.owner||0==we.answer.owner?!1:!0,void 0!=we.answer.addinfo&&(we.answer.addinfo_teaser=we.answer.addinfo.slice(0,300),we.answer.addinfo_complete=we.answer.addinfo.slice(300)),we.bindtxt="","Establishment"==we.type&&(we.bindtxt="I represent this business"),"PersonCust"==we.type&&(we.bindtxt="I am this person"),"Event"==we.type&&(we.bindtxt="I organize this event"),we.moretext=" more ",we.completeinfo=!1}function C(){return" more "==we.moretext?(we.moretext=" less ",void(we.completeinfo=!0)):" less "==we.moretext?(we.moretext=" more ",void(we.completeinfo=!1)):void 0}function R(){if(we.hrset=!1,void 0!=we.answer.strhours&&null!=we.answer.strhours){we.hrset=!0;var e=new Date,t=e.getDay(),n=t-1;0>n&&(n=6);var a=JSON.parse(we.answer.strhours);we.hourstr="CLOSED"==a[n].opn?"Closed today":"Open today from: "+a[n].st+" to "+a[n].ct}}function M(e){var t=0,n=0,a="";we.relativetable=[];for(var s=o.R,i=o.GP,r=o.answersR,l=A.indexOf(+e),c=0,d=o.fields[0].name,u=!1,m=0;m<r.length;m++)if(A[m]!=e){switch(c=s[l][m],d){case"name":a=r[m].name;break;case"nickname":a=r[m].nickname;break;case"country":a=r[m].country,u=!0;break;case"club":a=r[m].club}i[l][m]?(t=Math.round(c/i[l][m]*100),n=100-t):(t=0,n=0),we.relativetable.push({id:r[m].id,Rank:r[m].Rank,PctF:t,vsName:a,PctC:n,GP:i[l][m],isC:u})}}function P(e){S(),Ee=!1,ye=!1,we.answer=De[A.indexOf(+e)],o.canswer=we.answer,L(we.answer.id),ke=we.catans.upV,xe=we.catans.downV,E(),j(),O(),M(e),z(we.answer.id),Y(we.answer.id),j()}function S(){o.DEBUG_MODE&&console.log("UpdateRecords @answerDetail");for(var e=0;e<we.answerRanks.length;e++){var t=we.answerRanks[e].voteRecordExists,n=!1,a={},s=o.thisuseractivity.map(function(e){return e.category}).indexOf(we.answerRanks[e].id);s>=0?(n=!0,a=o.thisuseractivity[s]):n=!1,t&&we.answerRanks[e].uservote.vote!=we.answerRanks[e].dV&&0!=we.answerRanks[e].dV&&(o.DEBUG_MODE&&console.log("UR-1"),c.patchRec(we.answerRanks[e].uservote.id,we.answerRanks[e].dV)),t&&we.answerRanks[e].uservote.vote!=we.answerRanks[e].dV&&0==we.answerRanks[e].dV&&(o.DEBUG_MODE&&console.log("UR-2"),c.deleteRec(we.answerRanks[e].uservote.id),a.votes<2?(o.DEBUG_MODE&&console.log("UR-3"),r.deleteRec(a.id)):(o.DEBUG_MODE&&console.log("UR-4"),r.patchRec(a.id,a.votes-1))),t||0==we.answerRanks[e].dV||(o.DEBUG_MODE&&console.log("UR-5"),c.postRec(we.answerRanks[e].catans,we.answer.id,we.answerRanks[e].id,we.answerRanks[e].dV),n?(o.DEBUG_MODE&&console.log("UR-6"),r.patchRec(a.id,a.votes+1)):(o.DEBUG_MODE&&console.log("UR-7"),r.postRec(we.answerRanks[e].id))),(we.answerRanks[e].upV!=we.answerRanks[e].upVi||we.answerRanks[e].downV!=we.answerRanks[e].downVi)&&(o.DEBUG_MODE&&console.log("UR-8"),g.updateRec(we.answerRanks[e].catans,["upV","downV"],[we.answerRanks[e].upV,we.answerRanks[e].downV]))}if("Establishment"==we.type||"PersonCust"==we.type)for(var e=0;e<we.vrows.length;e++){var i=we.vrows[e].voteExists;i&&we.vrows[e].dVi!=we.vrows[e].dV&&(o.DEBUG_MODE&&console.log("UR-9"),o.cvrowvotes[we.vrows[e].vidx].val=we.vrows[e].dV,y.patchRec(we.vrows[e].voteid,we.vrows[e].dV)),i||0==we.vrows[e].dV||(o.DEBUG_MODE&&console.log("UR-10"),y.postRec(we.vrows[e].id,we.vrows[e].dV)),(we.vrows[e].upV!=we.vrows[e].upVi||we.vrows[e].downV!=we.vrows[e].downVi)&&(o.DEBUG_MODE&&console.log("UR-11"),w.updateRec(we.vrows[e].id,["upV","downV"],[we.vrows[e].upV,we.vrows[e].downV]))}Ee=!0}function O(){for(var e=0;e<we.answerRanks.length;e++){we.answerRanks[e].voteRecordExists=!1;for(var t=0;t<o.cvotes.length;t++)if(o.cvotes[t].catans==we.answerRanks[e].catans){we.answerRanks[e].uservote=o.cvotes[t],we.answerRanks[e].uservote.ansvidx=e,we.answerRanks[e].voteRecordExists=!0;break}we.answerRanks[e].dV=we.answerRanks[e].voteRecordExists?we.answerRanks[e].uservote.vote:0,V(we.answerRanks[e])}}function I(){if(o.isLoggedIn)for(var e=0;e<o.cansvrows.length;e++)for(var t=0;t<o.cvrowvotes.length;t++)o.cvrowvotes[t].vrow==o.cansvrows[e].id&&(o.cansvrows[e].voteExists=!0,o.cansvrows[e].dVi=o.cvrowvotes[t].val,o.cansvrows[e].dV=o.cvrowvotes[t].val,o.cansvrows[e].voteid=o.cvrowvotes[t].id,o.cansvrows[e].vidx=t,$(o.cansvrows[e],o.cvrowvotes[t].val));K()}function $(e,t){1==t&&(e.upImage="thumbs_up_blue_table.png",e.downImage="thumbs_down_gray_table.png"),0==t&&(e.dVi=0,e.dV=0,e.upImage="thumbs_up_gray_table.png",e.downImage="thumbs_down_gray_table.png"),-1==t&&(e.dVi=-1,e.dV=-1,e.upImage="thumbs_up_gray_table.png",e.downImage="thumbs_down_blue_table.png")}function L(e){we.numEdits=0;for(var t=0;t<o.edits.length;t++)o.edits[t].answer==e&&we.numEdits++}function V(e){1==e.dV&&(e.thumbUp="thumbs_up_blue.png",e.thumbDn="thumbs_down_gray.png"),0==e.dV&&(e.thumbUp="thumbs_up_gray.png",e.thumbDn="thumbs_down_gray.png"),-1==e.dV&&(e.thumbUp="thumbs_up_gray.png",e.thumbDn="thumbs_down_blue.png")}function _(e){if(!o.isLoggedIn)return void s.getDialog("notLoggedIn");switch(e.dV){case-1:e.dV=1,e.upV++,e.downV--;break;case 0:e.dV=1,e.upV++;break;case 1:e.dV=0,e.upV--}V(e),o.DEBUG_MODE&&console.log("UpVote")}function U(e){if(!o.isLoggedIn)return void s.getDialog("notLoggedIn");switch(e.dV){case-1:e.dV=0,e.downV--;break;case 0:e.dV=-1,e.downV++;break;case 1:e.dV=-1,e.upV--,e.downV++}V(e),o.DEBUG_MODE&&console.log("DownVote")}function B(){o.DEBUG_MODE&&console.log("goBack"),"match"==o.previousState?n.go("match"):o.cCategory?n.go("rankSummary",{index:o.cCategory.id}):n.go("cwrapper")}function T(e){o.title=e.title,n.go("rankSummary",{index:e.id})}function N(){o.isLoggedIn?"Event"==we.answer.type?(o.eventmode="edit",n.go("addEvent",{index:we.answer.id})):n.go("editAnswer",{index:we.answer.id}):s.getDialog("notLoggedIn")}function G(){s.deleteType(function(){d.deleteRecordsbyCatans(o.cCategory.id,we.answer.id),g.deleteRec(we.answer.id,o.cCategory.id).then(function(){n.go("rankSummary",{index:o.cCategory.id})})},function(){a.deleteAnswer(we.answer.id),d.deleteRecordsbyAnswer(we.answer.id),u.deleteEditbyAnswer(we.answer.id),m.deleteEditVotesbyAnswer(we.answer.id),g.deleteAnswer(we.answer.id),w.deleteVrowByAnswer(we.answer.id),n.go("rankSummary",{index:o.cCategory.id})})}function q(t){return o.isLoggedIn?(o.DEBUG_MODE&&console.log("Answer Flagged"),e.flagAnswer("answer",we.answer.id,t),void s.getDialog("answerFlagged")):void s.getDialog("notLoggedIn")}function F(t){return o.isLoggedIn?(o.DEBUG_MODE&&console.log("Answer Comment Flagged"),e.flagAnswer("comment-answer",we.answer.id,t),void s.getDialog("commentFlagged")):void s.getDialog("notLoggedIn")}function j(){we.answerRanks=[];for(var e=0;e<o.catansrecs.length;e++)if(o.catansrecs[e].answer==we.answer.id)for(var t=0;t<o.content.length;t++)if(o.content[t].id==o.catansrecs[e].category){var n=o.content[t];n.upV=o.catansrecs[e].upV,n.downV=o.catansrecs[e].downV,n.catans=o.catansrecs[e].id,n.rank=o.catansrecs[e].rank,n.uservote={},n.upVi=o.catansrecs[e].upV,n.downVi=o.catansrecs[e].downV,we.answerRanks.push(n)}we.otherRanksExist=!0}function z(e){we.specialsList=[];for(var t=0;t<o.specials.length;t++)if(o.specials[t].answer==e){p.formatdatetime(o.specials[t]),o.specials[t].name=we.answer.name;var n=l.specialHtml(o.specials[t],we.sm);o.specials[t].html=n;var a="background-color:"+o.specials[t].bc+";color:"+o.specials[t].fc+";white-space:pre;";o.specials[t].style=a,o.specials[t].hasimage=void 0!=o.specials[t].image&&"../../../assets/images/noimage.jpg"!=o.specials[t].image?!0:!1,we.specialsList.push(o.specials[t])}}function W(e){e.showimage=!0}function Y(e){o.cansvrows=[];for(var t=0;t<o.cvrows.length;t++)if(o.cvrows[t].answer==e){var n=o.cvrows[t];n.idx=t,n.voteExists=!1,n.dV=0,n.upVi=o.cvrows[t].upV,n.downVi=o.cvrows[t].downV,n.upImage="thumbs_up_gray_table.png",n.downImage="thumbs_down_gray_table.png",o.cansvrows.push(n)}I()}function K(){function e(e,t){return e.gnum-t.gnum}if(we.vrows=[],o.cansvrows.length>0){we.vrows=o.cansvrows.sort(e),we.vrows[0].shdr=!0;for(var t=1;t<we.vrows.length;t++)we.vrows[t].shdr=we.vrows[t].gnum==we.vrows[t-1].gnum?!1:!0;we.vrows[we.vrows.length-1].saddr=!0;for(var t=0;t<we.vrows.length-1;t++)we.vrows[t].saddr=we.vrows[t].gnum!=we.vrows[t+1].gnum?!0:!1;we.vrowgroups=[];for(var n=[],a=we.vrows[0].gnum,t=0;t<we.vrows.length;t++)a!=we.vrows[t].gnum?(we.vrowgroups.push(n),n=[],n.push(we.vrows[t]),a=we.vrows[t].gnum):n.push(we.vrows[t]),t==we.vrows.length-1&&we.vrowgroups.push(n)}}function J(){we.deleteButton=o.isAdmin?"inline":"none"}function H(){s.url(we.answer.imageurl)}function X(){B()}function Q(){s.bizRegistration(Z)}function Z(){o.isLoggedIn?s.bindAccount(o.user.name,we.answer.name,ee):s.getDialog("notLoggedInBiz")}function ee(){o.DEBUG_MODE&&console.log("Bind business to user account"),a.updateAnswer(we.answer.id,["owner"],[o.user.id]).then(te),h.adduseraccnt().then(function(){for(var e=!1,t=0;t<o.useraccnts.length;t++)""!=o.useraccnts[t].email&&(e=!0);e||o.$emit("showWarning")})}function te(){n.go("answerDetail",{index:we.answer.id},{reload:!0})}function ne(){n.go("specials")}function ae(){n.go("editvrows")}function se(){k.getImageList().then(oe),we.showImageGallery=!0}function oe(){we.images=o.blobs,console.log("vm.images = ",we.images)}function ie(e){n.go("rankSummary",{index:e.id})}function re(){var e=De.length,t=De.map(function(e){return e.id}).indexOf(we.answer.id),a=t-1;0>a&&(a=e-1),o.isLoggedIn&&S(),n.go("answerDetail",{index:De[a].id})}function le(){var e=De.length,t=De.map(function(e){return e.id}).indexOf(we.answer.id),a=t+1;a>e-1&&(a=0),o.isLoggedIn&&S(),n.go("answerDetail",{index:De[a].id})}function ce(e){if(!o.isLoggedIn)return void s.getDialog("notLoggedIn");switch(e.dV){case-1:e.dV=1,e.upV++,e.downV--;break;case 0:e.dV=1,e.upV++;break;case 1:e.dV=0,e.upV--}ue(e),o.DEBUG_MODE&&console.log("VRow UpVote")}function de(e){if(!o.isLoggedIn)return void s.getDialog("notLoggedIn");switch(e.dV){case-1:e.dV=0,e.downV--;break;case 0:e.dV=-1,e.downV++;break;case 1:e.dV=-1,e.upV--,e.downV++}ue(e),o.DEBUG_MODE&&console.log("DownVote")}function ue(e){1==e.dV&&(e.upImage="thumbs_up_blue_table.png",e.downImage="thumbs_down_gray_table.png"),0==e.dV&&(e.upImage="thumbs_up_gray_table.png",e.downImage="thumbs_down_gray_table.png"),-1==e.dV&&(e.upImage="thumbs_up_gray_table.png",e.downImage="thumbs_down_blue_table.png")}function me(){v.loadComments("answer",Ce)}function ge(){v.postComment("answer",Ce)}function pe(e,t){e.bc=t.bc,e.fc=t.fc,e.freq=t.freq,e.edate=t.edate,e.sdate=t.sdate,e.etime=t.etime,e.etime2=t.etime2,e.stime=t.stime,e.stime2=t.stime2,e.mon=t.mon,e.tue=t.tue,e.wed=t.wed,e.thu=t.thu,e.fri=t.fri,e.sat=t.sat,e.sun=t.sun}function ve(e){s.seePhotos(we.images,e,we.answer,we.userIsOwner)}function fe(){we.modeIsImage?be():he()}function he(){we.imgmode="Show Map",we.imgmodeicon="fa fa-globe",we.modeIsImage=!0,o.modeIsImage=!0}function be(){we.imgmode="Show Image",we.imgmodeicon="fa fa-picture-o",we.modeIsImage=!1,o.modeIsImage=!1}var we=this;we.title="answerDetail",we.ranking=o.title;var ye=!1,ke=0,xe=0,De=o.canswers,Ee=!1;we.numEdits=0,we.relativetable=[],we.catans=[],we.sm=!1,we.UpVote=_,we.DownVote=U,we.refresh=P,we.goBack=B,we.goPrev=re,we.goNext=le,we.editAnswer=N,we.deleteAnswer=G,we.flagAnswer=q,we.deleteButton="none",we.showUrl=H,we.closeRank=X,we.rankSel=T,we.bizRegDialog=Q,we.openSpecials=ne,we.editVRows=ae,we.getImages=se,we.showsimage=W,we.gotoRank=ie,we.showcomplete=C,we.vrowVoteUp=ce,we.vrowVoteDown=de,we.loadComments=me,we.postComment=ge,we.selectPhoto=ve,we.cmFlag=F,we.toggleimgmode=fe,we.fields=o.fields,o.isLoggedIn=o.isLoggedIn?o.isLoggedIn:!1,we.isLoggedIn=o.isLoggedIn;var Ce={};if(Ce.commLoaded=!1,Ce.initials="",Ce.bc="",Ce.fc="",Ce.comments=[],Ce.newComment="",we.cm=Ce,we.commentAllowed=!0,t.index){var Ae=o.answers.map(function(e){return e.id}).indexOf(+t.index);we.answer=o.answers[Ae]}o.canswer=we.answer,we.type=we.answer.type,o.cCategory?we.title=o.cCategory.title:(we.title="",De=[we.answer]),we.idx=De.map(function(e){return e.id}).indexOf(we.answer.id)+1,we.isMobile=!1,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|ipad|iris|kindle|Android|Silk|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(navigator.userAgent)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(navigator.userAgent.substr(0,4)))&&(we.isMobile=!0),i.innerWidth<512?(we.mxheight="250",we.sp1="width:5%;padding:0px;",we.sp2="width:25%;max-height:50px",we.sp3="width:20%",we.sm=!0,we.nsm=!1,we.width=Math.round(.9*i.innerWidth)):(we.mxheight="300",we.sp1="width:15%",we.sp2="width:22.5%;max-height:50px;",we.sp3="width:20%",we.sm=!1,we.nsm=!0,we.width=Math.round(.9*i.innerWidth)),o.$on("$stateChangeSuccess",function(e,t,n,a,s){o.previousState=a.name}),o.$on("$stateChangeStart",function(e,t,n,a,s){"answerDetail"==a.name&&"answerDetail"!=t.name&&!Ee&&o.isLoggedIn&&S()}),o.$on("refreshImages",function(){"answerDetail"==n.current.name&&se()}),o.$on("fileUploaded",function(){"answerDetail"==n.current.name&&se()}),x()}angular.module("app").controller("answerDetail",e),e.$inject=["flag","$stateParams","$state","answer","dialog","$rootScope","$window","useractivity","htmlops","votes","matchrec","edit","editvote","catans","datetime","commentops","userdata","useraccnt","$location","vrows","vrowvotes","imagelist"]}(),function(){"use strict";function e(t,n,a,s,o,i,r,l,c,d,u,m){function g(){v(),p(),"edit"==s.eventmode&&(T.ev=JSON.parse(JSON.stringify(s.canswer)),i.formatdatetime(T.ev),T.isEdit=!0,"onetime"==T.ev.freq&&I(1),"weekly"==T.ev.freq&&I(2),console.log("vm.ev --- ",T.ev),T.imageURL=T.ev.imageurl),"add"==s.eventmode&&(T["char"]=45,T.ev.fc="hsl(0, 100%, 0%)",T.ev.bc="hsl(0, 0%, 100%)",I(1)),U(),console.log("Add Event Activated!")}function p(){s.cCategory.title.indexOf("San Diego")>-1&&(K=!0),s.cCategory.title.indexOf("Downtown")>-1&&(Y=!0);for(var e=0;e<s.districts.length;e++)s.cCategory.title.indexOf(s.districts[e])>-1&&(z=!0,W=s.districts[e])}function v(){T.emptyarray=[],T.neighborhoods=s.neighborhoods.concat(s.districts),T.fields=s.fields,T.type=s.cCategory.type,T.fields.opts=[],T.fields.val=[],T.fields.textstyle=[];for(var e=0;e<T.fields.length;e++)T.fields[e].val="",T.fields[e].opts="cityarea"==T.fields[e].name?"c for c in vm.neighborhoods":"c for c in vm.emptyarray","cityarea"==T.fields[e].name&&"Establishment"==s.cCategory.type&&1==s.NhImplied&&(T.fields[e].val=s.NhValue),T.fields[e].textstyle="addinfo"==T.fields[e].name?"textarea":"text"}function f(){j.name=T.ev.name,j.location=T.ev.location,j.addinfo=T.ev.addinfo,j.cityarea=T.ev.cityarea,j.website=T.ev.website}function h(){N=!0,T.ev.name.length<3&&(N=!1),G=N&&(T.numLinks>0||T.ngi)}function b(){n.go("rankSummary",{index:s.cCategory.id})}function w(){var e=[];if(f(),h(),!N)return void t.getDialog("missingDataImage");var n={};n.field="name",n.val=T.ev.name,n.cval=T.ev.name,e.push(n);var a=r.getImageLinks(e,F,"add");a.then(x,y)}function y(){console.log("query failed, dont give up")}function k(){return f(),h(),G?void e():void t.getDialog("missingDataAnswer")}function x(e){for(var t,n=!1,a=0;a<e.length;a++){for(var s=0;s<q.length;s++)if(t=e[a].localeCompare(q[s]),0==t){n=!0;break}n||q.push(e[a])}T.numLinks=q.length,F++,(T.numLinks>10||F>=4)&&(T.searchDisabled="disabled"),F>1&&(T.imageCommand="Get more images"),T.linkIdx=0,T.imageURL=q[T.linkIdx],M(q[T.linkIdx],P),T.numLinks>0&&(T.imagefunctions="inline")}function D(){T.linkIdx++,T.linkIdx>=T.numLinks&&(T.linkIdx=0),T.imageURL=q[T.linkIdx],M(q[T.linkIdx],P)}function E(){T.linkIdx--,T.linkIdx<0&&(T.linkIdx=T.numLinks-1),T.imageURL=q[T.linkIdx],M(q[T.linkIdx],P)}function C(e){var t={};t.bc=e.bc,t.fc=e.fc,t.freq=e.freq,t.edate=e.edate,t.sdate=e.sdate,t.etime=e.etime,t.etime2=e.etime2,t.stime=e.stime,t.stime2=e.stime2,t.mon=e.mon,t.tue=e.tue,t.wed=e.wed,t.thu=e.thu,t.fri=e.fri,t.sat=e.sat,t.sun=e.sun;var n=JSON.stringify(t),o={};o.name=e.name,o.addinfo=e.addinfo,o.cityarea=e.cityarea,o.location=e.location,o.type="Event",o.website=e.website,o.imageurl=e.imageurl,o.views=0,o.eventstr=n,o.userid=s.user.id,T.bind&&(o.owner=s.user.id),L(),H&&!K?a.addAnswer2(o,[s.cCategory.id,J]).then(b):H&&K?a.addAnswer2(o,[J]).then(b):a.addAnswer(o).then(b)}function A(){var e={};e.bc=j.bc,e.fc=j.fc,e.freq=j.freq,e.edate=j.edate,e.sdate=j.sdate,e.etime=j.etime,e.etime2=j.etime2,e.stime=j.stime,e.stime2=j.stime2,e.mon=j.mon,e.tue=j.tue,e.wed=j.wed,e.thu=j.thu,e.fri=j.fri,e.sat=j.sat,e.sun=j.sun;var t=JSON.stringify(e),n=[],o=[];s.canswer.name!=T.ev.name&&(n.push("name"),o.push(T.ev.name)),s.canswer.addinfo!=T.ev.addinfo&&(n.push("addinfo"),o.push(T.ev.addinfo)),s.canswer.cityarea!=T.ev.cityarea&&(n.push("cityarea"),o.push(T.ev.cityarea)),s.canswer.location!=T.ev.location&&(n.push("location"),o.push(T.ev.location)),s.canswer.website!=T.ev.website&&(n.push("website"),o.push(T.ev.website)),s.canswer.imageurl!=T.imageURL&&(n.push("imageurl"),o.push(T.imageURL)),s.canswer.eventstr!=t&&(n.push("eventstr"),o.push(t)),s.canswer.owner!=T.ev.owner&&(n.push("owner"),o.push(T.ev.owner)),console.log("fields - ",n),console.log("vals - ",o),a.updateAnswer(T.ev.id,n,o)}function R(){t.howItWorks("addEvent")}function M(e,t,n){n=n||5e3;var a,s=!1,o=new Image;o.onerror=o.onabort=function(){s||(clearTimeout(a),t(e,"error"))},o.onload=function(){s||(clearTimeout(a),t(e,"success"))},o.src=e,a=setTimeout(function(){s=!0,t(e,"timeout")},n)}function P(e,t){("error"==t||"timeout"==t)&&(T.imageURL="../../../assets/images/noimage.jpg")}function S(e){T.imageURL=e?"../../../assets/images/noimage.jpg":q[T.linkIdx]}function O(){T["char"]=45-T.ev.name.length}function I(e){1==e&&(T.weekly=!1,T.onetime=!0,T.ev.freq="onetime"),2==e&&(T.weekly=!0,T.onetime=!1,T.ev.freq="weekly")}function $(){j=T.ev,j.imageurl=T.imageURL,j.date=j.sdate,"add"==s.eventmode?t.createEventPreview(j,C):t.createEventPreview(j,A)}function L(){var e="";if(Y||z||K){if(Y&&"Downtown"!=X.cityarea){e=s.cCategory.title.replace("Downtown",T.ev.cityarea);for(var t=0;t<s.content.length;t++)s.content[t].title==e&&(H=!0,J=s.content[t].id)}if(z){e=s.cCategory.title.replace(W,"Downtown");for(var t=0;t<s.content.length;t++)s.content[t].title==e&&(H=!0,J=s.content[t].id)}if(K){e=s.cCategory.title.replace("San Diego",T.ev.cityarea);for(var t=0;t<s.content.length;t++)s.content[t].title==e&&(H=!0,J=s.content[t].id)}}}function V(){event.deleteEvent(j.id),n.go("specials")}function _(){n.go("rankSummary",{index:s.cCategory.id})}function U(){T.timeDD=["7:00 AM","7:30 AM","8:00 AM","8:30 AM","9:00 AM","9:30 AM","10:00 AM","10:30 AM","11:00 AM","11:30 AM","12:00 PM","12:30 PM","1:00 PM","1:30 PM","2:00 PM","2:30 PM","3:00 PM","3:30 PM","4:00 PM","4:30 PM","5:00 PM","5:30 PM","6:00 PM","6:30 PM","7:00 PM","7:30 PM","8:00 PM","8:30 PM","9:00 PM","9:30 PM","10:00 PM","10:30 PM","11:00 PM","11:30 PM","12:00 AM","12:30 AM","1:00 AM","1:30 AM","2:00 AM","2:30 AM","3:00 AM","3:30 AM","4:00 AM","4:30 AM","5:00 AM","5:30 AM","6:00 AM","6:30 AM"]}function B(){n.go("cwrapper")}var T=this;T.title="addEvent",
T.header="table"+s.cCategory.id+".header",T.body="table"+s.cCategory.id+".body",T.searchDisabled="disabled",T.modalEnable=!0,T.publicfields=[],T.ranking=s.cCategory.title;var N=!1,G=!1,q=(s.events,[]);T.linkIdx=0,T.numLinks=0,T.imageCommand="Get images",T.searchDisabled="";var F=1;T.imagefunctions="none",T.ev={};var j={},z=!1,W="",Y=!1,K=!1,J=0,H=!1,X={};T.calladdEvent=k,T.rankSummary=b,T.callSearchImage=w,T.viewNext=D,T.viewPrev=E,T.closeRank=B,T.onNoGoodImages=S,T.showHowItWorksDialog=R,T.displayCharLength=O,T.frequencySel=I,T.showPreview=$,T.deleteSpecial=V,T.goBack=_,T.imageURL="../../../assets/images/noimage.jpg",T.header=s.header,m.innerWidth<512?(T.sm=!0,T.nsm=!1):(T.sm=!1,T.nsm=!0),g()}angular.module("app").controller("addEvent",e),e.$inject=["dialog","$state","answer","$rootScope","$modal","datetime","image","catans","getgps","$timeout","getwiki","$window"]}(),function(){"use strict";function e(e,t,n,a,s,o,i,r,l,c,d){function u(){g(),m(),a.DEBUG_MODE&&console.log("Add Answer Activated!")}function m(){a.cCategory.title.indexOf("San Diego")>-1&&(K=!0),a.cCategory.title.indexOf("Downtown")>-1&&(Y=!0);for(var e=0;e<a.districts.length;e++)a.cCategory.title.indexOf(a.districts[e])>-1&&(z=!0,W=a.districts[e])}function g(){_.emptyarray=[],_.neighborhoods=a.neighborhoods.concat(a.districts),_.establishmentNames=a.estNames,_.peopleNames=a.pplNames,_.fields=a.fields,_.type=a.cCategory.type,_.fields.opts=[],_.fields.val=[],_.fields.textstyle=[];for(var e=0;e<_.fields.length;e++)_.fields[e].val="",_.fields[e].opts="cityarea"==_.fields[e].name?"c for c in vm.neighborhoods":"c for c in vm.emptyarray","name"==_.fields[e].name&&"Establishment"==a.cCategory.type&&(_.fields[e].opts="c for c in vm.establishmentNames"),"name"==_.fields[e].name&&"Person"==a.cCategory.type&&(_.fields[e].opts="c for c in vm.peopleNames"),"cityarea"==_.fields[e].name&&"Establishment"==a.cCategory.type&&1==a.NhImplied&&(_.fields[e].val=a.NhValue),_.fields[e].textstyle="addinfo"==_.fields[e].name?"textarea":"text"}function p(){T||(X.imageurl=_.imageURL,"Short-Phrase"==a.cCategory.type&&(X.imageurl="none"),X.upV=0,X.downV=0,X.type=_.type,X.userid=a.user.id,X.views=0,F?e.checkSameAnswer(X,Q,E,A):e.addAnswer(X,_.imageURL,E),T=!0,l(function(){T=!1},1e3))}function v(){for(var e=0;e<_.fields.length;e++)switch(_.fields[e].name){case"name":X.name=_.fields[e].val;break;case"location":X.location=_.fields[e].val;break;case"addinfo":X.addinfo=_.fields[e].val;break;case"cityarea":X.cityarea=_.fields[e].val;break;case"phone":X.phone=_.fields[e].val;break;case"website":X.website=_.fields[e].val;break;case"email":X.email=_.fields[e].val}}function f(){U=!0;for(var e=0;e<_.fields.length;e++)if(_.fields[e].isrequired&&_.fields[e].val.length<3){U=!1;break}B="Short-Phrase"==a.cCategory.type||"PersonCust"==a.cCategory.type?U:U&&(_.numLinks>0||_.ngi)}function h(){t.go("rankSummary",{index:a.cCategory.id})}function b(){var t=[];if(v(),f(),!U)return void e.getDialog("missingDataImage");t=JSON.parse(JSON.stringify(_.fields));var n=o.getImageLinks(t,q,"add");n.then(k,w)}function w(){console.log("query failed, dont give up")}function y(){return v(),f(),("Establishment"==_.type||"Person"==_.type)&&O(X),B?void p():void e.getDialog("missingDataAnswer")}function k(e){for(var t,n=!1,a=0;a<e.length;a++){for(var s=0;s<G.length;s++)if(t=e[a].localeCompare(G[s]),0==t){n=!0;break}n||G.push(e[a])}_.numLinks=G.length,q++,(_.numLinks>10||q>=4)&&(_.searchDisabled="disabled"),q>1&&(_.imageCommand="Get more images"),_.linkIdx=0,_.imageURL=G[_.linkIdx],P(G[_.linkIdx],S),_.numLinks>0&&(_.imagefunctions="inline")}function x(){_.linkIdx++,_.linkIdx>=_.numLinks&&(_.linkIdx=0),_.imageURL=G[_.linkIdx],P(G[_.linkIdx],S)}function D(){_.linkIdx--,_.linkIdx<0&&(_.linkIdx=_.numLinks-1),_.imageURL=G[_.linkIdx],P(G[_.linkIdx],S)}function E(e){if(a.DEBUG_MODE&&console.log("No, different! @addAnswerConfirmed"),"Establishment"==e.type&&void 0!=e.location&&""!=e.location&&null!=e.location){var t=r.getLocationGPS(e);t.then(function(){})}else R(),H&&!K?(a.DEBUG_MODE&&console.log("P1 - eqFound,inCity,eqRankIdx - ",H,K,J),n.addAnswer2(e,[a.cCategory.id,J]).then(h)):H&&K?(a.DEBUG_MODE&&console.log("P2 - eqFound,inCity,eqRankIdx - ",H,K,J),n.addAnswer2(e,[J]).then(h)):(a.DEBUG_MODE&&console.log("P3"),n.addAnswer(e).then(h))}function C(){N||(a.DEBUG_MODE&&console.log("@exec-addAnswerGPS"),N=!0,R(),H&&!K?(a.DEBUG_MODE&&console.log("P4 - eqFound,inCity,eqRankIdx - ",H,K,J),n.addAnswer2(X,[a.cCategory.id,J]).then(h)):H&&K?(a.DEBUG_MODE&&console.log("P5 - eqFound,inCity,eqRankIdx - ",H,K,J),n.addAnswer2(X,[J]).then(h)):(a.DEBUG_MODE&&console.log("P6"),n.addAnswer(X).then(h)))}function A(){a.DEBUG_MODE&&console.log("Yeah Same, @answerIsSame"),j?e.getDialog("answerDuplicated"):(R(),H&&!K?(a.DEBUG_MODE&&console.log("P7 - eqFound,inCity,eqRankIdx - ",H,K,J),i.postRec2(Q.id,J),i.postRec2(Q.id,a.cCategory.id).then(h)):H&&K?(a.DEBUG_MODE&&console.log("P8 - eqFound,inCity,eqRankIdx - ",H,K,J),i.postRec2(Q.id,J).then(h)):(a.DEBUG_MODE&&console.log("P9"),i.postRec(Q.id).then(h)))}function R(){var e="";if(Y||z||K){if(Y&&"Downtown"!=X.cityarea){e=a.cCategory.title.replace("Downtown",X.cityarea);for(var t=0;t<a.content.length;t++)a.content[t].title==e&&(H=!0,J=a.content[t].id)}if(z){e=a.cCategory.title.replace(W,"Downtown");for(var t=0;t<a.content.length;t++)a.content[t].title==e&&(H=!0,J=a.content[t].id)}if(K){e=a.cCategory.title.replace("San Diego",X.cityarea);for(var t=0;t<a.content.length;t++)a.content[t].title==e&&(H=!0,J=a.content[t].id)}}}function M(){e.howItWorks("Short-Phrase"==a.cCategory.type?"shortPhrase":"addAnswer")}function P(e,t,n){n=n||5e3;var a,s=!1,o=new Image;o.onerror=o.onabort=function(){s||(clearTimeout(a),t(e,"error"))},o.onload=function(){s||(clearTimeout(a),t(e,"success"))},o.src=e,a=setTimeout(function(){s=!0,t(e,"timeout")},n)}function S(e,t){("error"==t||"timeout"==t)&&(_.imageURL="../../../assets/images/noimage.jpg")}function O(e){if("Establishment"==_.type){for(var t=0;t<a.estAnswers.length;t++)if(e.name==a.estAnswers[t].name&&e.cityarea==a.estAnswers[t].cityarea){F=!0,Q=a.estAnswers[t];for(var n=0;n<a.catansrecs.length;n++)a.catansrecs[n].answer==a.estAnswers[t].id&&a.catansrecs[n].category==a.cCategory.id&&(j=!0)}}else if("Person"==_.type)for(var t=0;t<a.pplAnswers.length;t++)if(e.name==a.pplAnswers[t].name){F=!0,Q=a.pplAnswers[t];for(var n=0;n<a.catansrecs.length;n++)a.catansrecs[n].answer==a.estAnswers[t].id&&a.catansrecs[n].category==a.cCategory.id&&(j=!0)}}function I(){for(var e="",t=0;t<_.fields.length;t++)if("name"==_.fields[t].name){e=_.fields[t].val;break}e.length>0&&c.getWiki(e)}function $(e){for(var t=0;t<_.fields.length;t++)if("addinfo"==_.fields[t].name){_.fields[t].val=e;break}}function L(e){_.imageURL=e?"../../../assets/images/noimage.jpg":G[_.linkIdx]}function V(){t.go("cwrapper")}var _=this;_.title="addAnswer",_.header="table"+a.cCategory.id+".header",_.body="table"+a.cCategory.id+".body",_.searchDisabled="disabled",_.modalEnable=!0,_.publicfields=[],_.ranking=a.cCategory.title;var U=!1,B=!1,T=!1,N=!1,G=(a.answers,[]);_.linkIdx=0,_.numLinks=0,_.imageCommand="Get images",_.searchDisabled="";var q=1;_.imagefunctions="none";var F=!1,j=!1,z=!1,W="",Y=!1,K=!1,J=0,H=!1,X={},Q={};_.callAddAnswer=y,_.rankSummary=h,_.callSearchImage=b,_.viewNext=x,_.viewPrev=D,_.closeRank=V,_.getWiki=I,_.onNoGoodImages=L,_.showHowItWorksDialog=M,_.imageURL="../../../assets/images/noimage.jpg",_.header=a.header,a.$on("answerGPSready",function(){"addAnswer"!=t.current.name||N||C()}),a.$on("wikiReady",function(e,n){"addAnswer"==t.current.name&&$(n)}),d.innerWidth<512?(_.sm=!0,_.nsm=!1):(_.sm=!1,_.nsm=!0),u()}angular.module("app").controller("addAnswer",e),e.$inject=["dialog","$state","answer","$rootScope","$modal","image","catans","getgps","$timeout","getwiki","$window"]}(),function(){"use strict";function e(e,t,n){function a(n){function a(e){return c=e.data.resource}if(r()&&!n)return t.when(c);var s=d;return e.get(s).then(a,l)}function s(t,n){function a(e){console.log("Creating new query record was succesful")}var s={};s.resource=[];var o={};o.query=t,o.results=n,o.timestmp=Date.now(),s.resource.push(o);var i=d;return e.post(i,s,{headers:{"Content-Type":"multipart/form-data"},body:s}).then(a,l)}function o(t){function n(e){console.log("Flushing queries db was succesful")}var a={};a.resource=t,console.log("obj ---",t);var s=d;return e["delete"](s,t,{headers:{"Content-Type":"multipart/form-data"},body:t}).then(n,l)}function i(t){function n(e){return console.log("Deleting record was succesful"),e.data}var a={};a.resource=[];var s={};s.id=t,a.resource.push(s);var o=d+"/"+t;return e["delete"](o,s,{headers:{"Content-Type":"multipart/form-data"},body:a}).then(n,l)}function r(){return c.length>0}function l(e){throw e}var c=[],d="/api/v2/mysql/_table/queries",u={getQueries:a,postQuery:s,flushAll:o,deleteRec:i};return u}angular.module("app").factory("query",e),e.$inject=["$http","$q","$rootScope"]}(),function(){"use strict";function e(e,t,n){function a(){console.log("views page Loaded!")}var s=this;s.title="views",s.content=t.content,a()}angular.module("app").controller("views",e),e.$inject=["$location","$rootScope","$state"]}(),function(){"use strict";function e(e,t,n,a,s){function o(){console.log("updateHeaders page Loaded!")}function i(){var e="",n=[],a=[];m.res=[];for(var o={},i=!0,l="",c="",d=0;d<t.cblocks.length;d++){l="",c="",i=!0,o={},a=[];for(var u=0;u<t.headlines.length;u++)if(t.cblocks[d].type==t.headlines[u].type){"city"==t.cblocks[d].scope&&(e=t.headlines[u].filter+" isMP"),"rx"==t.cblocks[d].scope&&(e=t.headlines[u].filter),"nh"==t.cblocks[d].scope&&(e=t.headlines[u].filter+" "+t.cblocks[d].scopename),n=e.split(" ");break}for(var g="",p=0;p<t.content.length;p++){g=t.content[p].tags+" "+t.content[p].title,i=!0;for(var v=0;v<n.length;v++){var f=n[v].charAt(0).toUpperCase()+n[v].slice(1),h=n[v].charAt(0).toLowerCase()+n[v].slice(1);i=i&&(g.indexOf(n[v])>-1||g.indexOf(n[v].toUpperCase())>-1||g.indexOf(f)>-1||g.indexOf(h)>-1)}i&&a.push(p)}r(a);for(var b=0;b<a.length;b++)l=l+":"+a[b];c=l.substring(1),s.update(t.cblocks[d].id,["catstr"],[c])}}function r(e){for(var t,n,a=e.length;0!==a;)n=Math.floor(Math.random()*a),a-=1,t=e[a],e[a]=e[n],e[n]=t;return e}function l(){if(!g){for(var e=["rankofweek","city","lifestyle","food","politics","services","social","beauty","sports","personalities","technology","dating","health"],t={},n=0;n<e.length;n++)t={},t.scope="city",t.scopename="San Diego",t.catstr="0",t.type=e[n],s.addcblock(t);g=!0}}function c(){if(!v){for(var e=["rankofweeknh","neighborhood","lifestyle","food","services","social","beauty","health"],t={},n=0;n<p.length;n++)for(var a=0;a<e.length;a++)t={},t.scope="nh",t.scopename=p[n],t.catstr="0",t.type=e[a],s.addcblock(t);v=!0}}function d(){if(!f){for(var e=["rxfeedback","rxsuggestion"],t={},n=0;n<e.length;n++)t={},t.scope="rx",t.scopename="RankX",t.catstr="0",t.type=e[n],s.addcblock(t);f=!0}}function u(){for(var e=0;e<t.cblocks.length;e++)s.deleteRec(t.cblocks[e].id)}var m=this;m.title="updateHeaders",m.refresh=i,m.createCBlocksRecsCity=l,m.createCBlocksRecsNh=c,m.createCBlocksRecsRankX=d,m.deleteCBlocks=u,m.isAdmin=t.isAdmin,o();var g=!1,p=t.neighborhoods.concat(t.districts),v=!1,f=!1}angular.module("app").controller("updateHeaders",e),e.$inject=["$location","$rootScope","$state","headline","cblock"]}(),function(){"use strict";function e(e,t,n,a){function s(){a.getQueries().then(function(e){i.queries=e,console.log("Queries Loaded!")})}function o(){for(var e=0;e<i.queries.length;e++)a.deleteRec(i.queries[e].id)}var i=this;i.title="queries",i.clearDb=o,i.isAdmin=t.isAdmin,s()}angular.module("app").controller("queries",e),e.$inject=["$location","$rootScope","$state","query"]}(),function(){"use strict";function e(e,t,n,a,s){function o(){console.log("foodRanks page Loaded!")}function i(){console.log("getRanks");for(var e="",n=0;n<t.content.length;n++)(t.content[n].title.indexOf("restaurant")>-1||t.content[n].title.indexOf("food")>-1||t.content[n].tags.indexOf("food")>-1)&&(e=e+":"+t.content[n].id);for(var s=e.substring(1),o=s.split(":").map(Number),i={},r=0,l=0,c=[],d=!1,n=0;n<t.catansrecs.length;n++){i=t.catansrecs[n];for(var u=0;u<o.length;u++)if(i.category==o[u]){if(r=i.answer,l=t.answers.map(function(e){return e.id}).indexOf(r),0>l&&(console.log("idx - ",r,"catansrec - ",i.id,i.answer,i.category),a.deleteRec(i.answer,i.category)),d=!1,c.length>0&&l>0)for(var m=0;m<c.length;m++)if(c[m].id==t.answers[l].id){d=!0;break}d||c.push(t.answers[l])}}console.log("Food ranks: - ",s),console.log("Food ranks length: - ",o.length)}var r=this;r.title="foodRanks",r.getRanks=i,o()}angular.module("app").controller("foodRanks",e),e.$inject=["$location","$rootScope","$state","catans","$http"]}(),function(){"use strict";function e(e,t,n,a){function s(){console.log("Flags page loaded!")}function o(){a.getFlags().then(function(e){i.flags=e;for(var t=0;t<i.flags.length;t++){if("comment-rank"==i.flags[t].type||"comment-answer"==i.flags[t].type)switch(i.flags[t].flag){case 1:i.flags[t].desc="Off-Topic";break;case 2:i.flags[t].desc="Offensive";break;case 3:i.flags[t].desc="Spam"}if("answer"==i.flags[t].type)switch(i.flags[t].flag){case 1:i.flags[t].desc="Wrong Category";break;case 2:i.flags[t].desc="Offensive";break;case 3:i.flags[t].desc="Spam"}}})}var i=this;i.title="flags",i.getFlags=o,s()}angular.module("app").controller("flags",e),e.$inject=["$location","$rootScope","$state","flag"]}(),function(){"use strict";function e(e,t,n,a,s,o,i,r){function l(){console.log("dbQuery page Loaded!")}function c(){console.log("query Answer"),m.ansRes=[];for(var e=0,n={},a=0;a<t.answers.length;a++)t.answers[a].name.indexOf(m.val)>-1&&m.ansRes.push(t.answers[a]);for(var s=0;s<m.ansRes.length;s++){m.ansRes[s].catans=[],e=m.ansRes[s].id;for(var o=0;o<t.catansrecs.length;o++)if(e==t.catansrecs[o].answer){n=t.catansrecs[o];for(var i=0;i<t.content.length;i++)t.catansrecs[o].category==t.content[i].id&&(n.rank=t.content[i].title);m.ansRes[s].catans.push(n)}}}function d(e){r.deleteRec(e.answer,e.category)}function u(e){i.deleteAnswer(e.id)}var m=this;m.title="dbQuery",m.queryAnswer=c,m.delCatans=d,m.delAnswer=u,m.isAdmin=t.isAdmin,l()}angular.module("app").controller("dbQuery",e),e.$inject=["$location","$rootScope","$state","$stateParams","table","dialog","answer","catans"]}(),function(){"use strict";function e(e,t,n,a,s,o,i,r,l){function c(){console.log("dbMaint page Loaded!")}function d(){var e=0,n=!1,a={};E.unrefans=[];for(var s=0;s<t.answers.length;s++){e=t.answers[s],n=!1;for(var o=0;o<t.catansrecs.length;o++)if(t.catansrecs[o].answer==e.id){n=!0;break}0==n&&(a.name=e.name,a.id=e.id,E.unrefans.push(a))}E.showDelete=E.unrefans.length>0?!0:!1}function u(){for(var e=0;e<E.unrefans.length;e++)i.deleteAnswer(E.unrefans[e].id)}function m(){console.log("@ Show Possible Duplicated"),console.log("answers length",t.answers.length);var e={},n={};E.dupAnswers=[];for(var a=0,s=0,o="",i=0;i<t.answers.length;i++)if(s=.75*t.answers[i].name.length,e=t.answers[i],o=t.answers[i].name.slice(0,s),"Establishment"==t.answers[i].type&&o.length>8)for(var r=0;r<t.answers.length;r++)t.answers[r].name.indexOf(o)>-1&&i!=r&&(n={},n.id=a,n.add1=e.addinfo,n.nh1=e.cityarea,n.loc1=e.location,n.name1=e.name,n.image1=e.imageurl,n.id1=e.id,n.name2=t.answers[r].name,n.idx1=i,n.idx2=r,n.loc2=t.answers[r].location,n.nh2=t.answers[r].cityarea,n.add2=t.answers[r].addinfo,n.image2=t.answers[r].imageurl,n.id2=t.answers[r].id,E.dupAnswers.push(n),a++);console.log("finished")}function g(e){for(var n=0;n<t.catansrecs.length;n++)if(e.id2==t.catansrecs[n].answer){r.updateRec(t.catansrecs[n].id,["answer"],[e.id1]);break}i.deleteAnswer(e.id2),m()}function p(e){for(var n=0;n<t.catansrecs.length;n++)if(e.id1==t.catansrecs[n].answer){r.updateRec(t.catansrecs[n].id,["answer"],[e.id2]);break}i.deleteAnswer(e.id1),m()}function v(){var e={},n={};E.dupAnsNames=[];for(var a=0,s=0;s<t.answers.length;s++){e=t.answers[s];for(var o=0;o<t.answers.length;o++)e.name==t.answers[o].name&&e.cityarea==t.answers[o].cityarea&&s!=o&&(n={},n.id=a,n.add1=e.addinfo,n.nh1=e.cityarea,n.loc1=e.location,n.name1=e.name,n.image1=e.imageurl,n.id1=e.id,n.name2=t.answers[o].name,n.idx1=s,n.idx2=o,n.loc2=t.answers[o].location,n.nh2=t.answers[o].cityarea,n.add2=t.answers[o].addinfo,n.image2=t.answers[o].imageurl,n.id2=t.answers[o].id,E.dupAnsNames.push(n),a++)}}function f(){}function h(){for(var e=[],n=0;n<t.content.length;n++)for(var a=n;a<t.content.length;a++)t.content[n].title==t.content[a].title&&n!=a&&(console.log("duplicated rank --- ",t.content[n].title),e.push(t.content[n]))}function b(){console.log("Clearing all catans vote sums to zero");for(var e=0;e<t.catansrecs.length;e++)(0!=t.catansrecs[e].upV||0!=t.catansrecs[e].downV)&&r.updateRec(t.catansrecs[e].id,["upV","downV"],[0,0])}function w(){console.log("syncUSerVotes"),l.loadAllVotes().then(function(e){t.allvotes=e,y()})}function y(){console.log("syncVotes");var e={},n={},a=[],s=[],o=0,i=0;E.syncp=[];for(var r={},l=0;l<t.catansrecs.length;l++){e=t.catansrecs[l],a=[],s=[],n={};for(var c=0;c<t.allvotes.length;c++)n=t.allvotes[c],n.catans==e.id&&(1==n.vote&&a.push(n),-1==n.vote&&s.push(n));(a.length!=e.upV||s.length!=e.downV)&&(r={},o=t.answers.map(function(e){return e.id}).indexOf(e.answer),i=t.content.map(function(e){return e.id}).indexOf(e.category),r.answername=t.answers[o].name,r.categorytitle=t.content[i].title,r.answer=t.answers[o].id,r.catans=e.id,r.category=t.content[i].id,r.caUpV=e.upV,r.caDownV=e.downV,r.nUpVlen=a.length,r.nDownVlen=s.length,E.syncp.push(r))}}function k(e){r.updateRec(e.catans,["upV","downV"],[e.nUpVlen,e.nDownVlen])}function x(){console.log("@estDistances",t.answers.length),E.answerdist=[];for(var e=.017453292519943295,n=Math.cos,a=0,s=t.currentUserLatitude,o=t.currentUserLongitude,i=0,r=0,l=0,c={},d=0;d<t.answers.length;d++)"Establishment"==t.answers[d].type&&void 0!=t.answers[d].location&&""!=t.answers[d].location&&(i=t.answers[d].lat,r=t.answers[d].lng,c=t.answers[d],a=.5-n((i-s)*e)/2+n(s*e)*n(i*e)*(1-n((r-o)*e))/2,l=12742*Math.asin(Math.sqrt(a))/1.609,c.dist=l,(l>100||l==0/0)&&E.answerdist.push(c))}function D(e){n.go("answerDetail",{index:e.id})}var E=this;E.title="dbMaint",E.showUrefAns=d,E.deleteAnswers=u,E.showPossibleDuplicated=m,E.syncToFirst=g,E.syncToSecond=p,E.showDuplicatedOnlyName=v,E.findPhoneWebsite=f,E.findDuplicatedRanks=h,E.clearAllCatansVotes=b,E.syncUserVotes=w,E.updatecatans=k,E.estDistances=x,E.gotoAnswer=D,E.isAdmin=t.isAdmin,c()}angular.module("app").controller("dbMaint",e),e.$inject=["$location","$rootScope","$state","$stateParams","table","dialog","answer","catans","votes"]}(),function(){"use strict";function e(e,t,n){function a(){console.log("admin page Loaded!")}function s(){g.selKeywords="active",g.selViews="",g.selFlags="",g.selRankings="",g.selDbMaint="",g.selQuery="",g.selUpdate="",g.selFoodRanks="",n.go("queries")}function o(){g.selKeywords="",g.selViews="active",g.selFlags="",g.selRankings="",g.selDbMaint="",g.selQuery="",g.selUpdate="",g.selFoodRanks="",n.go("views")}function i(){g.selKeywords="",g.selViews="",g.selFlags="active",g.selRankings="",g.selDbMaint="",g.selQuery="",g.selUpdate="",g.selFoodRanks="",n.go("flags")}function r(){g.selKeywords="",g.selViews="",g.selFlags="",g.selRankings="active",g.selDbMaint="",g.selQuery="",g.selUpdate="",g.selFoodRanks="",n.go("addRank")}function l(){g.selKeywords="",g.selViews="",g.selFlags="",g.selRankings="",g.selDbMaint="active",g.selQuery="",g.selUpdate="",g.selFoodRanks="",n.go("dbMaint")}function c(){g.selKeywords="",g.selViews="",g.selFlags="",g.selRankings="",g.selDbMaint="",g.selQuery="active",g.selUpdate="",g.selFoodRanks="",n.go("dbQuery")}function d(){g.selKeywords="",g.selViews="",g.selFlags="",g.selRankings="",g.selDbMaint="",g.selQuery="",g.selUpdate="active",g.selFoodRanks="",n.go("updateHeaders")}function u(){g.selKeywords="",g.selViews="",g.selFlags="",g.selRankings="",g.selDbMaint="",g.selQuery="",g.selUpdate="",g.selFoodRanks="active",n.go("foodRanks")}function m(){n.go("content")}var g=this;g.title="admin",g.selKeywords="active",g.selViews="",g.selFlags="",g.selRankings="",g.goBack=m,g.keywords=s,g.views=o,g.flags=i,g.addRank=r,g.dbMaint=l,g.dbQuery=c,g.update=d,g.foodranks=u,g.isAdmin=t.isAdmin,a()}angular.module("app").controller("admin",e),e.$inject=["$location","$rootScope","$state"]}(),function(){"use strict";function e(e,t,n,a,s,o){function i(){console.log("addRank page Loaded!")}function r(){u.title=d.rankTitle,u.tags=d.tags,u.keywords=d.keywords,u.type=d.type,u.question=d.question,u.views=0,u.answers=0,(null==u.title||void 0==u.title||u.title.length<10)&&(m=!1),(null==u.question||void 0==u.question||u.question.length<10)&&(p=!1),"Person"!=u.type&&"Establishment"!=u.type&&"Short-Phrase"!=u.type&&"Event"!=u.type&&"Organization"!=u.type&&"Place"!=u.type&&"Activity"!=u.type&&"Thing"!=u.type&&"PersonCust"!=u.type&&(g=!1)}function l(){if(r(),console.log("vm.allNh --- ",d.allNh),0==d.allNh||void 0==d.allNh)m&&g&&p?(s.addTable(u),c()):o.getDialog(m?p?"rankType":"rankQuestion":"rankTitle");else if(m&&g&&p){for(var e=0;e<t.content.length;e++)if(t.content[e].title.indexOf("Yoga studios in")>-1){var n=JSON.parse(JSON.stringify(t.content[e]));n.id=void 0;var a=n.title.replace("Yoga studios in",d.rankTitle);n.title=a;var i=d.tags;n.tags=i,n.answers=0,n.views=0,n.answertags="",n.catstr="",s.addTable(n)}c()}else o.getDialog(m?p?"rankType":"rankQuestion":"rankTitle")}function c(){u={},d.rankTitle="",d.tags="",d.keywords="",d.type="",d.question=""}var d=this;d.title="addRank";var u={},m=!0,g=!0,p=!0;d.addRanking=l,d.typeList=["Person","Establishment","Place","Activity","Short-Phrase","Organization","Event","Thing","PersonCust"],d.isAdmin=t.isAdmin,i()}angular.module("app").controller("addRank",e),e.$inject=["$location","$rootScope","$state","$stateParams","table","dialog"]}(),function(){"use strict";function e(e,t){var n=[{name:"login",url:"/login",templateUrl:"app/login/partials/login.html",controller:"login as vm"},{name:"bizlogin",url:"/bizlogin",templateUrl:"app/login/partials/bizlogin.html",controller:"bizlogin as vm"},{name:"register",url:"/register",templateUrl:"app/login/partials/register.html",controller:"register as  vm"}];$(n).each(function(){e.state(this)})}var t=angular.module("login");t.config(["$stateProvider","$urlRouterProvider",e])}(),function(){"use strict";function e(e,t){var n=[{name:"customer",url:"/customer",views:{"@":{templateUrl:"app/customer/Partials/customer.html",controller:"customer as vm"},"navbar@customer":{templateUrl:"app/layout/Partials/navbar.html",controller:"navbar as vm"}},resolve:{answers:["answer",function(e){return e.getAnswers().then(function(e){return e})}]}},{name:"mainphoto",parent:"customer",url:"/mainphoto",templateUrl:"app/customer/Partials/mainphoto.html",controller:"mainphoto as vm"},{name:"photogallery",parent:"customer",url:"/photogallery",templateUrl:"app/customer/Partials/photogallery.html",controller:"photogallery as vm"}];$(n).each(function(){e.state(this)})}var t=angular.module("app");t.config(["$stateProvider","$urlRouterProvider",e])}(),function(){"use strict";function e(e,t){var n=[{name:"admin",url:"/admin",views:{"@":{templateUrl:"app/admin/Partials/admin.html",controller:"admin as vm"},"navbar@admin":{templateUrl:"app/layout/Partials/navbar.html",controller:"navbar as vm"}}},{name:"queries",parent:"admin",url:"/queries",templateUrl:"app/admin/Partials/queries.html",controller:"queries as vm"},{name:"views",parent:"admin",url:"/views",templateUrl:"app/admin/Partials/views.html",controller:"views as vm"},{name:"flags",parent:"admin",url:"/flags",templateUrl:"app/admin/Partials/flags.html",controller:"flags as vm"},{name:"addRank",parent:"admin",url:"/addRank",templateUrl:"app/admin/Partials/addRank.html",controller:"addRank as vm"},{name:"dbMaint",parent:"admin",url:"/dbMaint",templateUrl:"app/admin/Partials/dbMaint.html",controller:"dbMaint as vm"},{name:"dbQuery",parent:"admin",url:"/dbQuery",templateUrl:"app/admin/Partials/dbQuery.html",controller:"dbQuery as vm"},{name:"updateHeaders",parent:"admin",url:"/updateHeaders",templateUrl:"app/admin/Partials/updateHeaders.html",controller:"updateHeaders as vm"},{name:"foodRanks",parent:"admin",url:"/foodRanks",templateUrl:"app/admin/Partials/foodRanks.html",controller:"foodRanks as vm"}];$(n).each(function(){e.state(this)})}var t=angular.module("app");t.config(["$stateProvider","$urlRouterProvider",e])}();var openModal=function(e,t){$(e).modal({backdrop:!t||1!=t.backdrop&&0!=t.backdrop?"static":t.backdrop,keyboard:t&&t.keyboard?t.keyboard:"false",show:"true"})},closeModal=function(e,t){$(e).modal("hide"),t&&t()};!function(){"user strict";angular.module("app").constant("INSTANCE_URL","https://api.rank-x.com").constant("APP_API_KEY","8b8174170d616f3adb571a0b28daf65a0cf07aa149aad9bf6554986856debdf4").constant("GOOGLE_API_KEY","AIzaSyC2gAzj80m1XpaagvunSDPgEvOCleNNe5A").constant("DEBUG_MODE",!1)}(),function(){"use strict";function e(e,t){t.otherwise("/");var n=[{name:"layout","abstract":!0,url:"",views:{"@":{templateUrl:"app/layout/Partials/layout.html",controller:"layout as vm"},"navbar@layout":{templateUrl:"app/layout/Partials/navbar.html",controller:"navbar as vm"}}},{name:"cwrapper",parent:"layout",url:"",views:{"@layout":{templateUrl:"app/layout/Partials/cwrapper.html",controller:"cwrapper as vm"}}},{name:"rankSummary",parent:"layout",url:"/rankSummary/:index",templateUrl:"app/rank/Partials/RankSummary.html",controller:"rankSummary as vm"},{name:"editRanking",parent:"layout",url:"/editRanking/:index",templateUrl:"app/rank/Partials/editRanking.html",controller:"editRanking as vm",resolve:{rankings:["table",function(e){return e.getTables().then(function(e){return e})}]}},{name:"addAnswer",parent:"layout",url:"/addAnswer",templateUrl:"app/answer/Partials/addAnswer.html",controller:"addAnswer as vm"},{name:"addEvent",parent:"layout",url:"/addEvent",templateUrl:"app/answer/Partials/addEvent.html",controller:"addEvent as vm"},{name:"editAnswer",parent:"layout",url:"/editAnswer/:index",templateUrl:"app/answer/Partials/editAnswer.html",controller:"editAnswer as vm",resolve:{answers:["answer",function(e){return e.getAnswers().then(function(e){return e})}],edits:["edit",function(e){return e.getEdits().then(function(e){return e})}]}},{name:"specials",parent:"layout",url:"/specials",templateUrl:"app/customer/Partials/specials.html",controller:"specials as vm"},{name:"editspecial",parent:"layout",url:"/editspecial",templateUrl:"app/customer/Partials/editspecial.html",controller:"editspecial as vm"},{name:"answerDetail",parent:"layout",url:"/answerDetail/:index",templateUrl:"app/answer/Partials/answerDetail.html",controller:"answerDetail as vm"},{name:"editvrows",parent:"layout",url:"/editvrows",templateUrl:"app/customer/Partials/editvrows.html",controller:"editvrows as vm"},{name:"match",parent:"layout",url:"/match",templateUrl:"app/rank/Partials/match.html",controller:"match as vm",resolve:{answers:["answer",function(e){return e.getAnswers().then(function(e){return e})}]}},{name:"about",url:"/about",views:{"@":{templateUrl:"app/layout/Partials/about.html",controller:"about as vm"},"navbar@about":{templateUrl:"app/layout/Partials/navbar.html",controller:"navbar as vm"}}},{name:"mybiz",url:"/mybiz",views:{"@":{templateUrl:"app/layout/Partials/mybiz.html",controller:"mybiz as vm"},"navbar@mybiz":{templateUrl:"app/layout/Partials/navbar.html",controller:"navbar as vm"}}}];$(n).each(function(){e.state(this)})}var t=angular.module("app");t.config(["$stateProvider","$urlRouterProvider",e])}(),function(){"use strict";function e(e){e.interceptors.push("httpInterceptor")}var t=angular.module("app");t.config(e),e.$inject=["$httpProvider"]}(),function(){"use strict";function e(e,t,n,a){t.defaults.headers.common["X-Dreamfactory-API-Key"]=a,t.defaults.headers.common["X-DreamFactory-Session-Token"]=e.session_token}angular.module("app").run(e),e.$inject=["$cookies","$http","$rootScope","APP_API_KEY"]}(),angular.module("app").run(["$templateCache",function(e){e.put("app/admin/Partials/addRank.html",'<br><div class="row" ng-if="vm.isAdmin"><div class="col-sm-1"></div><div class="col-sm-10"><h4>Add Ranking</h4><label class="checkbox-inline"><input type="checkbox" ng-model="vm.allNh" value="">All Neighborhoods</label><p>To add a ranking to all neighborhoods, type title without actual neighborhood name:</p><p>For instance, for \'Best pizza in ###? , simply type \'Best pizza in\' and select the checkbox</p><label><strong>Title:</strong></label> <input class="form-control" ng-model="vm.rankTitle" type="text" placeholder="{{vm.rankTitle}}"> <label><strong>Question:</strong></label> <input class="form-control" ng-model="vm.question" type="text" placeholder="{{vm.question}}"> <label><strong>Tags:</strong></label> <input class="form-control" ng-model="vm.tags" type="text" placeholder="{{vm.tags}}"> <label><strong>Keywords:</strong></label> <input class="form-control" ng-model="vm.keywords" type="text" placeholder="{{vm.keywords}}"> <label><strong>Type:</strong></label> <input class="form-control" ng-model="vm.type" bs-typeahead="" type="text" placeholder="{{vm.type}}" bs-options="c for c in vm.typeList"><br><div class="form-group text-right"><button type="button" class="btn btn-primary" ng-click="vm.addRanking()">Add</button></div></div><div class="col-sm-1"></div></div>'),e.put("app/admin/Partials/admin.html",'<div ui-view="navbar"></div><br><div class="text-center" ng-if="vm.isAdmin"><div class="btn-group col-sm-6 col-md-6"><button class="btn btn-default {{vm.selKeywords}}" ng-click="vm.keywords()">Searched-Keyword</button> <button class="btn btn-default {{vm.selViews}}" ng-click="vm.views()">Ranking-Answers Views</button> <button class="btn btn-default {{vm.selFlags}}" ng-click="vm.flags()">Answer Flags</button> <button class="btn btn-default {{vm.selAddRanking}}" ng-click="vm.addRank()">Add Ranking</button> <button class="btn btn-default {{vm.selDbMaint}}" ng-click="vm.dbMaint()">dB Maint</button> <button class="btn btn-default {{vm.selQuery}}" ng-click="vm.dbQuery()">Query</button> <button class="btn btn-default {{vm.selUpdate}}" ng-click="vm.update()">Update Headlines</button> <button class="btn btn-default {{vm.selFoodRanks}}" ng-click="vm.foodranks()">Food Ranks</button></div></div><br><br><div ui-view=""></div><br><br><footer class="footer"><div class="container"><p class="text-muted">Rank-X is property of Rank-X LLC. San Diego, CA - 2016</p></div></footer>'),e.put("app/admin/Partials/dbMaint.html",'<div class="container" ng-if="vm.isAdmin"><h1>Database Maintenance</h1><button class="btn btn-success" ng-click="vm.showUrefAns()">Unreferenced Answers</button><br><button class="btn btn-danger" ng-click="vm.deleteAnswers()">Delete Answers</button> <button class="btn btn-default" ng-click="vm.showPossibleDuplicated()">Show Possible Duplicated</button> <button class="btn btn-default" ng-click="vm.showDuplicatedOnlyName()">Show Duplicated Only Name</button><br><button class="btn btn-default" ng-click="vm.findPhoneWebsite()">Phone Numbers & Website</button><br><button class="btn btn-default" ng-click="vm.findDuplicatedRanks()">Duplicated Ranks</button><br><button class="btn btn-default" ng-click="vm.clearAllCatansVotes()">Clear Catans Votes</button><br><button class="btn btn-default" ng-click="vm.syncUserVotes()">Sync User Votes</button><br><button class="btn btn-default" ng-click="vm.estDistances()">Establishment Distances</button><br><br><p ng-repeat="x in vm.unrefans track by $index">{{x.name}} --- {{x.id}}</p><div ng-repeat="x in vm.dupAnswers track by $index"><img src="{{x.image1}}" style="width:120px"> <img src="{{x.image2}}" style="width:120px"><p>{{x.name1}} --- {{x.idx1}} --- {{x.loc1}} --- {{x.nh1}} --- {{x.add1}} --- {{x.id1}}</p><p>{{x.name2}} --- {{x.idx2}} --- {{x.loc2}} --- {{x.nh2}} --- {{x.add2}} --- {{x.id2}}</p><button class="btn btn-default" ng-click="vm.syncToFirst(x)">Sync 1st</button> <button class="btn btn-default" ng-click="vm.syncToSecond(x)">Sync 2nd</button><p>-------------------------------------------------------</p></div><div ng-repeat="x in vm.dupAnsNames track by $index"><img src="{{x.image1}}" style="width:120px"> <img src="{{x.image2}}" style="width:120px"><p>{{x.name1}} --- {{x.idx1}} --- {{x.loc1}} --- {{x.nh1}} --- {{x.add1}} --- {{x.id1}}</p><p>{{x.name2}} --- {{x.idx2}} --- {{x.loc2}} --- {{x.nh2}} --- {{x.add2}} --- {{x.id2}}</p><button class="btn btn-default" ng-click="vm.syncToFirst(x)">Sync 1st</button> <button class="btn btn-default" ng-click="vm.syncToSecond(x)">Sync 2nd</button><p>-------------------------------------------------------</p></div><p ng-repeat="x in vm.resDupRanks track by $index">{{x.title}} --- {{x.id}}</p><div ng-repeat="x in vm.syncp">{{x.answername}} - {{x.categoryname}} - caUpV {{x.caUpV}} - nUpVotes {{x.nUpVlen}} - caDownV {{x.caDownV}} - nDownVotes {{x.nDownVlen}} <button class="btn btn-primary" ng-click="vm.updatecatans(x)">Fix</button></div><div ng-repeat="x in vm.answerdist"><div class="row">{{x.name}} - {{x.location}} - {{x.dist}} <button class="btn btn-default" ng-click="vm.gotoAnswer(x)">Go to Answer</button></div></div></div>'),
e.put("app/admin/Partials/dbQuery.html",'<div class="container" ng-if="vm.isAdmin"><h1>Database Query</h1><input class="form-control" ng-model="vm.val" placeholder="Enter answer to search"> <button class="btn btn-primary" ng-click="vm.queryAnswer()">Query</button><div ng-repeat="x in vm.ansRes"><p>Answer</p>{{x.id}} --- {{x.name}} --- {{x.userid}} <button class="btn btn-danger" ng-click="vm.delAnswer(x)">Delete Answer</button><br><p>Catans</p><div ng-repeat="y in x.catans">{{y.id}} --- {{y.category}} --- {{y.answer}} --- {{y.rank}} <button class="btn btn-danger" ng-click="vm.delCatans(y)">Delete Catans</button><br></div></div></div>'),e.put("app/admin/Partials/flags.html",'<h1>Flags</h1><br><button class="btn btn-danger" ng-click="vm.getFlags()">Get Flags</button><table class="table table-hover cursor"><tbody><thead><tr><th>Type</th><th>Flag</th><th>Go To</th></tr></thead><tbody><tr ng-repeat="x in vm.flags"><td>{{x.type}}</td><td>{{x.desc}}</td><td>{{x.number}}</td></tr></tbody></tbody></table>'),e.put("app/admin/Partials/foodRanks.html",'<br><br><h1>Get Food Ranks</h1><br><br><button class="btn btn-primary" ng-click="vm.getRanks()">Get Food Ranks</button>'),e.put("app/admin/Partials/queries.html",'<div class="container" ng-if="vm.isAdmin"><h1>Queries</h1><br><a ng-click="vm.clearDb()" class="btn btn-danger">Clear Database</a><br><div class="row"><div class="col-sm-2"></div><div class="col-sm-8"><table class="table table-hover cursor"><tbody><thead><tr><th>User Input</th><th>Num. Results</th></tr></thead><tbody><tr ng-repeat="x in vm.queries | orderBy: \'-results\'"><td>{{x.query}}</td><td>{{x.results}}</td></tr></tbody></tbody></table></div><div class="col-sm-2"></div></div></div>'),e.put("app/admin/Partials/updateHeaders.html",'<div class="container" ng-if="vm.isAdmin"><br><br><h1>Refresh Headlines</h1><br><div class="text-center"><button ng-click="vm.refresh()" class="btn btn-success">Shuffle Headers</button><br><br><button ng-click="vm.createCBlocksRecsCity()" class="btn btn-success">Create C-Blocks City</button><br><br><button ng-click="vm.createCBlocksRecsNh()" class="btn btn-success">Create C-Blocks Neighborhood</button><br><br><button ng-click="vm.createCBlocksRecsRankX()" class="btn btn-success">Create C-Blocks RankX</button><br><br><button ng-click="vm.deleteCBlocks()" class="btn btn-warning">Delete ALL C-Blocks</button></div><div ng-repeat="x in vm.res track by $index">{{x.modeNum}} - {{x.htitle}} - {{x.scope}} - {{x.title}}</div></div>'),e.put("app/admin/Partials/views.html",'<h1>Views</h1><div class="row"><div class="col-sm-2"></div><div class="col-sm-8"><table class="table table-hover cursor"><tbody><thead><tr><th>Ranking</th><th>Views</th></tr></thead><tbody><tr ng-repeat="x in vm.content | orderBy: \'-views\'"><td>{{x.title}}</td><td>{{x.views}}</td></tr></tbody></tbody></table></div><div class="col-sm-2"></div></div>'),e.put("app/answer/Partials/addAnswer.html",'<div class="container"><div class="well-rank" ng-if="vm.sm"><h3 class="sub-header">{{vm.ranking}} <span class="nomargin"><button type="button" class="btn btn-default pull-right" style="vertical-align:middle;" ng-click="vm.closeRank()"><span class="glyphicon glyphicon-remove" style="padding-top:0px;padding-bottom:0px;" aria-hidden="true"></span></button></span></h3></div><div class="well-rank" ng-if="vm.nsm"><h2 class="sub-header">{{vm.ranking}} <span class="nomargin"><button type="button" class="btn btn-default pull-right" style="vertical-align:middle;" ng-click="vm.closeRank()"><span class="glyphicon glyphicon-remove" style="padding-top:0px;padding-bottom:0px;" aria-hidden="true"></span></button></span></h2></div></div><div class="row"><h4>&nbsp&nbspAdd a new answer</h4></div><div class="text-right"><p class="hiw" ng-click="vm.showHowItWorksDialog()"><u>How it works?</u></p></div><br><div class="row"><div class="col-sm-12 col-md-5"><div class="" ng-show="{{vm.type != \'Short-Phrase\'}}"><img src="{{vm.imageURL}}" alt="{{image.errorLoading}}" style="width:100%; max-height:300px"> <img src="../../../assets/images/powered_by_google_on_white.png" ng-if="vm.type!=\'PersonCust\'"></div><div class="" ng-show="{{vm.type == \'Short-Phrase\'}}"><div class="container-answer" style="width:100%;height:auto" ng-if="vm.type == \'Short-Phrase\'"><br><h2 style="text-align:center"><strong>{{vm.fields[0].val}}</strong></h2><br><h4 style="text-align:center">{{vm.fields[1].val}}</h4></div></div><div ng-if="vm.type != \'PersonCust\'"><div class="form-group text-right"><button type="submit" class="btn btn-primary {{vm.searchDisabled}}" ng-click="vm.callSearchImage()" ng-show="{{vm.type != \'Short-Phrase\'}}">{{vm.imageCommand}}</button> <button type="submit" class="btn btn-primary" ng-click="vm.viewPrev()" ng-disabled="vm.numLinks === 0" style="display:{{vm.imagefunctions}}">&laquo</button> <button type="submit" class="btn btn-primary" ng-click="vm.viewNext()" ng-disabled="vm.numLinks === 0" style="display:{{vm.imagefunctions}}">&raquo</button> <a style="display:{{vm.imagefunctions}}">{{vm.linkIdx+1}} of {{vm.numLinks}}</a></div><label class="checkbox-inline" ng-show="{{vm.type != \'Short-Phrase\'}}"><input type="checkbox" ng-change="vm.onNoGoodImages(vm.ngi)" ng-model="vm.ngi">No good images were found</label></div></div><br ng-if="vm.sm"><form class="form-horizontal col-sm-12 col-md-7" role="form" name="answerForm"><div class="form-group" ng-repeat="x in vm.fields"><label class="control-label capitalize" ng-if="!x.onlybyowner" style="padding-left:10px">{{x.isrequired ? \'**\':\'\'}}{{x.label}}:</label> <input class="form-control" ng-model="x.val" bs-options="{{x.opts}}" bs-typeahead="" type="{{x.textstyle}}" bs-typeahead-on-select="vm.onSelect(x.val)" placeholder="{{x.label}}" ng-hide="{{x.name==\'addinfo\'}}" ng-if="!x.onlybyowner" style="width:94%;margin-left:10px;margin-right:10px;"> <textarea class="form-control" ng-model="x.val" placeholder="{{x.label}}" ng-model-options="{debounce: 2500}" ng-show="{{x.name==\'addinfo\'}}" rows="3" ng-if="!x.onlybyowner" id="textarea2" style="width:94%;margin-left:10px;margin-right:10px;"></textarea></div><div class="text-right" ng-if="vm.type == \'Person\'"><button ng-click="vm.getWiki()" class="btn btn-primary" style="background-color:#595959;border-color:black">Get from Wikipedia</button></div></form></div><div class="row form-group"><div class="text-center"><button ng-click="vm.rankSummary()" class="btn btn-danger">Cancel</button><button type="submit" class="btn btn-success" ng-click="vm.callAddAnswer()">Add Answer</button></div></div>'),e.put("app/answer/Partials/addEvent.html",'<div class="container"><div class="well-rank" ng-if="vm.sm"><h3 class="sub-header">{{vm.ranking}} <span class="nomargin"><button type="button" class="btn btn-default pull-right" style="vertical-align:middle;" ng-click="vm.closeRank()"><span class="glyphicon glyphicon-remove" style="padding-top:0px;padding-bottom:0px;" aria-hidden="true"></span></button></span></h3></div><div class="well-rank" ng-if="vm.nsm"><h2 class="sub-header">{{vm.ranking}} <span class="nomargin"><button type="button" class="btn btn-default pull-right" style="vertical-align:middle;" ng-click="vm.closeRank()"><span class="glyphicon glyphicon-remove" style="padding-top:0px;padding-bottom:0px;" aria-hidden="true"></span></button></span></h2></div></div><div class="row"><h4>{{ vm.isEdit ? \'Edit Event\':\'Add Event\'}}</h4></div><div class="text-right"><p class="hiw" ng-click="vm.showHowItWorksDialog()"><u>How it works?</u></p></div><br><div class="row"><div class="col-xs-6 col-sm-4 col-md-4"><p class="text-right">** Event Title:</p></div><div class="col-xs-12 col-sm-4 col-md-4"><input class="form-control" ng-model="vm.ev.name" type="text" placeholder="Event Title" ng-change="vm.displayCharLength()" maxlength="45" style="background-color:{{vm.ev.bc}};color:{{vm.ev.fc}}"></div><div class="col-xs-8 hidden-sm hidden-md hidden-lg hidden-xl"></div><div class="col-xs-6 col-sm-4 col-md-4"><p class="text-left">{{vm.char}} chars left</p></div></div><br ng-if="!vm.sm"><div ng-if="!vm.sm"><div class="row"><div class="hidden-xs col-sm-2 col-md-2 col-lg-2"></div><div class="col-xs-6 col-sm-2 col-md-2 col-lg-2"><p class="text-right">Background Color</p></div><div class="col-xs-6 col-sm-2 col-md-2 col-lg-2"><color-picker ng-model="vm.ev.bc" color-picker-swatch="true" color-picker-swatch-pos="\'left\'" color-picker-swatch-bootstrap="true" color-picker-swatch-only="true"></color-picker></div><div class="col-xs-6 col-sm-2 col-md-2 col-lg-2"><p class="text-right">Font Color</p></div><div class="col-xs-6 col-sm-2 col-md-2 col-lg-2"><color-picker ng-model="vm.ev.fc" color-picker-swatch="true" color-picker-swatch-pos="\'left\'" color-picker-swatch-bootstrap="true" color-picker-swatch-only="true"></color-picker></div><div class="hidden-xs col-sm-2 col-md-2 col-lg-2"></div></div></div><br ng-if="!vm.sm"><br><p class="text-left">Frequency</p><div class="btn-group col-sm-6 col-md-6"><button class="btn btn-primary {{vm.ev.freq == \'onetime\'? \'active\':\'\'}}" ng-click="vm.frequencySel(1)">One-Time</button> <button class="btn btn-primary {{vm.ev.freq == \'weekly\'? \'active\':\'\'}}" ng-click="vm.frequencySel(2)">Weekly</button></div><br><br><div class="row" ng-if="vm.onetime"><div class="col-xs-12 col-sm-3 col-md-3 col-lg-3"><div style="display:{{vm.onetime ? \'inline\':\'none\'}}"><p class="{{vm.sm ? \'text-left\':\'text-right\'}}">Start date:</p></div></div><div class="col-xs-12 col-sm-3 col-md-3 col-lg-3"><div style="display:{{vm.onetime ? \'inline\':\'none\'}}"><datepicker date-format="EEE MMM d y" date-year-title="selected title------"><input ng-model="vm.ev.sdate" type="text"></datepicker></div></div></div><div class="row" ng-if="vm.onetime"><div class="col-xs-12 col-sm-3 col-md-3 col-lg-3"><div style="display:{{vm.onetime ? \'inline\':\'none\'}}"><p class="{{vm.sm ? \'text-left\':\'text-right\'}}">Start time:</p></div></div><div class="col-xs-12 col-sm-3 col-md-3 col-lg-3"><div style="display:{{vm.onetime ? \'inline\':\'none\'}}"><select ng-model="vm.ev.stime" ng-options="x for x in vm.timeDD"><option value="">{{vm.sp.stime}}</option></select></div></div></div><div class="row" ng-if="vm.onetime"><div class="col-xs-12 col-sm-3 col-md-3 col-lg-3"><div style="display:{{vm.onetime ? \'inline\':\'none\'}}"><p class="{{vm.sm ? \'text-left\':\'text-right\'}}">End date:</p></div></div><div class="col-xs-12 col-sm-3 col-md-3 col-lg-3" style="display:{{vm.onetime ? \'inline\':\'none\'}}"><datepicker date-format="EEE MMM d y" date-year-title="selected title------"><input ng-model="vm.ev.edate" type="text"></datepicker></div></div><div class="row" ng-if="vm.onetime"><div class="col-xs-12 col-sm-3 col-md-3 col-lg-3" style="display:{{vm.onetime ? \'inline\':\'none\'}}"><p class="{{vm.sm ? \'text-left\':\'text-right\'}}">End time:</p></div><div class="col-xs-12 col-sm-3 col-md-3 col-lg-3" style="display:{{vm.onetime ? \'inline\':\'none\'}}"><select ng-model="vm.ev.etime" ng-options="x for x in vm.timeDD"><option value="">{{vm.sp.etime}}</option></select></div></div><div class="row" ng-if="vm.weekly"><div class="text-center"><div class="col-xs-12 col-sm-12 col-md-12" style="display:{{vm.weekly ? \'inline\':\'none\'}}"><label class="checkbox-inline"><input type="checkbox" ng-model="vm.ev.mon" value="">Mon</label> <label class="checkbox-inline"><input type="checkbox" ng-model="vm.ev.tue" value="">Tue</label> <label class="checkbox-inline"><input type="checkbox" ng-model="vm.ev.wed" value="">Wed</label> <label class="checkbox-inline"><input type="checkbox" ng-model="vm.ev.thu" value="">Thu</label> <label class="checkbox-inline"><input type="checkbox" ng-model="vm.ev.fri" value="">Fri</label> <label class="checkbox-inline"><input type="checkbox" ng-model="vm.ev.sat" value="">Sat</label> <label class="checkbox-inline"><input type="checkbox" ng-model="vm.ev.sun" value="">Sun</label></div></div></div><br><div class="row" ng-if="vm.weekly"><div class="col-xs-6 col-sm-6 col-md-6 col-lg-6"><div style="display:{{vm.weekly ? \'inline\':\'none\'}}"><p class="text-right">Start time:</p></div></div><div class="col-xs-6 col-sm-6 col-md-6 col-lg-6"><div style="display:{{vm.weekly ? \'inline\':\'none\'}}"><select ng-model="vm.ev.stime2" ng-options="x for x in vm.timeDD"><option value="">{{vm.ev.stime2}}</option></select></div></div></div><div class="row" ng-if="vm.weekly"><div class="col-xs-6 col-sm-6 col-md-6 col-lg-6"><div style="display:{{vm.weekly ? \'inline\':\'none\'}}"><p class="text-right">End time:</p></div></div><div class="col-xs-6 col-sm-6 col-md-6 col-lg-6"><div style="display:{{vm.weekly ? \'inline\':\'none\'}}"><select ng-model="vm.ev.etime2" ng-options="x for x in vm.timeDD"><option value="">{{vm.ev.etime2}}</option></select></div></div></div><div class="row"><form class="form-horizontal col-xs-12 col-sm-12 col-md-6" role="form" name="answerForm"><div class="form-group" style="padding:10px"><label class="control-label">Neighborhood:</label> <input class="form-control" ng-model="vm.ev.cityarea" bs-typeahead="" bs-options="c for c in vm.neighborhoods" type="text" placeholder="{{vm.ev.cityarea}}"></div><div class="form-group" style="padding:10px"><label class="control-label">Location:</label> <input class="form-control" ng-model="vm.ev.location" type="text" placeholder="{{vm.ev.location}}"></div><div class="form-group" style="padding:10px"><label class="control-label">Website:</label> <input class="form-control" ng-model="vm.ev.website" type="text" placeholder="{{vm.ev.website}}"></div><div class="form-group" style="padding:10px"><label class="control-label">Additional Info:</label> <textarea class="form-control" ng-model="vm.ev.addinfo" placeholder="{{vm.ev.addinfo}}" rows="4" style="background-color:{{vm.ev.bc}};color:{{vm.ev.fc}};width:100%"></textarea></div></form><div class="col-xs-12 col-sm-12 col-md-6"><div class="" ng-show="{{vm.type != \'Short-Phrase\'}}"><img src="{{vm.imageURL}}" alt="{{image.errorLoading}}" style="width:100%; max-height:300px"> <img src="../../../assets/images/powered_by_google_on_white.png"></div><div class="form-group text-right"><button type="submit" class="btn btn-primary {{vm.searchDisabled}}" ng-click="vm.callSearchImage()" ng-show="{{vm.type != \'Short-Phrase\'}}">{{vm.imageCommand}}</button> <button type="submit" class="btn btn-primary" ng-click="vm.viewPrev()" ng-disabled="vm.numLinks === 0" style="display:{{vm.imagefunctions}}">&laquo</button> <button type="submit" class="btn btn-primary" ng-click="vm.viewNext()" ng-disabled="vm.numLinks === 0" style="display:{{vm.imagefunctions}}">&raquo</button> <a style="display:{{vm.imagefunctions}}">{{vm.linkIdx+1}} of {{vm.numLinks}}</a></div><label class="checkbox-inline"><input type="checkbox" ng-change="vm.onNoGoodImages(vm.ngi)" ng-model="vm.ngi" ng-show="{{vm.type != \'Short-Phrase\'}}">No good images were found</label></div></div><br><div class="radio"><label><input type="radio" ng-model="vm.nobind" name="optradio" checked="true">Do not bind event to my account, let anyone make changes.</label></div><div class="radio"><label><input type="radio" ng-model="vm.bind" name="optradio">Bind this event to my account, only I can make changes.</label></div><br><div class="row"><div class="form-group text-center"><button type="button" class="btn btn-success" ng-click="vm.goBack()">Back</button> <button type="button" class="btn btn-primary" ng-click="vm.showPreview()">Preview</button> <button type="button" class="btn btn-danger" ng-click="vm.deleteSpecial()" style="display:{{vm.isEdit ? \'inline\':\'none\'}}">Delete</button></div></div>'),e.put("app/answer/Partials/answerDetail.html",'<div class="container" style="padding:0px;margin:0px;"><div class="well-rank" style="padding:0px;margin:0px;"><h3 class="sub-header">{{vm.title}}</h3></div></div><div class="container"><div class="well-answer" ng-if="vm.nsm"><h2 class="sub-header">{{vm.idx}}. {{vm.answer.name}} <span class="nomargin"><button type="button" class="btn btn-default pull-right" style="vertical-align:middle;" ng-click="vm.closeRank()"><span class="glyphicon glyphicon-remove" style="padding-top:0px;padding-bottom:0px;" aria-hidden="true"></span></button></span></h2></div><div class="well-answer" ng-if="vm.sm"><h3 class="sub-header">{{vm.idx}}. {{vm.answer.name}} <span class="nomargin"><button type="button" class="btn btn-default pull-right" style="vertical-align:middle;" ng-click="vm.closeRank()"><span class="glyphicon glyphicon-remove" style="padding-top:0px;padding-bottom:0px;" aria-hidden="true"></span></button></span></h3></div></div><div class="row"><div class="col-xs-8 col-sm-9 col-md-10"><h2><span ng-repeat="f in vm.fields" ng-show="{{vm.type != \'Short-Phrase\'}}"></span></h2></div><div class="col-xs-4 col-sm-3 col-md-2"><div class="text-right"><small class="text-muted">&nbsp;&nbsp;&nbsp{{vm.answer.views}}&nbspviews</small><br><div ng-show="{{vm.type == \'Establishment\' || vm.type == \'PersonCust\' || vm.type == \'Event\' }}"><p style="display:{{vm.answer.hasOwner ? \'none\':\'inline\'}}" class="hiw text-right" ng-click="vm.bizRegDialog()"><u>{{vm.bindtxt}}</u></p><span class="glyphicon glyphicon-star-empty" style="display:{{vm.answer.hasOwner ? \'inline\':\'none\'}}"></span></div></div></div></div><div class="text-middle" ng-if="vm.type != \'Short-Phrase\'"><img class="displayed" src="{{vm.answer.imageurl}}" alt="Moustiers Sainte Marie" style="height:{{vm.mxheight}}px;width:auto;max-width:96%;margin-left:auto;margin-right:auto;" ng-click="vm.showUrl()" ng-if="vm.modeIsImage"> <img class="displayed" src="https://maps.googleapis.com/maps/api/staticmap?center={{vm.answer.location}}&zoom=13&size={{vm.width}}x{{vm.mxheight}}&maptype=roadmap &markers=color:red%7Clabel:%7C{{vm.answer.lat}},{{vm.answer.lng}}&key=AIzaSyDKXsql-P8czb4nAQMXjkFpm_I5HqKsQpo" ng-if="!vm.modeIsImage"></div><div class="container-answer" style="width:100%;height:auto" ng-if="vm.type == \'Short-Phrase\'"><br><h2 style="text-align:center"><strong>{{vm.answer.name}}</strong></h2><br><h4 style="text-align:center">{{vm.answer.addinfo}}</h4></div><div class="row" ng-if="vm.showNextnPrev"><div class="text-left col-xs-6"><button class="btn-success" ng-click="vm.goPrev()">&lt;&lt</button></div><div class="text-right col-xs-6"><button class="btn-success" ng-click="vm.goNext()">&gt;&gt</button></div></div><div class="answer_info row" ng-if="vm.type != \'Short-Phrase\' && vm.type != \'Event\'"><div class="col-sm-8"><br><strong ng-if="vm.answer.location">Address:</strong> <a ng-if="vm.answer.location" href="http://maps.apple.com/maps?q={{vm.answer.location}}" target="_blank">{{vm.answer.location}}</a><br ng-if="vm.answer.location"><strong>{{(vm.answer.cityarea) ? \'Neighboorhood:\' : ""}}</strong> {{(vm.answer.cityarea) ? vm.answer.cityarea : ""}}<br style="display:{{(vm.answer.cityarea) ? \'inline\' : \'none\'}}"><strong ng-if="vm.answer.phone">Phone:</strong> <a ng-if="vm.answer.phone" href="tel:{{vm.answer.phone}}">{{vm.answer.phone}}</a><br style="display:{{(vm.answer.phone) ? \'inline\' : \'none\'}}"><strong ng-if="vm.answer.website">Website:</strong> <a ng-if="vm.answer.website.indexOf(\'http\') >=0" href="{{vm.answer.website}}" target="_blank">{{vm.answer.website}}</a> <a ng-if="vm.answer.website.indexOf(\'http\') == -1" href="http://{{vm.answer.website}}" target="_blank">{{vm.answer.website}}</a><br ng-if="vm.answer.website"><strong>{{(vm.answer.email) ? \'Email:\' : ""}}</strong> {{(vm.answer.email) ? vm.answer.email : ""}}<br style="display:{{(vm.answer.email) ? \'inline\' : \'none\'}}"></div><div class="col-sm-4 answer_info_buttons"><a type="button" class="btn btn-default" style="vertical-align:middle;color:#0059b3;border-color:#0059b3;" ng-if="vm.isMobile && vm.answer.phone" href="tel:{{vm.answer.phone}}" target="_blank">Call&nbsp&nbsp<span class="fa fa-phone"></span></a> <a type="button" class="btn btn-default" style="vertical-align:middle;color:#0059b3;border-color:#0059b3;" ng-if="vm.answer.lat && vm.answer.lng" href="http://maps.apple.com/maps?q={{vm.answer.lat}}, {{vm.answer.lng}}" target="_blank">Directions&nbsp&nbsp<span class="fa fa-map-marker"></span></a> <a type="button" class="btn btn-default" style="vertical-align:middle;color:#0059b3;border-color:#0059b3;" ng-if="vm.answer.lat && vm.answer.lng" ng-click="vm.toggleimgmode()">{{vm.imgmode}}&nbsp&nbsp<span class="{{vm.imgmodeicon}}"></span></a></div></div><div ng-if="vm.type != \'Short-Phrase\' && vm.type != \'Event\'"><i style="display:{{vm.hrset ? \'inline\':\'none\'}}">{{vm.hourstr}}</i><br style="display:{{vm.answer.addinfo ? \'inline\':\'none\'}}"><span>{{vm.answer.addinfo_teaser}}</span> <span ng-show="vm.completeinfo">{{vm.answer.addinfo_complete}}</span> <span ng-if="vm.answer.addinfo.length > 0" ng-click="vm.showcomplete()" style="background-color:lightgray">{{vm.moretext}}</span><br style="display:{{vm.answer.addinfo ? \'inline\':\'none\'}}"></div><div ng-if="vm.type == \'Event\'"><br><div ng-bind-html="vm.ehtml" style="{{vm.estyle}}"><br></div></div><br><a type="button" class="btn btn-primary btn-block" ng-click="vm.editAnswer()" style="display:{{(vm.answer.hasOwner == false || vm.userIsOwner == true) ? \'inline\':\'none\'}}">Edit Info / Change Image {{vm.numEdits > 0? "("+vm.numEdits+")" : ""}}</a><div class="col-xs-12"><div class="well-sm" style="background-color:#666666;color:#f8f8ff"><h3 class="sub-header">Endorsements</h3></div><p class="text-left" ng-if="vm.type != \'Short-Phrase\'"><strong>{{vm.answer.name}}</strong> is featured in the following ranks:</p><p>Vote up if you endorse. Vote down if you disapprove.</p><div class="well well-light-ranks col-md-4 col-lg-4" ng-repeat="r in vm.answerRanks"><div class="well-sm" style="background-color:#666666;color:#f8f8ff"><h4 class="sub-header">{{(vm.type == \'Short-Phrase\') ? vm.answer.name : r.title}}</h4></div><p class="text-center" ng-if="vm.type == \'Short-Phrase\'">on {{r.title}}</p><p>Ranked <strong>#{{r.rank}}</strong> out of <strong>{{r.answers}}</strong></p><div class="row"><div class="col-xs-1 col-md-1 col-lg-1" style="{{vm.sp1}}"></div><img style="{{vm.sp2}}" class="img-circle col-xs-1 col-md-1 col-lg-1 cursor" src="../../../assets/images/{{r.thumbUp}}" ng-click="vm.UpVote(r)"> <label style="{{vm.sp3}}" class="col-xs-1 col-md-1 col-lg-1"><font size="5">{{r.upV}}</font></label> <img style="{{vm.sp2}}" class="img-circle col-xs-1 col-md-1 col-lg-1 cursor" src="../../../assets/images/{{r.thumbDn}}" ng-click="vm.DownVote(r)"> <label style="{{vm.sp3}}" class="col-xs-1 col-md-1 col-lg-1"><font size="5">{{r.downV}}</font></label></div><br><p class="hiw text-right" ng-click="vm.gotoRank(r)">&lt;&lt;See full ranking&gt;&gt;</p></div></div><div class="col-xs-12" ng-if="true"><div class="row" ng-if="vm.type != \'Short-Phrase\'"><div class="col-xs-12"><div class="well-sm" style="background-color:#666666;color:#f8f8ff;"><h3 class="sub-header">Photo Gallery</h3></div></div></div><div class="text-right" ng-if="vm.type != \'Short-Phrase\'"><a type="button" class="btn btn-success btn-block" ng-click="vm.getImages()" style="display:{{vm.showImageGallery == false ? \'inline\':\'none\'}}">Show Images</a></div><div style="display:{{vm.showImageGallery == true ? \'inline\':\'none\'}}"><div class="col-xs-4 col-sm-4 col-md-3 col-lg-2" ng-repeat="x in vm.images" style="margin:0px;padding:0px;"><a ng-click="vm.selectPhoto($index)" class="thumbnail"><img src="https://rankx.blob.core.windows.net/sandiego/{{x.Name}}" style="width:100%;height:120px"></a></div></div><div class="text-right" ng-if="vm.type != \'Short-Phrase\'"><div ng-if="vm.showImageGallery && vm.isLoggedIn && vm.userIsOwner" style="display:{{vm.isLoggedIn ? \'inline\':\'none\'}}"><blob-upload></blob-upload></div></div></div><div class="col-xs-12"><div ng-show="{{vm.type == \'Establishment\' || vm.type == \'PersonCust\' }}"><div class="well-sm" style="background-color:#666666;color:#f8f8ff"><h3 class="sub-header">Specials</h3></div><div ng-repeat="x in vm.specialsList"><div ng-bind-html="x.html" style="{{x.style}}"><br></div><p ng-if="x.hasimage" style="background-color:lightgray;cursor:pointer" ng-click="vm.showsimage(x)">Show Flyer</p><div class="text-middle" ng-if="x.showimage"><img class="displayed" src="{{x.image}}" style="height:{{vm.mxheight}};width:auto;max-width:96%;margin-left:auto;margin-right:auto;"><br></div></div><div class="text-right"><a type="button" class="btn btn-primary btn-block" ng-click="vm.openSpecials()" style="display:{{vm.access ? \'inline\':\'none\'}}">Edit Specials</a></div></div></div><div class="col-xs-12"><div ng-show="{{vm.type == \'Establishment\' || vm.type == \'PersonCust\' }}"><div class="well-sm" style="background-color:#666666;color:#f8f8ff"><h3 class="sub-header">How do we do?</h3></div><table class="table table-hover cursor" ng-repeat="x in vm.vrowgroups track by $index"><thead class="thead-inverse"><tr><th colspan="5" class="text-center" style="background-color:#d9d9d9;width:100%">{{x[0].gtitle}}</th></tr></thead><tbody><tr ng-repeat="item in x"><td align="middle" style="width:10%"><img src="../../../assets/images/{{item.upImage}}" style="max-height:30px;margin:0px;" ng-click="vm.vrowVoteUp(item)"></td><td align="left" style="width:10%">{{item.upV}}</td><td align="middle" style="width:60%">{{item.title}}</td><td align="right" style="width:10%">{{item.downV}}</td><td align="middle" style="width:10%"><img src="../../../assets/images/{{item.downImage}}" style="max-height:30px;margin:0px;" ng-click="vm.vrowVoteDown(item)"></td></tr></tbody></table><div class="text-right"><a type="button" class="btn btn-primary btn-block" ng-click="vm.editVRows()" style="display:{{vm.userIsOwner == true ? \'inline\': \'none\'}}">Edit VoteRows</a></div></div></div><div class="col-xs-12"><div ng-show="{{vm.type != \'Establishment\' && vm.type != \'PersonCust\' && vm.type != \'Event\' }}"><div class="well-sm" style="background-color:#666666;color:#f8f8ff"><h3 class="sub-header">Versus Table</h3></div><table class="table table-hover cursor"><tbody><thead><tr><th align="middle" style="width:15%">Pct (%)</th><th align="middle" style="width:60%">vs. Opponent</th><th align="middle" style="width:15%">Pct (%)</th><th align="middle" style="width:10%">GP</th></tr></thead><tbody><tr ng-repeat="x in vm.relativetable | orderBy: \'-Rank\'"><td align="middle" style="width:15%">{{x.PctF}}</td><td align="middle" style="width:60%">{{x.vsName}}</td><td align="middle" style="width:15%">{{x.PctC}}</td><td align="middle" style="width:10%">{{x.GP}}</td></tr></tbody></tbody></table></div></div><br><div class="text-center"><button ng-click="vm.loadComments()" class="btn btn-default" style="background-color:#e6e6e6;width:100%">COMMENTS ({{vm.numcom}})</button></div><br><div style="display:{{vm.cm.commLoaded ? \'inline\':\'none\'}}"><div ng-repeat="x in vm.cm.comments"><div class="row"><div class="usericon col-xs-2 col-sm-2 col-md-1 col-lg-1" style="background-color:{{x.bc}};color:{{x.fc}};" align="middle">{{x.initials}}</div><div class="col-xs-10 col-sm-10 col-md-11 col-lg-11">{{x.body}}<br><small style="color:#bfbfbf">{{x.username}} - {{x.date}}&nbsp&nbsp <span class="dropdown"><i type="button" class="fa fa-flag dropdown-toggle" data-toggle="dropdown"></i><ul class="dropdown-menu dropdown-menu-left"><li><a ng-click="vm.cmFlag(1)">Off-Topic</a></li><li><a ng-click="vm.cmFlag(2)">Offensive</a></li><li><a ng-click="vm.cmFlag(3)">Spam</a></li></ul></span></small></div></div><br></div><div style="display:{{(vm.cm.commLoaded && vm.cm.comments.length == 0 && !vm.isLoggedIn) ? \'inline\':\'none\'}}"><br><p><small>Nobody has commented yet. Be the first. Log in and leave a comment.</small></p></div><div style="display:{{(vm.cm.commLoaded && vm.cm.comments.length > 0 && !vm.isLoggedIn) ? \'inline\':\'none\'}}"><br><p><small>You must log in to leave a comment.</small></p></div><div style="display:{{(vm.cm.commLoaded && vm.isLoggedIn && !vm.commentAllowed) ? \'inline\':\'none\'}}"><br><p><small>Endorse one or more answers to leave a comment.</small></p></div><div style="display:{{(vm.isLoggedIn && vm.commentAllowed) ? \'inline\':\'none\'}}"><div class="row"><div class="usericon col-xs-2 col-sm-2 col-md-1 col-lg-1" style="background-color:{{vm.cm.bc}};color:{{vm.cm.fc}};" align="middle">{{vm.cm.initials}}</div><div class="col-xs-10 col-sm-10 col-md-11 col-lg-11"><textarea class="form-control" ng-model="vm.cm.newComment" placeholder="Leave a comment" style="margin-left:0px;margin-right:0px;"></textarea></div></div><div class="text-right"><button ng-click="vm.postComment()" class="btn btn-primary">Post</button></div></div></div><br><div class="btn-group" role="group"><button type="button" ng-click="vm.goBack()" class="btn btn-default">Back</button><div class="btn-group" role="group"><button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">Flag</button><ul class="dropdown-menu" role="menu"><li><a ng-click="vm.flagAnswer(1)">Wrong Category</a></li><li><a ng-click="vm.flagAnswer(2)">Offensive</a></li><li><a ng-click="vm.flagAnswer(3)">Spam</a></li></ul></div><button type="button" ng-click="vm.deleteAnswer()" class="btn btn-danger" style="display:{{vm.deleteButton}}">Delete</button></div><br><br>'),e.put("app/answer/Partials/blobupload.html",'<button type="file" ngf-select="uploadFiles($file, $invalidFiles)" accept="image/*" ngf-max-size="3MB" class="btn btn-primary text-center" ngf-resize="{width: 100, height: 100, quality: .1, type: \'image/jpeg\', ratio: \'19:11\', centerCrop: true, pattern=\'.jpg\', restoreExif: false}" role="button" ngf-validate-after-resize="boolean" ngf-model-invalid="invalidFiles">Upload New Image</button><br><br><div style="font:smaller">{{errFile.name}} {{errorMsg}}</div><div style="font:smaller"><span class="progress" ng-show="f.progress >= 0"><div style="width:{{f.progress}}%" ng-bind="f.progress + \'%\'"></div></span></div><br>'),e.put("app/answer/Partials/editAnswer.html",'<div class="container"><div class="well-answer"><h2 class="sub-header">{{vm.answer.name}} <span class="nomargin"><button type="button" class="btn btn-default pull-right" style="vertical-align:middle;" ng-click="vm.closeRank()"><span class="glyphicon glyphicon-remove" style="padding-top:0px;padding-bottom:0px;" aria-hidden="true"></span></button></span></h2></div></div><div class="row"><div class="col-sm-6"><h3>Edit Answer Profile</h3></div><div class="col-sm-6 text-right"><p class="hiw" ng-click="vm.showHowItWorksDialog()"><u>How it Works</u></p></div></div><br><div class="row"><div class="col-sm-12 col-md-6"><div class="" ng-show="{{vm.type != \'Short-Phrase\'}}"><img class="displayed-uc" src="{{vm.imageURL}}" alt="{{image.errorLoading}}" style="width:100%; max-height:300px" ng-show="{{vm.type != \'Short-Phrase\'}}"> <img src="../../../assets/images/powered_by_google_on_white.png" ng-if="vm.type!=\'PersonCust\' && !vm.userIsOwner"></div><div class="container-answer" style="width:100%; max-height:300px;" ng-show="{{vm.type == \'Short-Phrase\'}}"><br><h2 style="text-align:center"><strong>{{vm.answer.name}}</strong></h2><br><h4 style="text-align:center">{{vm.answer.addinfo}}</h4></div><br><div ng-if="vm.userIsOwner" style="display:{{vm.userIsOwner ? \'inline\':\'none\'}}"><blob-upload></blob-upload></div><div style="display:{{vm.userIsOwner ? \'none\':\'inline\'}}" ng-if="vm.type!=\'PersonCust\'"><button type="submit" class="btn btn-primary" ng-click="vm.editImage()">{{vm.imageCommand}}</button> <button type="submit" class="btn btn-primary" ng-click="vm.viewPrev()" style="display:{{vm.imagefunctions}}">&laquo</button> <button type="submit" class="btn btn-primary" ng-click="vm.viewNext()" style="display:{{vm.imagefunctions}}">&raquo</button> <a style="display:{{vm.imagefunctions}}">{{vm.linkIdx+1}} of {{vm.numLinks}}</a> <button type="submit" class="btn btn-success" ng-click="vm.selectImage()" style="display:{{vm.imagefunctions}}">Select</button></div></div><form class="form-horizontal col-sm-12 col-md-6" role="form" name="answerForm" ng-repeat="x in vm.fields"><div style="display:{{x.field!=\'addinfo\' ? \'inline\':\'none\'}}" ng-hide="{{x.onlybyowner && !vm.userIsOwner}}"><label class="control-label capitalize">{{x.label}}:</label><div class="input-group"><input type="text" class="form-control" ng-model="x.val" bs-options="{{x.opts}}" bs-typeahead="" placeholder="{{x.cval}}"> <span class="input-group-btn text-right"><button class="btn btn-primary" type="button" ng-click="vm.editField(x)">Edit</button></span></div></div><div class="input-group" style="display:{{x.field==\'addinfo\' ? \'inline\':\'none\'}}" ng-hide="{{!vm.access && (vm.type == \'PersonCust\')}}"><label class="control-label capitalize">{{x.label}}:</label> <textarea id="textarea1" class="form-control" ng-model="x.val" placeholder="{{x.cval}}" rows="5" ng-model-options="{debounce: 2500}">\r\n            </textarea><br><br><span class="input-group-btn text-right"><button ng-click="vm.getWiki()" class="btn btn-primary" style="background-color:#595959;border-color:gray;margin-right:10px" ng-if="vm.type == \'Person\'">Get from Wikipedia</button> <button class="btn btn-primary" type="button" ng-click="vm.editField(x)">Edit</button></span></div></form></div><br><div class="well well-light-edit" ng-repeat="x in vm.edits"><div ng-if="x.field != \'addinfo\'"><p><strong>{{x.username}}</strong> has edited the <strong class="capitalize"><em>{{x.field}}</em></strong> of <strong><em>{{x.name}}</em></strong> to <strong><em>{{x.nval}}</em></strong>.</p></div><div ng-if="x.field == \'addinfo\'"><p><strong>{{x.username}}</strong> has edited the information of <strong><em>{{x.name}}</em></strong> to:<br><br>{{x.nval}}.</p></div><img src="{{x.imageURL}}" "="" class="displayed" style="height:150px;display:{{x.display}}"><div class="row form-group"><div class="text-center"><label>{{x.upV}}</label> <label></label> <button class="btn btn-primary {{x.agree}}" ng-click="vm.editAgree(x, $index)">Agree</button> <button type="submit" class="btn btn-primary {{x.disagree}}" ng-click="vm.editDisagree(x, $index)">Disagree</button> <label></label> <label>{{x.downV}}</label></div></div></div><div ng-if="vm.sm && vm.userIsOwner && vm.type == \'Establishment\'"><div class="text-center"><label>Service Hours</label></div><br><div ng-repeat="x in vm.openhours"><div class="container-hours"><div class="row"><div class="col-xs-6 col-sm-6 col-md-2"><p>{{x.day}}:</p></div><div class="col-xs-6 col-sm-6 col-md-2"><select ng-model="x.opn" ng-change="vm.hoursChanged()" ng-options="n for n in vm.openOptions"></select></div></div><div class="row"><div class="col-xs-2 col-sm-2 col-md-2" style="display:{{x.opn==\'OPEN\' ? \'inline\': \'none\'}}"><p class="text-right">From:</p></div><div class="col-xs-4 col-sm-4 col-md-2" style="display:{{x.opn==\'OPEN\' ? \'inline\': \'none\'}}"><select ng-model="x.st" ng-change="vm.hoursChanged()" ng-options="t for t in vm.timeDD"></select></div><div class="col-xs-2 col-sm-2 col-md-2" style="display:{{x.opn==\'OPEN\' ? \'inline\': \'none\'}}"><p class="text-right">To:</p></div><div class="col-xs-4 col-sm-4 col-md-2" style="display:{{x.opn==\'OPEN\' ? \'inline\': \'none\'}}"><select ng-model="x.ct" ng-change="vm.hoursChanged()" ng-options="t for t in vm.timeDD"></select></div></div></div><br></div></div><div ng-if="vm.nsm && vm.userIsOwner && vm.type == \'Establishment\'"><div class="container" style="background-color:#e6e6e6;padding-right:50px;padding-left:10px;padding-top:10px;padding-bottom:0px;"><div class="text-center"><label>Service Hours</label></div><br><div class="container" ng-repeat="x in vm.openhours"><div class="row"><div class="col-xs-2 col-sm-2 col-md-2"><p>{{x.day}}:</p></div><div class="col-xs-2 col-sm-2 col-md-2"><select ng-model="x.opn" ng-change="vm.hoursChanged()" ng-options="n for n in vm.openOptions"></select></div><div class="col-xs-2 col-sm-2 col-md-2" style="display:{{x.opn==\'OPEN\' ? \'inline\': \'none\'}}"><p class="text-right">From:</p></div><div class="col-xs-2 col-sm-2 col-md-2" style="display:{{x.opn==\'OPEN\' ? \'inline\': \'none\'}}"><select ng-model="x.st" ng-change="vm.hoursChanged()" ng-options="t for t in vm.timeDD"></select></div><div class="col-xs-2 col-sm-2 col-md-2" style="display:{{x.opn==\'OPEN\' ? \'inline\': \'none\'}}"><p class="text-right">To:</p></div><div class="col-xs-2 col-sm-2 col-md-2" style="display:{{x.opn==\'OPEN\' ? \'inline\': \'none\'}}"><select ng-model="x.ct" ng-change="vm.hoursChanged()" ng-options="t for t in vm.timeDD"></select></div></div><br></div></div></div><div class="text-right" ng-if="vm.userIsOwner && vm.type == \'Establishment\'"><a ng-click="vm.updateHours()" class="btn btn-primary {{vm.updateHoursEn}}">Update Hours</a></div><br><div class="text-center"><a ng-click="vm.answerDetail()" class="btn btn-success">Back</a></div><br>'),
e.put("app/content/partials/content-block.html",'<div style="display:{{hideme ? \'none\':\'inline\'}}"><br ng-if="isDynamic"><table class="table" style="border-style:none" ng-if="isRoW"><tbody><thead><tr><th style="background-color:{{bgc}};color:{{fc}};width:50%;border-style:none">{{headline}}</th></tr></thead></tbody></table><div class="container" ng-if="isRoW"><div class="row"><div class="col-sm-6 col-md-6 col-lg-4"><img class="mainpic" src="{{image1}}" style="display:{{image1 != undefined ? \'inline\':\'none\'}}"></div><div class="hidden-xs col-sm-6 col-md-6 col-lg-4"><img class="mainpic" src="{{image2}}" style="display:{{image2 != undefined ? \'inline\':\'none\'}}"></div><div class="hidden-xs hidden-sm hidden-md col-lg-4"><img class="mainpic" src="{{image3}}" style="display:{{image3 != undefined ? \'inline\':\'none\'}}"></div></div></div><br ng-if="isRoW"><table class="table"><tbody><thead ng-if="!isRoW" style="border-style:none;"><tr><th style="background-color:{{bgc}};color:{{fc}};width:50%;">{{headline}}</th></tr></thead><tr ng-repeat="x in results_nm" ng-click="rankSel(x,true)" style="cursor:pointer;" ng-if="nm"><td style="width:50%;">{{x.title}} <small class="text-muted">&nbsp;&nbsp;&nbsp;&nbsp;{{x.answers}}&nbspanswers-{{x.views}}&nbspviews</small></td></tr><tr ng-repeat="x in results | limitTo:maxRes" ng-click="rankSel(x,false)" style="cursor:pointer;"><td style="width:50%;">{{x.title}} <small class="text-muted">&nbsp;&nbsp;&nbsp;&nbsp;{{x.answers}}&nbspanswers-{{x.views}}&nbspviews</small></td></tr></tbody></table><p class="text-right" style="color:blue;" ng-click="seeMore(maxRes, btext)" ng-if="!resLT6 && modType!=\'rankofweek\'">&lt;&lt;{{btext}}&gt;&gt;</p></div>'),e.put("app/customer/Partials/customer.html",'<div ui-view="navbar"></div><br><h2>Select business you wish to manage</h2><div ng-repeat="x in vm.answers"><label><input type="radio" name="businessradio" ng-click="vm.selAnswer(x)">&nbsp;&nbsp;{{x.name}}, {{x.location}}, {{x.cityarea}}</label></div><br><div class="text-center"><div class="btn-group col-sm-6 col-md-6"><button class="btn btn-success {{vm.loadMainPhoto}}" ng-click="vm.loadMainPhoto()">Main Photo</button> <button class="btn btn-primary {{vm.loadSpecials}}" ng-click="vm.loadSpecials()">Specials</button> <button class="btn btn-danger {{vm.loadPhotoGallery}}" ng-click="vm.loadPhotoGallery()">Photo Gallery</button></div></div><br><br><div ui-view=""></div><br><br><footer class="footer"><div class="container"><p class="text-muted">Rank-X is property of Rank-X LLC. San Diego, CA - 2016</p></div></footer>'),e.put("app/customer/Partials/editspecial.html",'<div class="container"><div class="well-sm"><h3 class="sub-header">{{vm.header}} <span class="nomargin"><button type="button" class="btn btn-default pull-right" style="vertical-align:middle;" ng-click="vm.closeRank()"><span class="glyphicon glyphicon-remove" style="padding-top:0px;padding-bottom:0px;" aria-hidden="true"></span></button></span></h3></div></div><h3>{{ vm.isEdit ? \'Edit Special\':\'Add Special\'}}</h3><br><div class="well"><div class="row"><div class="col-xs-6 col-sm-4 col-md-4"><p class="text-right">Specials Title:</p></div><div class="col-xs-12 col-sm-4 col-md-4"><input class="form-control" ng-model="vm.sp.stitle" type="text" placeholder="Special Banner" ng-change="vm.displayCharLength()" maxlength="25" style="background-color:{{vm.sp.bc}};color:{{vm.sp.fc}}"></div><div class="col-xs-8 hidden-sm hidden-md hidden-lg hidden-xl"></div><div class="col-xs-6 col-sm-4 col-md-4"><p class="text-left">{{vm.char}} chars left</p></div></div><br><div class="row"><div class="hidden-xs col-sm-2 col-md-2 col-lg-2"></div><div class="col-xs-6 col-sm-2 col-md-2 col-lg-2"><p class="text-right">Background Color</p></div><div class="col-xs-6 col-sm-2 col-md-2 col-lg-2"><color-picker ng-model="vm.sp.bc" color-picker-swatch="true" color-picker-swatch-pos="\'left\'" color-picker-swatch-bootstrap="true" color-picker-swatch-only="true"></color-picker></div><div class="col-xs-6 col-sm-2 col-md-2 col-lg-2"><p class="text-right">Font Color</p></div><div class="col-xs-6 col-sm-2 col-md-2 col-lg-2"><color-picker ng-model="vm.sp.fc" color-picker-swatch="true" color-picker-swatch-pos="\'left\'" color-picker-swatch-bootstrap="true" color-picker-swatch-only="true"></color-picker></div><div class="hidden-xs col-sm-2 col-md-2 col-lg-2"></div></div><p class="text-left">Frequency</p><div class="btn-group col-sm-6 col-md-6"><button class="btn btn-primary {{vm.sp.freq == \'onetime\'? \'active\':\'\'}}" ng-click="vm.frequencySel(1)">One-Time</button> <button class="btn btn-primary {{vm.sp.freq == \'weekly\'? \'active\':\'\'}}" ng-click="vm.frequencySel(2)">Weekly</button></div><br><br><br><div class="row"><div class="col-xs-6 col-sm-3 col-md-3 col-lg-3"><div style="display:{{vm.onetime ? \'inline\':\'none\'}}"><p class="text-right">Start date:</p></div></div><div class="col-xs-6 col-sm-3 col-md-3 col-lg-3"><div style="display:{{vm.onetime ? \'inline\':\'none\'}}"><datepicker date-format="EEE MMM d y" date-year-title="selected title------"><input ng-model="vm.sp.sdate" type="text"></datepicker></div></div></div><div class="row"><div class="col-xs-6 col-sm-3 col-md-3 col-lg-3"><div style="display:{{vm.onetime ? \'inline\':\'none\'}}"><p class="text-right">Start time:</p></div></div><div class="col-xs-6 col-sm-3 col-md-3 col-lg-3"><div style="display:{{vm.onetime ? \'inline\':\'none\'}}"><select ng-model="vm.sp.stime" ng-options="x for x in vm.timeDD"><option value="">{{vm.sp.stime}}</option></select></div></div></div><div class="row"><div class="col-xs-6 col-sm-3 col-md-3 col-lg-3"><div style="display:{{vm.onetime ? \'inline\':\'none\'}}"><p class="text-right">End date:</p></div></div><div class="col-xs-4 col-sm-3 col-md-3 col-lg-3" style="display:{{vm.onetime ? \'inline\':\'none\'}}"><datepicker date-format="EEE MMM d y" date-year-title="selected title------"><input ng-model="vm.sp.edate" type="text"></datepicker></div></div><div class="row"><div class="col-xs-6 col-sm-3 col-md-3 col-lg-3" style="display:{{vm.onetime ? \'inline\':\'none\'}}"><p class="text-right">End time:</p></div><div class="col-xs-6 col-sm-3 col-md-3 col-lg-3" style="display:{{vm.onetime ? \'inline\':\'none\'}}"><select ng-model="vm.sp.etime" ng-options="x for x in vm.timeDD"><option value="">{{vm.sp.etime}}</option></select></div></div><div class="row"><div class="text-center"><div class="col-xs-12 col-sm-12 col-md-12" style="display:{{vm.weekly ? \'inline\':\'none\'}}"><label class="checkbox-inline"><input type="checkbox" ng-model="vm.sp.mon" value="">Mon</label> <label class="checkbox-inline"><input type="checkbox" ng-model="vm.sp.tue" value="">Tue</label> <label class="checkbox-inline"><input type="checkbox" ng-model="vm.sp.wed" value="">Wed</label> <label class="checkbox-inline"><input type="checkbox" ng-model="vm.sp.thu" value="">Thu</label> <label class="checkbox-inline"><input type="checkbox" ng-model="vm.sp.fri" value="">Fri</label> <label class="checkbox-inline"><input type="checkbox" ng-model="vm.sp.sat" value="">Sat</label> <label class="checkbox-inline"><input type="checkbox" ng-model="vm.sp.sun" value="">Sun</label></div></div></div><br><div class="row"><div class="col-xs-6 col-sm-6 col-md-6 col-lg-6"><div style="display:{{vm.weekly ? \'inline\':\'none\'}}"><p class="text-right">Start time:</p></div></div><div class="col-xs-6 col-sm-6 col-md-6 col-lg-6"><div style="display:{{vm.weekly ? \'inline\':\'none\'}}"><select ng-model="vm.sp.stime2" ng-options="x for x in vm.timeDD"><option value="">{{vm.sp.stime2}}</option></select></div></div></div><div class="row"><div class="col-xs-6 col-sm-6 col-md-6 col-lg-6"><div style="display:{{vm.weekly ? \'inline\':\'none\'}}"><p class="text-right">End time:</p></div></div><div class="col-xs-6 col-sm-6 col-md-6 col-lg-6"><div style="display:{{vm.weekly ? \'inline\':\'none\'}}"><select ng-model="vm.sp.etime2" ng-options="x for x in vm.timeDD"><option value="">{{vm.sp.etime2}}</option></select></div></div></div><br><div class="row"><div class="col-sm-0 col-md-3 col-lg-3"></div><div class="container col-sm-12 col-md-6 col-lg-6"><p>Event Details</p><textarea class="form-control" ng-model="vm.sp.details" placeholder="{{x.label}}" rows="4" style="background-color:{{vm.sp.bc}};color:{{vm.sp.fc}};width:100%"></textarea></div><div class="col-sm-0 col-md-3 col-lg-3"></div><br></div><div class="row"><div class="col-sm-0 col-md-3 col-lg-3"></div><div class="container col-sm-12 col-md-6 col-lg-6"><div class=""><p>Event Image</p><img src="{{vm.imageURL}}" alt="{{image.errorLoading}}" style="width:100%; max-height:300px"><div ng-if="vm.userIsOwner" style="display:{{vm.userIsOwner ? \'inline\':\'none\'}}"><blob-upload></blob-upload></div></div></div><div class="col-sm-0 col-md-3 col-lg-3"></div><br></div><br><div class="form-group text-center"><button type="button" class="btn btn-success" ng-click="vm.goBack()">Back</button> <button type="button" class="btn btn-primary" ng-click="vm.showPreview()">Preview</button> <button type="button" class="btn btn-danger" ng-click="vm.deleteSpecial()" style="display:{{vm.isEdit ? \'inline\':\'none\'}}">Delete</button></div></div>'),e.put("app/customer/Partials/editvrows.html",'<div class="container"><div class="well-sm"><h3 class="sub-header">{{vm.header}} <span class="nomargin"><button type="button" class="btn btn-default pull-right" style="vertical-align:middle;" ng-click="vm.closeRank()"><span class="glyphicon glyphicon-remove" style="padding-top:0px;padding-bottom:0px;" aria-hidden="true"></span></button></span></h3></div></div><div ng-repeat="x in vm.vrows track by $index"><div style="display:{{x.shdr ? \'inline\':\'none\'}}"><br></div><div class="row"><div style="display:{{x.shdr ? \'inline\':\'none\'}}"><div class="col-xs-10" style="background-color:gray;color:white;"><p>{{x.gtitle}}</p></div><div class="col-xs-2"><button type="button" class="btn btn-default" ng-click="vm.editVRowGroupDiag(x)"><span class="glyphicon glyphicon-pencil" aria-hidden="true"></span></button></div></div></div><div style="display:{{x.title != \'-\' ? \'inline\':\'none\'}}"><div class="row"><div class="col-xs-10" style="background-color:#d9d9d9;padding-top:2px;padding-bottom:2px;">{{x.title}}</div><div class="col-xs-2"><div class="btn-group"><button type="button" class="btn btn-default" ng-click="vm.deleteVRowDiag(x)"><span class="glyphicon glyphicon-remove" aria-hidden="true"></span></button></div></div></div></div><div style="display:{{x.saddr ? \'inline\':\'none\'}}"><div class="row"><div class="col-xs-10"><div class="text-right"><button type="button" class="btn btn-default" ng-click="vm.addVRowDiag(x)">Add Vote Row</button></div></div><div class="col-xs-2"></div></div></div></div><br><div class="text-left"><button type="button" class="btn btn-default" ng-click="vm.addVRowGroupDiag()">Add Group</button></div><div class="text-right"><button type="button" class="btn btn-success" ng-click="vm.closeRank()">Go Back</button></div>'),e.put("app/customer/Partials/mainphoto.html","<h1>Main Photo</h1>"),e.put("app/customer/Partials/photogallery.html","<h1>Photo Gallery</h1>"),e.put("app/customer/Partials/specials.html",'<div class="container"><div class="well-sm"><h3 class="sub-header">{{vm.header}} <span class="nomargin"><button type="button" class="btn btn-default pull-right" style="vertical-align:middle;" ng-click="vm.closeRank()"><span class="glyphicon glyphicon-remove" style="padding-top:0px;padding-bottom:0px;" aria-hidden="true"></span></button></span></h3></div></div><label>{{vm.specialsList.length > 0? \'Choose a special to Edit\':\'There are no specials registered to this establishment\'}}</label><div ng-repeat="x in vm.specialsList"><div class="row"><div class="col-xs-12 col-sm-6 col-md-4"><label style="background-color:{{x.bc}};color:{{x.fc}};padding:3px;width:100%;cursor:pointer;" ng-click="vm.selSpecial(x)">{{x.stitle}}</label><br></div></div></div><br><button ng-click="vm.addSpecial()" class="btn btn-primary">Add Special</button>'),e.put("app/layout/Partials/about.html",'<div ui-view="navbar"></div><div class="container"><div class="jumbotron"><br><div class="row"><div class="col-sm-0 col-md-2 col-lg-3"></div><div class="col-sm-12 col-md-8 col-lg-6"><img src="{{vm.logoimage}}" class="displayed-uc" alt="Cinque Terre" style="width:100%;height:{{vm.sm ? \'100px\':\'200px\'}}"></div><div class="col-sm-0 col-md-2 col-lg-3"></div></div><br><br><p>Rank-X collects users preferences to generate truly collective rankings on all things that are important to you.</p><br></div><div class="well"><div class="form-group text-left"><p>San Diego, CA - 2016</p><p>Contact: contact@rank-x.com</p></div></div><br><div class="form-group text-center"><button type="button" class="btn btn-primary" ng-click="vm.goBack()">Back</button></div></div><footer class="footer"><div class="container"><p class="text-muted">Rank-X is property of Rank-X LLC. San Diego, CA - 2016</p></div></footer>'),e.put("app/layout/Partials/city-selection.html",'<div class="modal fade" id="selectCityModal" tabindex="-1" role="dialog" aria-labelledby="selectCityModalLabel"><div class="modal-dialog" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="selectCityModalLabel">Select City</h4></div><div class="modal-body" style="height: 250px"><div class="col-md-12" style="height: 250px"><div class="col-md-6"><input placeholder="Search City" class="form-control" ng-model="searchCity"></div><div class="clearfix" style="margin-bottom: 24px"></div><div class="col-md-3" ng-repeat="city in cities | searchObject : searchCity : \'name\' | orderObjectBy : \'name\'"><a href="#" ng-click="selectCity(city)" ng-if="city.is_active">{{city.name}}</a></div><div class="col-md-12 text-center" style="height: 150px;padding-top: 50px" ng-if="(cities | searchObject : searchCity : \'name\' | objectLength) == 0"><span class="text-muted">City not found.</span></div></div></div></div></div></div>'),e.put("app/layout/Partials/cwrapper.html",'<div class="input-group" style="width:100%"><div class="text-center" style="display:{{vm.isAdmin ? \'inline\':\'none\'}}"><div class="btn-group col-sm-6 col-md-6"><button class="btn btn-primary {{vm.selEditRank}}" ng-click="vm.editRank()">Edit Mode</button> <button class="btn btn-primary {{vm.selViewRank}}" ng-click="vm.viewRank()">View Mode</button></div><button class="btn btn-danger" ng-click="vm.applyRule()">apply Rule</button></div><br style="display:{{vm.isAdmin ? \'inline\':\'none\'}}"><br style="display:{{vm.isAdmin ? \'inline\':\'none\'}}"><br style="display:{{vm.isAdmin ? \'inline\':\'none\'}}"></div><div class="row" ng-if="!vm.fbm"><div class="text-center col-sm-12 col-md-4" ng-if="!vm.hidelogo"><div class="btn-group"><button class="btn btn-default {{vm.isCity ? \'active\':\'\'}}" ng-click="vm.switchScope(1)">San Diego</button> <button class="btn btn-default {{vm.isNh ? \'active\':\'\'}}" ng-click="vm.switchScope(2)">Neighborhood</button></div></div><div class="col-sm-12 col-md-8" style="display:{{(vm.isNhRdy || vm.isCity) ? \'inline\':\'none\'}}"><div class="input-group" style="padding:10px;background-color:{{vm.querybc}}"><input type="text" class="form-control" placeholder="Search in {{vm.searchScope}}" ng-model="vm.val" ng-change="vm.refreshRanks()" id="SearchInput"><div class="input-group-btn"><button class="btn btn-default" type="submit"><i class="glyphicon glyphicon-search"></i></button></div></div></div></div><div style="display:{{vm.isNh ? \'inline\':\'none\'}}" ng-if="!vm.fbm"><br><div class="dropdown"><button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown" id="nhdropdown" style="width:200px">{{vm.cnh}} <span class="caret"></span></button><ul class="dropdown-menu dropdown-menu-middle"><li ng-repeat="x in vm.nhs | orderBy: x" ng-click="vm.selnh(x)"><a>{{x}}</a></li></ul></div></div><div style="display:{{vm.searchActive ? \'inline\':\'none\'}}" ng-if="!vm.fbm"><content-block type="query" dynamic="true"></content-block></div><br ng-if="vm.isNh"><div style="display:{{((vm.isNhRdy || vm.isCity) && (vm.searchActive == false)) ? \'inline\':\'none\'}}" ng-if="!vm.fbm"><content-block type="rankofweek" dynamic="false" rankofweek="true"></content-block><table class="table" style="border-style:none" ng-if="vm.isCity"><tbody><thead><tr><th style="background-color:#595959;color:#f8f8ff;width:50%;border-style:none">Quick Links</th></tr></thead></tbody></table><div class="text-center" ng-if="vm.isCity"><button class="btn btn-danger" ng-click="vm.foodNearMe()">Food near me</button> <button class="btn btn-primary" ng-click="vm.events()">Events</button> <button class="btn btn-success" ng-click="vm.selfimprove()">I feel lucky</button></div><br ng-if="vm.isCity"><table class="table" style="border-style:none" ng-if="vm.isCity"><tbody><thead><tr><th style="background-color:#595959;color:#f8f8ff;width:50%">Feed <span class="nomargin"><button type="button" class="btn btn-default pull-right" style="vertical-align:middle;" ng-click="vm.refreshFeed()"><span class="glyphicon glyphicon-refresh" style="padding-top:0px;padding-bottom:0px;" aria-hidden="true"></span></button></span></th></tr></thead></tbody></table><div ng-repeat="x in vm.feeds | orderBy:\'-id\' | limitTo:vm.fres" ng-if="vm.isCity"><div class="row" style="margin:4px"><div class="usericon col-xs-2 col-sm-2 col-md-1 col-lg-1" style="background-color:{{x.bc}};color:{{x.fc}};" align="middle">{{x.initials}}</div><div class="col-xs-10 col-sm-10 col-md-11 col-lg-11"><div ng-if="x.action == \'addedAnswer\'">added <a href="#/answerDetail/{{x.answer}}">{{x.text1}}</a> to <a href="#/rankSummary/{{x.category}}">{{x.text2}}</a>.</div><div ng-if="x.action == \'upVoted\'">endorsed <a href="#/answerDetail/{{x.answer}}">{{x.text1}}</a> in <a href="#/rankSummary/{{x.category}}">{{x.text2}}</a>.</div><div ng-if="x.action == \'downVoted\'">voted down <a href="#/answerDetail/{{x.answer}}">{{x.text1}}</a> in <a href="#/rankSummary/{{x.category}}">{{x.text2}}</a>.</div><div ng-if="x.action == \'commentR\'">posted a comment in <a href="#/rankSummary/{{x.category}}">{{x.text2}}</a>.</div><div ng-if="x.action == \'commentA\'">posted a comment for <a href="#/answerDetail/{{x.answer}}">{{x.text1}}</a>.</div><div ng-if="x.action == \'editA\'">edited the information of <a href="#/answerDetail/{{x.answer}}">{{x.text1}}</a>.</div><div ng-if="x.action == \'upVotedVrow\'">endorsed the <em>{{x.text2}}</em> of <a href="#/answerDetail/{{x.answer}}">{{x.text1}}</a>.</div><div ng-if="x.action == \'downVotedVrow\'">voted down the <em>{{x.text2}}</em> of <a href="#/answerDetail/{{x.answer}}">{{x.text1}}</a>.</div><div ng-if="x.action == \'binded\'">binded account to <a href="#/answerDetail/{{x.answer}}">{{x.text1}}</a>.</div></div></div></div><p class="text-right" style="color:blue;" ng-click="vm.seeMoreFeed()" ng-if="vm.isCity">&lt;&lt;{{vm.ftext}}&gt;&gt;</p><br><div class="row"><div class="col-lg-6"><content-block type="lifestyle" dynamic="false"></content-block></div><div class="col-lg-6"><content-block type="social" dynamic="false"></content-block></div></div><div class="row"><div class="col-lg-6"><content-block type="food" dynamic="false"></content-block></div><div class="col-lg-6"><content-block type="health" dynamic="false"></content-block></div></div><div class="row"><div class="col-lg-6"><content-block type="politics" dynamic="false"></content-block></div><div class="col-lg-6"><content-block type="sports" dynamic="false"></content-block></div></div><div class="row"><div class="col-lg-6"><content-block type="city" dynamic="false"></content-block></div><div class="col-lg-6"><content-block type="personalities" dynamic="false"></content-block></div></div><div class="row"><div class="col-lg-6"><content-block type="beauty" dynamic="false"></content-block></div><div class="col-lg-6"><content-block type="services" dynamic="false"></content-block></div></div><div class="row"><div class="col-lg-6"><content-block type="neighborhood" dynamic="false"></content-block><content-block type="technology" dynamic="false"></content-block></div><div class="col-lg-6"><content-block type="dating" dynamic="false"></content-block></div></div></div><div ng-if="vm.fbm"><div class="well-small" style="background-color:#d9d9d9;color:#24478f; padding:5px;"><p>Thanks for visiting Rank-X. You can use the ranks below to give us feedback and suggestions or you can also reach us by email at: <strong>contact@rank-x.com</strong>.</p></div><br><div class="row"><div class="col-lg-6"><content-block type="rxfeedback" dynamic="false"></content-block></div><div class="col-lg-6"><content-block type="rxsuggestion" dynamic="false"></content-block></div></div><div class="text-right"><button class="btn btn-default" ng-click="vm.goHome()">Home</button></div></div>'),e.put("app/layout/Partials/feedback.html",'<div class="row"><div class="col-lg-6"><content-block type="rxfeedback" dynamic="false"></content-block></div><div class="col-lg-6"><content-block type="rxsuggestion" dynamic="false"></content-block></div></div>'),e.put("app/layout/Partials/layout.html",'<div ui-view="navbar"></div><div class="container"><div id="veil" ng-show="vm.isLoading"></div><div id="feedLoading" ng-show="vm.isLoading"><div style="text-align: center" ng-if="vm.isLoading"><div class="loading-pulse"></div><p style="font-size:large">{{vm.veilMsg}}</p></div></div><div class="container-fluid" ng-hide="vm.isLoading"><br ng-if="!vm.sm"><div class="row"><div class="col-sm-0 col-md-1 col-lg-1"></div><div class="col-sm-12 col-md-10 col-lg-10"><img src="{{vm.logoimage}}" style="width:100%;max-height:275px" ng-if="!vm.hidelogo"></div><div class="col-sm-0 col-md-1 col-lg-1"></div></div><br ng-if="!vm.hidelogo"><div ui-view="" ng-if="!vm.isLoading"></div><br></div></div><br><footer class="footer"><div class="container"><p class="text-muted">Rank-X is a registered trademark property of Rank-X LLC. San Diego, CA - 2016</p></div></footer>'),e.put("app/layout/Partials/mybiz.html",'<div ui-view="navbar"></div><div class="panel panel-primary signin-card"><div class="panel-heading"><h3 class="text-center">Grow your Customer Base with Rank-X</h3><h1 class="text-center">Business Registration</h1></div><div class="panel-body"><p>{{vm.user.name}}</p><p>{{vm.user.email}}</p><div class="form-group text-center"><button type="button" class="btn btn-primary" ng-click="showpremium=true;vm.setupFreeBillingAccount();">Learn More</button><div ng-show="showpremium"><h2>Grow Your Business</h2><p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p><form action="http://localhost:3000/charge" method="POST"><script src="https://checkout.stripe.com/checkout.js" class="stripe-button" data-key="pk_test_q9kbYzvzE6uMwZH9ZUjfK6Xq" data-amount="999" data-name="Rank-X" data-description="Subscription Upgrade" data-email="{{vm.user.email}}" data-image="https://stripe.com/img/documentation/checkout/marketplace.png" data-locale="auto" data-zip-code="true">\r\n      					  </script><input type="hidden" id="userEmail" name="userEmail" value="{{vm.user.email}}"></form><br><a ng-click="showpremium=false">maybe later</a></div></div></div></div>'),e.put("app/layout/Partials/navbar.html",'<nav class="navbar navbar-inverse"><div class="container"><div class="navbar-header"><button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar"><span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span></button> <a class="navbar-brand" ng-click="vm.gotoHome()" style="cursor:pointer">Home</a> <a class="navbar-brand" ng-show="vm.user"><i class="fa fa-user"></i> Welcome {{vm.user.first_name}}</a> <a class="navbar-brand" ng-if="vm.warning" style="background-color:#33cccc;color:black;margin:2px" ng-click="vm.goWarning()"><i class="fa fa-warning"></i></a> <a class="navbar-brand" ng-if="vm.coordsRdy" ng-click="vm.goCoords()"><i class="fa fa-location-arrow"></i></a></div><div id="navbar" class="navbar-collapse collapse"><ul class="nav navbar-nav navbar-right"><li ng-show="!vm.isLoggedIn"><a href="#/login">Login</a></li><li ng-show="vm.isLoggedIn"><a href="" ng-click="vm.logout()">Logout</a></li></ul><ul class="nav navbar-nav navbar-right"><li><a href="" ng-click="vm.gotoAbout()">About</a></li><li><a href="" ng-click="vm.gotoFeedback()">Feedback</a></li></ul></div></div></nav>'),e.put("app/login/partials/add-user-detail.html",'<div class="modal fade" id="addUserDetailModal" tabindex="-1" role="dialog" aria-labelledby="addUserDetailModalLabel"><div class="modal-dialog" role="document"><div class="modal-content"><div class="modal-header"><h4 class="modal-title" id="addUserDetailModalLabel">Add User Detail</h4></div><div class="modal-body" style="height: 214px"><div class="col-md-12"><form class="form-horizontal" role="form" name="answerForm"><div class="col-md-12"><div class="form-group"><label for="birthdate">Birth Date:</label><datepicker date-year-title="selected year" date-max-limit="{{maxDate}}" date-format="yyyy/MM/dd" date-month-title="selected year"><input id="birthdate" ng-model="user.birth_date" class="form-control"></datepicker></div><div class="form-group"><label>Gender:</label><div class="clearfix"></div><label class="radio-inline"><input name="gender" type="radio" value="Male" ng-model="user.gender">Male</label> <label class="radio-inline"><input name="gender" type="radio" value="Female" ng-model="user.gender">Female</label> <label class="radio-inline"><input name="gender" type="radio" value="Other" ng-model="user.gender">Other</label></div><div class="row form-group"><button type="submit" class="btn btn-success" ng-click="addUserDetail()">Add Detail</button><p class="hiw" ng-click="whyThisInfoDialog()"><u>why you need this?</u></p></div></div></form></div></div></div></div></div>'),e.put("app/login/partials/bizlogin.html",'<div class="panel panel-primary signin-card"><div class="panel-heading"><h1 class="text-center">Rank-X</h1><h1 class="text-center">Business Registration</h1></div><div class="panel-body"><form ng-submit="vm.submit()" ng-if="!vm.isProgressing"><div class="form-group"><label>Email</label> <input type="email" class="form-control" ng-model="vm.username"></div><div class="form-group"><label>Password</label> <input type="password" class="form-control" ng-model="vm.password"></div><div class="form-group text-right"><button type="submit" class="btn btn-primary">Sign In</button></div></form><div style="text-align: center" ng-if="vm.isProgressing"><div class="loading-pulse"></div><p class="text-muted">Loading...</p></div></div></div>'),e.put("app/login/partials/login.html",'<div class="panel panel-primary signin-card"><div class="panel-heading"><img src="../../../assets/images/rankxlogo_login.png" style="width:100%; padding:10px;"></div><div class="panel-body"><form ng-submit="vm.submit()" ng-if="!vm.isProgressing"><div class="form-group text-center"><button type="button" class="btn btn-primary form-control" ng-click="vm.redirectForFacebook()"><i class="fa fa-facebook"></i> Login</button><br><br><button type="button" class="btn btn-default form-control" style="vertical-align:middle;" ng-click="vm.goBack()">Cancel</button></div><br><p class="hiw" ng-click="vm.whyFacebookDialog()"><u>why Facebook?</u></p></form><div style="text-align: center" ng-if="vm.isProgressing"><div class="loading-pulse"></div><p class="text-muted">Loading...</p></div></div></div>'),e.put("app/login/partials/register.html",'<div class="panel panel-primary signin-card"><div class="panel-heading"><h1 class="text-center">Register</h1></div><div class="panel-body"><form name="registerForm"><div class="form-group"><label>First Name</label> <input type="text" name="firstName" class="form-control" ng-model="vm.firstName"></div><div class="form-group"><label>Last Name</label> <input type="text" name="lastName" class="form-control" ng-model="vm.lastName"></div><div class="form-group"><label>Email</label> <input type="email" class="form-control" ng-model="vm.username"></div><div class="form-group"><label>Password</label> <input type="password" name="password" class="form-control" ng-model="vm.password"></div><div class="form-group"><label>Confirm Password</label> <input type="password" name="confirm" class="form-control" ng-model="vm.confirm"></div><div class="form-group text-right"><button type="submit" class="btn btn-primary" ng-click="vm.signIn()">Sign In</button> <button type="button" class="btn btn-primary" ng-click="vm.register()">Register</button></div></form></div></div>'),e.put("app/rank/Partials/RankChat.html",'<div class="container"><div class="row"><div class="col-md-6"><h1 class="page-heading">This is a test</h1></div></div></div>'),e.put("app/rank/Partials/RankSummary.html",'<div class="container"><div class="well-rank" ng-if="vm.nsm"><h2 class="sub-header">{{vm.ranking}} <span class="nomargin"><button type="button" class="btn btn-default pull-right" style="vertical-align:middle;" ng-click="vm.closeRank()"><span class="glyphicon glyphicon-remove" style="padding-top:0px;padding-bottom:0px;" aria-hidden="true"></span></button></span></h2></div><div class="well-rank" ng-if="vm.sm"><h3 class="sub-header">{{vm.ranking}} <span class="nomargin"><button type="button" class="btn btn-default pull-right" style="vertical-align:middle;" ng-click="vm.closeRank()"><span class="glyphicon glyphicon-remove" style="padding-top:0px;padding-bottom:0px;" aria-hidden="true"></span></button></span></h3></div></div><br><div class="row" style="display:{{vm.isShortPhrase == false? \'inline\':\'none\'}}"><div class="col-sm-6 col-md-6 col-lg-4"><img class="displayed" src="{{vm.image1}}" ng-if="vm.image1ok" style="width:100%;max-height:200px;display:{{vm.image1 != undefined ? \'inline\':\'none\'}}"></div><div class="hidden-xs col-sm-6 col-md-6 col-lg-4"><img class="displayed" src="{{vm.image2}}" ng-if="vm.image2ok" style="width:100%;max-height:200px;display:{{vm.image2 != undefined ? \'inline\':\'none\'}}"></div><div class="hidden-xs hidden-sm hidden-md col-lg-4"><img class="displayed" src="{{vm.image3}}" ng-if="vm.image3ok" style="width:100%;max-height:200px;display:{{vm.image3 != undefined ? \'inline\':\'none\'}}"></div></div><div class="row" style="display:{{vm.isShortPhrase == true? \'inline\':\'none\'}}"><div class="col-sm-6 col-md-6 col-lg-4"><div class="container-answer" style="width:100%; max-height:300px;"><br><h2 style="text-align:center"><strong>{{vm.title1}}</strong></h2><br><h4 style="text-align:center">{{vm.addinfo1}}</h4></div></div><div class="hidden-xs col-sm-6 col-md-6 col-lg-4"><div class="container-answer" style="width:100%; max-height:300px;"><br><h2 style="text-align:center"><strong>{{vm.title2}}</strong></h2><br><h4 style="text-align:center">{{vm.addinfo2}}</h4></div></div><div class="hidden-xs hidden-sm hidden-md col-lg-4"><div class="container-answer" style="width:100%; max-height:300px;"><br><h2 style="text-align:center"><strong>{{vm.title3}}</strong></h2><br><h4 style="text-align:center">{{vm.addinfo3}}</h4></div></div></div><br><div class="text-center"><a href="http://twitter.com/home?status=" title="Share in Twitter" target="_blank" class="btn btn-twitter"><i class="fa fa-twitter"></i></a><a href="https://www.facebook.com/sharer/sharer.php" title="Share in Facebook" target="_blank" class="btn btn-facebook"><i class="fa fa-facebook">acebook</i></a><a href="https://plus.google.com/share?url=" title="Share in Google+" target="_blank" class="btn btn-googleplus"><i class="fa fa-google-plus"></i></a></div><br class="hidden-md hidden-lg hidden-xl"><div class="row"><div class="btn-group col-sm-6 col-md-6"><div><p>Sort by: <span><button class="btn btn-default {{vm.selRank}}" ng-click="vm.sortByRank()" ng-if="vm.type != \'Event\' && !vm.fnm">Rank</button> <button class="btn btn-default {{vm.selUpV}}" ng-click="vm.sortByUpV()">Popular</button> <button class="btn btn-default {{vm.selDistance}}" ng-click="vm.sortByDistance()" ng-show="{{vm.type == \'Establishment\'}}">Distance</button> <button class="btn btn-default {{vm.selDate}}" ng-click="vm.sortByDate()" ng-show="{{vm.type == \'Event\'}}">Date</button></span></p></div></div><div class="btn-group text-right col-sm-6 col-md-6"><h4>Contributors: <b style="color:blue;"><i>{{vm.numContributors}}</i></b></h4></div></div><div class="text-center"><button ng-click="vm.goRank()" class="btn btn-success {{vm.rankDisabled}}">Rank</button></div><br><table class="table table-hover cursor"><tbody><thead><tr><th>{{vm.showR ? \'Rank\' : \'Votes\'}}</th><th ng-show="{{!vm.sm && !vm.fnm && !vm.isE}}">Votes</th><th class="capitalize" ng-repeat="h in vm.fields | filter:{isrequired:true}">{{h.label}}</th><th ng-show="{{vm.type == \'Establishment\' && vm.haveLocation}}">Distance (mi)</th><th ng-show="{{vm.type == \'Event\'}}">Date</th><th ng-show="{{vm.type == \'Establishment\'}}">Specials</th></tr></thead><tbody><tr ng-repeat="x in vm.answers track by $index" ng-click="vm.answerDetail(x)"><td>{{vm.showR ? x.Rank : x.upV}}</td><td ng-show="{{!vm.sm && !vm.fnm && !vm.isE}}">{{x.upV}}</td><td ng-repeat="h in vm.fields | filter:{isrequired:true}">{{ x[h.name]}}</td><td ng-show="{{vm.type == \'Establishment\' && vm.haveLocation}}">{{x.dist}}</td><td ng-show="{{vm.type == \'Event\'}}">{{x.date}}</td><td ng-show="{{vm.type == \'Establishment\'}}" style="background-color:{{x.sp_bc}};color:{{x.sp_fc}}">{{x.sp_title}}</td></tr></tbody></tbody></table><div class="row"><div class="col-sm-1"><a class="btn btn-primary" ng-click="vm.addAnswer()">+</a></div><div class="col-sm-11" style="display:{{vm.addInfoMsgAck == false ? \'inline\':\'none\'}}"><div class="alert alert-warning" style="padding-top: 5px;padding-bottom: 5px;"><a class="close" data-dismiss="alert" aria-label="close" ng-click="vm.closeAddInfoMsg()">&times;</a> <span class="glyphicon glyphicon-arrow-left"></span><strong>&nbsp;&nbsp;Are we missing one?</strong>&nbsp;&nbsp;Use the \'+\' button to add a new <span ng-if="vm.type == \'Establishment\'">Establishment to this list.</span> <span ng-if="vm.type == \'Organization\'">Organization or Company to this list.</span> <span ng-if="vm.type == \'Person\'">Person to this list.</span> <span ng-if="vm.type == \'PersonCust\'">Professional to this list.</span> <span ng-if="vm.type == \'Place\'">Place to this list.</span> <span ng-if="vm.type == \'Short-Phrase\'">Answer to this list.</span> <span ng-if="vm.type == \'Thing\'">Item to this list.</span> <span ng-if="vm.type == \'Event\'">Event to this list.</span></div></div></div><br><br><div class="text-center"><button ng-click="vm.loadComments()" class="btn btn-default" style="background-color:#e6e6e6;width:100%">COMMENTS ({{vm.numcom}})</button></div><br><div style="display:{{vm.cm.commLoaded ? \'inline\':\'none\'}}"><div ng-repeat="x in vm.cm.comments"><div class="row"><div class="usericon col-xs-2 col-sm-2 col-md-1 col-lg-1" style="background-color:{{x.bc}};color:{{x.fc}};" align="middle">{{x.initials}}</div><div class="col-xs-10 col-sm-10 col-md-11 col-lg-11">{{x.body}}<br><small style="color:#bfbfbf">{{x.username}} - {{x.date}}&nbsp&nbsp <span class="dropdown"><i type="button" class="fa fa-flag dropdown-toggle" data-toggle="dropdown"></i><ul class="dropdown-menu dropdown-menu-left"><li><a ng-click="vm.cmFlag(1)">Off-Topic</a></li><li><a ng-click="vm.cmFlag(2)">Offensive</a></li><li><a ng-click="vm.cmFlag(3)">Spam</a></li></ul></span></small></div></div><br></div><div style="display:{{(vm.cm.commLoaded && vm.cm.comments.length == 0 && !vm.isLoggedIn) ? \'inline\':\'none\'}}"><br><p><small>Nobody has commented yet. Be the first. Log in, endorse answers and leave a comment.</small></p></div><div style="display:{{(vm.cm.commLoaded && vm.cm.comments.length > 0 && !vm.isLoggedIn) ? \'inline\':\'none\'}}"><br><p><small>You must log in and endorse one or more answers to leave a comment.</small></p></div><div style="display:{{(vm.cm.commLoaded && vm.isLoggedIn && !vm.commentAllowed) ? \'inline\':\'none\'}}"><br><p><small>Endorse one or more answers to leave a comment.</small></p></div><div style="display:{{(vm.isLoggedIn && vm.commentAllowed) ? \'inline\':\'none\'}}"><div class="row"><div class="usericon col-xs-2 col-sm-2 col-md-1 col-lg-1" style="background-color:{{vm.cm.bc}};color:{{vm.cm.fc}};" align="middle">{{vm.cm.initials}}</div><div class="col-xs-10 col-sm-10 col-md-11 col-lg-11"><textarea class="form-control" ng-model="vm.cm.newComment" placeholder="Leave a comment" style="margin-left:0px;margin-right:0px;"></textarea></div></div><div class="text-right"><button ng-click="vm.postComment()" class="btn btn-primary">Post</button></div></div></div>'),
e.put("app/rank/Partials/editRanking.html",'<div class="container"><div class="well-rank" ng-if="vm.nsm"><h2 class="sub-header">{{vm.ranking}} <span class="nomargin"><button type="button" class="btn btn-default pull-right" style="vertical-align:middle;" ng-click="vm.closeRank()"><span class="glyphicon glyphicon-remove" style="padding-top:0px;padding-bottom:0px;" aria-hidden="true"></span></button></span></h2></div><div class="well-rank" ng-if="vm.sm"><h3 class="sub-header">{{vm.ranking}} <span class="nomargin"><button type="button" class="btn btn-default pull-right" style="vertical-align:middle;" ng-click="vm.closeRank()"><span class="glyphicon glyphicon-remove" style="padding-top:0px;padding-bottom:0px;" aria-hidden="true"></span></button></span></h3></div></div><h4>Edit Ranking</h4><br><label><strong>Title:</strong></label> <input class="form-control" ng-model="vm.rankTitle" type="text" placeholder="{{vm.rankTitle}}"> <label><strong>Question:</strong></label> <input class="form-control" ng-model="vm.question" type="text" placeholder="{{vm.question}}"> <label><strong>Tags:</strong></label> <input class="form-control" ng-model="vm.tags" type="text" placeholder="{{vm.tags}}"> <label><strong>Keywords:</strong></label> <input class="form-control" ng-model="vm.keywords" type="text" placeholder="{{vm.keywords}}"> <label><strong>AnswerTags:</strong></label> <input class="form-control" ng-model="vm.answertags" type="text" placeholder="{{vm.answertags}}"> <label><strong>IsAtomic:</strong></label> <input class="form-control" ng-model="vm.isatomic" type="text" placeholder="{{vm.isatomic}}"> <label><strong>Category-Strings:</strong></label> <input class="form-control" ng-model="vm.catstr" type="text" placeholder="{{vm.catstr}}"> <label><strong>Type:</strong></label> <input class="form-control" ng-model="vm.type" bs-typeahead="" type="text" placeholder="{{vm.type}}" bs-options="c for c in vm.typeList"><br><div class="form-group text-right"><button type="button" class="btn btn-primary" ng-click="vm.goEdit()">Edit</button> <button type="button" class="btn btn-danger" ng-click="vm.goDelete()">Delete</button></div><br>'),e.put("app/rank/Partials/match.html",'<div class="container"><div class="well-sm"><h3 class="sub-header">{{vm.ranking}} <span class="nomargin"><button type="button" class="btn btn-default pull-right" style="vertical-align:middle;" ng-click="vm.closeRank()"><span class="glyphicon glyphicon-remove" style="padding-top:0px;padding-bottom:0px;" aria-hidden="true"></span></button></span></h3></div></div><h3>{{vm.table.question}}</h3><div class="form-group text-center"><div class="well well-dark">Match <strong>{{vm.GP}}</strong> of <strong>{{vm.Tot}}</strong></div></div><div class="row"><div class="col-xs-6 col-md-6 col-lg-6"><div class="well well-light" ng-click="vm.selectAnswer(1)" ng-show="{{vm.type != \'Short-Phrase\'}}"><span ng-repeat="f in vm.fields | filter:(f.isrequired=true)">{{(f.name == "name" && vm.answer1.name) ? vm.answer1.name : ""}} {{(f.name == "cityarea" && vm.answer1.cityarea) ? " - "+ vm.answer1.cityarea : ""}}</span></div><img class="displayed" src="{{vm.answer1.imageurl}}" ng-click="vm.selectAnswer(1)" style="width:100%;max-height:300px" ng-show="{{vm.type != \'Short-Phrase\'}}"><div class="container-answer" style="width:100%; height:auto;" ng-click="vm.selectAnswer(1)" ng-show="{{vm.type == \'Short-Phrase\'}}"><br><h2 style="text-align:center"><strong>{{vm.answer1.name}}</strong></h2><br><h4 style="text-align:center">{{vm.answer1.addinfo}}</h4></div></div><div class="col-xs-6 col-md-6 col-lg-6"><div class="well well-light" ng-click="vm.selectAnswer(2)" ng-show="{{vm.type != \'Short-Phrase\'}}"><span ng-repeat="f in vm.fields | filter:(f.isrequired=true)">{{(f.name == "name" && vm.answer2.name) ? vm.answer2.name : ""}} {{(f.name == "cityarea" && vm.answer2.cityarea) ? " - "+ vm.answer2.cityarea : ""}}</span></div><img class="displayed" src="{{vm.answer2.imageurl}}" ng-click="vm.selectAnswer(2)" style="width:100%;max-height:300px" ng-show="{{vm.type != \'Short-Phrase\'}}"><div class="container-answer" style="width:100%; height:auto;" ng-click="vm.selectAnswer(2)" ng-show="{{vm.type == \'Short-Phrase\'}}"><br><h2 style="text-align:center"><strong>{{vm.answer2.name}}</strong></h2><br><h4 style="text-align:center">{{vm.answer2.addinfo}}</h4></div></div></div><br><div class="row"><div class="form-group text-left col-xs-6 col-md-6 col-lg-6"><button ng-click="vm.answerDetail(1)" type="button" class="btn btn-success">Details</button></div><div class="form-group text-right col-xs-6 col-md-6 col-lg-6"><button ng-click="vm.answerDetail(2)" type="button" class="btn btn-success">Details</button></div></div><div class="form-group text-center"><button ng-click="vm.skipMatch()" type="button" class="btn btn-default">I don\'t know, Skip</button> <button ng-click="vm.rankSummary()" type="button" class="btn btn-danger">Stop</button></div><br>')}]);